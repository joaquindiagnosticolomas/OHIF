!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@cornerstonejs/core"),require("@kitware/vtk.js/Common/DataModel/PiecewiseFunction"),require("@kitware/vtk.js/Rendering/Core/ColorTransferFunction"),require("@kitware/vtk.js/Common/Core/DataArray"),require("@kitware/vtk.js/Filters/General/AppendPolyData"),require("@kitware/vtk.js/Common/Core/CellArray"),require("@kitware/vtk.js/Common/Core/Points"),require("@kitware/vtk.js/Common/DataModel/PolyData"),require("@kitware/vtk.js/Rendering/Core/Actor"),require("@kitware/vtk.js/Rendering/Core/Mapper"),require("gl-matrix"),require("@kitware/vtk.js/Common/Core/Math"),require("@kitware/vtk.js/Common/Core/MatrixBuilder")):"function"==typeof define&&define.amd?define(["@cornerstonejs/core","@kitware/vtk.js/Common/DataModel/PiecewiseFunction","@kitware/vtk.js/Rendering/Core/ColorTransferFunction","@kitware/vtk.js/Common/Core/DataArray","@kitware/vtk.js/Filters/General/AppendPolyData","@kitware/vtk.js/Common/Core/CellArray","@kitware/vtk.js/Common/Core/Points","@kitware/vtk.js/Common/DataModel/PolyData","@kitware/vtk.js/Rendering/Core/Actor","@kitware/vtk.js/Rendering/Core/Mapper","gl-matrix","@kitware/vtk.js/Common/Core/Math","@kitware/vtk.js/Common/Core/MatrixBuilder"],t):"object"==typeof exports?exports.cornerstoneTools3D=t(require("@cornerstonejs/core"),require("@kitware/vtk.js/Common/DataModel/PiecewiseFunction"),require("@kitware/vtk.js/Rendering/Core/ColorTransferFunction"),require("@kitware/vtk.js/Common/Core/DataArray"),require("@kitware/vtk.js/Filters/General/AppendPolyData"),require("@kitware/vtk.js/Common/Core/CellArray"),require("@kitware/vtk.js/Common/Core/Points"),require("@kitware/vtk.js/Common/DataModel/PolyData"),require("@kitware/vtk.js/Rendering/Core/Actor"),require("@kitware/vtk.js/Rendering/Core/Mapper"),require("gl-matrix"),require("@kitware/vtk.js/Common/Core/Math"),require("@kitware/vtk.js/Common/Core/MatrixBuilder")):e.cornerstoneTools3D=t(e.cornerstone3D,e["@kitware/vtk.js/Common/DataModel/PiecewiseFunction"],e["@kitware/vtk.js/Rendering/Core/ColorTransferFunction"],e["@kitware/vtk.js/Common/Core/DataArray"],e["@kitware/vtk.js/Filters/General/AppendPolyData"],e["@kitware/vtk.js/Common/Core/CellArray"],e["@kitware/vtk.js/Common/Core/Points"],e["@kitware/vtk.js/Common/DataModel/PolyData"],e["@kitware/vtk.js/Rendering/Core/Actor"],e["@kitware/vtk.js/Rendering/Core/Mapper"],e.window,e["@kitware/vtk.js/Common/Core/Math"],e["@kitware/vtk.js/Common/Core/MatrixBuilder"])}(self,(function(e,t,n,r,o,a,i,l,c,s,d,u,v){return function(){var f={162:function(e,t,n){e.exports=n(47)},907:function(e,t,n){e=n.nmd(e);var r="__lodash_hash_undefined__",o=9007199254740991,a="[object Arguments]",i="[object Boolean]",l="[object Date]",c="[object Function]",s="[object GeneratorFunction]",d="[object Map]",u="[object Number]",v="[object Object]",f="[object Promise]",g="[object RegExp]",h="[object Set]",p="[object String]",m="[object Symbol]",w="[object WeakMap]",E="[object ArrayBuffer]",y="[object DataView]",I="[object Float32Array]",b="[object Float64Array]",C="[object Int8Array]",T="[object Int16Array]",_="[object Int32Array]",O="[object Uint8Array]",D="[object Uint8ClampedArray]",S="[object Uint16Array]",x="[object Uint32Array]",k=/\w*$/,M=/^\[object .+?Constructor\]$/,R=/^(?:0|[1-9]\d*)$/,P={};P[a]=P["[object Array]"]=P[E]=P[y]=P[i]=P[l]=P[I]=P[b]=P[C]=P[T]=P[_]=P[d]=P[u]=P[v]=P[g]=P[h]=P[p]=P[m]=P[O]=P[D]=P[S]=P[x]=!0,P["[object Error]"]=P[c]=P[w]=!1;var N="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,A="object"==typeof self&&self&&self.Object===Object&&self,L=N||A||Function("return this")(),U=t&&!t.nodeType&&t,V=U&&e&&!e.nodeType&&e,B=V&&V.exports===U;function j(e,t){return e.set(t[0],t[1]),e}function H(e,t){return e.add(t),e}function W(e,t,n,r){var o=-1,a=e?e.length:0;for(r&&a&&(n=e[++o]);++o<a;)n=t(n,e[o],o,e);return n}function F(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function G(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}function q(e,t){return function(n){return e(t(n))}}function z(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}var K,Y=Array.prototype,J=Function.prototype,$=Object.prototype,Z=L["__core-js_shared__"],X=(K=/[^.]+$/.exec(Z&&Z.keys&&Z.keys.IE_PROTO||""))?"Symbol(src)_1."+K:"",Q=J.toString,ee=$.hasOwnProperty,te=$.toString,ne=RegExp("^"+Q.call(ee).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),re=B?L.Buffer:void 0,oe=L.Symbol,ae=L.Uint8Array,ie=q(Object.getPrototypeOf,Object),le=Object.create,ce=$.propertyIsEnumerable,se=Y.splice,de=Object.getOwnPropertySymbols,ue=re?re.isBuffer:void 0,ve=q(Object.keys,Object),fe=Le(L,"DataView"),ge=Le(L,"Map"),he=Le(L,"Promise"),pe=Le(L,"Set"),me=Le(L,"WeakMap"),we=Le(Object,"create"),Ee=He(fe),ye=He(ge),Ie=He(he),be=He(pe),Ce=He(me),Te=oe?oe.prototype:void 0,_e=Te?Te.valueOf:void 0;function Oe(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function De(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Se(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function xe(e){this.__data__=new De(e)}function ke(e,t,n){var r=e[t];ee.call(e,t)&&We(r,n)&&(void 0!==n||t in e)||(e[t]=n)}function Me(e,t){for(var n=e.length;n--;)if(We(e[n][0],t))return n;return-1}function Re(e,t,n,r,o,f,w){var M;if(r&&(M=f?r(e,o,f,w):r(e)),void 0!==M)return M;if(!Ke(e))return e;var R=Fe(e);if(R){if(M=function(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&ee.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!t)return function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(e,M)}else{var N=Ve(e),A=N==c||N==s;if(qe(e))return function(e,t){if(t)return e.slice();var n=new e.constructor(e.length);return e.copy(n),n}(e,t);if(N==v||N==a||A&&!f){if(F(e))return f?e:{};if(M=function(e){return"function"!=typeof e.constructor||je(e)?{}:Ke(t=ie(e))?le(t):{};var t}(A?{}:e),!t)return function(e,t){return Ne(e,Ue(e),t)}(e,function(e,t){return e&&Ne(t,Ye(t),e)}(M,e))}else{if(!P[N])return f?e:{};M=function(e,t,n,r){var o,a=e.constructor;switch(t){case E:return Pe(e);case i:case l:return new a(+e);case y:return function(e,t){var n=t?Pe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,r);case I:case b:case C:case T:case _:case O:case D:case S:case x:return function(e,t){var n=t?Pe(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,r);case d:return function(e,t,n){return W(t?n(G(e),!0):G(e),j,new e.constructor)}(e,r,n);case u:case p:return new a(e);case g:return function(e){var t=new e.constructor(e.source,k.exec(e));return t.lastIndex=e.lastIndex,t}(e);case h:return function(e,t,n){return W(t?n(z(e),!0):z(e),H,new e.constructor)}(e,r,n);case m:return o=e,_e?Object(_e.call(o)):{}}}(e,N,Re,t)}}w||(w=new xe);var L=w.get(e);if(L)return L;if(w.set(e,M),!R)var U=n?function(e){return function(e,t,n){var r=t(e);return Fe(e)?r:function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}(r,n(e))}(e,Ye,Ue)}(e):Ye(e);return function(e,t){for(var n=-1,r=e?e.length:0;++n<r&&!1!==t(e[n],n););}(U||e,(function(o,a){U&&(o=e[a=o]),ke(M,a,Re(o,t,n,r,a,e,w))})),M}function Pe(e){var t=new e.constructor(e.byteLength);return new ae(t).set(new ae(e)),t}function Ne(e,t,n,r){n||(n={});for(var o=-1,a=t.length;++o<a;){var i=t[o],l=r?r(n[i],e[i],i,n,e):void 0;ke(n,i,void 0===l?e[i]:l)}return n}function Ae(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function Le(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Ke(e)||(t=e,X&&X in t))&&(ze(e)||F(e)?ne:M).test(He(e));var t}(n)?n:void 0}Oe.prototype.clear=function(){this.__data__=we?we(null):{}},Oe.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},Oe.prototype.get=function(e){var t=this.__data__;if(we){var n=t[e];return n===r?void 0:n}return ee.call(t,e)?t[e]:void 0},Oe.prototype.has=function(e){var t=this.__data__;return we?void 0!==t[e]:ee.call(t,e)},Oe.prototype.set=function(e,t){return this.__data__[e]=we&&void 0===t?r:t,this},De.prototype.clear=function(){this.__data__=[]},De.prototype.delete=function(e){var t=this.__data__,n=Me(t,e);return!(n<0||(n==t.length-1?t.pop():se.call(t,n,1),0))},De.prototype.get=function(e){var t=this.__data__,n=Me(t,e);return n<0?void 0:t[n][1]},De.prototype.has=function(e){return Me(this.__data__,e)>-1},De.prototype.set=function(e,t){var n=this.__data__,r=Me(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},Se.prototype.clear=function(){this.__data__={hash:new Oe,map:new(ge||De),string:new Oe}},Se.prototype.delete=function(e){return Ae(this,e).delete(e)},Se.prototype.get=function(e){return Ae(this,e).get(e)},Se.prototype.has=function(e){return Ae(this,e).has(e)},Se.prototype.set=function(e,t){return Ae(this,e).set(e,t),this},xe.prototype.clear=function(){this.__data__=new De},xe.prototype.delete=function(e){return this.__data__.delete(e)},xe.prototype.get=function(e){return this.__data__.get(e)},xe.prototype.has=function(e){return this.__data__.has(e)},xe.prototype.set=function(e,t){var n=this.__data__;if(n instanceof De){var r=n.__data__;if(!ge||r.length<199)return r.push([e,t]),this;n=this.__data__=new Se(r)}return n.set(e,t),this};var Ue=de?q(de,Object):function(){return[]},Ve=function(e){return te.call(e)};function Be(e,t){return!!(t=null==t?o:t)&&("number"==typeof e||R.test(e))&&e>-1&&e%1==0&&e<t}function je(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||$)}function He(e){if(null!=e){try{return Q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function We(e,t){return e===t||e!=e&&t!=t}(fe&&Ve(new fe(new ArrayBuffer(1)))!=y||ge&&Ve(new ge)!=d||he&&Ve(he.resolve())!=f||pe&&Ve(new pe)!=h||me&&Ve(new me)!=w)&&(Ve=function(e){var t=te.call(e),n=t==v?e.constructor:void 0,r=n?He(n):void 0;if(r)switch(r){case Ee:return y;case ye:return d;case Ie:return f;case be:return h;case Ce:return w}return t});var Fe=Array.isArray;function Ge(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=o}(e.length)&&!ze(e)}var qe=ue||function(){return!1};function ze(e){var t=Ke(e)?te.call(e):"";return t==c||t==s}function Ke(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function Ye(e){return Ge(e)?function(e,t){var n=Fe(e)||function(e){return function(e){return function(e){return!!e&&"object"==typeof e}(e)&&Ge(e)}(e)&&ee.call(e,"callee")&&(!ce.call(e,"callee")||te.call(e)==a)}(e)?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],r=n.length,o=!!r;for(var i in e)!t&&!ee.call(e,i)||o&&("length"==i||Be(i,r))||n.push(i);return n}(e):function(e){if(!je(e))return ve(e);var t=[];for(var n in Object(e))ee.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}e.exports=function(e){return Re(e,!0,!0)}},485:function(e,t,n){var r,o="__lodash_hash_undefined__",a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/,l=/^\./,c=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,s=/\\(\\)?/g,d=/^\[object .+?Constructor\]$/,u="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,v="object"==typeof self&&self&&self.Object===Object&&self,f=u||v||Function("return this")(),g=Array.prototype,h=Function.prototype,p=Object.prototype,m=f["__core-js_shared__"],w=(r=/[^.]+$/.exec(m&&m.keys&&m.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",E=h.toString,y=p.hasOwnProperty,I=p.toString,b=RegExp("^"+E.call(y).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),C=f.Symbol,T=g.splice,_=N(f,"Map"),O=N(Object,"create"),D=C?C.prototype:void 0,S=D?D.toString:void 0;function x(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function k(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function M(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function R(e,t){for(var n,r,o=e.length;o--;)if((n=e[o][0])===(r=t)||n!=n&&r!=r)return o;return-1}function P(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map}function N(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){if(!B(e)||w&&w in e)return!1;var t=function(e){var t=B(e)?I.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}(e)||function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}(e)?b:d;return t.test(function(e){if(null!=e){try{return E.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}(n)?n:void 0}x.prototype.clear=function(){this.__data__=O?O(null):{}},x.prototype.delete=function(e){return this.has(e)&&delete this.__data__[e]},x.prototype.get=function(e){var t=this.__data__;if(O){var n=t[e];return n===o?void 0:n}return y.call(t,e)?t[e]:void 0},x.prototype.has=function(e){var t=this.__data__;return O?void 0!==t[e]:y.call(t,e)},x.prototype.set=function(e,t){return this.__data__[e]=O&&void 0===t?o:t,this},k.prototype.clear=function(){this.__data__=[]},k.prototype.delete=function(e){var t=this.__data__,n=R(t,e);return!(n<0||(n==t.length-1?t.pop():T.call(t,n,1),0))},k.prototype.get=function(e){var t=this.__data__,n=R(t,e);return n<0?void 0:t[n][1]},k.prototype.has=function(e){return R(this.__data__,e)>-1},k.prototype.set=function(e,t){var n=this.__data__,r=R(n,e);return r<0?n.push([e,t]):n[r][1]=t,this},M.prototype.clear=function(){this.__data__={hash:new x,map:new(_||k),string:new x}},M.prototype.delete=function(e){return P(this,e).delete(e)},M.prototype.get=function(e){return P(this,e).get(e)},M.prototype.has=function(e){return P(this,e).has(e)},M.prototype.set=function(e,t){return P(this,e).set(e,t),this};var A=U((function(e){var t;e=null==(t=e)?"":function(e){if("string"==typeof e)return e;if(j(e))return S?S.call(e):"";var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(t);var n=[];return l.test(e)&&n.push(""),e.replace(c,(function(e,t,r,o){n.push(r?o.replace(s,"$1"):t||e)})),n}));function L(e){if("string"==typeof e||j(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function U(e,t){if("function"!=typeof e||t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],a=n.cache;if(a.has(o))return a.get(o);var i=e.apply(this,r);return n.cache=a.set(o,i),i};return n.cache=new(U.Cache||M),n}U.Cache=M;var V=Array.isArray;function B(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function j(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==I.call(e)}e.exports=function(e,t,n){var r=null==e?void 0:function(e,t){var n;t=function(e,t){if(V(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!j(e))||i.test(e)||!a.test(e)||null!=t&&e in Object(t)}(t,e)?[t]:V(n=t)?n:A(n);for(var r=0,o=t.length;null!=e&&r<o;)e=e[L(t[r++])];return r&&r==o?e:void 0}(e,t);return void 0===r?n:r}},47:function(e){var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function s(e,t,n,r){var o=t&&t.prototype instanceof p?t:p,a=Object.create(o.prototype),i=new S(r||[]);return a._invoke=function(e,t,n){var r=u;return function(o,a){if(r===f)throw new Error("Generator is already running");if(r===g){if("throw"===o)throw a;return k()}for(n.method=o,n.arg=a;;){var i=n.delegate;if(i){var l=_(i,n);if(l){if(l===h)continue;return l}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===u)throw r=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=f;var c=d(e,t,n);if("normal"===c.type){if(r=n.done?g:v,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=g,n.method="throw",n.arg=c.arg)}}}(e,n,i),a}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=s;var u="suspendedStart",v="suspendedYield",f="executing",g="completed",h={};function p(){}function m(){}function w(){}var E={};c(E,a,(function(){return this}));var y=Object.getPrototypeOf,I=y&&y(y(x([])));I&&I!==n&&r.call(I,a)&&(E=I);var b=w.prototype=p.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function T(e,t){function n(o,a,i,l){var c=d(e[o],e,a);if("throw"!==c.type){var s=c.arg,u=s.value;return u&&"object"==typeof u&&r.call(u,"__await")?t.resolve(u.__await).then((function(e){n("next",e,i,l)}),(function(e){n("throw",e,i,l)})):t.resolve(u).then((function(e){s.value=e,i(s)}),(function(e){return n("throw",e,i,l)}))}l(c.arg)}var o;this._invoke=function(e,r){function a(){return new t((function(t,o){n(e,r,t,o)}))}return o=o?o.then(a,a):a()}}function _(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,_(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var o=d(r,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,h;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function D(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function x(e){if(e){var n=e[a];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function n(){for(;++o<e.length;)if(r.call(e,o))return n.value=e[o],n.done=!1,n;return n.value=t,n.done=!0,n};return i.next=i}}return{next:k}}function k(){return{value:t,done:!0}}return m.prototype=w,c(b,"constructor",w),c(w,"constructor",m),m.displayName=c(w,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===m||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,c(e,l,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},C(T.prototype),c(T.prototype,i,(function(){return this})),e.AsyncIterator=T,e.async=function(t,n,r,o,a){void 0===a&&(a=Promise);var i=new T(s(t,n,r,o),a);return e.isGeneratorFunction(n)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},C(b),c(b,l,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=x,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(D),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function o(r,o){return l.type="throw",l.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=r.call(i,"catchLoc"),s=r.call(i,"finallyLoc");if(c&&s){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var o=this.tryEntries[n];if(o.tryLoc<=this.prev&&r.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),D(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;D(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:x(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=t}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}},396:function(e){"use strict";e.exports=a},785:function(e){"use strict";e.exports=r},807:function(e){"use strict";e.exports=u},847:function(e){"use strict";e.exports=v},348:function(e){"use strict";e.exports=i},441:function(e){"use strict";e.exports=t},70:function(e){"use strict";e.exports=l},127:function(e){"use strict";e.exports=o},474:function(e){"use strict";e.exports=c},795:function(e){"use strict";e.exports=n},610:function(e){"use strict";e.exports=s},953:function(t){"use strict";t.exports=e},976:function(e){"use strict";e.exports=d}},g={};function h(e){var t=g[e];if(void 0!==t)return t.exports;var n=g[e]={id:e,loaded:!1,exports:{}};return f[e](n,n.exports,h),n.loaded=!0,n.exports}h.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return h.d(t,{a:t}),t},h.d=function(e,t){for(var n in t)h.o(t,n)&&!h.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},h.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),h.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},h.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},h.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e};var p={};return function(){"use strict";h.r(p),h.d(p,{AngleTool:function(){return kg},AnnotationTool:function(){return od},ArrowAnnotateTool:function(){return Sg},BaseTool:function(){return ka},BidirectionalTool:function(){return Tg},BrushTool:function(){return As},CONSTANTS:function(){return u},CircleROITool:function(){return Ig},CircleScissorsTool:function(){return Jg},CobbAngleTool:function(){return Pg},CrosshairsTool:function(){return sg},DragProbeTool:function(){return Nf},EllipticalROITool:function(){return pg},Enums:function(){return z},LengthTool:function(){return Qf},MIPJumpToClickTool:function(){return $f},MagnifyTool:function(){return Lg},PaintFillTool:function(){return th},PanTool:function(){return _f},PlanarFreehandROITool:function(){return Yv},PlanarRotateTool:function(){return Ff},ProbeTool:function(){return Rf},RectangleROIStartEndThresholdTool:function(){return yd},RectangleROIThresholdTool:function(){return md},RectangleROITool:function(){return hd},RectangleScissorsTool:function(){return Kg},ReferenceCursors:function(){return Vg},ReferenceLines:function(){return vg},ReferenceLinesTool:function(){return vg},ScaleOverlayTool:function(){return Hg},SegmentationDisplayTool:function(){return Ai},SphereScissorsTool:function(){return Zg},StackScrollMouseWheelTool:function(){return qf},StackScrollTool:function(){return jf},Synchronizer:function(){return il},SynchronizerManager:function(){return c},ToolGroupManager:function(){return d},TrackballRotateTool:function(){return Df},Types:function(){return H},VolumeRotateMouseWheelTool:function(){return Yf},WindowLevelTool:function(){return Lf},ZoomTool:function(){return Vf},addTool:function(){return Qi},annotation:function(){return F},cancelActiveManipulations:function(){return nl},cursors:function(){return j},destroy:function(){return $i},drawing:function(){return f},init:function(){return Ji},removeTool:function(){return el},segmentation:function(){return q},state:function(){return ze},synchronizers:function(){return v},utilities:function(){return B}});var e={};h.r(e),h.d(e,{checkAndDefineIsLockedProperty:function(){return ce},getAnnotationsLocked:function(){return ae},getAnnotationsLockedCount:function(){return le},isAnnotationLocked:function(){return ie},setAnnotationLocked:function(){return re},unlockAllAnnotations:function(){return oe}});var t={};h.r(t),h.d(t,{deselectAnnotation:function(){return we},getAnnotationsSelected:function(){return Ee},getAnnotationsSelectedByToolName:function(){return ye},getAnnotationsSelectedCount:function(){return be},isAnnotationSelected:function(){return Ie},setAnnotationSelected:function(){return pe}});var n={};h.r(n),h.d(n,{checkAndDefineIsVisibleProperty:function(){return ke},isAnnotationVisible:function(){return xe},setAnnotationVisibility:function(){return De},showAllAnnotations:function(){return Se}});var r={};h.r(r),h.d(r,{addAnnotation:function(){return tt},getAnnotation:function(){return ot},getAnnotationManager:function(){return Ze},getAnnotations:function(){return et},getNumberOfAnnotations:function(){return nt},removeAllAnnotations:function(){return at},removeAnnotation:function(){return rt},resetAnnotationManager:function(){return Qe},setAnnotationManager:function(){return Xe}});var o={};h.r(o),h.d(o,{triggerSegmentationDataModified:function(){return Ct},triggerSegmentationModified:function(){return bt},triggerSegmentationRemoved:function(){return Et},triggerSegmentationRepresentationModified:function(){return It},triggerSegmentationRepresentationRemoved:function(){return yt}});var a={};h.r(a),h.d(a,{addColorLUT:function(){return zt},addSegmentation:function(){return xt},addSegmentationRepresentation:function(){return Vt},getColorLUT:function(){return qt},getDefaultSegmentationStateManager:function(){return Ot},getGlobalConfig:function(){return Bt},getSegmentSpecificRepresentationConfig:function(){return Lt},getSegmentation:function(){return Dt},getSegmentationRepresentationByUID:function(){return Ht},getSegmentationRepresentationSpecificConfig:function(){return At},getSegmentationRepresentations:function(){return kt},getSegmentations:function(){return St},getToolGroupIdsWithSegmentation:function(){return Mt},getToolGroupSpecificConfig:function(){return Rt},removeColorLUT:function(){return Gt},removeSegmentation:function(){return Wt},removeSegmentationRepresentation:function(){return Ft},setGlobalConfig:function(){return jt},setSegmentSpecificRepresentationConfig:function(){return Ut},setSegmentationRepresentationSpecificConfig:function(){return Nt},setToolGroupSpecificConfig:function(){return Pt}});var i={};h.r(i),h.d(i,{copyPoints:function(){return zn},copyPointsList:function(){return qn},getDeltaDistance:function(){return Wn},getDeltaDistanceBetweenIPoints:function(){return Gn},getDeltaPoints:function(){return Hn},getDeltaRotation:function(){return Fn},getMeanPoints:function(){return Kn},getMeanTouchPoints:function(){return Yn}});var l={};h.r(l),h.d(l,{getSegmentationVisibility:function(){return Oa},setSegmentVisibility:function(){return Sa},setSegmentationVisibility:function(){return _a},setSegmentsVisibility:function(){return Da}});var c={};h.r(c),h.d(c,{createSynchronizer:function(){return ll},destroy:function(){return cl},destroySynchronizer:function(){return ul},getAllSynchronizers:function(){return dl},getSynchronizer:function(){return sl},getSynchronizersForViewport:function(){return ea}});var s={};h.r(s),h.d(s,{hideElementCursor:function(){return Ql},initElementCursor:function(){return $l},resetElementCursor:function(){return Xl},setElementCursor:function(){return Zl}});var d={};h.r(d),h.d(d,{createToolGroup:function(){return cc},destroy:function(){return Ki},destroyToolGroup:function(){return qi},getAllToolGroups:function(){return sc},getToolGroup:function(){return ia},getToolGroupForViewport:function(){return Ar},getToolGroupsWithToolName:function(){return Je}});var u={};h.r(u),h.d(u,{COLOR_LUT:function(){return lt}});var v={};h.r(v),h.d(v,{createCameraPositionSynchronizer:function(){return vc},createStackImageSynchronizer:function(){return Mc},createVOISynchronizer:function(){return gc},createZoomPanSynchronizer:function(){return mc}});var f={};h.r(f),h.d(f,{draw:function(){return Nr},drawArrow:function(){return Zc},drawCircle:function(){return Ac},drawEllipse:function(){return Lc},drawHandles:function(){return Uc},drawLine:function(){return Vc},drawLinkedTextBox:function(){return Jc},drawPolyline:function(){return jc},drawRect:function(){return $c},drawTextBox:function(){return qc}});var g={};h.r(g),h.d(g,{getActiveSegmentationRepresentation:function(){return Cs},setActiveSegmentationRepresentation:function(){return Ts}});var m={};h.r(m),h.d(m,{getLockedSegments:function(){return Ds},isSegmentIndexLocked:function(){return _s},setSegmentIndexLocked:function(){return Os}});var w={};h.r(w),h.d(w,{getActiveSegmentIndex:function(){return xs},setActiveSegmentIndex:function(){return Ss}});var E={};h.r(E),h.d(E,{addColorLUT:function(){return ks},getColorForSegmentIndex:function(){return Rs},setColorForSegmentIndex:function(){return Ps},setColorLUT:function(){return Ms}});var y={};h.r(y),h.d(y,{createLabelmapVolumeForViewport:function(){return kd},createMergedLabelmapForIndex:function(){return Dd},floodFill:function(){return Ad},getBrushSizeForToolGroup:function(){return Ud},getBrushThresholdForToolGroup:function(){return Bd},getDefaultRepresentationConfig:function(){return xd},isValidRepresentationConfig:function(){return Sd},rectangleROIThresholdVolumeByRange:function(){return Od},setBrushSizeForToolGroup:function(){return Ld},setBrushThresholdForToolGroup:function(){return Vd},thresholdSegmentationByRange:function(){return jd},thresholdVolumeByRange:function(){return Bs},triggerSegmentationRender:function(){return Bi}});var I={};h.r(I),h.d(I,{getTextBoxCoordsCanvas:function(){return sd}});var b={};h.r(b),h.d(b,{findClosestPoint:function(){return zc},liangBarksyClip:function(){return Fd}});var C={};h.r(C),h.d(C,{getCanvasEllipseCorners:function(){return fs},pointInEllipse:function(){return gs}});var T={};h.r(T),h.d(T,{distanceToPoint:function(){return ld},distanceToPointSquared:function(){return id},intersectLine:function(){return qd}});var _={};h.r(_),h.d(_,{distanceToPoint:function(){return cd}});var O={};h.r(O),h.d(O,{addCanvasPointsToArray:function(){return eu},calculateAreaOfPoints:function(){return nu},getClosestIntersectionWithPolyline:function(){return Kd},getFirstIntersectionWithPolyline:function(){return zd},getSubPixelSpacingAndXYDirections:function(){return Xd},pointCanProjectOnLine:function(){return tu},pointsAreWithinCloseContourProximity:function(){return Qd}});var D={};h.r(D),h.d(D,{distanceToPoint:function(){return ru}});var S={};h.r(S),h.d(S,{ellipse:function(){return C},lineSegment:function(){return T},point:function(){return D},polyline:function(){return O},rectangle:function(){return _},vec2:function(){return b}});var x={};h.r(x),h.d(x,{default:function(){return su},filterAnnotationsForDisplay:function(){return Zs},filterAnnotationsWithinSlice:function(){return $s},getPointInLineOfSightWithCriteria:function(){return iu},getWorldWidthAndHeightFromCorners:function(){return dd}});var k={};h.r(k),h.d(k,{filterViewportsWithFrameOfReferenceUID:function(){return js},filterViewportsWithParallelNormals:function(){return zs},filterViewportsWithToolEnabled:function(){return Gs},getViewportIdsWithToolToRender:function(){return Ks}});var M={};h.r(M),h.d(M,{getOrientationStringLPS:function(){return du},invertOrientationStringLPS:function(){return uu}});var R={};h.r(R),h.d(R,{Events:function(){return vu},addToolState:function(){return gu},getToolState:function(){return hu},playClip:function(){return wu},stopClip:function(){return Eu}});var P={};h.r(P),h.d(P,{extend2DBoundingBoxInViewAxis:function(){return Id},getBoundingBoxAroundShape:function(){return cs}});var N={};h.r(N),h.d(N,{default:function(){return $v},interpolateAnnotation:function(){return Jv}});var A={};h.r(A),h.d(A,{getBoundsIJKFromRectangleAnnotations:function(){return bd}});var L={};h.r(L),h.d(L,{disable:function(){return sf},enable:function(){return cf},getConfiguration:function(){return df},setConfiguration:function(){return uf}});var U={};h.r(U),h.d(U,{isViewportPreScaled:function(){return vd},jumpToSlice:function(){return _c},jumpToWorld:function(){return vf}});var V={};h.r(V),h.d(V,{generateImageFromTimeData:function(){return gf},getDataInTime:function(){return ff}});var B={};h.r(B),h.d(B,{boundingBox:function(){return P},calibrateImageSpacing:function(){return is},cine:function(){return R},clip:function(){return Ec},debounce:function(){return rs},drawing:function(){return I},dynamicVolume:function(){return V},getAnnotationNearPoint:function(){return Qc},getAnnotationNearPointOnEnabledElement:function(){return es},isObject:function(){return ns},jumpToSlice:function(){return _c},math:function(){return S},orientation:function(){return M},planar:function(){return x},planarFreehandROITool:function(){return N},pointInShapeCallback:function(){return ls},pointInSurroundingSphereCallback:function(){return ds},rectangleROITool:function(){return A},scroll:function(){return yc},segmentation:function(){return y},stackPrefetch:function(){return L},throttle:function(){return os},touch:function(){return i},triggerAnnotationRender:function(){return Fr},triggerAnnotationRenderForViewportIds:function(){return na},triggerEvent:function(){return Y.triggerEvent},viewport:function(){return U},viewportFilters:function(){return k}});var j={};h.r(j),h.d(j,{CursorNames:function(){return pf},CursorSVG:function(){return Ml},ImageMouseCursor:function(){return Cl},MouseCursor:function(){return pl},SVGMouseCursor:function(){return Fl},elementCursor:function(){return s},registerCursor:function(){return Pl},setCursorForElement:function(){return hf}});var H={};h.r(H);var W={};h.r(W),h.d(W,{getFont:function(){return mf},getState:function(){return Xs},style:function(){return Vl}});var F={};h.r(F),h.d(F,{FrameOfReferenceSpecificAnnotationManager:function(){return Fe},config:function(){return W},locking:function(){return e},selection:function(){return t},state:function(){return r},visibility:function(){return n}});var G={};h.r(G),h.d(G,{color:function(){return E},getGlobalConfig:function(){return ha},getGlobalRepresentationConfig:function(){return ma},getSegmentSpecificConfig:function(){return Ca},getSegmentationRepresentationSpecificConfig:function(){return Ia},getToolGroupSpecificConfig:function(){return Ea},setGlobalConfig:function(){return pa},setGlobalRepresentationConfig:function(){return wa},setSegmentSpecificConfig:function(){return Ta},setSegmentationRepresentationSpecificConfig:function(){return ba},setToolGroupSpecificConfig:function(){return ya},visibility:function(){return l}});var q={};h.r(q),h.d(q,{activeSegmentation:function(){return g},addSegmentationRepresentations:function(){return Cf},addSegmentations:function(){return Ef},config:function(){return G},removeSegmentationsFromToolGroup:function(){return Gi},segmentIndex:function(){return w},segmentLocking:function(){return m},state:function(){return a},triggerSegmentationEvents:function(){return o}});var z={};h.r(z),h.d(z,{AnnotationStyleStates:function(){return bl},Events:function(){return J},KeyboardBindings:function(){return ro},MouseBindings:function(){return no},SegmentationRepresentations:function(){return st},Swipe:function(){return An},ToolModes:function(){return Ke}});var K,Y=h(953);!function(e){e.ANNOTATION_ADDED="CORNERSTONE_TOOLS_ANNOTATION_ADDED",e.ANNOTATION_COMPLETED="CORNERSTONE_TOOLS_ANNOTATION_COMPLETED",e.ANNOTATION_MODIFIED="CORNERSTONE_TOOLS_ANNOTATION_MODIFIED",e.ANNOTATION_REMOVED="CORNERSTONE_TOOLS_ANNOTATION_REMOVED",e.ANNOTATION_SELECTION_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_SELECTION_CHANGE",e.ANNOTATION_LOCK_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_LOCK_CHANGE",e.ANNOTATION_VISIBILITY_CHANGE="CORNERSTONE_TOOLS_ANNOTATION_VISIBILITY_CHANGE",e.ANNOTATION_RENDERED="CORNERSTONE_TOOLS_ANNOTATION_RENDERED",e.SEGMENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_MODIFIED",e.SEGMENTATION_RENDERED="CORNERSTONE_TOOLS_SEGMENTATION_RENDERED",e.SEGMENTATION_REPRESENTATION_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_MODIFIED",e.SEGMENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REMOVED",e.SEGMENTATION_REPRESENTATION_REMOVED="CORNERSTONE_TOOLS_SEGMENTATION_REPRESENTATION_REMOVED",e.SEGMENTATION_DATA_MODIFIED="CORNERSTONE_TOOLS_SEGMENTATION_DATA_MODIFIED",e.KEY_DOWN="CORNERSTONE_TOOLS_KEY_DOWN",e.KEY_UP="CORNERSTONE_TOOLS_KEY_UP",e.MOUSE_DOWN="CORNERSTONE_TOOLS_MOUSE_DOWN",e.MOUSE_UP="CORNERSTONE_TOOLS_MOUSE_UP",e.MOUSE_DOWN_ACTIVATE="CORNERSTONE_TOOLS_MOUSE_DOWN_ACTIVATE",e.MOUSE_DRAG="CORNERSTONE_TOOLS_MOUSE_DRAG",e.MOUSE_MOVE="CORNERSTONE_TOOLS_MOUSE_MOVE",e.MOUSE_CLICK="CORNERSTONE_TOOLS_MOUSE_CLICK",e.MOUSE_DOUBLE_CLICK="CORNERSTONE_TOOLS_MOUSE_DOUBLE_CLICK",e.MOUSE_WHEEL="CORNERSTONE_TOOLS_MOUSE_WHEEL",e.TOUCH_START="CORNERSTONE_TOOLS_TOUCH_START",e.TOUCH_START_ACTIVATE="CORNERSTONE_TOOLS_TOUCH_START_ACTIVATE",e.TOUCH_PRESS="CORNERSTONE_TOOLS_TOUCH_PRESS",e.TOUCH_DRAG="CORNERSTONE_TOOLS_TOUCH_DRAG",e.TOUCH_END="CORNERSTONE_TOOLS_TOUCH_END",e.TOUCH_TAP="CORNERSTONE_TOOLS_TAP",e.TOUCH_SWIPE="CORNERSTONE_TOOLS_SWIPE"}(K||(K={}));var J=K;function $(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Z(e,t,n){return t&&$(e.prototype,t),n&&$(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function X(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ee=h(907),te=h.n(ee),ne=new Set;function re(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=se();e&&(t?de(e,ne,n):ue(e,ne,n)),ve(n,ne)}function oe(){var e=se();!function(e,t){e.forEach((function(n){ue(n,e,t)}))}(ne,e),ve(e,ne)}function ae(){return Array.from(ne)}function ie(e){return ne.has(e)}function le(){return ne.size}function ce(e){if(e){var t=!!e.isLocked;(function(e){var t=Object.getOwnPropertyDescriptor(e,"isLocked");return t?t.configurable&&(t.set!==fe||t.get!==ge):Object.isExtensible(e)})(e)&&Object.defineProperty(e,"isLocked",{configurable:!1,enumerable:!0,set:fe,get:ge}),re(e,t)}}function se(){return Object.freeze({added:[],removed:[],locked:[]})}function de(e,t,n){t.has(e)||(t.add(e),n.added.push(e))}function ue(e,t,n){t.delete(e)&&n.removed.push(e)}function ve(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach((function(t){e.locked.push(t)})),(0,Y.triggerEvent)(Y.eventTarget,J.ANNOTATION_LOCK_CHANGE,e))}function fe(e){re(this,e)}function ge(){return ie(this)}var he=new Set;function pe(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t?me(e,n):we(e)}function me(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Ce();t||Te(he,n),e&&!he.has(e)&&(he.add(e),n.added.push(e)),_e(n,he)}function we(e){var t=Ce();e?he.delete(e)&&t.removed.push(e):Te(he,t),_e(t,he)}function Ee(){return Array.from(he)}function ye(e){return Ee().filter((function(t){return ot(t).metadata.toolName===e}))}function Ie(e){return he.has(e)}function be(){return he.size}function Ce(){return Object.freeze({added:[],removed:[],selection:[]})}function Te(e,t){e.forEach((function(n){e.delete(n)&&t.removed.push(n)}))}function _e(e,t){(e.added.length>0||e.removed.length>0)&&(t.forEach((function(t){e.selection.push(t)})),(0,Y.triggerEvent)(Y.eventTarget,J.ANNOTATION_SELECTION_CHANGE,e))}var Oe=new Set;function De(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=Me();e&&(t?Re(e,Oe,n):Pe(e,Oe,n)),Ne(n)}function Se(){var e=Me();Oe.forEach((function(t){Re(t,Oe,e)})),Ne(e)}function xe(e){if(ot(e))return!Oe.has(e)}function ke(e){if(e){var t,n=null===(t=e.isVisible)||void 0===t||t;(function(e){var t=Object.getOwnPropertyDescriptor(e,"isVisible");return t?t.configurable&&(t.set!==Ae||t.get!==Le):Object.isExtensible(e)})(e)&&Object.defineProperty(e,"isVisible",{configurable:!1,enumerable:!0,set:Ae,get:Le}),De(e.annotationUID,n)}}function Me(){return Object.freeze({lastVisible:[],lastHidden:[],hidden:[]})}function Re(e,t,n){t.delete(e)&&n.lastVisible.push(e)}function Pe(e,t,n){t.has(e)||(t.add(e),Ie(e)&&we(e),n.lastHidden.push(e))}function Ne(e){(e.lastHidden.length>0||e.lastVisible.length>0)&&(Oe.forEach((function(t){e.hidden.push(t)})),(0,Y.triggerEvent)(Y.eventTarget,J.ANNOTATION_VISIBILITY_CHANGE,e))}function Ae(e){De(this.annotationUID,e)}function Le(){return xe(this.annotationUID)}function Ue(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ve(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ve(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function Ve(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Be,je,He=Z((function e(t){var n=this;X(this,e),Q(this,"annotations",void 0),Q(this,"uid",void 0),Q(this,"getGroupKey",(function(e){if("string"==typeof e)return e;var t=e,n=(0,Y.getEnabledElement)(t);if(!n)throw new Error("Element not enabled, you must have an enabled element if you are not providing a FrameOfReferenceUID");return n.FrameOfReferenceUID})),Q(this,"_imageVolumeModifiedHandler",(function(e){var t=e.detail.FrameOfReferenceUID,r=n.annotations[t];r&&Object.keys(r).forEach((function(e){r[e].forEach((function(e){void 0!==e.invalidated&&(e.invalidated=!0)}))}))})),Q(this,"getFramesOfReference",(function(){return Object.keys(n.annotations)})),Q(this,"getAnnotations",(function(e,t){var r=n.annotations;return r[e]?t?r[e][t]:r[e]:[]})),Q(this,"getAnnotation",(function(e){var t=n.annotations;for(var r in t){var o=t[r];for(var a in o){var i,l=Ue(o[a]);try{for(l.s();!(i=l.n()).done;){var c=i.value;if(e===c.annotationUID)return c}}catch(e){l.e(e)}finally{l.f()}}}})),Q(this,"getNumberOfAnnotations",(function(e,t){var r=n.getAnnotations(e,t);if(!r.length)return 0;if(t)return r.length;var o=0;for(var a in r)o+=r[a].length;return o})),Q(this,"addAnnotation",(function(e,t){var r=e.metadata,o=r.FrameOfReferenceUID,a=r.toolName;t=t||o;var i=n.annotations,l=i[t];l||(i[t]={},l=i[t]);var c=l[a];c||(l[a]=[],c=l[a]),c.push(e),ce(e),ke(e)})),Q(this,"removeAnnotation",(function(e){var t=n.annotations;for(var r in t){var o=t[r];for(var a in o){var i=o[a],l=i.findIndex((function(t){return t.annotationUID===e}));-1!==l&&(i.splice(l,1),0===i.length&&delete o[a])}0===Object.keys(o).length&&delete t[r]}})),Q(this,"removeAnnotations",(function(e,t){var r=n.annotations;r[e]&&(t?delete r[e][t]:delete r[e])})),Q(this,"saveAnnotations",(function(e,t){var r=n.annotations;if(e&&t){var o=r[e];if(!o)return;var a=o[t];return te()(a)}if(e){var i=r[e];return te()(i)}return te()(r)})),Q(this,"restoreAnnotations",(function(e,t,r){var o=n.annotations;if(t&&r){var a=o[t];a||(o[t]={},a=o[t]),a[r]=e}else t?o[t]=e:n.annotations=te()(e)})),Q(this,"getNumberOfAllAnnotations",(function(){var e=0,t=n.annotations;for(var r in t){var o=t[r];for(var a in o)e+=o[a].length}return e})),Q(this,"removeAllAnnotations",(function(){n.annotations={}})),t||(t=Y.utilities.uuidv4()),this.annotations={},this.uid=t,Y.eventTarget.addEventListener(Y.Enums.Events.IMAGE_VOLUME_MODIFIED,this._imageVolumeModifiedHandler)})),We=new He("DEFAULT"),Fe=He,Ge={},qe={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:Ge,enabledElements:[],handleRadius:6},ze={isInteractingWithTool:!1,isMultiPartToolActive:!1,tools:{},toolGroups:[],synchronizers:[],svgNodeCache:Ge,enabledElements:[],handleRadius:6};(je=Be||(Be={})).Active="Active",je.Passive="Passive",je.Enabled="Enabled",je.Disabled="Disabled";var Ke=Be,Ye=[Ke.Active,Ke.Passive,Ke.Enabled],Je=function(e){return ze.toolGroups.filter((function(t){for(var n=t.toolOptions,r=Object.keys(n),o=0;o<r.length;o++)if(e===r[o]&&n[e]&&Ye.includes(n[e].mode))return!0;return!1}))},$e=We;function Ze(){return $e}function Xe(e){$e=e}function Qe(){$e=We}function et(e,t){var n=Ze(),r=n.getGroupKey(t);return n.getAnnotations(r,e)}function tt(e,t){void 0===e.annotationUID&&(e.annotationUID=Y.utilities.uuidv4());var n=Ze(),r=n.getGroupKey(t);return n.addAnnotation(e,r),t instanceof HTMLDivElement&&function(e,t){var n=(0,Y.getEnabledElement)(t),r=n.renderingEngine,o=n.viewportId,a=J.ANNOTATION_ADDED,i={annotation:e,viewportId:o,renderingEngineId:r.id};(0,Y.triggerEvent)(Y.eventTarget,a,i)}(e,t),function(e){var t=e.metadata.toolName,n=Je(t);if(n.length){var r=[];if(n.forEach((function(t){t.viewportsInfo.forEach((function(t){var n=t.renderingEngineId,o=t.viewportId,a=(0,Y.getEnabledElementByIds)(o,n).FrameOfReferenceUID;e.metadata.FrameOfReferenceUID===a&&r.push(t)}))})),r.length){var o=J.ANNOTATION_ADDED;r.forEach((function(t){var n=t.renderingEngineId,r=t.viewportId,a={annotation:e,viewportId:r,renderingEngineId:n};(0,Y.triggerEvent)(Y.eventTarget,o,a)}))}}}(e),e.annotationUID}function nt(e,t){var n=Ze(),r=n.getGroupKey(t);return n.getNumberOfAnnotations(r,e)}function rt(e){var t=Ze(),n=t.getAnnotation(e);if(n){t.removeAnnotation(e);var r=J.ANNOTATION_REMOVED,o={annotation:n,annotationManagerUID:t.uid};(0,Y.triggerEvent)(Y.eventTarget,r,o)}}function ot(e){return Ze().getAnnotation(e)}function at(){Ze().removeAllAnnotations()}var it,lt=[[0,0,0,0],[221,84,84,255],[77,228,121,255],[166,70,235,255],[189,180,116,255],[109,182,196,255],[204,101,157,255],[123,211,94,255],[93,87,218,255],[225,128,80,255],[73,232,172,255],[181,119,186,255],[176,193,112,255],[105,153,200,255],[208,97,120,255],[90,215,101,255],[135,83,222,255],[229,178,76,255],[122,183,181,255],[190,115,171,255],[149,197,108,255],[100,118,205,255],[212,108,93,255],[86,219,141,255],[183,79,226,255],[233,233,72,255],[118,167,187,255],[194,111,146,255],[116,201,104,255],[115,96,209,255],[216,147,89,255],[82,223,188,255],[230,75,224,255],[163,184,121,255],[114,143,191,255],[198,107,114,255],[99,206,122,255],[153,92,213,255],[220,192,85,255],[78,215,227,255],[234,71,173,255],[141,188,117,255],[110,113,195,255],[202,128,103,255],[95,210,157,255],[195,88,217,255],[206,224,81,255],[74,166,231,255],[185,120,139,255],[113,192,113,255],[133,106,199,255],[207,162,98,255],[91,214,198,255],[221,84,198,255],[159,228,77,255],[70,111,235,255],[189,119,116,255],[109,196,138,255],[165,101,204,255],[211,201,94,255],[87,191,218,255],[225,80,153,255],[106,232,73,255],[124,119,186,255],[193,142,112,255],[105,200,168,255],[203,97,208,255],[184,215,90,255],[83,147,222,255],[229,76,101,255],[122,183,130,255],[146,115,190,255],[197,171,108,255],[100,205,205,255],[212,93,177,255],[141,219,86,255],[79,97,226,255],[233,99,72,255],[118,187,150,255],[173,111,194,255],[197,201,104,255],[96,171,209,255],[216,89,137,255],[94,223,82,255],[107,75,230,255],[184,153,121,255],[114,191,175,255],[198,107,191,255],[166,206,99,255],[92,132,213,255],[220,85,91,255],[78,227,115,255],[159,71,234,255],[188,176,117,255],[110,185,195,255],[202,103,161,255],[129,210,95,255],[88,88,217,255],[224,123,81,255],[74,231,166,255],[177,120,185,255],[179,192,113,255],[106,156,199,255],[207,98,125,255],[91,214,96,255],[130,84,221,255],[228,171,77,255],[70,235,221,255],[189,116,174,255],[153,196,109,255],[101,123,204,255],[211,104,94,255],[87,218,136,255],[177,80,225,255],[232,225,73,255],[119,169,186,255],[193,112,149,255],[121,200,105,255],[111,97,208,255],[215,142,90,255],[83,222,181,255],[229,76,229,255],[165,183,122,255],[115,146,190,255],[197,108,119,255],[100,205,118,255],[148,93,212,255],[219,186,86,255],[79,220,226,255],[233,72,179,255],[144,187,118,255],[111,118,194,255],[201,124,104,255],[96,209,153,255],[189,89,216,255],[211,223,82,255],[75,172,230,255],[184,121,142,255],[117,191,114,255],[130,107,198,255],[206,157,99,255],[92,213,193,255],[220,85,203,255],[165,227,78,255],[71,118,234,255],[188,117,117,255],[110,195,135,255],[161,103,202,255],[210,195,95,255],[88,195,217,255],[224,81,158,255],[113,231,74,255],[123,120,185,255],[192,139,113,255],[106,199,164,255],[198,98,207,255],[188,214,91,255],[84,153,221,255],[228,77,108,255],[70,235,84,255],[143,116,189,255],[196,167,109,255],[101,204,199,255],[211,94,182,255],[147,218,87,255],[80,104,225,255],[232,93,73,255],[119,186,147,255],[170,112,193,255],[200,200,105,255],[97,175,208,255],[215,90,142,255],[100,222,83,255],[101,76,229,255],[183,150,122,255],[115,190,171,255],[197,108,194,255],[170,205,100,255],[93,138,212,255],[219,86,97,255],[79,226,110,255],[153,72,233,255],[187,173,118,255],[111,187,194,255],[201,104,165,255],[134,209,96,255],[89,95,216,255],[223,117,82,255],[75,230,159,255],[174,121,184,255],[182,191,114,255],[107,160,198,255],[206,99,130,255],[92,213,92,255],[124,85,220,255],[227,165,78,255],[71,234,214,255],[188,117,176,255],[156,195,110,255],[103,128,202,255],[210,100,95,255],[88,217,131,255],[170,81,224,255],[231,218,74,255],[120,172,185,255],[192,113,153,255],[125,199,106,255],[107,98,207,255],[214,137,91,255],[84,221,175,255],[222,77,228,255],[194,235,70,255],[116,149,189,255],[196,109,123,255],[101,204,114,255],[143,94,211,255],[218,180,87,255],[80,225,225,255],[232,73,186,255],[147,186,119,255],[112,122,193,255],[200,121,105,255],[97,208,148,255],[184,90,215,255],[216,222,83,255],[76,178,229,255],[183,122,145,255],[121,190,115,255],[126,108,197,255],[205,153,100,255],[93,212,187,255],[219,86,208,255],[171,226,79,255],[72,126,233,255],[187,118,121,255],[111,194,132,255],[157,104,201,255],[209,190,96,255],[89,200,216,255],[223,82,164,255],[120,230,75,255],[121,121,184,255],[191,136,114,255],[107,198,160,255],[192,99,206,255],[193,213,92,255],[85,158,220,255],[227,78,115,255],[71,234,78,255],[141,117,188,255],[195,163,110,255],[103,202,194,255],[210,95,186,255],[153,217,88,255],[81,111,224,255]];!function(e){e.Labelmap="LABELMAP",e.Contour="CONTOUR"}(it||(it={}));var ct,st=it,dt={renderOutline:!0,outlineWidthActive:2,outlineWidthInactive:2,outlineOpacity:1,outlineOpacityInactive:.85},ut={renderOutline:!0,outlineWidthActive:3,outlineWidthInactive:2,renderFill:!0,renderFillInactive:!0,fillAlpha:.7,fillAlphaInactive:.65,outlineOpacity:1,outlineOpacityInactive:.85},vt=function(){return ut};function ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function gt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ht=vt(),pt=dt,mt={colorLUT:[],segmentations:[],globalConfig:{renderInactiveSegmentations:!0,representations:(ct={},Q(ct,st.Labelmap,ht),Q(ct,st.Contour,pt),ct)},toolGroups:{}},wt=new(function(){function e(t){X(this,e),Q(this,"state",void 0),Q(this,"uid",void 0),t||(t=Y.utilities.uuidv4()),this.state=te()(mt),this.uid=t}return Z(e,[{key:"getState",value:function(){return this.state}},{key:"getToolGroups",value:function(){return Object.keys(this.state.toolGroups)}},{key:"getColorLUT",value:function(e){return this.state.colorLUT[e]}},{key:"resetState",value:function(){this.state=te()(mt)}},{key:"getSegmentation",value:function(e){return this.state.segmentations.find((function(t){return t.segmentationId===e}))}},{key:"addSegmentation",value:function(e){if(this._initDefaultColorLUTIfNecessary(),this.getSegmentation(e.segmentationId))throw new Error("Segmentation with id ".concat(e.segmentationId," already exists"));this.state.segmentations.push(e)}},{key:"getSegmentationRepresentations",value:function(e){var t=this.state.toolGroups[e];if(t)return t.segmentationRepresentations}},{key:"addSegmentationRepresentation",value:function(e,t){this.state.toolGroups[e]||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{}}),this.state.toolGroups[e].segmentationRepresentations.push(t),this._handleActiveSegmentation(e,t)}},{key:"getGlobalConfig",value:function(){return this.state.globalConfig}},{key:"setGlobalConfig",value:function(e){this.state.globalConfig=e}},{key:"getSegmentationRepresentationByUID",value:function(e,t){return this.getSegmentationRepresentations(e).find((function(e){return e.segmentationRepresentationUID===t}))}},{key:"removeSegmentation",value:function(e){this.state.segmentations=this.state.segmentations.filter((function(t){return t.segmentationId!==e}))}},{key:"removeSegmentationRepresentation",value:function(e,t){var n=this.getSegmentationRepresentations(e);if(!n||!n.length)throw new Error("No viewport specific segmentation state found for viewport ".concat(e));var r=n.findIndex((function(e){return e.segmentationRepresentationUID===t}));-1===r&&console.warn("No viewport specific segmentation state data found for viewport ".concat(e," and segmentation data UID ").concat(t));var o=n[r];n.splice(r,1),this._handleActiveSegmentation(e,o)}},{key:"setActiveSegmentationRepresentation",value:function(e,t){var n=this.getSegmentationRepresentations(e);if(!n||!n.length)throw new Error("No segmentation data found for toolGroupId: ".concat(e));var r=n.find((function(e){return e.segmentationRepresentationUID===t}));if(!r)throw new Error("No segmentation data found for segmentation data UID ".concat(t));r.active=!0,this._handleActiveSegmentation(e,r)}},{key:"getToolGroupSpecificConfig",value:function(e){var t=this.state.toolGroups[e];if(t)return t.config}},{key:"getSegmentationRepresentationSpecificConfig",value:function(e,t){var n=this.getSegmentationRepresentationByUID(e,t);if(n)return n.segmentationRepresentationSpecificConfig}},{key:"setSegmentationRepresentationSpecificConfig",value:function(e,t,n){var r=this.getSegmentationRepresentationByUID(e,t);r&&(r.segmentationRepresentationSpecificConfig=n)}},{key:"getSegmentSpecificConfig",value:function(e,t,n){var r=this.getSegmentationRepresentationByUID(e,t);if(r)return r.segmentSpecificConfig[n]}},{key:"setSegmentSpecificConfig",value:function(e,t,n){var r=this.getSegmentationRepresentationByUID(e,t);r&&(r.segmentSpecificConfig=n)}},{key:"setSegmentationRepresentationConfig",value:function(e,t){var n=this.state.toolGroups[e];n||(this.state.toolGroups[e]={segmentationRepresentations:[],config:{renderInactiveSegmentations:!0,representations:{}}},n=this.state.toolGroups[e]),n.config=gt(gt({},n.config),t)}},{key:"addColorLUT",value:function(e,t){this.state.colorLUT[t]&&console.log("Color LUT table already exists, overwriting"),this.state.colorLUT[t]=e}},{key:"removeColorLUT",value:function(e){delete this.state.colorLUT[e]}},{key:"_handleActiveSegmentation",value:function(e,t){var n=this.getSegmentationRepresentations(e);0!==n.length&&(1!==n.length&&0!==n.filter((function(e){return e.active})).length?t.active&&n.forEach((function(e){e.segmentationRepresentationUID!==t.segmentationRepresentationUID&&(e.active=!1)})):n[0].active=!0)}},{key:"_initDefaultColorLUTIfNecessary",value:function(){0!==this.state.colorLUT.length&&this.state.colorLUT[0]||this.addColorLUT(lt,0)}}]),e}())("DEFAULT");function Et(e){var t={segmentationId:e};(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_REMOVED,t)}function yt(e,t){var n={toolGroupId:e,segmentationRepresentationUID:t};(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_REPRESENTATION_REMOVED,n)}function It(e,t){var n={toolGroupId:e,segmentationRepresentationUID:t};t?(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_REPRESENTATION_MODIFIED,n):(kt(e)||[]).forEach((function(t){var n=t.segmentationRepresentationUID,r={toolGroupId:e,segmentationRepresentationUID:n};(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_REPRESENTATION_MODIFIED,r)}))}function bt(e){(e?[e]:St().map((function(e){return e.segmentationId}))).forEach((function(e){var t={segmentationId:e};(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_MODIFIED,t)}))}function Ct(e,t){var n={segmentationId:e,modifiedSlicesToUse:t};(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_DATA_MODIFIED,n)}function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _t(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ot(){return wt}function Dt(e){return Ot().getSegmentation(e)}function St(){return Ot().getState().segmentations}function xt(e,t){var n=Ot(),r=function(e){var t=e.segmentationId,n=e.representation;return{segmentationId:t,cachedStats:{},segmentLabels:{},label:null,segmentsLocked:new Set,type:n.type,activeSegmentIndex:1,representationData:Q({},n.type,_t({},n.data))}}(e);n.addSegmentation(r),t||bt(r.segmentationId)}function kt(e){return Ot().getSegmentationRepresentations(e)}function Mt(e){var t=Ot(),n=t.getState(),r=Object.keys(n.toolGroups),o=[];return r.forEach((function(n){t.getSegmentationRepresentations(n).forEach((function(t){t.segmentationId===e&&o.push(n)}))})),o}function Rt(e){return Ot().getToolGroupSpecificConfig(e)}function Pt(e,t,n){Ot().setSegmentationRepresentationConfig(e,t),n||It(e)}function Nt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Ot();o.setSegmentationRepresentationSpecificConfig(e,t,n),r||It(e,t)}function At(e,t){return Ot().getSegmentationRepresentationSpecificConfig(e,t)}function Lt(e,t,n){return Ot().getSegmentSpecificConfig(e,t,n)}function Ut(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=Ot();o.setSegmentSpecificConfig(e,t,n),r||It(e,t)}function Vt(e,t,n){Ot().addSegmentationRepresentation(e,t),n||It(e,t.segmentationRepresentationUID)}function Bt(){return Ot().getGlobalConfig()}function jt(e,t){Ot().setGlobalConfig(e),t||bt()}function Ht(e,t){return Ot().getSegmentationRepresentationByUID(e,t)}function Wt(e){Ot().removeSegmentation(e),Et(e)}function Ft(e,t){Ot().removeSegmentationRepresentation(e,t),yt(e,t)}function Gt(e){Ot().removeColorLUT(e)}function qt(e){return Ot().getColorLUT(e)}function zt(e,t){Ot().addColorLUT(e,t)}function Kt(e,t){var n=t||e.currentTarget,r=(0,Y.getEnabledElement)(n).viewport,o=function(e){return[e.clientX,e.clientY]}(e),a=function(e){return[e.pageX,e.pageY]}(e),i=function(e,t){var n=e.getBoundingClientRect();return[t[0]-n.left-window.pageXOffset,t[1]-n.top-window.pageYOffset]}(n,a);return{page:a,client:o,canvas:i,world:r.canvasToWorld(i)}}var Yt=function(e){var t=e.currentTarget,n=(0,Y.getEnabledElement)(t),r=n.viewportId,o=n.renderingEngineId,a=Kt(e,t),i={event:e,eventName:J.MOUSE_DOUBLE_CLICK,viewportId:r,renderingEngineId:o,camera:{},element:t,startPoints:a,lastPoints:a,currentPoints:a,deltaPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}};!(0,Y.triggerEvent)(t,J.MOUSE_DOUBLE_CLICK,i)&&(e.stopImmediatePropagation(),e.preventDefault())},Jt=J.MOUSE_MOVE,$t=function(e){var t=e.currentTarget,n=(0,Y.getEnabledElement)(t),r={renderingEngineId:n.renderingEngineId,viewportId:n.viewportId,camera:{},element:t,currentPoints:Kt(e),eventName:Jt,event:e};(0,Y.triggerEvent)(t,Jt,r)},Zt=J.MOUSE_DOWN,Xt=J.MOUSE_DOWN_ACTIVATE,Qt=J.MOUSE_CLICK,en=J.MOUSE_UP,tn=J.MOUSE_DRAG,nn={mouseButton:void 0,element:null,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}},rn={mouseButton:void 0,renderingEngineId:void 0,viewportId:void 0,isClickEvent:!0,clickDelay:200,element:null,preventClickTimeout:null,startPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},lastPoints:{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]}},on={doubleClickTimeout:null,mouseDownEvent:null,mouseUpEvent:null,ignoreDoubleClick:!1};function an(e){var t=Kt(e,rn.element),n=hn(rn.element,rn.lastPoints),r=pn(t,n);if(on.doubleClickTimeout){if(!sn(r.canvas))return;un()}var o={event:e,eventName:tn,mouseButton:rn.mouseButton,renderingEngineId:rn.renderingEngineId,viewportId:rn.viewportId,camera:{},element:rn.element,startPoints:gn(rn.startPoints),lastPoints:gn(n),currentPoints:t,deltaPoints:r};(0,Y.triggerEvent)(rn.element,tn,o),rn.lastPoints=gn(t)}function ln(e){if(clearTimeout(rn.preventClickTimeout),on.doubleClickTimeout)on.mouseUpEvent?fn():(on.mouseUpEvent=e,rn.element.addEventListener("mousemove",cn));else{var t=rn.isClickEvent?Qt:en,n=Kt(e,rn.element),r=pn(n,rn.lastPoints),o={event:e,eventName:t,mouseButton:rn.mouseButton,element:rn.element,renderingEngineId:rn.renderingEngineId,viewportId:rn.viewportId,camera:{},startPoints:gn(rn.startPoints),lastPoints:gn(rn.lastPoints),currentPoints:n,deltaPoints:r};(0,Y.triggerEvent)(o.element,t,o),fn()}document.removeEventListener("mousemove",an)}function cn(e){sn(pn(Kt(e,rn.element),hn(rn.element,rn.lastPoints)).canvas)&&(un(),$t(e))}function sn(e){return Math.abs(e[0])+Math.abs(e[1])>3}function dn(){rn.isClickEvent=!1}function un(){on.ignoreDoubleClick=!0;var e,t,n,r=on.mouseDownEvent,o=on.mouseUpEvent;vn(),e=r,t=pn(rn.startPoints,rn.startPoints),n={event:e,eventName:Zt,element:rn.element,mouseButton:rn.mouseButton,renderingEngineId:rn.renderingEngineId,viewportId:rn.viewportId,camera:{},startPoints:rn.startPoints,lastPoints:rn.startPoints,currentPoints:rn.startPoints,deltaPoints:t},rn.lastPoints=gn(n.lastPoints),(0,Y.triggerEvent)(n.element,Zt,n)&&(0,Y.triggerEvent)(n.element,Xt,n),o&&ln(o)}function vn(){on.doubleClickTimeout&&(clearTimeout(on.doubleClickTimeout),on.doubleClickTimeout=null),on.mouseDownEvent=null,on.mouseUpEvent=null}function fn(){var e,t;document.removeEventListener("mouseup",ln),null===(e=rn.element)||void 0===e||e.removeEventListener("mousemove",cn),null===(t=rn.element)||void 0===t||t.addEventListener("mousemove",$t),vn(),rn=JSON.parse(JSON.stringify(nn))}function gn(e){return JSON.parse(JSON.stringify(e))}function hn(e,t){var n=(0,Y.getEnabledElement)(e).viewport.canvasToWorld(t.canvas);return{page:t.page,client:t.client,canvas:t.canvas,world:n}}function pn(e,t){return{page:mn(e.page,t.page),client:mn(e.client,t.client),canvas:mn(e.canvas,t.canvas),world:(n=e.world,r=t.world,[n[0]-r[0],n[1]-r[1],n[2]-r[2]])};var n,r}function mn(e,t){return[e[0]-t[0],e[1]-t[1]]}function wn(e){on.ignoreDoubleClick?(on.ignoreDoubleClick=!1,e.stopImmediatePropagation(),e.preventDefault()):fn()}var En=function(e){if(!on.doubleClickTimeout){on.doubleClickTimeout=setTimeout(un,400),on.mouseDownEvent=e,on.ignoreDoubleClick=!1,rn.element=e.currentTarget,rn.mouseButton=e.button;var t=(0,Y.getEnabledElement)(rn.element),n=t.renderingEngineId,r=t.viewportId;rn.renderingEngineId=n,rn.viewportId=r,rn.preventClickTimeout=setTimeout(dn,rn.clickDelay),rn.element.removeEventListener("mousemove",$t);var o=Kt(e,rn.element);rn.startPoints=gn(o),rn.lastPoints=gn(o),document.addEventListener("mouseup",ln),document.addEventListener("mousemove",an)}};function yn(e){e.removeEventListener("dblclick",Yt),e.removeEventListener("mousedown",En),e.removeEventListener("mousemove",$t),e.removeEventListener("dblclick",wn,{capture:!0})}var In={enable:function(e){yn(e),e.addEventListener("dblclick",Yt),e.addEventListener("mousedown",En),e.addEventListener("mousemove",$t),e.addEventListener("dblclick",wn,{capture:!0})},disable:yn},bn=function(e){var t=e.currentTarget,n=(0,Y.getEnabledElement)(t),r=n.renderingEngineId,o=n.viewportId;if(!(e.deltaY>-1&&e.deltaY<1)){e.preventDefault();var a=function(e){var t=0,n=0,r=0,o=0;return"detail"in e&&(n=e.detail),"wheelDelta"in e&&(n=-e.wheelDelta/120),"wheelDeltaY"in e&&(n=-e.wheelDeltaY/120),"wheelDeltaX"in e&&(t=-e.wheelDeltaX/120),r=10*t,o=10*n,"deltaY"in e&&(o=e.deltaY),"deltaX"in e&&(r=e.deltaX),(r||o)&&e.deltaMode&&(1===e.deltaMode?(r*=40,o*=40):(r*=800,o*=800)),r&&!t&&(t=r<1?-1:1),o&&!n&&(n=o<1?-1:1),{spinX:t,spinY:n,pixelX:r,pixelY:o}}(e),i=a.spinX,l=a.spinY,c=a.pixelX,s=a.pixelY,d=l<0?-1:1,u={event:e,eventName:J.MOUSE_WHEEL,renderingEngineId:r,viewportId:o,element:t,camera:{},detail:e,wheel:{spinX:i,spinY:l,pixelX:c,pixelY:s,direction:d},points:Kt(e)};(0,Y.triggerEvent)(t,J.MOUSE_WHEEL,u)}};function Cn(e){e.removeEventListener("wheel",bn)}var Tn,_n,On={enable:function(e){Cn(e),e.addEventListener("wheel",bn,{passive:!1})},disable:Cn};function Dn(e,t){var n=Date.now();if(e!==Tn){if(n-_n<=2e3)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;Tn=e}_n=n}var Sn=Dn.bind(null,0),xn=Dn.bind(null,1);function kn(e,t,n){var r=n?Sn:xn;t.forEach((function(t){e.addEventListener(t,r,{passive:!1})}))}function Mn(e,t,n){var r=n?Sn:xn;t.forEach((function(t){e.removeEventListener(t,r)}))}var Rn=["mousedown","mouseup","mousemove"],Pn=["touchstart","touchend"];function Nn(e){Mn(e,Rn,0),Mn(e,Pn,1)}var An,Ln={enable:function(e){Nn(e),kn(e,Rn,0),kn(e,Pn,1)},disable:Nn};function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vn(e,t){if(e){if("string"==typeof e)return Un(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Un(e,t):void 0}}function Bn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,l=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){l=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(l)throw o}}return a}}(e,t)||Vn(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function jn(e,t){var n=t||e.currentTarget,r="touchend"===e.type?e.changedTouches:e.touches;return Object.keys(r).map((function(e){var t=function(e){return[e.clientX,e.clientY]}(r[e]),o=function(e){return[e.pageX,e.pageY]}(r[e]),a=function(e,t){var n=e.getBoundingClientRect();return[t[0]-n.left-window.pageXOffset,t[1]-n.top-window.pageYOffset]}(n,o);return{page:o,client:t,canvas:a,world:(0,Y.getEnabledElement)(n).viewport.canvasToWorld(a),touch:{identifier:e,radiusX:r[e].radiusX,radiusY:r[e].radiusY,force:r[e].force,rotationAngle:r[e].rotationAngle}}}))}function Hn(e,t){var n,r,o=Kn(e),a=Kn(t);return{page:Jn(o.page,a.page),client:Jn(o.client,a.client),canvas:Jn(o.canvas,a.canvas),world:(n=o.world,r=a.world,[n[0]-r[0],n[1]-r[1],n[2]-r[2]])}}function Wn(e,t){var n=Kn(e),r=Kn(t);return{page:Zn(n.page,r.page),client:Zn(n.client,r.client),canvas:Zn(n.canvas,r.canvas),world:Xn(n.world,r.world)}}function Fn(e,t){}function Gn(e,t){var n=$n(e),r=$n(t);return{page:n.page-r.page,client:n.client-r.client,canvas:n.canvas-r.canvas,world:n.world-r.world}}function qn(e){return JSON.parse(JSON.stringify(e))}function zn(e){return JSON.parse(JSON.stringify(e))}function Kn(e){return e.reduce((function(t,n){return{page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length]}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]})}function Yn(e){return e.reduce((function(t,n){return{page:[t.page[0]+n.page[0]/e.length,t.page[1]+n.page[1]/e.length],client:[t.client[0]+n.client[0]/e.length,t.client[1]+n.client[1]/e.length],canvas:[t.canvas[0]+n.canvas[0]/e.length,t.canvas[1]+n.canvas[1]/e.length],world:[t.world[0]+n.world[0]/e.length,t.world[1]+n.world[1]/e.length,t.world[2]+n.world[2]/e.length],touch:{identifier:null,radiusX:t.touch.radiusX+n.touch.radiusX/e.length,radiusY:t.touch.radiusY+n.touch.radiusY/e.length,force:t.touch.force+n.touch.force/e.length,rotationAngle:t.touch.rotationAngle+n.touch.rotationAngle/e.length}}}),{page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0],touch:{identifier:null,radiusX:0,radiusY:0,force:0,rotationAngle:0}})}function Jn(e,t){return[e[0]-t[0],e[1]-t[1]]}function $n(e){for(var t=[],n=0;n<e.length;n++)for(var r=0;r<e.length;r++)n<r&&t.push({page:Zn(e[n].page,e[r].page),client:Zn(e[n].client,e[r].client),canvas:Zn(e[n].canvas,e[r].canvas),world:Xn(e[n].world,e[r].world)});return t.reduce((function(e,n){return{page:e.page+n.page/t.length,client:e.client+n.client/t.length,canvas:e.canvas+n.canvas/t.length,world:e.world+n.world/t.length}}),{page:0,client:0,canvas:0,world:0})}function Zn(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Xn(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2)+Math.pow(e[2]-t[2],2))}function Qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function er(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qn(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT"}(An||(An={}));var tr=Y.Settings.getRuntimeSettings(),nr=J.TOUCH_START,rr=J.TOUCH_START_ACTIVATE,or=J.TOUCH_PRESS,ar=J.TOUCH_DRAG,ir=J.TOUCH_END,lr=J.TOUCH_TAP,cr=J.TOUCH_SWIPE,sr={page:[0,0],client:[0,0],canvas:[0,0],world:[0,0,0]},dr={page:0,client:0,canvas:0,world:0},ur={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[er(er({},sr),{},{touch:null})],lastPointsList:[er(er({},sr),{},{touch:null})],isTouchStart:!1,startTime:null,pressTimeout:null,pressDelay:700,pressMaxDistance:5,accumulatedDistance:dr,swipeDistanceThreshold:48,swiped:!1,swipeToleranceMs:300},vr={renderingEngineId:void 0,viewportId:void 0,element:null,startPointsList:[er(er({},sr),{},{touch:null})],taps:0,tapTimeout:null,tapMaxDistance:24,tapToleranceMs:300},fr=JSON.parse(JSON.stringify(ur)),gr=JSON.parse(JSON.stringify(vr));function hr(e,t,n){return tr.get("debug")&&("CORNERSTONE_TOOLS_TOUCH_DRAG"===t?console.debug(t):console.debug(t,n)),(0,Y.triggerEvent)(e,t,n)}function pr(e){var t=jn(e,fr.element),n=wr(fr.element,fr.lastPointsList),r=t.length===n.length?Hn(t,n):sr,o=t.length===n.length?Gn(t,n):dr,a=t.length===n.length?Wn(t,fr.lastPointsList):dr;fr.accumulatedDistance={page:fr.accumulatedDistance.page+a.page,client:fr.accumulatedDistance.client+a.client,canvas:fr.accumulatedDistance.canvas+a.canvas,world:fr.accumulatedDistance.world+a.world};var i={event:e,eventName:ar,renderingEngineId:fr.renderingEngineId,viewportId:fr.viewportId,camera:{},element:fr.element,startPoints:Yn(fr.startPointsList),lastPoints:Yn(n),currentPoints:Yn(t),startPointsList:qn(fr.startPointsList),lastPointsList:qn(n),currentPointsList:t,deltaPoints:r,deltaDistance:o};hr(fr.element,ar,i),function(e,t){var n=(new Date).getTime(),r=fr.startTime.getTime();if(!(fr.swiped||n-r>fr.swipeToleranceMs)){var o=Bn(t.canvas,2),a=o[0],i=o[1],l={event:e,eventName:cr,renderingEngineId:fr.renderingEngineId,viewportId:fr.viewportId,camera:{},element:fr.element,swipe:null};Math.abs(a)>fr.swipeDistanceThreshold&&(l.swipe=a>0?An.RIGHT:An.LEFT,hr(l.element,cr,l),fr.swiped=!0),Math.abs(i)>fr.swipeDistanceThreshold&&(l.swipe=i>0?An.DOWN:An.UP,hr(l.element,cr,l),fr.swiped=!0)}}(e,r),fr.lastPointsList=qn(t)}function mr(e){clearTimeout(fr.pressTimeout);var t=jn(e,fr.element),n=wr(fr.element,fr.lastPointsList),r=t.length===n.length?Hn(t,n):Hn(t,t),o=t.length===n.length?Gn(t,n):Gn(t,t),a={event:e,eventName:ir,element:fr.element,renderingEngineId:fr.renderingEngineId,viewportId:fr.viewportId,camera:{},startPointsList:qn(fr.startPointsList),lastPointsList:qn(n),currentPointsList:t,startPoints:Yn(fr.startPointsList),lastPoints:Yn(n),currentPoints:Yn(t),deltaPoints:r,deltaDistance:o};hr(a.element,ir,a),function(e){if(!((new Date).getTime()-fr.startTime.getTime()>gr.tapToleranceMs||(0===gr.taps&&(gr.element=fr.element,gr.renderingEngineId=fr.renderingEngineId,gr.viewportId=fr.viewportId,gr.startPointsList=fr.startPointsList),gr.taps>0&&(gr.element!=fr.element||gr.renderingEngineId!=fr.renderingEngineId||gr.viewportId!=fr.viewportId)))){var t=jn(e,gr.element);Wn(t,gr.startPointsList).canvas>gr.tapMaxDistance||(clearTimeout(gr.tapTimeout),gr.taps+=1,gr.tapTimeout=setTimeout((function(){var n={event:e,eventName:lr,element:gr.element,renderingEngineId:gr.renderingEngineId,viewportId:gr.viewportId,camera:{},currentPointsList:t,currentPoints:Yn(t),taps:gr.taps};hr(n.element,lr,n),gr=JSON.parse(JSON.stringify(vr))}),gr.tapToleranceMs))}}(e),fr=JSON.parse(JSON.stringify(ur)),document.removeEventListener("touchmove",pr),document.removeEventListener("touchend",mr)}function wr(e,t){var n=(0,Y.getEnabledElement)(e).viewport;return t.map((function(e){var t=n.canvasToWorld(e.canvas);return{page:e.page,client:e.client,canvas:e.canvas,world:t,touch:e.touch}}))}var Er=function(e){fr.element=e.currentTarget;var t=(0,Y.getEnabledElement)(fr.element),n=t.renderingEngineId,r=t.viewportId;fr.renderingEngineId=n,fr.viewportId=r,fr.isTouchStart||(clearTimeout(fr.pressTimeout),fr.pressTimeout=setTimeout((function(){return function(e){if(!(fr.accumulatedDistance.canvas>fr.pressMaxDistance)){var t={event:e,eventName:or,renderingEngineId:fr.renderingEngineId,viewportId:fr.viewportId,camera:{},element:fr.element,startPointsList:qn(fr.startPointsList),lastPointsList:qn(fr.lastPointsList),startPoints:zn(Yn(fr.startPointsList)),lastPoints:zn(Yn(fr.lastPointsList))};hr(t.element,or,t)}}(e)}),fr.pressDelay),function(e){fr.isTouchStart=!0,fr.startTime=new Date;var t=jn(e,fr.element),n=Yn(t),r=sr,o=dr,a={event:e,eventName:nr,element:fr.element,renderingEngineId:fr.renderingEngineId,viewportId:fr.viewportId,camera:{},startPointsList:t,lastPointsList:t,currentPointsList:t,startPoints:n,lastPoints:n,currentPoints:n,deltaPoints:r,deltaDistance:o};fr.startPointsList=qn(a.startPointsList),fr.lastPointsList=qn(a.lastPointsList),hr(a.element,nr,a)&&hr(a.element,rr,a)}(e),document.addEventListener("touchmove",pr),document.addEventListener("touchend",mr))};function yr(e){Ln.disable(e),e.removeEventListener("touchstart",Er)}var Ir={enable:function(e){yr(e),Ln.enable(e),e.addEventListener("touchstart",Er,{passive:!1})},disable:yr},br={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null},Cr={renderingEngineId:void 0,viewportId:void 0,key:void 0,keyCode:void 0,element:null};function Tr(e){Cr.element=e.currentTarget;var t=(0,Y.getEnabledElement)(Cr.element),n=t.renderingEngineId,r=t.viewportId;Cr.renderingEngineId=n,Cr.viewportId=r,Cr.key=e.key,Cr.keyCode=e.keyCode,e.preventDefault();var o={renderingEngineId:Cr.renderingEngineId,viewportId:Cr.viewportId,element:Cr.element,key:Cr.key,keyCode:Cr.keyCode};(0,Y.triggerEvent)(o.element,J.KEY_DOWN,o),document.addEventListener("keyup",_r),Cr.element.removeEventListener("keydown",Tr)}function _r(e){var t={renderingEngineId:Cr.renderingEngineId,viewportId:Cr.viewportId,element:Cr.element,key:Cr.key,keyCode:Cr.keyCode};document.removeEventListener("keyup",_r),Cr.element.addEventListener("keydown",Tr),Cr=te()(br),(0,Y.triggerEvent)(t.element,J.KEY_UP,t)}var Or=Tr;function Dr(e){e.removeEventListener("keydown",Or)}var Sr={enable:function(e){Dr(e),e.addEventListener("keydown",Or)},disable:Dr,getModifierKey:function(){return Cr.keyCode}};function xr(e){return function(e){if(Array.isArray(e))return Un(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Vn(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kr(e,t){if(ze.svgNodeCache[e])return ze.svgNodeCache[e][t]?ze.svgNodeCache[e][t].domRef:void 0}function Mr(e,t,n,r){if(!ze.svgNodeCache[t])return null;ze.svgNodeCache[t][r]={touched:!0,domRef:n},e.appendChild(n)}function Rr(e,t){ze.svgNodeCache[e]&&ze.svgNodeCache[e][t]&&(ze.svgNodeCache[e][t].touched=!0)}function Pr(e,t){ze.svgNodeCache[t]&&Object.keys(ze.svgNodeCache[t]).forEach((function(n){var r=ze.svgNodeCache[t][n];!r.touched&&r.domRef&&(e.removeChild(r.domRef),delete ze.svgNodeCache[t][n])}))}var Nr=function(e,t){var n=function(e){var t=(0,Y.getEnabledElement)(e),n=t.viewportId,r=t.renderingEngineId,o="".concat(n,":").concat(r),a=function(e){var t=".".concat("viewport-element");return e.querySelector(t).querySelector(".svg-layer")}(e);return Object.keys(ze.svgNodeCache[o]).forEach((function(e){ze.svgNodeCache[o][e].touched=!1})),{svgLayerElement:a,svgNodeCacheForCanvas:ze.svgNodeCache,getSvgNode:kr.bind(this,o),appendNode:Mr.bind(this,a,o),setNodeTouched:Rr.bind(this,o),clearUntouched:Pr.bind(this,a,o)}}(e);t(n),n.clearUntouched()},Ar=function(e,t){var n=ze.toolGroups.filter((function(n){return n.viewportsInfo.some((function(n){return n.renderingEngineId===t&&(!n.viewportId||n.viewportId===e)}))}));if(n.length){if(n.length>1)throw new Error("Multiple tool groups found for renderingEngineId: ".concat(t," and viewportId: ").concat(e,". You should only\n      have one tool group per viewport in a renderingEngine."));return n[0]}};function Lr(e,t){var n=(0,Y.getEnabledElement)(e),r=n.renderingEngineId,o=n.viewportId,a=Ar(o,r);if(!a)return[];for(var i=[],l=Object.keys(a.toolOptions),c=0;c<l.length;c++){var s=l[c],d=a.toolOptions[s];if(d&&t.includes(d.mode)){var u=a.getToolInstance(s);i.push(u)}}return i}function Ur(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Vr=Ke.Active,Br=Ke.Passive,jr=Ke.Enabled,Hr=function(){function e(){var t=this;X(this,e),Q(this,"hasBeenDestroyed",void 0),Q(this,"_needsRender",new Set),Q(this,"_animationFrameSet",!1),Q(this,"_animationFrameHandle",null),Q(this,"_viewportElements",void 0),Q(this,"_renderFlaggedViewports",(function(){t._throwIfDestroyed();for(var e=Array.from(t._viewportElements.values()),n=0;n<e.length;n++){var r=e[n];if(t._needsRender.has(r)&&(t._triggerRender(r),t._needsRender.delete(r),0===t._needsRender.size))return t._animationFrameSet=!1,void(t._animationFrameHandle=null)}})),this._viewportElements=new Map}return Z(e,[{key:"addViewportElement",value:function(e,t){this._viewportElements.set(e,t)}},{key:"removeViewportElement",value:function(e,t){this._viewportElements.delete(e),this._needsRender.delete(t),this._reset()}},{key:"renderViewport",value:function(e){this._setViewportsToBeRenderedNextFrame([e])}},{key:"_throwIfDestroyed",value:function(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}},{key:"_setAllViewportsToBeRenderedNextFrame",value:function(){var e=this;xr(this._viewportElements.values()).forEach((function(t){e._needsRender.add(t)})),this._renderFlaggedViewports()}},{key:"_setViewportsToBeRenderedNextFrame",value:function(e){var t=this,n=xr(this._viewportElements.values());e.forEach((function(e){-1!==n.indexOf(e)&&t._needsRender.add(e)})),this._render()}},{key:"_render",value:function(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedViewports),this._animationFrameSet=!0)}},{key:"_triggerRender",value:function(e){var t=(0,Y.getEnabledElement)(e);if(t)if((0,Y.getRenderingEngine)(t.renderingEngineId)){var n=Lr(e,[Vr,Br,jr]),r=t.renderingEngineId,o=t.viewportId,a={element:e,renderingEngineId:r,viewportId:o};Nr(e,(function(r){var o=!1;n.forEach((function(e){if(e.renderAnnotation){var n=e.renderAnnotation(t,r);o=o||n}})),o&&(0,Y.triggerEvent)(e,J.ANNOTATION_RENDERED,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ur(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ur(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},a))}))}else console.warn("rendering Engine has been destroyed");else console.warn("Element has been disabled")}},{key:"_reset",value:function(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null,this._setAllViewportsToBeRenderedNextFrame()}}]),e}(),Wr=new Hr,Fr=function(e){Wr.renderViewport(e)},Gr=function(e){Fr(e.detail.element)};function qr(e,t,n){var r=e.detail,o=r.renderingEngineId,a=r.viewportId,i=Ar(a,o);if(!i)return[];for(var l=[],c=Object.keys(i.toolOptions),s=0;s<c.length;s++){var d=c[s],u=i.toolOptions[d],v=null!=n&&u.bindings.length&&u.bindings.some((function(e){return e.mouseButton===n}));if(t.includes(u.mode)&&(!n||v)){var f=i.getToolInstance(d);l.push(f)}}return l}var zr=Ke.Active,Kr=Ke.Passive,Yr=Ke.Enabled,Jr=function(e){qr(e,[zr,Kr,Yr]).forEach((function(t){t.onCameraModified&&t.onCameraModified(e)}))},$r=Ke.Active,Zr=Ke.Passive,Xr=Ke.Enabled,Qr=function(e){qr(e,[$r,Zr,Xr]).forEach((function(t){t.onImageSpacingCalibrated&&t.onImageSpacingCalibrated(e)}))},eo=Ke.Active;function to(e,t,n){if(ze.isInteractingWithTool)return!1;var r,o=n.detail,a=o.renderingEngineId,i=o.viewportId,l=Ar(i,a);if(!l)return!1;for(var c=Object.keys(l.toolOptions),s=0;s<c.length;s++){var d=c[s],u=l.toolOptions[d],v=l.getToolInstance(d);if(u.mode===eo&&"function"==typeof v[t]){r=l.getToolInstance(d);break}}r&&r[t](n)}var no,ro,oo=to.bind(null,"Mouse","mouseClickCallback");function ao(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return io(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?io(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function io(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lo(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o="touch"===r?36:6,a=[];return t.forEach((function(t){var r,i=t.tool,l=ao(t.annotations);try{for(l.s();!(r=l.n()).done;){var c=r.value;if(!c.isLocked&&c.isVisible){var s=i.getHandleNearImagePoint(e,c,n,o);if(s){a.push({tool:i,annotation:c,handle:s});break}}}}catch(e){l.e(e)}finally{l.f()}})),a}function co(e,t){for(var n=[],r=0;r<t.length;r++){var o,a=t[r];if(a){var i=et(a.constructor.toolName,e);null!==(o=i)&&void 0!==o&&o.length&&("function"==typeof a.filterInteractableAnnotationsForElement&&(i=a.filterInteractableAnnotationsForElement(e,i)),i.length>0&&n.push({tool:a,annotations:i}))}else console.warn("undefined tool in filterToolsWithAnnotationsForElement")}return n}function so(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return uo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uo(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function uo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vo(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o="touch"===r?36:6,a=[];return t.forEach((function(t){var i,l=t.tool,c=so(t.annotations);try{for(c.s();!(i=c.n()).done;){var s=i.value;if(!s.isLocked&&s.isVisible&&l.isPointNearTool(e,s,n,o,r)){a.push({tool:l,annotation:s});break}}}catch(e){c.e(e)}finally{c.f()}})),a}!function(e){e[e.Primary=1]="Primary",e[e.Secondary=2]="Secondary",e[e.Primary_And_Secondary=3]="Primary_And_Secondary",e[e.Auxiliary=4]="Auxiliary",e[e.Primary_And_Auxiliary=5]="Primary_And_Auxiliary",e[e.Secondary_And_Auxiliary=6]="Secondary_And_Auxiliary",e[e.Primary_And_Secondary_And_Auxiliary=7]="Primary_And_Secondary_And_Auxiliary",e[e.Fourth_Button=8]="Fourth_Button",e[e.Fifth_Button=16]="Fifth_Button"}(no||(no={})),function(e){e[e.Shift=16]="Shift",e[e.Ctrl=17]="Ctrl",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta",e[e.ShiftCtrl=1617]="ShiftCtrl",e[e.ShiftAlt=1618]="ShiftAlt",e[e.ShiftMeta=1691]="ShiftMeta",e[e.CtrlAlt=1718]="CtrlAlt",e[e.CtrlMeta=1791]="CtrlMeta",e[e.AltMeta=1891]="AltMeta"}(ro||(ro={}));var fo=function(e){return e.shiftKey?e.ctrlKey?ro.ShiftCtrl:e.altKey?ro.ShiftAlt:e.metaKey?ro.ShiftMeta:ro.Shift:e.ctrlKey?e.altKey?ro.CtrlAlt:e.metaKey?ro.CtrlMeta:ro.Ctrl:e.altKey?e.metaKey&&ro.AltMeta||ro.Alt:void(e.metaKey&&ro.Meta)},go=Ke.Active;function ho(e){var t=e.detail,n=t.renderingEngineId,r=t.viewportId,o=e.detail.event,a=Sr.getModifierKey()||fo(o),i=Ar(r,n);if(!i)return null;for(var l=Object.keys(i.toolOptions),c=0;c<l.length;c++){var s=l[c],d=i.toolOptions[s],u=d.bindings.length&&d.bindings.some((function(e){return e.mouseButton===(o?o.buttons:no.Primary)&&e.modifierKey===a}));if(d.mode===go&&u)return i.getToolInstance(s)}}var po=Ke.Active,mo=Ke.Passive;function wo(e){if(!ze.isInteractingWithTool){var t=ho(e);if(t&&"function"==typeof t.preMouseDownCallback&&t.preMouseDownCallback(e))return;var n=1===e.detail.event.buttons,r=qr(e,[po],e.detail.event.buttons),o=n?qr(e,[mo]):void 0,a=[].concat(xr(r||[]),xr(o||[])),i=e.detail,l=i.element,c=co(l,a),s=i.currentPoints.canvas,d=lo(l,c,s,"mouse"),u=!!e.detail.event.shiftKey;if(d.length>0){var v=Eo(d),f=v.tool,g=v.annotation,h=v.handle;return yo(g.annotationUID,u),void f.handleSelectedCallback(e,g,h,"Mouse")}var p=vo(l,c,s,"mouse");if(p.length>0){var m=Eo(p),w=m.tool,E=m.annotation;return yo(E.annotationUID,u),void w.toolSelectedCallback(e,E,"Mouse")}if(t&&"function"==typeof t.postMouseDownCallback&&t.postMouseDownCallback(e))return}}function Eo(e){return e.length>1&&e.find((function(e){return!ie(e.annotation)&&xe(e.annotation.annotationUID)}))||e[0]}function yo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)if(Ie(e))pe(e,!1);else{var n=!0;pe(e,!0,n)}else{var r=!1;pe(e,!0,r)}}function Io(e){if(!ze.isInteractingWithTool){var t=ho(e);t&&(ze.isMultiPartToolActive||t.addNewAnnotation&&pe(t.addNewAnnotation(e,"mouse").annotationUID))}}var bo=to.bind(null,"Mouse","doubleClickCallback");function Co(e){if(!ze.isInteractingWithTool){var t=ho(e);!t||"function"!=typeof t.mouseDragCallback||t.mouseDragCallback(e)}}function To(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var _o=Ke.Active,Oo=Ke.Passive;function Do(e){if(!ze.isInteractingWithTool&&!ze.isMultiPartToolActive){var t,n=qr(e,[_o,Oo]),r=e.detail.element,o=co(r,n),a=n.filter((function(e){return!o.some((function(t){return t.tool.getToolName()===e.getToolName()}))})),i=!1,l=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return To(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?To(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(o);try{for(l.s();!(t=l.n()).done;){var c=t.value,s=c.tool,d=c.annotations;"function"==typeof s.mouseMoveCallback&&(i=s.mouseMoveCallback(e,d)||i)}}catch(e){l.e(e)}finally{l.f()}a.forEach((function(t){"function"==typeof t.mouseMoveCallback&&t.mouseMoveCallback(e)})),!0===i&&Fr(r)}}var So=to.bind(null,"Mouse","mouseUpCallback"),xo=to.bind(null,"MouseWheel","mouseWheelCallback"),ko=function(e){e.addEventListener(J.MOUSE_CLICK,oo),e.addEventListener(J.MOUSE_DOWN,wo),e.addEventListener(J.MOUSE_DOWN_ACTIVATE,Io),e.addEventListener(J.MOUSE_DOUBLE_CLICK,bo),e.addEventListener(J.MOUSE_DRAG,Co),e.addEventListener(J.MOUSE_MOVE,Do),e.addEventListener(J.MOUSE_UP,So),e.addEventListener(J.MOUSE_WHEEL,xo)},Mo=function(e){e.removeEventListener(J.MOUSE_CLICK,oo),e.removeEventListener(J.MOUSE_DOWN,wo),e.removeEventListener(J.MOUSE_DOWN_ACTIVATE,Io),e.removeEventListener(J.MOUSE_DOUBLE_CLICK,bo),e.removeEventListener(J.MOUSE_DRAG,Co),e.removeEventListener(J.MOUSE_MOVE,Do),e.removeEventListener(J.MOUSE_UP,So),e.removeEventListener(J.MOUSE_WHEEL,xo)},Ro=Ke.Active;function Po(e){var t=e.detail,n=t.renderingEngineId,r=t.viewportId,o=rn.mouseButton,a=Sr.getModifierKey(),i=Ar(r,n);if(!i)return null;for(var l=Object.keys(i.toolOptions),c=0;c<l.length;c++){var s=l[c],d=i.toolOptions[s],u=d.bindings.length&&d.bindings.some((function(e){return e.mouseButton===(null!=o?o:no.Primary)&&e.modifierKey===a}));if(d.mode===Ro&&u)return i.getToolInstance(s)}}function No(e){var t=Po(e);if(t){var n=e.detail,r=n.renderingEngineId,o=n.viewportId,a=Ar(o,r),i=t.getToolName();Object.keys(a.toolOptions).includes(i)&&a.setViewportsCursorByToolName(i)}}function Ao(e){var t=Po(e);if(t){var n=e.detail,r=n.renderingEngineId,o=n.viewportId,a=Ar(o,r);Cr.keyCode=void 0;var i=t.getToolName();Object.keys(a.toolOptions).includes(i)&&a.setViewportsCursorByToolName(i)}}var Lo=function(e){e.addEventListener(J.KEY_DOWN,No),e.addEventListener(J.KEY_UP,Ao)},Uo=function(e){e.removeEventListener(J.KEY_DOWN,No),e.removeEventListener(J.KEY_UP,Ao)},Vo=Ke.Active;function Bo(e){var t=e.detail,n=t.renderingEngineId,r=t.viewportId,o=e.detail.event,a=Ar(r,n);if(!a)return null;for(var i=Object.keys(a.toolOptions),l=Object.keys(o.touches).length,c=fo(o),s=0;s<i.length;s++){var d=i[s],u=a.toolOptions[d],v=u.bindings.length&&u.bindings.some((function(e){return(e.numTouchPoints===l||1===l&&e.mouseButton===no.Primary)&&e.modifierKey===c}));if(u.mode===Vo&&v)return a.getToolInstance(d)}}function jo(e,t,n){var r=e.detail,o=r.renderingEngineId,a=r.viewportId,i=Ar(a,o);if(!i)return[];for(var l=[],c=Object.keys(i.toolOptions),s=0;s<c.length;s++){var d=c[s],u=i.toolOptions[d],v=null!=n&&u.bindings.length&&u.bindings.some((function(e){return e.numTouchPoints===n}));if(t.includes(u.mode)&&(!n||v)){var f=i.getToolInstance(d);l.push(f)}}return l}var Ho=Ke.Active,Wo=Ke.Passive;function Fo(e){if(!ze.isInteractingWithTool){var t=Bo(e);if(t&&"function"==typeof t.preTouchStartCallback&&t.preTouchStartCallback(e))return;var n=1===Object.keys(e.detail.event.touches).length,r=jo(e,[Ho],Object.keys(e.detail.event.touches).length),o=n?jo(e,[Wo]):void 0,a=[].concat(xr(r||[]),xr(o||[]),[t]),i=e.detail,l=i.element,c=co(l,a),s=i.currentPoints.canvas,d=lo(l,c,s,"touch");if(d.length>0){var u=Go(d),v=u.tool,f=u.annotation,g=u.handle;return qo(f.annotationUID,!1),void v.handleSelectedCallback(e,f,g,"Touch")}var h=vo(l,c,s,"touch");if(h.length>0){var p=Go(h),m=p.tool,w=p.annotation;return qo(w.annotationUID,!1),void m.toolSelectedCallback(e,w,"Touch")}if(t&&"function"==typeof t.postTouchStartCallback&&t.postTouchStartCallback(e))return}}function Go(e){return e.length>1&&e.find((function(e){return!ie(e.annotation)&&xe(e.annotation.annotationUID)}))||e[0]}function qo(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)if(Ie(e))pe(e,!1);else{var n=!0;pe(e,!0,n)}else{var r=!1;pe(e,!0,r)}}function zo(e){if(!ze.isInteractingWithTool){var t=Bo(e);t&&(ze.isMultiPartToolActive||t.addNewAnnotation&&pe(t.addNewAnnotation(e,"touch").annotationUID))}}function Ko(e){if(!ze.isInteractingWithTool){var t=Bo(e);!t||"function"!=typeof t.touchDragCallback||t.touchDragCallback(e)}}var Yo=to.bind(null,"Touch","touchEndCallback"),Jo=to.bind(null,"Touch","touchTapCallback"),$o=to.bind(null,"Touch","touchPressCallback"),Zo=function(e){e.addEventListener(J.TOUCH_START,Fo),e.addEventListener(J.TOUCH_START_ACTIVATE,zo),e.addEventListener(J.TOUCH_DRAG,Ko),e.addEventListener(J.TOUCH_END,Yo),e.addEventListener(J.TOUCH_TAP,Jo),e.addEventListener(J.TOUCH_PRESS,$o)},Xo=function(e){e.removeEventListener(J.TOUCH_START,Fo),e.removeEventListener(J.TOUCH_START_ACTIVATE,zo),e.removeEventListener(J.TOUCH_DRAG,Ko),e.removeEventListener(J.TOUCH_END,Yo),e.removeEventListener(J.TOUCH_PRESS,$o)};function Qo(e){var t,n=e.detail,r=n.element,o=n.viewportId,a=function(e){var t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),r="svg-layer-".concat(e);n.classList.add("svg-layer"),n.setAttribute("id",r),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.position="absolute";var o=document.createElementNS(t,"defs"),a=document.createElementNS(t,"filter"),i=document.createElementNS(t,"feOffset"),l=document.createElementNS(t,"feColorMatrix"),c=document.createElementNS(t,"feBlend");return a.setAttribute("id","shadow-".concat(r)),a.setAttribute("filterUnits","userSpaceOnUse"),i.setAttribute("result","offOut"),i.setAttribute("in","SourceGraphic"),i.setAttribute("dx","0.5"),i.setAttribute("dy","0.5"),l.setAttribute("result","matrixOut"),l.setAttribute("in","offOut"),l.setAttribute("in2","matrix"),l.setAttribute("values","0.2 0 0 0 0 0 0.2 0 0 0 0 0 0.2 0 0 0 0 0 1 0"),c.setAttribute("in","SourceGraphic"),c.setAttribute("in2","matrixOut"),c.setAttribute("mode","normal"),a.appendChild(i),a.appendChild(l),a.appendChild(c),o.appendChild(a),n.appendChild(o),n}(o);!function(e){var t=e.dataset,n=t.viewportUid,r=t.renderingEngineUid,o="".concat(n,":").concat(r);ze.svgNodeCache[o]={}}(r),t=a,r.querySelector("div.viewport-element").appendChild(t),Wr.addViewportElement(o,r),In.enable(r),On.enable(r),Ir.enable(r),Sr.enable(r),function(e){e.addEventListener(Y.Enums.Events.IMAGE_RENDERED,Gr)}(r),function(e){e.addEventListener(Y.Enums.Events.CAMERA_MODIFIED,Jr)}(r),function(e){e.addEventListener(Y.Enums.Events.IMAGE_SPACING_CALIBRATED,Qr)}(r),ko(r),Lo(r),Zo(r),ze.enabledElements.push(r)}var ea=function(e,t){var n=[];if(!t&&!e)throw new Error("At least one of renderingEngineId or viewportId should be given");for(var r=0;r<ze.synchronizers.length;r++){var o=ze.synchronizers[r],a=!o.isDisabled(),i=o.hasSourceViewport(t,e),l=o.hasTargetViewport(t,e);a&&(i||l)&&n.push(o)}return n},ta=function(e){var t=e.detail,n=t.element,r=t.viewportId;!function(e){var t=e.dataset,n=t.viewportUid,r=t.renderingEngineUid,o="".concat(n,":").concat(r);delete ze.svgNodeCache[o]}(n),function(e){var t=e.querySelector("div.".concat("viewport-element")),n=t.querySelector("svg");n&&t.removeChild(n)}(n),Wr.removeViewportElement(r,n),In.disable(n),On.disable(n),Ir.disable(n),Sr.disable(n),function(e){e.removeEventListener(Y.Enums.Events.IMAGE_RENDERED,Gr)}(n),function(e){e.removeEventListener(Y.Enums.Events.CAMERA_MODIFIED,Jr)}(n),function(e){e.removeEventListener(Y.Enums.Events.IMAGE_SPACING_CALIBRATED,Qr)}(n),Mo(n),Uo(n),Xo(n),function(e){var t=(0,Y.getEnabledElement)(e);ea(t.viewportId,t.renderingEngineId).forEach((function(e){e.remove(t)}))}(n),function(e){var t=(0,Y.getEnabledElement)(e),n=t.renderingEngineId,r=t.viewportId,o=Ar(r,n);o&&o.removeViewports(n,r)}(n),function(e){var t=ze.enabledElements.findIndex((function(t){return t===e}));t>-1&&ze.enabledElements.splice(t,1)}(n)},na=function(e,t){t.length&&t.forEach((function(t){var n=e.getViewport(t).element;Fr(n)}))},ra=function(e){var t=e.detail,n=t.viewportId,r=t.renderingEngineId,o=(0,Y.getRenderingEngine)(r);na(o,[n])},oa=function(e){e.detail.removed.length&&(0,Y.getRenderingEngines)().forEach((function(e){var t=e.getViewports().map((function(e){return e.id}));na(e,t)}))},aa=function(e){var t=e.detail.segmentationId;Mt(t).forEach((function(e){kt(e).forEach((function(n){n.segmentationId===t&&It(e,n.segmentationRepresentationUID)}))}))},ia=function(e){return ze.toolGroups.find((function(t){return t.id===e}))};function la(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ca(e,t){return ca=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ca(e,t)}function sa(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ca(e,t)}function da(e){return da="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},da(e)}function ua(e,t){if(t&&("object"===da(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return la(e)}function va(e){return va=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},va(e)}function fa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ga(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fa(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ha(){return Bt()}function pa(e){jt(e)}function ma(e){return ha().representations[e]}function wa(e,t){var n=ha();pa(ga(ga({},n),{},{representations:ga(ga({},n.representations),{},Q({},e,ga(ga({},n.representations[e]),t)))}))}function Ea(e){return Rt(e)}function ya(e,t){Pt(e,t)}function Ia(e,t){return At(e,t)}function ba(e,t,n){Nt(e,t,n)}function Ca(e,t,n){return Lt(e,t,n)}function Ta(e,t,n){Ut(e,t,n)}function _a(e,t,n){var r=kt(e);if(r){var o=r.find((function(e){return e.segmentationRepresentationUID===t}));if(o){var a=o.segmentsHidden,i=function(e){var t=Dt(e);if(t.type===st.Labelmap){var n=Y.cache.getVolume(e).getScalarData(),r={};return n.forEach((function(e){return r[e]=e})),Object.keys(r).map((function(e){return parseInt(e,10)}))}if(t.type===st.Contour){var o,a=null===(o=t.representationData.CONTOUR)||void 0===o?void 0:o.geometryIds;if(!a)throw new Error("No geometryIds found for segmentationId ".concat(e));return a.map((function(e){return Y.cache.getGeometry(e).data.getSegmentIndex()}))}}(o.segmentationId);n?a.clear():i.forEach((function(e){a.add(e)})),It(e,o.segmentationRepresentationUID)}}}function Oa(e,t){var n=kt(e).find((function(e){return e.segmentationRepresentationUID===t}));if(n)return 0===n.segmentsHidden.size}function Da(e,t,n,r){var o=Ht(e,t);o&&(n.forEach((function(e){r?o.segmentsHidden.delete(e):o.segmentsHidden.add(e)})),It(e,t))}function Sa(e,t,n,r){var o=Ht(e,t);o&&(r?o.segmentsHidden.delete(n):o.segmentsHidden.add(n),It(e,t))}var xa=function(){function e(t,n){X(this,e),Q(this,"supportedInteractionTypes",void 0),Q(this,"configuration",void 0),Q(this,"toolGroupId",void 0),Q(this,"mode",void 0);var r=Y.utilities.deepMerge(n,t),o=r.configuration,a=void 0===o?{}:o,i=r.supportedInteractionTypes,l=r.toolGroupId;a.strategies||(a.strategies={},a.defaultStrategy=void 0,a.activeStrategy=void 0,a.strategyOptions={}),this.toolGroupId=l,this.supportedInteractionTypes=i||[],this.configuration=Object.assign({},a),this.mode=Ke.Disabled}return Z(e,[{key:"getToolName",value:function(){return this.constructor.toolName}},{key:"applyActiveStrategy",value:function(e,t){var n=this.configuration;return n.strategies[n.activeStrategy].call(this,e,t)}},{key:"setConfiguration",value:function(e){this.configuration=Y.utilities.deepMerge(this.configuration,e)}},{key:"setActiveStrategy",value:function(e){this.setConfiguration({activeStrategy:e})}},{key:"getTargetVolumeId",value:function(e){var t;if(this.configuration.volumeId)return this.configuration.volumeId;var n=e.getActors();return n?null===(t=n.find((function(e){return"vtkVolume"===e.actor.getClassName()})))||void 0===t?void 0:t.uid:void 0}},{key:"getTargetIdImage",value:function(e,t){if(e.startsWith("imageId:")){var n=e.split("imageId:")[1],r=Y.utilities.imageIdToURI(n),o=Y.utilities.getViewportsWithImageURI(r,t.id);if(!o||!o.length)return;if(!(o=o.filter((function(e){return e.getCurrentImageId()===n})))||!o.length)return;return o[0].getImageData()}if(e.startsWith("volumeId:")){var a=e.split("volumeId:")[1],i=Y.utilities.getViewportsWithVolumeId(a,t.id);if(!i||!i.length)return;return i[0].getImageData()}throw new Error('getTargetIdImage: targetId must start with "imageId:" or "volumeId:"')}},{key:"getTargetId",value:function(e){if(e instanceof Y.StackViewport)return"imageId:".concat(e.getCurrentImageId());if(e instanceof Y.VolumeViewport)return"volumeId:".concat(this.getTargetVolumeId(e));throw new Error("getTargetId: viewport must be a StackViewport or VolumeViewport")}}]),e}();Q(xa,"toolName",void 0),xa.toolName="BaseTool";var ka=xa;function Ma(e,t,n,r,o,a,i){try{var l=e[a](i),c=l.value}catch(e){return void n(e)}l.done?t(c):Promise.resolve(c).then(r,o)}function Ra(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){Ma(a,r,o,i,l,"next",e)}function l(e){Ma(a,r,o,i,l,"throw",e)}i(void 0)}))}}var Pa=h(162),Na=h.n(Pa),Aa=h(785),La=h.n(Aa),Ua=h(127),Va=h.n(Ua),Ba=h(474),ja=h.n(Ba),Ha=h(610),Wa=h.n(Ha),Fa=h(396),Ga=h.n(Fa),qa=h(348),za=h.n(qa),Ka=h(70),Ya=h.n(Ka);function Ja(e){var t=[],n=za().newInstance(),r=Ga().newInstance(),o=0;e.getContours().forEach((function(e){var n=e.getPoints(),a=e.getFlatPointsArray(),i=e.getType(),l=n.map((function(e,t){return t+o}));i===Y.Enums.ContourType.CLOSED_PLANAR&&l.push(l[0]);var c=Float32Array.from(a);t.push.apply(t,xr(c)),r.insertNextCell(xr(l)),o+=n.length})),n.setData(t,3);var a=Ya().newInstance();return a.setPoints(n),a.setLines(r),a}var $a=new Map;function Za(e){return $a.get(e)}function Xa(e,t){$a.set(e,t)}function Qa(e,t,n,r,o){var a=n.segmentationRepresentationUID,i=n.segmentsHidden,l=Va().newInstance(),c=new Map,s=new Map;t.forEach((function(e){var t=Y.cache.getGeometry(e);if(t){var r=t.data.getSegmentIndex();!function(e){if(!e)throw new Error("No contours found for geometryId ".concat(e.id));var t=e.id;if(e.type!==Y.Enums.GeometryType.CONTOUR)throw new Error("Geometry type ".concat(e.type," not supported for rendering."));e.data||console.warn("No contours found for geometryId ".concat(t,". Skipping render."))}(t);for(var o=function(e,t,n){var r,o,a=null===(r=e.segmentSpecificConfig)||void 0===r?void 0:r[t];return a||(a=null===(o=e.segmentSpecificConfig)||void 0===o?void 0:o[n]),a?a.CONTOUR:null}(n,e,r),a=t.data,d=Ja(a),u=a.getColor(),v=d.getPoints().getNumberOfPoints(),f=La().newInstance({size:4*v,numberOfComponents:4,dataType:"Uint8Array"}),g=0;g<v;++g)f.setTuple(g,[].concat(xr(u),[255]));d.getPointData().setScalars(f),o&&s.set(r,o),c.set(r,[].concat(xr(u),[i.has(r)?0:255])),0===r?l.setInputData(d):l.addInputData(d)}else console.warn("No geometry found for geometryId ".concat(e,". Skipping render."))}));var d=l.getOutputData(),u=r.representations.CONTOUR.outlineWidthActive,v=Wa().newInstance();v.setInputData(d);var f=ja().newInstance();f.setMapper(v),f.getProperty().setLineWidth(u),Xa(a,Object.assign({},Za(a),{segmentsHidden:new Set(i),segmentSpecificMap:s,outlineWidthActive:u})),f.setForceOpaque(!0),e.addActor({uid:o,actor:f}),e.resetCamera(),e.render()}function ei(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return ti(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ti(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function ti(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ni(e,t,n,r,o){var a=n.segmentationRepresentationUID,i=n.segmentsHidden,l=r.representations.CONTOUR,c=Za(a),s=e.getActor(o);if(s){var d=s.actor,u=l.outlineWidthActive;(null==c?void 0:c.outlineWidthActive)!==u&&(d.getProperty().setLineWidth(u),Xa(a,Object.assign({},c,{outlineWidthActive:u})));var v,f=d.getMapper(),g=f.getLookupTable(),h=[],p=[],m=ei(i);try{for(m.s();!(v=m.n()).done;){var w=v.value;null!=c&&c.segmentsHidden.has(w)||h.push(w)}}catch(e){m.e(e)}finally{m.f()}var E,y=ei(c.segmentsHidden);try{for(y.s();!(E=y.n()).done;){var I=E.value;i.has(I)||p.push(I)}}catch(e){y.e(e)}finally{y.f()}if(h.length||p.length){var b=Va().newInstance();t.forEach((function(e){for(var t=Y.cache.getGeometry(e).data,n=t.getSegmentIndex(),r=t.getColor(),o=h.includes(n)?0:255,a=Ja(t),i=a.getPoints().getNumberOfPoints(),l=La().newInstance({size:4*i,numberOfComponents:4,dataType:"Uint8Array"}),c=0;c<i;++c)l.setTuple(c,[].concat(xr(r),[o]));a.getPointData().setScalars(l),0===n?b.setInputData(a):b.addInputData(a)}));var C=b.getOutputData();f.setInputData(C),Xa(a,Object.assign({},c,{segmentsHidden:new Set(i)})),f.setLookupTable(g)}e.render()}else console.warn("No contour actor found for actorUID ".concat(o,". Skipping render."))}function ri(e,t,n,r){var o=n.segmentationRepresentationUID,a="CONTOUR_".concat(o);(e.getActor(a)?ni:Qa)(e,t,n,r,a)}var oi=function(e,t){var n=(0,Y.getEnabledElement)(e).viewport,r=n.getActors().map((function(e){var n=e.uid;return n.startsWith(t)?n:void 0})).filter(Boolean);n.removeActors(r)};function ai(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ai(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ai(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function li(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ci(){return(ci=Ra(Na().mark((function e(t,n,r){var o,a,i,l,c,s;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.segmentationId,a=Y.utilities.uuidv4(),i=new Set,l={segmentationId:o,segmentationRepresentationUID:a,type:st.Contour,segmentsHidden:i,colorLUTIndex:0,active:!0,segmentationRepresentationSpecificConfig:{},segmentSpecificConfig:{},config:{}},r&&(c=Ea(t),s=Y.utilities.deepMerge(c,r),ya(t,{renderInactiveSegmentations:s.renderInactiveSegmentations||!0,representations:ii({},s.representations)})),Vt(t,l),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function si(){return(si=Ra(Na().mark((function e(t,n,r){var o,a,i,l;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=n.segmentationId,a=Dt(o),i=a.representationData[st.Contour],null!=(l=i.geometryIds)&&l.length||console.warn("No contours found for segmentationId ".concat(o,". Skipping render.")),ri(t,l,n,r);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function di(e,t){var n=ia(e);if(void 0===n)throw new Error("ToolGroup with ToolGroupId ".concat(e," does not exist"));var r,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return li(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?li(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(n.viewportsInfo);try{for(o.s();!(r=o.n()).done;){var a=r.value,i=a.viewportId,l=a.renderingEngineId,c=(0,Y.getEnabledElementByIds)(i,l);oi(c.viewport.element,t)}}catch(e){o.e(e)}finally{o.f()}}var ui={render:function(e,t,n){return si.apply(this,arguments)},addSegmentationRepresentation:function(e,t,n){return ci.apply(this,arguments)},removeSegmentationRepresentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(di(e,t),Ft(e,t),n){var r=ia(e).getViewportsInfo();r.forEach((function(e){var t=e.viewportId,n=e.renderingEngineId;(0,Y.getEnabledElementByIds)(t,n).viewport.render()}))}}},vi=h(441),fi=h.n(vi),gi=h(795),hi=h.n(gi);function pi(){return(pi=Ra(Na().mark((function e(t,n,r){var o,a,i,l,c;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=(0,Y.getEnabledElement)(t),a=o.renderingEngine,i=o.viewport,l=i.id,c=[{volumeId:n,actorUID:r,visibility:!0,blendMode:Y.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND}],e.next=9,(0,Y.addVolumesToViewports)(a,c,[l],!1,!0);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var mi=function(e,t,n){return pi.apply(this,arguments)},wi=function(e,t){(0,Y.getEnabledElement)(e).viewport.removeVolumeActors([t])};function Ei(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function yi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yi(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bi=new Map;function Ci(){return(Ci=Ra(Na().mark((function e(t,n,r){var o,a,i,l,c,s,d,u;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=n.segmentationId,a=Y.utilities.uuidv4(),i=new Set,l=hi().newInstance(),(c=fi().newInstance()).addPoint(0,0),s={segmentationId:o,segmentationRepresentationUID:a,type:st.Labelmap,segmentsHidden:i,colorLUTIndex:0,active:!0,segmentationRepresentationSpecificConfig:{},segmentSpecificConfig:{},config:{cfun:l,ofun:c}},r&&(d=Ea(t),u=Y.utilities.deepMerge(d,r),ya(t,{renderInactiveSegmentations:u.renderInactiveSegmentations||!0,representations:Ii({},u.representations)})),Vt(t,s),e.abrupt("return",a);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ti(){return(Ti=Ra(Na().mark((function e(t,n,r){var o,a,i,l,c,s,d,u,v,f,g,h,p,m,w,E;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=n.colorLUTIndex,a=n.active,i=n.segmentationId,l=n.segmentationRepresentationUID,c=n.segmentsHidden,s=n.config,d=Dt(i),u=d.representationData[st.Labelmap],v=u.volumeId,Y.cache.getVolume(v)){e.next=7;break}throw new Error("No Labelmap found for volumeId: ".concat(v));case 7:if(f=t.getActor(l)){e.next=14;break}return g=Dt(i),h=g.representationData[st.Labelmap].volumeId,e.next=13,xi(t,h,l);case 13:f=t.getActor(l);case 14:m=(p=s).cfun,w=p.ofun,E=r.renderInactiveSegmentations,_i(t.id,f,m,w,o,r.representations[st.Labelmap],n,a,E,c);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _i(e,t,n,r,o,a,i,l,c,s){for(var d=i.segmentSpecificConfig,u=i.segmentationRepresentationSpecificConfig[st.Labelmap],v=qt(o),f=Math.min(256,v.length),g=t.actor,h=t.uid,p=Oi(a,u,l),m=p.outlineWidth,w=p.renderOutline,E=p.outlineOpacity,y=0;y<f;y++){var I,b=y,C=v[b],T=Oi(a,u,l,null===(I=d[b])||void 0===I?void 0:I[st.Labelmap]),_=T.fillAlpha,O=T.outlineWidth,D=T.renderFill,S=Di(e,h,b,{fillAlpha:_,renderFill:D,renderOutline:T.renderOutline,segmentColor:C,outlineWidth:O,segmentsHidden:s}),x=S.forceOpacityUpdate;if(S.forceColorUpdate&&n.addRGBPoint(b,C[0]/255,C[1]/255,C[2]/255),x)if(D){var k=s.has(b)?0:C[3]/255*_;r.removePoint(b),r.addPointLong(b,k,.5,1)}else r.addPointLong(b,.01,.5,1)}g.getProperty().setRGBTransferFunction(0,n),r.setClamping(!1),g.getProperty().setScalarOpacity(0,r),g.getProperty().setInterpolationTypeToNearest(),g.getProperty().setUseLabelOutline(w),g.getProperty().setLabelOutlineOpacity(E),g.getProperty().setLabelOutlineThickness(m);var M=l||c;g.setVisibility(M)}function Oi(e,t,n,r){var o=r||{},a=Ii(Ii(Ii({},e),t),o);return{fillAlpha:n?a.fillAlpha:a.fillAlphaInactive,outlineWidth:n?a.outlineWidthActive:a.outlineWidthInactive,renderFill:n?a.renderFill:a.renderFillInactive,renderOutline:a.renderOutline,outlineOpacity:n?a.outlineOpacity:a.outlineOpacityInactive}}function Di(e,t,n,r){var o=r.fillAlpha,a=r.renderFill,i=r.renderOutline,l=r.segmentColor,c=r.outlineWidth,s=r.segmentsHidden,d="".concat(e,"-").concat(t,"-").concat(n),u=bi.get(d);if(!u)return bi.set(d,{fillAlpha:o,renderFill:a,renderOutline:i,outlineWidth:c,segmentColor:l,segmentsHidden:new Set(s)}),{forceOpacityUpdate:!0,forceColorUpdate:!0};var v=u.fillAlpha,f=u.renderFill,g=u.renderOutline,h=u.outlineWidth,p=u.segmentColor,m=u.segmentsHidden,w=p[0]!==l[0]||p[1]!==l[1]||p[2]!==l[2],E=p[3]!==l[3]||v!==o||f!==a||g!==i||h!==c||m.has(n)!==s.has(n);return bi.set(d,{fillAlpha:o,renderFill:a,renderOutline:i,outlineWidth:c,segmentColor:l.slice(),segmentsHidden:new Set(s)}),{forceOpacityUpdate:E,forceColorUpdate:w}}function Si(e,t){var n=ia(e);if(void 0===n)throw new Error("ToolGroup with ToolGroupId ".concat(e," does not exist"));var r,o=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ei(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ei(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(n.viewportsInfo);try{for(o.s();!(r=o.n()).done;){var a=r.value,i=a.viewportId,l=a.renderingEngineId,c=(0,Y.getEnabledElementByIds)(i,l);wi(c.viewport.element,t)}}catch(e){o.e(e)}finally{o.f()}}function xi(e,t,n){return ki.apply(this,arguments)}function ki(){return(ki=Ra(Na().mark((function e(t,n,r){return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mi(t.element,n,r);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Mi={render:function(e,t,n){return Ti.apply(this,arguments)},addSegmentationRepresentation:function(e,t,n){return Ci.apply(this,arguments)},removeSegmentationRepresentation:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Si(e,t),Ft(e,t),n){var r=ia(e).getViewportsInfo();r.forEach((function(e){var t=e.viewportId,n=e.renderingEngineId;(0,Y.getEnabledElementByIds)(t,n).viewport.render()}))}}};function Ri(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Pi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pi(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function Pi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ni=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{configuration:{}};return X(this,o),Q(la(e=r.call(this,t,n)),"renderSegmentation",(function(t){var n=ia(t);if(n){var r=kt(t);if(r&&0!==r.length){var o=n.viewportsInfo.map((function(e){var t=e.renderingEngineId,n=e.viewportId,r=(0,Y.getEnabledElementByIds)(n,t);if(r)return r.viewport})),a=r.map((function(n){var r,a=e._getMergedRepresentationsConfig(t),i=[],l=Ri(o);try{for(l.s();!(r=l.n()).done;){var c=r.value;n.type==st.Labelmap?i.push(Mi.render(c,n,a)):n.type==st.Contour&&i.push(ui.render(c,n,a))}}catch(e){l.e(e)}finally{l.f()}return i}));Promise.allSettled(a).then((function(){o.forEach((function(e){e.render()}))}))}}})),e}return Z(o,[{key:"onSetToolEnabled",value:function(){var e=this.toolGroupId,t=kt(e);t&&0!==t.length&&t.forEach((function(t){_a(e,t.segmentationRepresentationUID,!0)}))}},{key:"onSetToolDisabled",value:function(){var e=this.toolGroupId,t=kt(e);t&&0!==t.length&&t.forEach((function(t){_a(e,t.segmentationRepresentationUID,!1)}))}},{key:"_getMergedRepresentationsConfig",value:function(e){var t=Ea(e),n=ha();return Y.utilities.deepMerge(n,t)}}]),o}(ka);Q(Ni,"toolName",void 0),Ni.toolName="SegmentationDisplay";var Ai=Ni;function Li(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ui=function(){function e(){var t=this;X(this,e),Q(this,"_needsRender",new Set),Q(this,"_animationFrameSet",!1),Q(this,"_animationFrameHandle",null),Q(this,"hasBeenDestroyed",void 0),Q(this,"_renderFlaggedToolGroups",(function(){t._throwIfDestroyed();for(var e=0,n=Array.from(t._needsRender.values());e<n.length;e++){var r=n[e];if(t._triggerRender(r),t._needsRender.delete(r),0===t._needsRender.size)return t._animationFrameSet=!1,void(t._animationFrameHandle=null)}}))}return Z(e,[{key:"removeToolGroup",value:function(e){this._needsRender.delete(e),0===this._needsRender.size&&this._reset()}},{key:"renderToolGroupSegmentations",value:function(e){this._setToolGroupSegmentationToBeRenderedNextFrame([e])}},{key:"_throwIfDestroyed",value:function(){if(this.hasBeenDestroyed)throw new Error("this.destroy() has been manually called to free up memory, can not longer use this instance. Instead make a new one.")}},{key:"_setToolGroupSegmentationToBeRenderedNextFrame",value:function(e){var t=this;e.forEach((function(e){t._needsRender.add(e)})),this._render()}},{key:"_render",value:function(){this._needsRender.size>0&&!1===this._animationFrameSet&&(this._animationFrameHandle=window.requestAnimationFrame(this._renderFlaggedToolGroups),this._animationFrameSet=!0)}},{key:"_triggerRender",value:function(e){var t=ia(e);if(t){var n=t.viewportsInfo,r=[];n.forEach((function(e){var t=e.viewportId,n=e.renderingEngineId,o=(0,Y.getRenderingEngine)(n);o?r.push(o.getViewport(t)):console.warn("rendering Engine has been destroyed")}));var o=t.getToolInstance(Ai.toolName);o?(r.forEach((function(e){e.element.addEventListener(Y.Enums.Events.IMAGE_RENDERED,a)})),o.renderSegmentation(e)):console.warn("No segmentation tool found inside",e)}else console.warn("No tool group found with toolGroupId: ".concat(e));function a(e){var t=e.detail,n=t.element,r=t.viewportId,o=t.renderingEngineId;n.removeEventListener(Y.Enums.Events.IMAGE_RENDERED,a);var i=Ar(r,o);if(i){var l={toolGroupId:i.id,viewportId:r};(0,Y.triggerEvent)(Y.eventTarget,J.SEGMENTATION_RENDERED,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Li(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Li(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},l))}else console.warn("toolGroup has been destroyed")}}},{key:"_reset",value:function(){window.cancelAnimationFrame(this._animationFrameHandle),this._needsRender.clear(),this._animationFrameSet=!1,this._animationFrameHandle=null}}]),e}(),Vi=new Ui;function Bi(e){Vi.renderToolGroupSegmentations(e)}var ji=Bi,Hi=function(e){var t=e.detail,n=t.segmentationId,r=t.modifiedSlicesToUse,o=Dt(n),a=o.representationData,i=o.type;if(i!==st.Labelmap)throw new Error("onSegmentationDataModified: representationType ".concat(i," not supported yet"));var l=Y.cache.getVolume(a[i].volumeId);if(l){var c,s=l.imageData,d=l.vtkOpenGLTexture;if(r&&Array.isArray(r))c=r;else{var u=s.getDimensions()[2];c=xr(Array(u).keys())}c.forEach((function(e){d.setUpdatedFrame(e)})),s.modified(),Mt(n).forEach((function(e){ji(e)}))}else console.warn("segmentation not found in cache")},Wi=function(e){var t=e.detail.toolGroupId;ji(t)},Fi=function(e){var t=e.detail,n=t.toolGroupId;t.segmentationRepresentationUID,ji(n)},Gi=function(e,t,n){var r=kt(e);if(r&&0!==r.length){var o=r.map((function(e){return e.segmentationRepresentationUID})),a=t;if(a){var i=t.filter((function(e){return!o.includes(e)}));if(i.length>0)throw new Error("The following segmentationRepresentationUIDs are not part of the toolGroup: ".concat(JSON.stringify(i)))}else a=o;a.forEach((function(t){!function(e,t,n){var r=Ht(e,t).type;if(r===st.Labelmap)Mi.removeSegmentationRepresentation(e,t,n);else{if(r!==st.Contour)throw new Error("The representation ".concat(r," is not supported yet"));console.debug("Contour representation is not supported yet, ignoring...")}}(e,t,n)}))}},qi=function(e){var t=ze.toolGroups.findIndex((function(t){return t.id===e}));t>-1&&(Vi.removeToolGroup(e),Gi(e),ze.toolGroups.splice(t,1))};function zi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Ki=function(){var e,t=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return zi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zi(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(xr(ze.toolGroups));try{for(t.s();!(e=t.n()).done;){var n=e.value;qi(n.id)}}catch(e){t.e(e)}finally{t.f()}ze.toolGroups=[]},Yi=!1;function Ji(){Yi||(function(){Zi();var e=Y.Enums.Events.ELEMENT_ENABLED,t=Y.Enums.Events.ELEMENT_DISABLED;Y.eventTarget.addEventListener(e,Qo),Y.eventTarget.addEventListener(t,ta)}(),Xi(),Y.eventTarget.addEventListener(J.ANNOTATION_MODIFIED,ra),Y.eventTarget.addEventListener(J.ANNOTATION_SELECTION_CHANGE,oa),Y.eventTarget.addEventListener(J.ANNOTATION_SELECTION_CHANGE,oa),Y.eventTarget.addEventListener(J.SEGMENTATION_MODIFIED,aa),Y.eventTarget.addEventListener(J.SEGMENTATION_DATA_MODIFIED,Hi),Y.eventTarget.addEventListener(J.SEGMENTATION_REPRESENTATION_MODIFIED,Wi),Y.eventTarget.addEventListener(J.SEGMENTATION_REPRESENTATION_REMOVED,Fi),Yi=!0)}function $i(){Zi(),Xi(),Ki(),Ge={},ze=te()(qe);var e=Ze(),t=Ot();e.restoreAnnotations({}),t.resetState(),Yi=!1}function Zi(){var e=Y.Enums.Events.ELEMENT_ENABLED,t=Y.Enums.Events.ELEMENT_DISABLED;Y.eventTarget.removeEventListener(e,Qo),Y.eventTarget.removeEventListener(t,ta)}function Xi(){Y.eventTarget.removeEventListener(J.ANNOTATION_MODIFIED,ra),Y.eventTarget.removeEventListener(J.ANNOTATION_SELECTION_CHANGE,oa),Y.eventTarget.removeEventListener(J.ANNOTATION_SELECTION_CHANGE,oa),Y.eventTarget.removeEventListener(J.SEGMENTATION_MODIFIED,aa),Y.eventTarget.removeEventListener(J.SEGMENTATION_DATA_MODIFIED,Hi),Y.eventTarget.removeEventListener(J.SEGMENTATION_REPRESENTATION_MODIFIED,Wi),Y.eventTarget.removeEventListener(J.SEGMENTATION_REPRESENTATION_REMOVED,Fi)}function Qi(e){var t=e.toolName,n=void 0!==ze.tools[t];if(!t)throw new Error("No Tool Found for the ToolClass ".concat(e.name));if(n)throw new Error("".concat(t," has already been added globally"));ze.tools[t]={toolClass:e}}function el(e){var t=e.toolName;if(!t)throw new Error("No tool found for: ".concat(e.name));if(void 0===!ze.tools[t])throw new Error("".concat(t," cannot be removed because it has not been added"));delete ze.tools[t]}function tl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nl(e){var t,n=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return tl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tl(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(co(e,Lr(e,[Ke.Active,Ke.Passive])));try{for(n.s();!(t=n.n()).done;){var r=t.value.tool.cancel(e);if(r)return r}}catch(e){n.e(e)}finally{n.f()}}var rl=function(){function e(t,n,r){var o=this;X(this,e),Q(this,"_enabled",void 0),Q(this,"_eventName",void 0),Q(this,"_eventHandler",void 0),Q(this,"_ignoreFiredEvents",void 0),Q(this,"_sourceViewports",void 0),Q(this,"_targetViewports",void 0),Q(this,"_viewportOptions",{}),Q(this,"id",void 0),Q(this,"_onEvent",(function(e){if(!0!==o._ignoreFiredEvents&&o._targetViewports.length){var t=(0,Y.getEnabledElement)(e.currentTarget);if(t){var n=t.renderingEngineId,r=t.viewportId;o._sourceViewports.find((function(e){return e.viewportId===r}))&&o.fireEvent({renderingEngineId:n,viewportId:r},e)}}})),this._enabled=!0,this._eventName=n,this._eventHandler=r,this._ignoreFiredEvents=!1,this._sourceViewports=[],this._targetViewports=[],this.id=t}return Z(e,[{key:"isDisabled",value:function(){return!this._enabled||!this._hasSourceElements()}},{key:"setOptions",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._viewportOptions[e]=t}},{key:"getOptions",value:function(e){return this._viewportOptions[e]}},{key:"add",value:function(e){this.addTarget(e),this.addSource(e)}},{key:"addSource",value:function(e){if(!al(this._sourceViewports,e)){var t=e.renderingEngineId,n=e.viewportId;(0,Y.getRenderingEngine)(t).getViewport(n).element.addEventListener(this._eventName,this._onEvent.bind(this)),this._updateDisableHandlers(),this._sourceViewports.push(e)}}},{key:"addTarget",value:function(e){al(this._targetViewports,e)||(this._targetViewports.push(e),this._updateDisableHandlers())}},{key:"getSourceViewports",value:function(){return this._sourceViewports}},{key:"getTargetViewports",value:function(){return this._targetViewports}},{key:"destroy",value:function(){var e=this;this._sourceViewports.forEach((function(t){return e.removeSource(t)})),this._targetViewports.forEach((function(t){return e.removeTarget(t)}))}},{key:"remove",value:function(e){this.removeTarget(e),this.removeSource(e)}},{key:"removeSource",value:function(e){var t=ol(this._sourceViewports,e);if(-1!==t){var n=function(e){var t=(0,Y.getRenderingEngine)(e.renderingEngineId);if(!t)throw new Error("No RenderingEngine for Id: ".concat(e.renderingEngineId));return t.getViewport(e.viewportId).element}(e);this._sourceViewports.splice(t,1),n.removeEventListener(this._eventName,this._eventHandler),this._updateDisableHandlers()}}},{key:"removeTarget",value:function(e){var t=ol(this._targetViewports,e);-1!==t&&(this._targetViewports.splice(t,1),this._updateDisableHandlers())}},{key:"hasSourceViewport",value:function(e,t){return al(this._sourceViewports,{renderingEngineId:e,viewportId:t})}},{key:"hasTargetViewport",value:function(e,t){return al(this._targetViewports,{renderingEngineId:e,viewportId:t})}},{key:"fireEvent",value:function(e,t){if(!this.isDisabled()&&!this._ignoreFiredEvents){this._ignoreFiredEvents=!0;try{for(var n=0;n<this._targetViewports.length;n++){var r=this._targetViewports[n];e.viewportId===r.viewportId||this._eventHandler(this,e,r,t)}}catch(e){console.warn("Synchronizer, for: ".concat(this._eventName),e)}finally{this._ignoreFiredEvents=!1}}}},{key:"_hasSourceElements",value:function(){return 0!==this._sourceViewports.length}},{key:"_updateDisableHandlers",value:function(){var e=function(e,t){for(var n=[],r=e.concat(t),o=function(e){var t=r[e];n.some((function(e){return t.renderingEngineId===e.renderingEngineId&&t.viewportId===e.viewportId}))||n.push(t)},a=0;a<r.length;a++)o(a);return n}(this._sourceViewports,this._targetViewports),t=this.remove,n=function(e){t(e.detail.element)};e.forEach((function(e){var t=(0,Y.getRenderingEngine)(e.renderingEngineId).getViewport(e.viewportId);if(t){var r=t.element;r.removeEventListener(Y.Enums.Events.ELEMENT_DISABLED,n),r.addEventListener(Y.Enums.Events.ELEMENT_DISABLED,n)}}))}}]),e}();function ol(e,t){return e.findIndex((function(e){return t.renderingEngineId===e.renderingEngineId&&t.viewportId===e.viewportId}))}function al(e,t){return e.some((function(e){return e.renderingEngineId===t.renderingEngineId&&e.viewportId===t.viewportId}))}var il=rl,ll=function(e,t,n){if(ze.synchronizers.some((function(t){return t.id===e})))throw new Error("Synchronizer with id '".concat(e,"' already exists."));var r=new il(e,t,n);return ze.synchronizers.push(r),r},cl=function(){for(;ze.synchronizers.length>0;)ze.synchronizers.pop().destroy()},sl=function(e){return ze.synchronizers.find((function(t){return t.id===e}))},dl=function(){return ze.synchronizers},ul=function(e){var t=ze.synchronizers.findIndex((function(t){return t.id===e}));t>-1&&(ze.synchronizers[t].destroy(),ze.synchronizers.splice(t,1))},vl=h(485),fl=h.n(vl),gl=Symbol("DefinedCursors"),hl=new Set(["alias","all-scroll","auto","cell","col-resize","context-menu","copy","crosshair","default","e-resize","ew-resize","grab","grabbing","help","move","ne-resize","nesw-resize","no-drop","none","not-allowed","n-resize","ns-resize","nw-resize","nwse-resize","pointer","progress","row-resize","se-resize","s-resize","sw-resize","text","vertical-text","wait","w-resize","zoom-in","zoom-out"]),pl=function(){function e(t,n){X(this,e),Q(this,"name",void 0),Q(this,"fallback",void 0),this.name=t+"",this.fallback=n}return Z(e,[{key:"getName",value:function(){return this.name+""}},{key:"addFallbackStyleProperty",value:function(t){var n=this.fallback;return n instanceof e?"".concat(t,", ").concat(n.getStyleProperty()):t+""}},{key:"getStyleProperty",value:function(){return this.addFallbackStyleProperty(this.name)+""}}],[{key:"getDefinedCursor",value:function(t){var n=ml(e,gl),r=n.get(t);return r instanceof e?r:hl.has(t)?(r=new e(t),n.set(t,r),r):void 0}},{key:"setDefinedCursor",value:function(t,n){return n instanceof e&&(ml(e,gl).set(t,n),!0)}}]),e}();function ml(e,t){var n=e[t];return n instanceof Map||(n=new Map,Object.defineProperty(e,t,{value:n})),n}var wl,El=hl.values();function yl(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=va(e)););return e}function Il(){return Il="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=yl(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Il.apply(this,arguments)}!function(e){e.Default="",e.Highlighted="Highlighted",e.Selected="Selected",e.Locked="Locked"}(wl||(wl={}));var bl=wl;var Cl=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(e,t,n,a,i){var l;return X(this,o),Q(la(l=r.call(this,a||o.getUniqueInstanceName("image-cursor"),i)),"url",void 0),Q(la(l),"x",void 0),Q(la(l),"y",void 0),l.url=e,l.x=Number(t)||0,l.y=Number(n)||0,l}return Z(o,[{key:"getStyleProperty",value:function(){var e=this.url,t=this.x,n=this.y,r="url('".concat(e,"')");return t>=0&&n>=0&&(t>0||n>0)&&(r+=" ".concat(t," ").concat(n)),this.addFallbackStyleProperty(r)}}],[{key:"getUniqueInstanceName",value:function(e){return"".concat(e,"-").concat(Y.utilities.getRuntimeId(o))}}]),o}(pl),Tl={iconContent:"",iconSize:16,viewBox:{x:16,y:16},mousePoint:{x:8,y:8},mousePointerGroupString:'\n    <path stroke="{{color}}" d="M8 16L8 0"></path>\n    <path stroke="{{color}}" d="M16 8L0 8"></path>\n  '},_l={x:127,y:60},Ol='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n',Dl='\n<rect fill="{{color}}" x="80.19" y="25.03" width="47.14" height="15.85"/>\n<rect fill="{{color}}" x="95.84" y="9.38" width="15.85" height="47.14"/>\n',Sl='<path fill="{{color}}" d="M82.89,10a12.09,12.09,0,0,0-16.8-2.5l-27.5,20.4-8.5-6.3a2.93,2.93,0,0,1-1.1-3,14.66,14.66,0,0,0,.1-6.6,14.08,14.08,0,1,0-6.5,15.2,2.87,2.87,0,0,1,3.2.2l8.2,6.1-8.2,6.1a2.87,2.87,0,0,1-3.2.2,14.16,14.16,0,1,0,6.7,14.4,14,14,0,0,0-.3-5.8,2.93,2.93,0,0,1,1.1-3l8.5-6.3,27.5,20.4A11.91,11.91,0,0,0,82.89,57l-31.7-23.5ZM15.29,21a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,21Zm0,36.8a5.9,5.9,0,1,1,5.9-5.9A5.91,5.91,0,0,1,15.29,57.77Zm28.3-21.5a2.8,2.8,0,1,1,2.8-2.8A2.8,2.8,0,0,1,43.59,36.27Z" transform="translate(-1.17 -0.96)"/>',xl='<path fill="{{color}}" d="M8.86,2.25V66.08H72.69V2.25H8.86ZM65.28,58.67h-49v-49h49v49Z" transform="translate(-8.86 -2.25)"/>',kl='<path fill="{{color}}" d="M40.77,2.25A31.92,31.92,0,1,0,72.69,34.16,31.92,31.92,0,0,0,40.77,2.25Zm0,57.63A25.71,25.71,0,1,1,66.48,34.16,25.71,25.71,0,0,1,40.77,59.87Z" transform="translate(-8.86 -2.25)"/>',Ml={Angle:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1203 544q0 13-10 23l-393 393 393 393q10 10 10 23t-10 23l-50\n    50q-10 10-23 10t-23-10l-466-466q-10-10-10-23t10-23l466-466q10-10 23-10t23\n    10l50 50q10 10 10 23z" />',viewBox:{x:1792,y:1792}}),ArrowAnnotate:Rl(Tl,{iconContent:'<g id="arrowAnnotate-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="arrowAnnotate-arrow" d="M23,7 l-15,15 M7,17 l0,6 6,0" stroke-width="2" />\n  </g>',viewBox:{x:24,y:24}}),Bidirectional:Rl(Tl,{iconContent:'<g fill="{{color}}" stroke-width="3" stroke="{{color}}">\n    <path d="M27.63 3.21L3.12 28.81"></path>\n    <path d="M27.63 15.75L15.27 4.43"></path>\n    <path d="M16.5 4.28C16.5 4.96 15.95 5.51 15.27 5.51C14.59 5.51 14.03 4.96 14.03 4.28C14.03 3.59 14.59 3.04 15.27 3.04C15.95 3.04 16.5 3.59 16.5 4.28Z" ></path>\n    <path d="M28.87 3.19C28.87 3.87 28.31 4.43 27.63 4.43C26.95 4.43 26.4 3.87 26.4 3.19C26.4 2.51 26.95 1.95 27.63 1.95C28.31 1.95 28.87 2.51 28.87 3.19Z"></path>\n    <path d="M28.87 15.75C28.87 16.43 28.31 16.99 27.63 16.99C26.95 16.99 26.4 16.43 26.4 15.75C26.4 15.07 26.95 14.51 27.63 14.51C28.31 14.51 28.87 15.07 28.87 15.75Z"></path>\n    <path d="M4.73 28.44C4.73 29.12 4.17 29.68 3.49 29.68C2.81 29.68 2.25 29.12 2.25 28.44C2.25 27.76 2.81 27.2 3.49 27.2C4.17 27.2 4.73 27.76 4.73 28.44Z"></path>\n  </g>',viewBox:{x:48,y:48}}),CobbAngle:Rl(Tl,{iconContent:'<g stroke="{{color}}" stroke-width="3">\n    <path d="M28.59 2.34L3.82 12.32"></path>\n    <path d="M28.59 29.66L3.82 19.68"></path>\n    <path stroke-dasharray="2" fill-opacity="0" d="M12.37\n      23.06C12.67 22.36 12.85 21.93 12.92 21.76C14.6 17.8 14.68 13.35 13.15\n      9.33C13.11 9.24 13.02 9 12.88 8.63">\n    </path>\n  </g>',viewBox:{x:32,y:32}}),CircleROI:Rl(Tl,{iconContent:'<circle stroke="{{color}}" fill="none" stroke-width="3" cx="16" cy="16" r="14" />',viewBox:{x:32,y:32}}),EllipticalROI:Rl(Tl,{iconContent:'<path stroke="{{color}}" fill="none" stroke-width="3" d="M30.74 15.76C30.74 20.99 24.14 25.23 16\n    25.23C7.86 25.23 1.26 20.99 1.26 15.76C1.26 10.54 7.86 6.3 16 6.3C24.14\n    6.3 30.74 10.54 30.74 15.76Z" />',viewBox:{x:32,y:32}}),FreehandROI:Rl(Tl,{iconContent:'<g fill="{{color}}" stroke="{{color}}" stroke-width="2">\n    <ellipse ry="1" rx="1" id="svg_3" cy="4.240343" cx="14.306499"/>\n    <line id="svg_4" y2="3.58462" x2="12.242186" y1="3.997482" x1="13.432202"/>\n    <line id="svg_5" y2="3.268901" x2="10.857882" y1="3.608906" x1="12.387902"/>\n    <line id="svg_6" y2="3.147471" x2="9.740724" y1="3.293187" x1="10.955026"/>\n    <line id="svg_7" y2="3.147471" x2="8.089274" y1="3.196043" x1="9.983585"/>\n    <line id="svg_8" y2="3.268901" x2="6.874972" y1="3.123185" x1="8.307848"/>\n    <line id="svg_9" y2="3.657478" x2="5.587812" y1="3.220329" x1="7.020688"/>\n    <line id="svg_10" y2="4.046054" x2="4.737801" y1="3.560334" x1="5.854959"/>\n    <line id="svg_11" y2="4.337487" x2="4.300652" y1="3.997482" x1="4.834945"/>\n    <line id="svg_12" y2="4.726063" x2="3.88779" y1="4.191771" x1="4.470655"/>\n    <line id="svg_15" y2="5.3575" x2="3.377783" y1="4.604633" x1="3.960648"/>\n    <line id="svg_16" y2="6.183226" x2="2.916348" y1="5.138926" x1="3.547785"/>\n    <line id="svg_17" y2="6.960379" x2="2.770632" y1="5.867507" x1="3.037779"/>\n    <line id="svg_18" y2="7.713246" x2="2.673488" y1="6.741804" x1="2.819204"/>\n    <line id="svg_19" y2="8.684687" x2="2.697774" y1="7.616102" x1="2.673488"/>\n    <line id="svg_20" y2="9.753273" x2="2.892062" y1="8.611829" x1="2.697774"/>\n    <line id="svg_21" y2="10.724714" x2="3.134923" y1="9.534698" x1="2.84349"/>\n    <line id="svg_23" y2="11.647583" x2="3.596357" y1="10.578998" x1="3.086351"/>\n    <line id="svg_25" y2="12.521881" x2="4.276366" y1="11.501867" x1="3.499213"/>\n    <line id="svg_26" y2="13.930471" x2="5.830673" y1="12.376165" x1="4.13065"/>\n    <line id="svg_28" y2="14.707624" x2="7.263549" y1="13.881899" x1="5.733528"/>\n    <line id="svg_29" y2="15.339061" x2="8.963571" y1="14.61048" x1="7.06926"/>\n    <line id="svg_30" y2="15.581921" x2="10.882168" y1="15.314775" x1="8.817855"/>\n    <line id="svg_31" y2="15.460491" x2="12.023612" y1="15.581921" x1="10.785024"/>\n    <line id="svg_33" y2="15.120487" x2="13.092197" y1="15.484777" x1="11.877895"/>\n    <line id="svg_34" y2="14.586194" x2="13.86935" y1="15.217631" x1="12.897909"/>\n    <line id="svg_35" y2="13.833327" x2="14.597931" y1="14.756196" x1="13.699348"/>\n    <line id="svg_37" y2="12.716169" x2="15.180796" y1="13.881899" x1="14.549359"/>\n    <line id="svg_39" y2="11.429009" x2="15.520801" y1="12.813313" x1="15.15651"/>\n    <ellipse ry="1" rx="1" id="svg_40" cy="10.967574" cx="15.520801"/>\n  </g>',viewBox:{x:18,y:18}}),FreehandROISculptor:Rl(Tl,{iconContent:'<g id="icon-freehand-sculpt" fill="none" stroke-width="1.5" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <line id="svg_1" y2="2.559367" x2="10.184807" y1="4.467781" x1="8.81711"/>\n    <line id="svg_4" y2="1.493836" x2="11.727442" y1="2.766112" x1="10.089386"/>\n    <line id="svg_7" y2="1.080346" x2="13.047428" y1="1.748291" x1="11.345759"/>\n    <line id="svg_8" y2="1.000829" x2="14.351511" y1="1.112153" x1="12.77707"/>\n    <line id="svg_9" y2="1.350705" x2="15.242104" y1="0.905408" x1="13.969828"/>\n    <line id="svg_10" y2="2.098167" x2="15.862339" y1="1.14396" x1="14.955842"/>\n    <line id="svg_11" y2="3.195505" x2="16.41896" y1="1.939133" x1="15.766918"/>\n    <line id="svg_12" y2="4.292843" x2="16.530284" y1="2.925147" x1="16.387153"/>\n    <line id="svg_16" y2="5.644637" x2="16.196311" y1="3.831643" x1="16.593898"/>\n    <line id="svg_18" y2="7.266789" x2="15.623787" y1="5.19934" x1="16.275829"/>\n    <line id="svg_19" y2="10.813258" x2="14.526449" y1="6.726071" x1="15.766918"/>\n    <line id="svg_20" y2="5.056209" x2="8.085552" y1="4.181519" x1="8.976145"/>\n    <line id="svg_23" y2="5.326568" x2="7.481221" y1="4.78585" x1="8.403621"/>\n    <line id="svg_24" y2="5.565119" x2="6.749662" y1="5.294761" x1="7.624352"/>\n    <line id="svg_25" y2="5.994512" x2="5.429675" y1="5.533312" x1="6.956407"/>\n    <line id="svg_27" y2="6.551133" x2="4.284627" y1="5.962706" x1="5.572807"/>\n    <line id="svg_28" y2="7.584858" x2="3.044158" y1="6.392099" x1="4.427758"/>\n    <line id="svg_29" y2="8.84123" x2="2.185372" y1="7.489437" x1="3.219096"/>\n    <line id="svg_31" y2="10.606513" x2="1.644654" y1="8.602678" x1="2.280792"/>\n    <line id="svg_32" y2="13.214679" x2="1.48562" y1="10.352058" x1="1.724171"/>\n    <line id="svg_33" y2="14.375631" x2="1.676461" y1="12.992031" x1="1.453813"/>\n    <line id="svg_34" y2="15.298031" x2="2.264889" y1="14.152983" x1="1.517427"/>\n    <line id="svg_35" y2="16.172721" x2="3.521261" y1="14.948155" x1="1.915013"/>\n    <line id="svg_36" y2="16.824762" x2="5.207027" y1="15.997783" x1="3.28271"/>\n    <line id="svg_38" y2="17.063314" x2="7.035924" y1="16.745245" x1="4.968475"/>\n    <line id="svg_39" y2="16.888376" x2="9.278311" y1="17.047411" x1="6.733758"/>\n    <line id="svg_40" y2="16.284045" x2="10.661911" y1="16.983797" x1="8.992048"/>\n    <line id="svg_41" y2="15.313934" x2="11.647925" y1="16.395369" x1="10.455166"/>\n    <line id="svg_44" y2="13.898527" x2="12.82478" y1="15.425259" x1="11.504794"/>\n    <line id="svg_45" y2="12.037824" x2="14.144766" y1="14.312017" x1="12.522614"/>\n    <line id="svg_47" y2="10.59061" x2="14.605966" y1="12.228665" x1="13.953925"/>\n    <ellipse ry="1" rx="1" id="svg_48" cy="3.982726" cx="13.460918"/>\n  </g>',viewBox:{x:18,y:18}}),Length:Rl(Tl,{iconContent:'<g id="length-group" fill="none" stroke-width="1" stroke="{{color}}" stroke-linecap="round" stroke-linejoin="round">\n    <path id="length-dashes" d="m22.5,6 -16.5,16.5" stroke-width="3" stroke-dasharray="0.6666,5" />\n  </g>',viewBox:{x:24,y:24}}),Probe:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1152 896q0 106-75 181t-181 75-181-75-75-181 75-181 181-75 181 75\n    75 181zm-256-544q-148 0-273 73t-198 198-73 273 73 273 198 198 273 73 273-73\n    198-198 73-273-73-273-198-198-273-73zm768 544q0 209-103 385.5t-279.5\n    279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5\n    385.5-103 385.5 103 279.5 279.5 103 385.5z" />',viewBox:{x:1792,y:1792}}),RectangleROI:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1312 256h-832q-66 0-113 47t-47 113v832q0 66 47\n    113t113 47h832q66 0 113-47t47-113v-832q0-66-47-113t-113-47zm288 160v832q0\n    119-84.5 203.5t-203.5 84.5h-832q-119 0-203.5-84.5t-84.5-203.5v-832q0-119\n    84.5-203.5t203.5-84.5h832q119 0 203.5 84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),TextMarker:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M789 559l-170 450q33 0 136.5 2t160.5 2q19 0\n    57-2-87-253-184-452zm-725 1105l2-79q23-7 56-12.5t57-10.5 49.5-14.5 44.5-29\n    31-50.5l237-616 280-724h128q8 14 11 21l205 480q33 78 106 257.5t114 274.5q15\n    34 58 144.5t72 168.5q20 45 35 57 19 15 88 29.5t84 20.5q6 38 6 57 0 5-.5\n    13.5t-.5 12.5q-63 0-190-8t-191-8q-76 0-215 7t-178 8q0-43 4-78l131-28q1 0\n    12.5-2.5t15.5-3.5 14.5-4.5 15-6.5 11-8 9-11\n    2.5-14q0-16-31-96.5t-72-177.5-42-100l-450-2q-26 58-76.5 195.5t-50.5 162.5q0\n    22 14 37.5t43.5 24.5 48.5 13.5 57 8.5 41 4q1 19 1 58 0 9-2 27-58\n    0-174.5-10t-174.5-10q-8 0-26.5 4t-21.5 4q-80 14-188 14z" />',viewBox:{x:1792,y:1792}}),Crosshairs:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1325 1024h-109q-26 0-45-19t-19-45v-128q0-26\n    19-45t45-19h109q-32-108-112.5-188.5t-188.5-112.5v109q0 26-19 45t-45\n    19h-128q-26 0-45-19t-19-45v-109q-108 32-188.5 112.5t-112.5 188.5h109q26\n    0 45 19t19 45v128q0 26-19 45t-45 19h-109q32 108 112.5 188.5t188.5\n    112.5v-109q0-26 19-45t45-19h128q26 0 45 19t19 45v109q108-32\n    188.5-112.5t112.5-188.5zm339-192v128q0 26-19 45t-45 19h-143q-37 161-154.5\n    278.5t-278.5 154.5v143q0 26-19 45t-45 19h-128q-26\n    0-45-19t-19-45v-143q-161-37-278.5-154.5t-154.5-278.5h-143q-26\n    0-45-19t-19-45v-128q0-26 19-45t45-19h143q37-161\n    154.5-278.5t278.5-154.5v-143q0-26 19-45t45-19h128q26 0 45 19t19 45v143q161\n    37 278.5 154.5t154.5 278.5h143q26 0 45 19t19 45z" />',viewBox:{x:1792,y:1792}}),Eraser:Rl(Tl,{iconContent:'<path transform="translate(0,1792) scale(1,-1)" fill="{{color}}" d="M960 1408l336-384h-768l-336 384h768zm1013-1077q15\n    34 9.5 71.5t-30.5 65.5l-896 1024q-38 44-96 44h-768q-38\n    0-69.5-20.5t-47.5-54.5q-15-34-9.5-71.5t30.5-65.5l896-1024q38-44 96-44h768q38\n    0 69.5 20.5t47.5 54.5z" />',viewBox:{x:2048,y:1792}}),Magnify:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />',viewBox:{x:512,y:512}}),Pan:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1411 541l-355 355 355 355 144-144q29-31 70-14 39 17\n    39 59v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39 14-69l144-144-355-355-355\n    355 144 144q31 30 14 69-17 40-59 40h-448q-26 0-45-19t-19-45v-448q0-42 40-59\n    39-17 69 14l144 144 355-355-355-355-144 144q-19 19-45 19-12\n    0-24-5-40-17-40-59v-448q0-26 19-45t45-19h448q42 0 59 40 17 39-14 69l-144\n    144 355 355 355-355-144-144q-31-30-14-69 17-40 59-40h448q26 0 45 19t19\n    45v448q0 42-39 59-13 5-25 5-26 0-45-19z" />',viewBox:{x:1792,y:1792}}),Rotate:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1664 256v448q0 26-19 45t-45 19h-448q-42 0-59-40-17-39\n    14-69l138-138q-148-137-349-137-104 0-198.5 40.5t-163.5 109.5-109.5\n    163.5-40.5 198.5 40.5 198.5 109.5 163.5 163.5 109.5 198.5 40.5q119 0\n    225-52t179-147q7-10 23-12 15 0 25 9l137 138q9 8 9.5 20.5t-7.5 22.5q-109\n    132-264 204.5t-327 72.5q-156 0-298-61t-245-164-164-245-61-298 61-298\n    164-245 245-164 298-61q147 0 284.5 55.5t244.5 156.5l130-129q29-31 70-14\n    39 17 39 59z" />',viewBox:{x:1792,y:1792}}),StackScroll:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M24 21v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1zM24 13v2c0\n    0.547-0.453 1-1 1h-22c-0.547 0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547\n    0 1 0.453 1 1zM24 5v2c0 0.547-0.453 1-1 1h-22c-0.547\n    0-1-0.453-1-1v-2c0-0.547 0.453-1 1-1h22c0.547 0 1 0.453 1 1z" />',viewBox:{x:24,y:28}}),WindowLevelRegion:Rl(Tl,{iconContent:'<path fill="{{color}}" d="M1664 416v960q0 119-84.5 203.5t-203.5 84.5h-960q-119\n    0-203.5-84.5t-84.5-203.5v-960q0-119 84.5-203.5t203.5-84.5h960q119 0 203.5\n    84.5t84.5 203.5z" />',viewBox:{x:1792,y:1792}}),WindowLevel:Rl(Tl,{iconContent:'\n    <path fill="{{color}}" d="M14.5,3.5 a1 1 0 0 1 -11,11 Z" stroke="none" opacity="0.8" />\n    <circle cx="9" cy="9" r="8" fill="none" stroke-width="2" stroke="{{color}}" />',viewBox:{x:18,y:18}}),Zoom:Rl(Tl,{iconContent:'\n  <path fill="{{color}}" d="M508.5 481.6l-129-129c-2.3-2.3-5.3-3.5-8.5-3.5h-10.3C395\n    312 416 262.5 416 208 416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c54.5\n    0 104-21 141.1-55.2V371c0 3.2 1.3 6.2 3.5 8.5l129 129c4.7 4.7 12.3 4.7 17\n    0l9.9-9.9c4.7-4.7 4.7-12.3 0-17zM208 384c-97.3 0-176-78.7-176-176S110.7 32 208\n    32s176 78.7 176 176-78.7 176-176 176z" />\n  <path fill="{{color}}" transform="scale(0.22,0.22) translate(1400,0)" d="M1216\n    320q0 26-19 45t-45 19h-128v1024h128q26 0 45 19t19 45-19 45l-256 256q-19\n    19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-1024h-128q-26\n    0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45z" />',viewBox:{x:640,y:512}}),SegmentationFreeHandEraseInside:Rl(Tl,{iconContent:"".concat(Sl," ").concat(Ol),viewBox:_l}),SegmentationFreeHandFillInside:Rl(Tl,{iconContent:"".concat(Sl," ").concat(Dl),viewBox:_l}),SegmentationFreeHandEraseOutside:Rl(Tl,{iconContent:"".concat(Sl," ").concat(Ol),viewBox:_l}),SegmentationFreeHandFillOutside:Rl(Tl,{iconContent:"".concat(Sl," ").concat(Dl),viewBox:_l}),SegmentationRectangleEraseInside:Rl(Tl,{iconContent:"".concat(xl," ").concat(Ol),viewBox:_l}),RectangleScissor:Rl(Tl,{iconContent:"".concat(xl," ").concat(Dl),viewBox:_l}),"RectangleScissor.FILL_INSIDE":Rl(Tl,{iconContent:"".concat(xl," ").concat(Dl),viewBox:_l}),"RectangleScissor.FILL_OUTSIDE":Rl(Tl,{iconContent:"".concat(xl," ").concat(Dl),viewBox:_l}),"RectangleScissor.ERASE_OUTSIDE":Rl(Tl,{iconContent:"".concat(xl," ").concat(Ol),viewBox:_l}),"RectangleScissor.ERASE_INSIDE":Rl(Tl,{iconContent:"".concat(xl," ").concat(Ol),viewBox:_l}),CircleScissor:Rl(Tl,{iconContent:"".concat(kl," ").concat(Dl),viewBox:_l}),"CircleScissor.FILL_INSIDE":Rl(Tl,{iconContent:"".concat(kl," ").concat(Dl),viewBox:_l}),"CircleScissor.ERASE_OUTSIDE":Rl(Tl,{iconContent:"".concat(kl," ").concat(Ol),viewBox:_l}),"CircleScissor.FILL_OUTSIDE":Rl(Tl,{iconContent:"".concat(kl," ").concat(Dl),viewBox:_l})};function Rl(e,t){return Object.assign(Object.create(e),t)}function Pl(e,t,n){Ml[e]=Rl(Tl,{iconContent:t,viewBox:n})}function Nl(e){if(Object.prototype.hasOwnProperty.call(Ml,e))return Ml[e]}var Al=Object.keys(Ml);function Ll(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ul(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ll(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ll(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Vl=new(function(){function e(){X(this,e),Q(this,"config",void 0),this._initializeConfig({color:"rgb(255, 255, 0)",colorHighlighted:"rgb(0, 255, 0)",colorSelected:"rgb(0, 220, 0)",colorLocked:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"",shadow:!0,textBoxFontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",textBoxFontSize:"14px",textBoxColor:"rgb(255, 255, 0)",textBoxColorHighlighted:"rgb(0, 255, 0)",textBoxColorSelected:"rgb(0, 255, 0)",textBoxColorLocked:"rgb(255, 255, 0)",textBoxBackground:"",textBoxLinkLineWidth:"1",textBoxLinkLineDash:"2,3",textBoxShadow:!0})}return Z(e,[{key:"getAnnotationToolStyles",value:function(e){return this.config.annotations&&this.config.annotations[e]}},{key:"getViewportToolStyles",value:function(e){return this.config.viewports&&this.config.viewports[e]}},{key:"getToolGroupToolStyles",value:function(e){return this.config.toolGroups&&this.config.toolGroups[e]}},{key:"getDefaultToolStyles",value:function(){return this.config.default}},{key:"setAnnotationStyles",value:function(e,t){var n=this.config.annotations;n||(this.config=Ul(Ul({},this.config),{},{annotations:{}}),n=this.config.annotations),n[e]=t}},{key:"setViewportToolStyles",value:function(e,t){var n=this.config.viewports;n||(this.config=Ul(Ul({},this.config),{},{viewports:{}}),n=this.config.viewports),n[e]=t}},{key:"setToolGroupToolStyles",value:function(e,t){var n=this.config.toolGroups;n||(this.config=Ul(Ul({},this.config),{},{toolGroups:{}}),n=this.config.toolGroups),n[e]=t}},{key:"setDefaultToolStyles",value:function(e){this.config.default=e}},{key:"getStyleProperty",value:function(e,t){var n=t.annotationUID,r=t.viewportId,o=t.toolGroupId,a=t.toolName;return this._getToolStyle(e,n,r,o,a)}},{key:"_getToolStyle",value:function(e,t,n,r,o){if(t){var a=this.getAnnotationToolStyles(t);if(a&&a[e])return a[e]}if(n){var i=this.getViewportToolStyles(n);if(i){if(i[o]&&i[o][e])return i[o][e];if(i.global&&i.global[e])return i.global[e]}}if(r){var l=this.getToolGroupToolStyles(r);if(l){if(l[o]&&l[o][e])return l[o][e];if(l.global&&l.global[e])return l.global[e]}}var c=this.getDefaultToolStyles();return c[o]&&c[o][e]?c[o][e]:c.global&&c.global[e]?c.global[e]:void 0}},{key:"_initializeConfig",value:function(e){var t={};for(var n in e)t[n]=e[n];this.config={default:{global:t}}}}]),e}());function Bl(e,t,n,r){for(var o=function(e,t,n){var r=["".concat(e)];return t&&r.push("".concat(r[0]).concat(t)),n&&r.push("".concat(r[r.length-1]).concat(n)),r}(e,n,r),a=o.length-1;a>=0;--a){var i=Vl.getStyleProperty(o[a],t);if(void 0!==i)return i}}var jl="color",Hl=bl.Highlighted,Wl=Ke.Active,Fl=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(e,t,n,a,i){return X(this,o),r.call(this,e,t,n,a,i)}return Z(o,null,[{key:"getDefinedCursor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0;n||(n=Bl(jl,{},Hl,Wl));var r=ql(e,t,n),a=Il(va(o),"getDefinedCursor",this).call(this,r);if(!a){var i=Nl(e);i&&(a=zl(i,r,t,n,Il(va(o),"getDefinedCursor",this).call(this,"default")),Il(va(o),"setDefinedCursor",this).call(this,r,a))}return a}}]),o}(Cl);function Gl(e,t){var n=Object(t),r=Object.prototype.hasOwnProperty.bind(n);return(e+"").replace(/\{\{(\w+)\}\}/g,(function(e,t){return r(t)?n[t]+"":""}))}function ql(e,t,n){return"".concat(t?"pointer":"cursor",":").concat(e,"/").concat(n)}function zl(e,t,n,r,o){var a=e.mousePoint,i=a.x,l=a.y;return new Fl(function(e,t,n){return URL.createObjectURL(function(e,t,n){var r=(t?Yl:Kl)(e,n);return new Blob([r],{type:"image/svg+xml"})}(e,t,n))}(e,n,{color:r}),i,l,t,o)}function Kl(e,t){var n=e.iconContent,r=e.iconSize,o=e.viewBox;return Gl('\n    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n      width="'.concat(r,'" height="').concat(r,'" viewBox="0 0\n      ').concat(o.x," ").concat(o.y,'">\n      ').concat(n,"\n    </svg>"),t)}function Yl(e,t){var n=e.iconContent,r=e.iconSize,o=e.viewBox,a=e.mousePointerGroupString,i=r/Math.max(o.x,o.y,1),l=16+r;return Gl('\n    <svg data-icon="cursor" role="img" xmlns="http://www.w3.org/2000/svg"\n      width="'.concat(l,'" height="').concat(l,'" viewBox="0 0 ').concat(l," ").concat(l,'">\n      <g>').concat(a,'</g>\n      <g transform="translate(16, 16) scale(').concat(i,')">').concat(n,"</g>\n    </svg>"),t)}var Jl=Symbol("ElementCursorsMap");function $l(e,t){ec(e)[0]=t,Zl(e,t)}function Zl(e,t){var n=ec(e);n[1]=n[0],n[0]=t,e.style.cursor=(t instanceof pl?t:pl.getDefinedCursor("auto")).getStyleProperty()}function Xl(e){Zl(e,ec(e)[1])}function Ql(e){Zl(e,pl.getDefinedCursor("none"))}function ec(e){var t=ec[Jl];t instanceof WeakMap||(t=new WeakMap,Object.defineProperty(ec,Jl,{value:t}));var n=t.get(e);return n||(n=[null,null],t.set(e,n)),n}function tc(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=va(e);if(t){var o=va(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ua(this,n)}}var nc=Ke.Active,rc=Ke.Passive,oc=Ke.Enabled,ac=Ke.Disabled,ic=function(){function e(t){X(this,e),Q(this,"id",void 0),Q(this,"viewportsInfo",[]),Q(this,"toolOptions",{}),Q(this,"_toolInstances",{}),this.id=t}return Z(e,[{key:"getViewportIds",value:function(){return this.viewportsInfo.map((function(e){return e.viewportId}))}},{key:"getViewportsInfo",value:function(){return this.viewportsInfo.slice()}},{key:"getToolInstance",value:function(e){var t=this._toolInstances[e];if(t)return t;console.warn("'".concat(e,"' is not registered with this toolGroup."))}},{key:"addTool",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ze.tools[e],r=void 0!==e&&""!==e,o=this.toolOptions[e];if(r)if(n)if(o)console.warn("'".concat(e,"' is already registered for ToolGroup ").concat(this.id,"."));else{var a=n.toolClass,i={name:e,toolGroupId:this.id,configuration:t},l=new a(i);this._toolInstances[e]=l}else console.warn("'".concat(e,"' is not registered with the library. You need to use cornerstoneTools.addTool to register it."));else console.warn("Tool with configuration did not produce a toolName: ",t)}},{key:"addToolInstance",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=null===(n=ze.tools[e])||void 0===n?void 0:n.toolClass;if(!o){var a=ze.tools[t].toolClass,i=function(e){sa(n,e);var t=tc(n);function n(){return X(this,n),t.apply(this,arguments)}return Z(n)}(a);i.toolName=e,o=i,ze.tools[e]={toolClass:i}}this.addTool(o.toolName,r)}},{key:"addViewport",value:function(e,t){var n=(0,Y.getRenderingEngines)();if(!t&&n.length>1)throw new Error("You must specify a renderingEngineId when there are multiple rendering engines.");var r=t||n[0].id;this.viewportsInfo.some((function(t){return t.viewportId===e}))||this.viewportsInfo.push({viewportId:e,renderingEngineId:r});var o=this.getActivePrimaryMouseButtonTool();Y.Settings.getRuntimeSettings().get("useCursors")&&this.setViewportsCursorByToolName(o)}},{key:"removeViewports",value:function(e,t){var n=[];if(this.viewportsInfo.forEach((function(r,o){var a=!1;r.renderingEngineId===e&&(a=!0,t&&r.viewportId!==t&&(a=!1)),a&&n.push(o)})),n.length)for(var r=n.length-1;r>=0;r--)this.viewportsInfo.splice(n[r],1)}},{key:"setActiveStrategy",value:function(e,t){var n=this._toolInstances[e];void 0!==n?n.setActiveStrategy(t):console.warn("Tool ".concat(e," not added to toolGroup, can't set tool configuration."))}},{key:"setToolMode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e?t!==Ke.Active?t!==Ke.Passive?t!==Ke.Enabled?t!==Ke.Disabled?console.warn("setToolMode: mode must be defined"):this.setToolDisabled(e):this.setToolEnabled(e):this.setToolPassive(e):this.setToolActive(e,n):console.warn("setToolMode: toolName must be defined")}},{key:"setToolActive",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this._toolInstances[e];if(void 0!==n)if(n){var r=this.toolOptions[e]?this.toolOptions[e].bindings:[],o=t.bindings?t.bindings:[],a=[].concat(xr(r),xr(o)).reduce((function(e,t){var n=void 0!==t.numTouchPoints,r=void 0!==t.mouseButton;return e.some((function(e){return lc(e,t)}))||!n&&!r||e.push(t),e}),[]),i={bindings:a,mode:nc};this.toolOptions[e]=i,this._toolInstances[e].mode=nc;var l=Y.Settings.getRuntimeSettings(),c=l.get("useCursors");if(this._hasMousePrimaryButtonBinding(t)&&c)this.setViewportsCursorByToolName(e);else{var s=this.getActivePrimaryMouseButtonTool();if(!s&&c){var d=pl.getDefinedCursor("default");this._setCursorForViewports(d)}}"function"==typeof n.onSetToolActive&&n.onSetToolActive(),this._renderViewports()}else console.warn("'".concat(e,"' instance ").concat(n," is not registered with this toolGroup, can't set tool mode."));else console.warn("Tool ".concat(e," not added to toolGroup, can't set tool mode."))}},{key:"setToolPassive",value:function(e){var t=this._toolInstances[e];if(void 0!==t){var n=this.getToolOptions(e),r=Object.assign({bindings:n?n.bindings:[]},n,{mode:rc});r.bindings=r.bindings.filter((function(e){return e.mouseButton!==no.Primary||e.modifierKey}));var o=rc;0!==r.bindings.length&&(o=nc,r.mode=o),this.toolOptions[e]=r,t.mode=o,"function"==typeof t.onSetToolPassive&&t.onSetToolPassive(),this._renderViewports()}else console.warn("Tool ".concat(e," not added to toolGroup, can't set tool mode."))}},{key:"setToolEnabled",value:function(e){var t=this._toolInstances[e];if(void 0!==t){var n={bindings:[],mode:oc};this.toolOptions[e]=n,t.mode=oc,"function"==typeof t.onSetToolEnabled&&t.onSetToolEnabled(),this._renderViewports()}else console.warn("Tool ".concat(e," not added to toolGroup, can't set tool mode."))}},{key:"setToolDisabled",value:function(e){var t=this._toolInstances[e];if(void 0!==t){var n={bindings:[],mode:ac};this.toolOptions[e]=n,t.mode=ac,"function"==typeof t.onSetToolDisabled&&t.onSetToolDisabled(),this._renderViewports()}else console.warn("Tool ".concat(e," not added to toolGroup, can't set tool mode."))}},{key:"getToolOptions",value:function(e){var t=this.toolOptions[e];if(void 0!==t)return t}},{key:"getActivePrimaryMouseButtonTool",value:function(){var e=this;return Object.keys(this.toolOptions).find((function(t){var n=e.toolOptions[t];return n.mode===nc&&e._hasMousePrimaryButtonBinding(n)}))}},{key:"setViewportsCursorByToolName",value:function(e,t){var n=this._getCursor(e,t);this._setCursorForViewports(n)}},{key:"_getCursor",value:function(e,t){var n,r;return t&&(n="".concat(e,".").concat(t),r=Fl.getDefinedCursor(n,!0))?r:(n="".concat(e),(r=Fl.getDefinedCursor(n,!0))?r:(n=e,(r=Fl.getDefinedCursor(n,!0))||pl.getDefinedCursor("default")))}},{key:"_setCursorForViewports",value:function(e){this.viewportsInfo.forEach((function(t){var n=t.renderingEngineId,r=t.viewportId,o=(0,Y.getEnabledElementByIds)(r,n);o&&$l(o.viewport.element,e)}))}},{key:"setToolConfiguration",value:function(e,t,n){return void 0===this._toolInstances[e]?(console.warn("Tool ".concat(e," not present, can't set tool configuration.")),!1):(r=n?t:Y.utilities.deepMerge(this._toolInstances[e].configuration,t),this._toolInstances[e].configuration=r,this._renderViewports(),!0);var r}},{key:"getToolConfiguration",value:function(e,t){if(void 0!==this._toolInstances[e]){var n=fl()(this._toolInstances[e].configuration,t);return te()(n)}console.warn("Tool ".concat(e," not present, can't set tool configuration."))}},{key:"_hasMousePrimaryButtonBinding",value:function(e){var t;return null==e||null===(t=e.bindings)||void 0===t?void 0:t.some((function(e){return e.mouseButton===no.Primary&&void 0===e.modifierKey}))}},{key:"_renderViewports",value:function(){this.viewportsInfo.forEach((function(e){var t=e.renderingEngineId,n=e.viewportId;(0,Y.getRenderingEngine)(t).renderViewport(n)}))}}]),e}();function lc(e,t){return e.mouseButton===t.mouseButton&&e.modifierKey===t.modifierKey}var cc=function(e){if(!ze.toolGroups.some((function(t){return t.id===e}))){var t=new ic(e);return ze.toolGroups.push(t),t}console.warn("'".concat(e,"' already exists."))},sc=function(){return ze.toolGroups};function dc(e,t,n,r){var o=r.detail.camera,a=(0,Y.getRenderingEngine)(n.renderingEngineId);if(!a)throw new Error("No RenderingEngine for Id: ".concat(n.renderingEngineId));var i=a.getViewport(n.viewportId);i.setCamera(o),i.render()}var uc=Y.Enums.Events.CAMERA_MODIFIED;function vc(e){return ll(e,uc,dc)}function fc(e,t,n,r){var o=r.detail,a=o.volumeId,i=o.range,l=(0,Y.getRenderingEngine)(n.renderingEngineId);if(!l)throw new Error("Rendering Engine does not exist: ".concat(n.renderingEngineId));var c=l.getViewport(n.viewportId);if(c instanceof Y.VolumeViewport)c.setProperties({voiRange:i},a);else{if(!(c instanceof Y.StackViewport))throw new Error("Viewport type not supported.");c.setProperties({voiRange:i})}c.render()}function gc(e){return ll(e,Y.Enums.Events.VOI_MODIFIED,fc)}function hc(e,t,n){var r=(0,Y.getRenderingEngine)(n.renderingEngineId);if(!r)throw new Error("No RenderingEngine for Id: ".concat(n.renderingEngineId));var o=e.getOptions(n.viewportId),a=r.getViewport(n.viewportId),i=r.getViewport(t.viewportId);if(!1!==(null==o?void 0:o.syncZoom)){var l=i.getZoom();a.setZoom(l)}if(!1!==(null==o?void 0:o.syncPan)){var c=i.getPan();a.setPan(c)}a.render()}var pc=Y.Enums.Events.CAMERA_MODIFIED;function mc(e){return ll(e,pc,hc)}var wc=h(976);var Ec=function(e,t,n){return Math.min(Math.max(t,e),n)};function yc(e,t){var n=e.type,r=t.volumeId,o=t.delta;if(e instanceof Y.StackViewport)e.scroll(o,t.debounceLoading,t.loop);else{if(!(e instanceof Y.VolumeViewport))throw new Error("Not implemented for Viewport Type: ".concat(n));Ic(e,r,o)}}function Ic(e,t,n){var r=Y.utilities.getVolumeViewportScrollInfo(e,t),o=r.numScrollSteps,a=r.currentStepIndex,i=r.sliceRangeInfo;if(i){var l=i.sliceRange,c=i.spacingInNormalDirection,s=i.camera,d=s.focalPoint,u=s.viewPlaneNormal,v=s.position,f=Y.utilities.snapFocalPointToSlice(d,v,l,u,c,n),g=f.newFocalPoint,h=f.newPosition;e.setCamera({focalPoint:g,position:h}),e.render();var p=a+n;if((p>o||p<0)&&e.getCurrentImageId()){var m={volumeId:t,viewport:e,delta:n,desiredStepIndex:p,currentStepIndex:a,numScrollSteps:o,currentImageId:e.getCurrentImageId()};Y.utilities.triggerEvent(Y.eventTarget,Y.EVENTS.VOLUME_SCROLL_OUT_OF_BOUNDS,m)}}}function bc(){return bc=Ra(Na().mark((function e(t){var n,r,o,a,i,l,c,s,d,u,v=arguments;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=v.length>1&&void 0!==v[1]?v[1]:{},r=n.imageIndex,o=n.debounceLoading,a=n.volumeId,i=(0,Y.getEnabledElement)(t)){e.next=5;break}throw new Error("Element has been disabled");case 5:l=i.viewport,c=Cc(l,o),s=c.imageIndex,d=c.numberOfSlices,u=Tc(d,r),yc(l,{delta:u-s,debounceLoading:o,volumeId:a});case 10:case"end":return e.stop()}}),e)}))),bc.apply(this,arguments)}function Cc(e,t){if(e instanceof Y.StackViewport)return{numberOfSlices:e.getImageIds().length,imageIndex:t?e.getTargetImageIdIndex():e.getCurrentImageIdIndex()};if(e instanceof Y.VolumeViewport)return Y.utilities.getImageSliceDataForVolumeViewport(e);throw new Error("Unsupported viewport type")}function Tc(e,t){return Ec(t,0,e-1)}var _c=function(e){return bc.apply(this,arguments)};function Oc(e,t){var n=e.getCamera().viewPlaneNormal,r=t.getCamera().viewPlaneNormal,o=wc.vec3.dot(n,r);return Math.abs(o)>.9}function Dc(e,t,n){return Sc.apply(this,arguments)}function Sc(){return(Sc=Ra(Na().mark((function e(t,n,r){var o,a,i,l,c,s,d,u,v,f,g,h,p;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=(0,Y.getRenderingEngine)(r.renderingEngineId)){e.next=3;break}throw new Error("No RenderingEngine for Id: ".concat(r.renderingEngineId));case 3:if(a=o.getViewport(n.viewportId),i=o.getViewport(r.viewportId),l=a.getFrameOfReferenceUID(),c=i.getFrameOfReferenceUID(),s=a.getCurrentImageId(),d=Y.metaData.get("imagePlaneModule",s),u=d.imagePositionPatient,v=i.getImageIds(),Oc(a,i)){e.next=13;break}return e.abrupt("return");case 13:if(l!==c){e.next=21;break}if(-1===(f=xc(u,v)).index||i.getCurrentImageIdIndex()===f.index){e.next=19;break}return e.next=18,_c(i.element,{imageIndex:f.index});case 18:return e.abrupt("return");case 19:e.next=29;break;case 21:if(g=Y.utilities.spatialRegistrationMetadataProvider.get("spatialRegistrationModule",[r.viewportId,n.viewportId])){e.next=24;break}throw new Error("No registration matrix found for sourceViewport: ".concat(n.viewportId," and targetViewport: ").concat(r.viewportId,", viewports with different frameOfReferenceUIDs must have a registration matrix in the registrationMetadataProvider. Use calculateViewportsRegistrationMatrix to calculate the matrix."));case 24:if(h=wc.vec3.transformMat4(wc.vec3.create(),u,g),-1===(p=xc(h,v)).index||i.getCurrentImageIdIndex()===p.index){e.next=29;break}return e.next=29,_c(i.element,{imageIndex:p.index});case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xc(e,t){return t.reduce((function(t,n,r){var o=Y.metaData.get("imagePlaneModule",n).imagePositionPatient,a=wc.vec3.distance(o,e);return a<t.distance?{distance:a,index:r}:t}),{distance:1/0,index:-1})}var kc=Y.Enums.Events.STACK_NEW_IMAGE;function Mc(e){return ll(e,kc,Dc)}var Rc=function(e,t,n){return"".concat(e,"::").concat(t,"::").concat(n)},Pc=function(e,t){Object.keys(e).forEach((function(n){var r=t.getAttribute(n),o=e[n];void 0===o||""===o?t.removeAttribute(n):r!==o&&t.setAttribute(n,o)}))},Nc=function(e,t){Object.keys(e).forEach((function(n){var r=e[n];void 0!==r&&""!==r&&t.setAttribute(n,r)}))},Ac=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=Object.assign({color:"dodgerblue",fill:"transparent",width:"2",lineWidth:void 0},a),c=l.color,s=l.fill,d=l.width,u=l.lineWidth,v=u||d,f="http://www.w3.org/2000/svg",g=Rc(t,"circle",n),h=e.getSvgNode(g),p={cx:"".concat(r[0]),cy:"".concat(r[1]),r:"".concat(o),stroke:c,fill:s,"stroke-width":v};if(h)Pc(p,h),e.setNodeTouched(g);else{var m=document.createElementNS(f,"circle");""!==i&&m.setAttribute("data-id",i),Nc(p,m),e.appendNode(m,g)}},Lc=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},a),c=l.color,s=l.width,d=l.lineWidth,u=l.lineDash,v=d||s,f="http://www.w3.org/2000/svg",g=Rc(t,"ellipse",n),h=e.getSvgNode(g),p=Math.abs(r[0]-o[0]),m=Math.abs(r[1]-o[1]),w=Math.min(r[0],o[0]),E=Math.min(r[1],o[1]),y=[w+p/2,E+m/2],I=p/2,b=m/2,C={cx:"".concat(y[0]),cy:"".concat(y[1]),rx:"".concat(I),ry:"".concat(b),stroke:c,fill:"transparent","stroke-width":v,"stroke-dasharray":u};if(h)Pc(C,h),e.setNodeTouched(g);else{var T=document.createElementNS(f,"ellipse");""!==i&&T.setAttribute("data-id",i),Nc(C,T),e.appendNode(T,g)}},Uc=function(e,t,n,r){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=Object.assign({color:"dodgerblue",handleRadius:"6",width:"2",lineWidth:void 0,fill:"transparent",type:"circle",opacity:1},o),i=a.color,l=a.handleRadius,c=a.width,s=a.lineWidth,d=a.fill,u=a.type,v=a.opacity,f=s||c,g=0;g<r.length;g++){var h=r[g],p="http://www.w3.org/2000/svg",m=Rc(t,"handle","hg-".concat(n,"-index-").concat(g)),w=void 0;if("circle"===u)w={cx:"".concat(h[0]),cy:"".concat(h[1]),r:l,stroke:i,fill:d,"stroke-width":f,opacity:v};else{if("rect"!==u)throw new Error("Unsupported handle type: ".concat(u));var E=parseFloat(l),y=1.5*E,I=h[0]-.5*y,b=h[1]-.5*y;w={x:"".concat(I),y:"".concat(b),width:"".concat(y),height:"".concat(y),stroke:i,fill:d,"stroke-width":f,rx:"".concat(.1*y),opacity:v}}var C=e.getSvgNode(m);if(C)Pc(w,C),e.setNodeTouched(m);else{var T=document.createElementNS(p,u);Nc(w,T),e.appendNode(T,m)}}};function Vc(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";if(!(isNaN(r[0])||isNaN(r[1])||isNaN(o[0])||isNaN(o[1]))){var l=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0,shadow:void 0},a),c=l.color,s=l.width,d=l.lineWidth,u=l.lineDash,v=l.shadow,f=d||s,g="http://www.w3.org/2000/svg",h=Rc(t,"line",n),p=e.getSvgNode(h),m=v?"filter:url(#shadow-".concat(e.svgLayerElement.id,");"):"",w={x1:"".concat(r[0]),y1:"".concat(r[1]),x2:"".concat(o[0]),y2:"".concat(o[1]),stroke:c,style:m,"stroke-width":f,"stroke-dasharray":u};if(p)Pc(w,p),e.setNodeTouched(h);else{var E=document.createElementNS(g,"line");""!==i&&E.setAttribute("data-id",i),Nc(w,E),e.appendNode(E,h)}}}function Bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jc(e,t,n,r,o){if(!(r.length<2)){var a,i=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0,connectLastToFirst:!1},o),l=i.color,c=i.width,s=i.lineWidth,d=i.lineDash,u=s||c,v=Rc(t,"polyline",n),f=e.getSvgNode(v),g="",h=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Bc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Bc(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(r);try{for(h.s();!(a=h.n()).done;){var p=a.value;g+="".concat(p[0],", ").concat(p[1]," ")}}catch(e){h.e(e)}finally{h.f()}if(o.connectLastToFirst){var m=r[0];g+="".concat(m[0],", ").concat(m[1])}var w={points:g,stroke:l,fill:"none","stroke-width":u,"stroke-dasharray":d};if(f)Pc(w,f),e.setNodeTouched(v);else{var E=document.createElementNS("http://www.w3.org/2000/svg","polyline");Nc(w,E),e.appendNode(E,v)}}}function Hc(e,t,n){var r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[""],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,l=i.padding,c=i.color,s=i.fontFamily,d=i.fontSize,u=i.background,v=a[0]+l,f=a[1]+l,g="http://www.w3.org/2000/svg",h=Rc(t,"text",n),p=e.getSvgNode(h);if(p){for(var m=p.querySelector("text"),w=Array.from(m.children),E=0;E<w.length;E++){var y=w[E],I=o[E]||"";y.textContent=I}if(o.length>w.length){for(var b=0;b<o.length-w.length;b++){var C=o[b+w.length],T=Fc(C);m.appendChild(T)}p.appendChild(m),e.appendNode(p,h)}var _={fill:c,"font-size":d,"font-family":s},O={transform:"translate(".concat(v," ").concat(f,")")};Pc(_,m),Pc(O,p),r=Gc(p,u),e.setNodeTouched(h)}else{var D=document.createElementNS(g,"g");D.setAttribute("transform","translate(".concat(v," ").concat(f,")"));for(var S=Wc(e,i),x=0;x<o.length;x++){var k=o[x],M=Fc(k);S.appendChild(M)}D.appendChild(S),e.appendNode(D,h),r=Gc(D,u)}return Object.assign({},r,{x:v,y:f,height:r.height+l,width:r.width+l})}function Wc(e,t){var n=t.color,r=t.fontFamily,o=t.fontSize,a=document.createElementNS("http://www.w3.org/2000/svg","text"),i="filter:url(#shadow-".concat(e.svgLayerElement.id,");"),l="".concat("user-select: none; pointer-events: none; -webkit-tap-highlight-color:  rgba(255, 255, 255, 0);").concat(i);return a.setAttribute("x","0"),a.setAttribute("y","0"),a.setAttribute("fill",n),a.setAttribute("font-family",r),a.setAttribute("font-size",o),a.setAttribute("style",l),a}function Fc(e){var t=document.createElementNS("http://www.w3.org/2000/svg","tspan");return t.setAttribute("x","0"),t.setAttribute("dy","1.2em"),t.textContent=e,t}function Gc(e,t){var n=e.querySelector("rect.background");if(!t)return n&&e.removeChild(n),e.getBBox();n||((n=document.createElementNS("http://www.w3.org/2000/svg","rect")).setAttribute("class","background"),e.insertBefore(n,e.firstChild));var r=e.getBBox(),o={x:"".concat(r.x),y:"".concat(r.y),width:"".concat(r.width),height:"".concat(r.height),fill:t};return Pc(o,n),r}var qc=function(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=Object.assign({fontFamily:"Helvetica, Arial, sans-serif",fontSize:"14px",color:"rgb(255, 255, 0)",background:"",padding:25,centerX:!1,centerY:!0},a),l=Hc(e,t,n,r,o,i);return l};function zc(e,t){var n=[0,0],r=Number.MAX_SAFE_INTEGER;return e.forEach((function(e){var o,a,i,l,c,s,d,u=(o=e,i=(a=Bn(t,2))[0],l=a[1],s=(c=Bn(o,2))[0],d=c[1],Math.sqrt(Math.pow(i-s,2)+Math.pow(l-d,2)));u<r&&(r=u,n=xr(e))})),n}function Kc(e){var t=e.x,n=e.y,r=e.height,o=e.width,a=o/2,i=r/2;return[[t+a,n],[t,n+i],[t+a,n+r],[t+o,n+i]]}var Yc=function(e,t,n,r,o,a){var i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},l=r.length>0?zc(r,o):o,c=Kc(a),s=zc(c,l),d=Object.assign({color:"rgb(255, 255, 0)",lineWidth:"1",lineDash:"2,3"},i);Vc(e,t,"link-".concat(n),l,s,d)},Jc=function(e,t,n,r,o,a,i){var l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=Object.assign({handleRadius:"6",centering:{x:!1,y:!0}},l),s=qc(e,t,n,r,o,c);return Yc(e,t,n,a,o,s,c),s};function $c(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",l=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},a),c=l.color,s=l.width,d=l.lineWidth,u=l.lineDash,v=d||s,f="http://www.w3.org/2000/svg",g=Rc(t,"rect",n),h=e.getSvgNode(g),p=[Math.min(r[0],o[0]),Math.min(r[1],o[1])],m=Math.abs(r[0]-o[0]),w=Math.abs(r[1]-o[1]),E={x:"".concat(p[0]),y:"".concat(p[1]),width:"".concat(m),height:"".concat(w),stroke:c,fill:"transparent","stroke-width":v,"stroke-dasharray":u};if(h)Pc(E,h),e.setNodeTouched(g);else{var y=document.createElementNS(f,"rect");""!==i&&y.setAttribute("data-id",i),Nc(E,y),e.appendNode(y,g)}}function Zc(e,t,n,r,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};if(!(isNaN(r[0])||isNaN(r[1])||isNaN(o[0])||isNaN(o[1]))){var i=Object.assign({color:"dodgerblue",width:"2",lineWidth:void 0,lineDash:void 0},a),l=i.color,c=i.width,s=i.lineWidth,d=i.lineDash;Vc(e,t,n,r,o,{color:l,width:c,lineWidth:s,lineDash:d});var u=10,v=Math.atan2(o[1]-r[1],o[0]-r[0]),f={start:[o[0]-u*Math.cos(v-Math.PI/7),o[1]-u*Math.sin(v-Math.PI/7)],end:o},g={start:[o[0]-u*Math.cos(v+Math.PI/7),o[1]-u*Math.sin(v+Math.PI/7)],end:o};Vc(e,t,"2",f.start,f.end,{color:l,width:c,lineWidth:s}),Vc(e,t,"3",g.start,g.end,{color:l,width:c,lineWidth:s})}}function Xc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,r=(0,Y.getEnabledElement)(e);if(!r)throw new Error("getAnnotationNearPoint: enabledElement not found");return es(r,t,n)}function es(e,t,n){var r=e.renderingEngineId,o=e.viewportId,a=Ar(o,r);if(!a)return null;var i=a._toolInstances;for(var l in i){var c=ts(i[l],e,t,n);if(c)return c}return null}function ts(e,t,n,r){var o,a=t.viewport,i=et(e.constructor.toolName,null==a?void 0:a.element),l=null==a||null===(o=a.getCurrentImageId)||void 0===o?void 0:o.call(a);if(null!=i&&i.length){var c,s=t.viewport.element,d=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Xc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xc(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(i);try{for(d.s();!(c=d.n()).done;){var u,v=c.value,f=null===(u=v.metadata)||void 0===u?void 0:u.referencedImageId;if(!(l&&f&&l!==f||!e.isPointNearTool)&&(e.isPointNearTool(s,v,n,r,"")||e.getHandleNearImagePoint(s,v,n,r)))return v}}catch(e){d.e(e)}finally{d.f()}}return null}var ns=function(e){var t=da(e);return null!==e&&("object"===t||"function"===t)},rs=function(e,t,n){var r,o,a,i,l,c,s=0,d=!1,u=!1,v=!0,f=!t&&0!==t&&"function"==typeof window.requestAnimationFrame;if("function"!=typeof e)throw new TypeError("Expected a function");function g(t){var n=r,a=o;return r=o=void 0,s=t,i=e.apply(a,n)}function h(e,t){return f?window.requestAnimationFrame(e):setTimeout(e,t)}function p(e){return s=e,l=h(w,t),d?g(e):i}function m(e){var n=e-c;return void 0===c||n>=t||n<0||u&&e-s>=a}function w(){var e=Date.now();if(m(e))return E(e);l=h(w,function(e){var n=e-s,r=t-(e-c);return u?Math.min(r,a-n):r}(e))}function E(e){return l=void 0,v&&r?g(e):(r=o=void 0,i)}function y(){for(var e=Date.now(),n=m(e),a=arguments.length,s=new Array(a),d=0;d<a;d++)s[d]=arguments[d];if(r=s,o=this,c=e,n){if(void 0===l)return p(c);if(u)return l=h(w,t),g(c)}return void 0===l&&(l=h(w,t)),i}return t=Number(t)||0,ns(n)&&(d=Boolean(n.leading),a=(u="maxWait"in n)?Math.max(Number(n.maxWait)||0,t):a,v="trailing"in n?Boolean(n.trailing):v),y.cancel=function(){void 0!==l&&function(e){if(f)return window.cancelAnimationFrame(e);clearTimeout(e)}(l),s=0,r=c=o=l=void 0},y.flush=function(){return void 0===l?i:E(Date.now())},y.pending=function(){return void 0!==l},y},os=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return ns(n)&&(r="leading"in n?Boolean(n.leading):r,o="trailing"in n?Boolean(n.trailing):o),rs(e,t,{leading:r,trailing:o,maxWait:t})},as=Y.utilities.calibratedPixelSpacingMetadataProvider;function is(e,t,n,r){r||(r=n),as.add(e,[n,r]),t.getStackViewports().forEach((function(t){t.getImageIds().includes(e)&&t.calibrateSpacing(e)}))}function ls(e,t,n,r){var o,a,i,l,c,s,d;d=e.getScalarData?e.getScalarData():e.getPointData().getScalars().getData();var u=e.getDimensions();if(r){var v=Bn(r,3),f=Bn(v[0],2);o=f[0],a=f[1];var g=Bn(v[1],2);i=g[0],l=g[1];var h=Bn(v[2],2);c=h[0],s=h[1]}else o=0,a=u[0],i=0,l=u[1],c=0,s=u[2];for(var p=wc.vec3.fromValues(o,i,c),m=e.getDirection(),w=m.slice(0,3),E=m.slice(3,6),y=m.slice(6,9),I=Bn(e.getSpacing(),3),b=I[0],C=I[1],T=I[2],_=e.indexToWorld(p),O=wc.vec3.fromValues(w[0]*b,w[1]*b,w[2]*b),D=wc.vec3.fromValues(E[0]*C,E[1]*C,E[2]*C),S=wc.vec3.fromValues(y[0]*T,y[1]*T,y[2]*T),x=u[0],k=u[0]*u[1],M=c;M<=s;M++)for(var R=i;R<=l;R++)for(var P=o;P<=a;P++){var N=[P,R,M],A=P-o,L=R-i,U=M-c,V=_,B=[V[0]+A*O[0]+L*D[0]+U*S[0],V[1]+A*O[1]+L*D[1]+U*S[1],V[2]+A*O[2]+L*D[2]+U*S[2]];if(t(B,N)){var j=M*k+R*x+P;n({value:d[j],index:j,pointIJK:N,pointLPS:B})}}}var cs=function(e,t){var n=1/0,r=0,o=1/0,a=0,i=1/0,l=0;if(e.forEach((function(e){n=Math.min(e[0],n),r=Math.max(e[0],r),o=Math.min(e[1],o),a=Math.max(e[1],a),i=Math.min(e[2],i),l=Math.max(e[2],l)})),n=Math.floor(n),r=Math.floor(r),o=Math.floor(o),a=Math.floor(a),i=Math.floor(i),l=Math.floor(l),t){var c=Bn(t,3),s=c[0],d=c[1],u=c[2];n=Math.max(0,n),r=Math.min(s-1,r),o=Math.max(0,o),a=Math.min(d-1,a),i=Math.max(0,i),l=Math.min(u-1,l)}return[[n,r],[o,a],[i,l]]},ss=Y.utilities.transformWorldToIndex;function ds(e,t,n,r){var o=function(e,t,n){var r,o=Bn(e,2),a=o[0],i=o[1],l=wc.vec3.fromValues((a[0]+i[0])/2,(a[1]+i[1])/2,(a[2]+i[2])/2),c=wc.vec3.distance(a,i)/2;if(!n){var s=ss(t,l),d=t.getSpacing(),u=Math.min.apply(Math,xr(d)),v=Math.ceil(c/u);return{boundsIJK:r=[[s[0]-v,s[0]+v],[s[1]-v,s[1]+v],[s[2]-v,s[2]+v]],centerWorld:l,radiusWorld:c}}return r=function(e,t,n,r,o){var a=Bn(n,2),i=a[0],l=a[1],c=e.getDimensions(),s=t.getCamera(),d=wc.vec3.fromValues(s.viewUp[0],s.viewUp[1],s.viewUp[2]),u=wc.vec3.fromValues(s.viewPlaneNormal[0],s.viewPlaneNormal[1],s.viewPlaneNormal[2]),v=wc.vec3.create();wc.vec3.cross(v,d,u);var f=wc.vec3.create(),g=wc.vec3.create();wc.vec3.scaleAndAdd(f,l,u,o),wc.vec3.scaleAndAdd(g,i,u,-o),wc.vec3.scaleAndAdd(f,f,v,-o),wc.vec3.scaleAndAdd(g,g,v,o);var h=[ss(e,f),ss(e,g)];return cs(h,c)}(t,n,e,0,c),{boundsIJK:r,centerWorld:l,radiusWorld:c}}(t,e,r),a=o.boundsIJK,i={center:o.centerWorld,radius:o.radiusWorld};ls(e,(function(e){return function(e,t){var n=e.center,r=e.radius;return Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)+Math.pow(t[2]-n[2],2)<=Math.pow(r,2)}(i,e)}),n,a)}function us(e,t){!function(e,t){var n=e.viewport,r=t.volume,o=t.segmentsLocked,a=t.segmentIndex,i=t.segmentationId,l=t.points,c=r.imageData,s=r.dimensions,d=r.getScalarData(),u=[];ds(c,[l[0],l[1]],(function(e){var t=e.index,n=e.value;o.includes(n)||(d[t]=a,u.push(t))}),n);var v=s[0]*s[1],f=Math.floor(u[0]/v),g=Math.floor(u[u.length-1]/v);Ct(i,Array.from({length:g-f+1},(function(e,t){return t+f})))}(e,t)}function vs(e,t){us(e,Object.assign({},t,{segmentIndex:0}))}function fs(e){var t=Bn(e,4),n=t[0],r=t[1],o=t[2],a=t[3];return[[o[0],r[1]],[a[0],n[1]]]}function gs(e,t){var n=e.center,r=e.xRadius,o=e.yRadius,a=e.zRadius,i=Bn(t,3),l=i[0],c=i[1],s=i[2],d=Bn(n,3),u=d[0],v=d[1],f=d[2],g=0;return 0!==r&&(g+=(l-u)*(l-u)/(r*r)),0!==o&&(g+=(c-v)*(c-v)/(o*o)),0!==a&&(g+=(s-f)*(s-f)/(a*a)),g<=1}var hs=Y.utilities.transformWorldToIndex;function ps(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=t.volume,o=t.imageVolume,a=t.points,i=t.segmentsLocked,l=t.segmentIndex,c=t.segmentationId,s=t.strategySpecificConfiguration,d=r.imageData,u=r.dimensions,v=r.getScalarData(),f=e.viewport,g=wc.vec3.fromValues(0,0,0);a.forEach((function(e){wc.vec3.add(g,g,e)})),wc.vec3.scale(g,g,1/a.length);var h=a.map((function(e){return f.worldToCanvas(e)})),p=fs(h),m=Bn(p,2),w=m[0],E=m[1],y=f.canvasToWorld(w),I=f.canvasToWorld(E),b=[hs(d,y),hs(d,I)],C=cs(b,u);if(C.every((function(e){var t=Bn(e,2);return t[0]!==t[1]})))throw new Error("Oblique segmentation tools are not supported yet");var T={center:g,xRadius:Math.abs(y[0]-I[0])/2,yRadius:Math.abs(y[1]-I[1])/2,zRadius:Math.abs(y[2]-I[2])/2},_=new Set;ls(d,(function(e,t){return gs(T,e)}),n?function(e){var t=e.value,n=e.index,r=e.pointIJK;i.includes(t)||ms(n,o,s)&&(v[n]=l,_.add(r[2]))}:function(e){var t=e.value,n=e.index,r=e.pointIJK;i.includes(t)||(v[n]=l,_.add(r[2]))},C);var O=Array.from(_);Ct(c,O)}function ms(e,t,n){var r=n.THRESHOLD_INSIDE_CIRCLE,o=t.getScalarData()[e],a=r.threshold;return a[0]<=o&&o<=a[1]}function ws(e,t){ps(e,t,!1)}function Es(e,t){var n=t.volume,r=t.imageVolume;if(!Y.utilities.isEqual(n.dimensions,r.dimensions)||!Y.utilities.isEqual(n.direction,r.direction))throw new Error("Only source data the same dimensions/size/orientation as the segmentation currently supported.");ps(e,t,!0)}function ys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Is(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ys(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function bs(e,t){ws(e,Is(Is({},t),{},{segmentIndex:0}))}function Cs(e){var t=Ot().getSegmentationRepresentations(e);if(t)return t.find((function(e){return e.active}))}function Ts(e,t){Ot().setActiveSegmentationRepresentation(e,t),It(e,t)}function _s(e,t){var n=Dt(e);if(!n)throw new Error("No segmentation state found for ".concat(e));return n.segmentsLocked.has(t)}function Os(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Dt(e);if(!r)throw new Error("No segmentation state found for ".concat(e));var o=r.segmentsLocked;n?o.add(t):o.delete(t),bt(e)}function Ds(e){var t=Dt(e);if(!t)throw new Error("No segmentation state found for ".concat(e));var n=t.segmentsLocked;return Array.from(n)}function Ss(e,t){var n=Dt(e);(null==n?void 0:n.activeSegmentIndex)!==t&&(n.activeSegmentIndex=t,bt(e))}function xs(e){var t=Dt(e);if(t)return t.activeSegmentIndex}function ks(e,t){if(!e)throw new Error("addColorLUT: colorLUT is required");Y.utilities.isEqual(e[0],[0,0,0,0])||(console.warn("addColorLUT: [0, 0, 0, 0] color is not provided for the background color (segmentIndex =0), automatically adding it"),e.unshift([0,0,0,0])),zt(e,t)}function Ms(e,t,n){var r=Ht(e,t);if(!r)throw new Error("setColorLUT: could not find segmentation representation with UID ".concat(t));if(!qt(n))throw new Error("setColorLUT: could not find colorLUT with index ".concat(n));r.colorLUTIndex=n,It(e,t)}function Rs(e,t,n){var r=Ht(e,t);if(!r)throw new Error("segmentation representation with UID ".concat(t," does not exist for tool group ").concat(e));return qt(r.colorLUTIndex)[n]}function Ps(e,t,n,r){for(var o=Rs(e,t,n),a=0;a<r.length;a++)o[a]=r[a];It(e,t)}var Ns=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE_CIRCLE:ws,THRESHOLD_INSIDE_CIRCLE:Es,ERASE_INSIDE_CIRCLE:bs,FILL_INSIDE_SPHERE:us,ERASE_INSIDE_SPHERE:vs},strategySpecificConfiguration:{THRESHOLD_INSIDE_CIRCLE:{threshold:[-150,-70]}},defaultStrategy:"FILL_INSIDE_CIRCLE",activeStrategy:"FILL_INSIDE_CIRCLE",brushSize:25}};return X(this,o),Q(la(e=r.call(this,t,n)),"_editData",void 0),Q(la(e),"_hoverData",void 0),Q(la(e),"onSetToolPassive",(function(){e.disableCursor()})),Q(la(e),"onSetToolEnabled",(function(){e.disableCursor()})),Q(la(e),"onSetToolDisabled",(function(){e.disableCursor()})),Q(la(e),"preMouseDownCallback",(function(t){var n=t.detail.element,r=(0,Y.getEnabledElement)(n),o=r.viewport,a=r.renderingEngine;if(o instanceof Y.StackViewport)throw new Error("Not implemented yet");var i=Cs(e.toolGroupId);if(!i)throw new Error("No active segmentation detected, create one before using the brush tool");var l=i.segmentationId,c=i.type,s=Ds(l),d=Dt(l).representationData[c].volumeId,u=Y.cache.getVolume(d),v=o.getActors()[0].uid,f=Y.cache.getVolume(v),g=[o.id];return e._editData={segmentation:u,imageVolume:f,segmentsLocked:s},e._activateDraw(n),Ql(n),t.preventDefault(),na(a,g),!0})),Q(la(e),"mouseMoveCallback",(function(t){e.mode===Ke.Active&&e.updateCursor(t)})),Q(la(e),"_dragCallback",(function(t){var n=t.detail.element,r=(0,Y.getEnabledElement)(n),o=r.renderingEngine,a=e._editData,i=a.imageVolume,l=a.segmentation,c=a.segmentsLocked;e.updateCursor(t);var s=e._hoverData,d=s.segmentIndex,u=s.segmentationId,v=s.segmentationRepresentationUID,f=s.brushCursor,g=s.viewportIdsToRender,h=f.data,p=f.metadata,m=p.viewPlaneNormal,w=p.viewUp;na(o,g);var E={points:h.handles.points,volume:l,imageVolume:i,segmentIndex:d,segmentsLocked:c,viewPlaneNormal:m,toolGroupId:e.toolGroupId,segmentationId:u,segmentationRepresentationUID:v,viewUp:w,strategySpecificConfiguration:e.configuration.strategySpecificConfiguration};e.applyActiveStrategy(r,E)})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e._editData,o=r.imageVolume,a=r.segmentation,i=r.segmentsLocked,l=e._hoverData,c=l.segmentIndex,s=l.segmentationId,d=l.segmentationRepresentationUID,u=l.brushCursor,v=u.data,f=u.metadata,g=f.viewPlaneNormal,h=f.viewUp;e._deactivateDraw(n),Xl(n);var p=(0,Y.getEnabledElement)(n),m=p.viewport;if(e._editData=null,e.updateCursor(t),m instanceof Y.StackViewport)throw new Error("Not implemented yet");var w={points:v.handles.points,volume:a,imageVolume:o,segmentIndex:c,segmentsLocked:i,viewPlaneNormal:g,toolGroupId:e.toolGroupId,segmentationId:s,segmentationRepresentationUID:d,viewUp:h,strategySpecificConfiguration:e.configuration.strategySpecificConfiguration};e.applyActiveStrategy(p,w)})),Q(la(e),"_activateDraw",(function(t){t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback)})),e}return Z(o,[{key:"disableCursor",value:function(){this._hoverData=void 0}},{key:"updateCursor",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints.canvas,o=(0,Y.getEnabledElement)(n),a=o.renderingEngine,i=o.viewport,l=i.getCamera(),c=l.viewPlaneNormal,s=l.viewUp,d=this.toolGroupId,u=Cs(d);if(u){var v=u.segmentationRepresentationUID,f=u.segmentationId,g=xs(f),h=Rs(d,v,g),p=[i.id],m={metadata:{viewPlaneNormal:xr(c),viewUp:xr(s),FrameOfReferenceUID:i.getFrameOfReferenceUID(),referencedImageId:"",toolName:this.getToolName(),segmentColor:h},data:{}};this._hoverData={brushCursor:m,centerCanvas:r,segmentIndex:g,segmentationId:f,segmentationRepresentationUID:v,segmentColor:h,viewportIdsToRender:p},this._calculateCursor(n,r),na(a,p)}else console.warn("No active segmentation detected, create one before using the brush tool")}},{key:"_calculateCursor",value:function(e,t){var n=(0,Y.getEnabledElement)(e).viewport.canvasToWorld,r=this.configuration.brushSize,o=[t[0],t[1]+r],a=[t[0],t[1]-r],i=[t[0]-r,t[1]],l=[t[0]+r,t[1]],c=this._hoverData.brushCursor.data;void 0===c.handles&&(c.handles={}),c.handles.points=[n(o),n(a),n(i),n(l)],c.invalidated=!1}},{key:"invalidateBrushCursor",value:function(){void 0!==this._hoverData&&(this._hoverData.brushCursor.data.invalidated=!0)}},{key:"renderAnnotation",value:function(e,t){if(this._hoverData){var n=e.viewport;if(this._hoverData.viewportIdsToRender.includes(n.id)){var r=this._hoverData.brushCursor;if(!0===r.data.invalidated){var o=this._hoverData.centerCanvas,a=n.element;this._calculateCursor(a,o)}var i=r.metadata,l=i.brushCursorUID,c=r.data.handles.points.map((function(e){return n.worldToCanvas(e)})),s=c[0],d=c[1],u=[Math.floor((s[0]+d[0])/2),Math.floor((s[1]+d[1])/2)],v=Math.abs(s[1]-Math.floor((s[1]+d[1])/2)),f="rgb(".concat(i.segmentColor.slice(0,3),")");n.getRenderingEngine()?Ac(t,l,"0",u,v,{color:f}):console.warn("Rendering Engine has been destroyed")}}}}]),o}(ka);Q(Ns,"toolName",void 0),Ns.toolName="Brush";var As=Ns;function Ls(e){var t=ia(e);if(void 0!==t){var n=t._toolInstances;if(Object.keys(n).length)return Object.values(n).filter((function(e){return e instanceof As}))}}function Us(e,t,n,r){for(var o=[],a=0;a<2;a++)for(var i=0;i<2;i++)for(var l=0;l<2;l++){var c=r;c[0]=c[0]+(2*a-1)*n[0]/2,c[1]=c[1]+(2*i-1)*n[1]/2,c[2]=c[2]+(2*l-1)*n[2]/2,o.push(c)}var s=o.map((function(t){return Y.utilities.transformWorldToIndex(e,t)}));return cs(s,t)}function Vs(e,t){for(var n,r,o=e.spacing,a=(e.imageData,e.getScalarData()),i=[],l=0,c=0;c<t.length;c++){var s=t[c].volume,d=s.imageData,u=s.spacing,v=s.dimensions,f=t[c].volume.getScalarData().length;f===a.length&&(n=u,r=o,JSON.stringify(n)===JSON.stringify(r))&&(l=c);var g=d.getPointData().getScalars().getData(),h=t[c].lower,p=t[c].upper;i.push({imageData:d,referenceValues:g,lower:h,upper:p,spacing:u,dimensions:v,volumeSize:f})}return{volumeInfoList:i,baseVolumeIdx:l}}var Bs=function(e,t,n){var r=e.imageData,o=e.getScalarData(),a=n.overwrite,i=n.boundsIJK,l=(null==n?void 0:n.overlapType)||0;if(a)for(var c=0;c<o.length;c++)o[c]=0;var s,d,u,v=Vs(e,t),f=v.baseVolumeIdx,g=v.volumeInfoList,h=function(e,t,n){var r=e.imageData,o=e.dimensions,a=e.lower,i=e.upper,c=Us(r,o,t,n);d=0,s=0,u={lower:a,upper:i};var v=!1;return ls(r,(function(){return!0}),(function(e){var t=e.value;d+=1,t>=u.lower&&t<=u.upper&&(s+=1)}),c),0===l?v=s>0:1==l&&(v=s===d),v},p=function(e,t){var n=e.imageData,r=e.referenceValues,o=e.lower,a=e.upper,i=r[n.computeOffsetIndex(t)];return!(i<=o||i>=a)};return ls(r,(function(){return!0}),(function(e){for(var t=e.index,n=e.pointIJK,r=e.pointLPS,a=g.length>0,i=0;i<g.length&&(a=g[i].volumeSize===o.length?p(g[i],n):h(g[i],g[f].spacing,r));i++);a&&(o[t]=1)}),i),Ct(e.volumeId),e};function js(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=e[o];a.getFrameOfReferenceUID()===t&&r.push(a)}return r}var Hs=Ke.Active,Ws=Ke.Passive,Fs=Ke.Enabled;function Gs(e,t){for(var n=e.length,r=[],o=0;o<n;o++){var a=e[o],i=Ar(a.id,a.renderingEngineId);i&&qs(i,t)&&r.push(a)}return r}function qs(e,t){var n=e.toolOptions[t];if(!n)return!1;var r=n.mode;return r===Hs||r===Ws||r===Fs}var zs=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999;return e.filter((function(e){var r=e.getCamera();return Math.abs(wc.vec3.dot(r.viewPlaneNormal,t.viewPlaneNormal))>n}))};function Ks(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=(0,Y.getEnabledElement)(e),o=r.renderingEngine,a=r.FrameOfReferenceUID,i=o.getViewports();i=Gs(i=js(i,a),t);var l=o.getViewport(r.viewportId);n&&(i=zs(i,l.getCamera()));var c=i.map((function(e){return e.id}));return c}function Ys(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Js=1-Y.CONSTANTS.EPSILON;function $s(e,t,n){var r=t.viewPlaneNormal,o=e.filter((function(e){var t=e.metadata.viewPlaneNormal;if(!t){var n=e.metadata.referencedImageId,o=Y.metaData.get("imagePlaneModule",n).imageOrientationPatient,a=wc.vec3.fromValues(o[0],o[1],o[2]),i=wc.vec3.fromValues(o[3],o[4],o[5]);t=wc.vec3.create(),wc.vec3.cross(t,a,i),e.metadata.viewPlaneNormal=t}var l=Math.abs(wc.vec3.dot(r,t))>Js;return t&&l}));if(!o.length)return[];var a,i=n/2,l=t.focalPoint,c=[],s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Ys(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ys(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(o);try{for(s.s();!(a=s.n()).done;){var d=a.value,u=d.data.handles.points[0];if(d.isVisible){var v=wc.vec3.create();wc.vec3.sub(v,l,u);var f=wc.vec3.dot(v,r);Math.abs(f)<i&&c.push(d)}}}catch(e){s.e(e)}finally{s.f()}return c}function Zs(e,t){if(e instanceof Y.StackViewport){var n=e.getCurrentImageId(),r=n.indexOf(":"),o=n.substring(r+1);return t.filter((function(e){if(!e.isVisible)return!1;var t=e.metadata.referencedImageId;if(void 0===t)return!1;var n=t.indexOf(":");return t.substring(n+1)===o}))}if(e instanceof Y.VolumeViewport){var a=e.getCamera();return $s(t,a,Y.utilities.getTargetVolumeAndSpacingInNormalDir(e,a).spacingInNormalDirection)}throw new Error("Viewport Type ".concat(e.type," not supported"))}var Xs=function(e){if(e){if(e.data&&e.highlighted)return bl.Highlighted;if(Ie(e.annotationUID))return bl.Selected;if(ie(e))return bl.Locked}return bl.Default};var Qs=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e;X(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Q(la(e=r.call.apply(r,[this].concat(n))),"onImageSpacingCalibrated",(function(t){var n=t.detail,r=n.element,o=n.rowScale,a=n.columnScale,i=n.imageId,l=n.imageData,c=n.worldToIndex;if((0,Y.getEnabledElement)(r).viewport instanceof Y.VolumeViewport)throw new Error("Cannot calibrate a volume viewport");var s=l.getIndexToWorld(),d=Y.utilities.imageIdToURI(i),u=Ze();u.getFramesOfReference().forEach((function(t){var n=u.getAnnotations(t)[e.getToolName()];n&&n.length&&(n.forEach((function(e){Y.utilities.imageIdToURI(e.metadata.referencedImageId)===d&&(e.invalidated=!0,e.data.cachedStats={},e.data.handles.points=e.data.handles.points.map((function(e){var t=wc.vec4.fromValues.apply(wc.vec4,xr(e).concat([1])),n=wc.vec4.fromValues(0,0,0,1),r=wc.vec4.create();wc.vec4.transformMat4(r,t,c);var i=[a*r[0],o*r[1],r[2]];return wc.vec4.transformMat4(n,wc.vec4.fromValues(i[0],i[1],i[2],1),s),n.slice(0,3)})))})),Fr(r))}))})),e}return Z(o,[{key:"filterInteractableAnnotationsForElement",value:function(e,t){if(t&&t.length)return Zs((0,Y.getEnabledElement)(e).viewport,t)}},{key:"getReferencedImageId",value:function(e,t,n,r){var o,a=this.getTargetId(e);if(e instanceof Y.StackViewport)o=a.split("imageId:")[1];else{var i=a.split("volumeId:")[1],l=Y.cache.getVolume(i);o=Y.utilities.getClosestImageId(l,t,n,r)}return o}},{key:"getStyle",value:function(e,t,n){return Bl(e,t,Xs(n),this.mode)}}]),o}(ka);Q(Qs,"toolName",void 0),Qs.toolName="AnnotationDisplayTool";var ed=Qs;function td(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return nd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nd(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}function nd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var rd=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e;X(this,o);for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return Q(la(e=r.call.apply(r,[this].concat(n))),"mouseMoveCallback",(function(t,n){if(!n)return!1;var r,o=t.detail,a=o.element,i=o.currentPoints.canvas,l=!1,c=td(n);try{for(c.s();!(r=c.n()).done;){var s=r.value;if(!ie(s)&&xe(s.annotationUID)){var d=s.data,u=d.handles?d.handles.activeHandleIndex:void 0,v=e._imagePointNearToolOrHandle(a,s,i,6),f=v&&!s.highlighted,g=!v&&s.highlighted;f||g?(s.highlighted=!s.highlighted,l=!0):d.handles&&d.handles.activeHandleIndex!==u&&(l=!0)}}}catch(e){c.e(e)}finally{c.f()}return l})),e}return Z(o,[{key:"getHandleNearImagePoint",value:function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=t.data,i=a.handles,l=i.points,c=i.textBox,s=c.worldBoundingBox;if(s){var d={topLeft:o.worldToCanvas(s.topLeft),topRight:o.worldToCanvas(s.topRight),bottomLeft:o.worldToCanvas(s.bottomLeft),bottomRight:o.worldToCanvas(s.bottomRight)};if(n[0]>=d.topLeft[0]&&n[0]<=d.bottomRight[0]&&n[1]>=d.topLeft[1]&&n[1]<=d.bottomRight[1])return a.handles.activeHandleIndex=null,c}for(var u=0;u<l.length;u++){var v=l[u],f=o.worldToCanvas(v);if(!0==wc.vec2.distance(n,f)<r)return a.handles.activeHandleIndex=u,v}a.handles.activeHandleIndex=null}},{key:"getLinkedTextBoxStyle",value:function(e,t){return{fontFamily:this.getStyle("textBoxFontFamily",e,t),fontSize:this.getStyle("textBoxFontSize",e,t),color:this.getStyle("textBoxColor",e,t),shadow:this.getStyle("textBoxShadow",e,t),background:this.getStyle("textBoxBackground",e,t),lineWidth:this.getStyle("textBoxLinkLineWidth",e,t),lineDash:this.getStyle("textBoxLinkLineDash",e,t)}}},{key:"_imagePointNearToolOrHandle",value:function(e,t,n,r){return!!this.getHandleNearImagePoint(e,t,n,r)||!!this.isPointNearTool(e,t,n,r,"mouse")||void 0}}]),o}(ed);Q(rd,"toolName",void 0),rd.toolName="AnnotationTool";var od=rd;function ad(e,t){return(e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])}function id(e,t,n){var r=ad(e,t);if(0===r)return ad(n,e);var o=((n[0]-e[0])*(t[0]-e[0])+(n[1]-e[1])*(t[1]-e[1]))/r;return ad(n,o<0?e:o>1?t:[e[0]+o*(t[0]-e[0]),e[1]+o*(t[1]-e[1])])}function ld(e,t,n){if(2!==e.length||2!==t.length||2!==n.length)throw Error("lineStart, lineEnd, and point should have 2 elements of [x, y]");return Math.sqrt(id(e,t,n))}function cd(e,t){if(4!==e.length||2!==t.length)throw Error("rectangle:[left, top, width, height] or point: [x,y] not defined correctly");var n=Bn(e,4),r=n[0],o=n[1],a=n[2],i=n[3],l=655535,c=function(e,t,n,r){return{top:[[e,t],[e+n,t]],right:[[e+n,t],[e+n,t+r]],bottom:[[e+n,t+r],[e,t+r]],left:[[e,t+r],[e,t]]}}(r,o,a,i);return Object.keys(c).forEach((function(e){var n=Bn(c[e],2),r=ld(n[0],n[1],t);r<l&&(l=r)})),l}function sd(e){var t,n,r,o,a=(n=[(t=e)[0],t[1]].sort((function(e,t){return e[0]<t[0]?-1:1})),r=[t[0],t[1]].sort((function(e,t){return e[1]<t[1]?-1:1})),o=n[n.length-1],{top:r[0],bottom:r[r.length-1],right:o}),i=(a.top[1]+a.bottom[1])/2;return[a.right[0],i]}function dd(e,t,n,r){var o=wc.vec3.create();wc.vec3.cross(o,t,e);var a=wc.vec3.fromValues.apply(wc.vec3,xr(n)),i=wc.vec3.fromValues.apply(wc.vec3,xr(r)),l=wc.vec3.create();wc.vec3.subtract(l,a,i);var c=wc.vec3.length(l);if(c<1e-4)return{worldWidth:0,worldHeight:0};var s=wc.vec3.dot(l,o)/(c*wc.vec3.length(o));return{worldWidth:Math.sqrt(1-s*s)*c,worldHeight:s*c}}function ud(e,t){return"CT"===e?"HU":"PT"===e&&!0===t?"SUV":""}function vd(e,t){if(e instanceof Y.BaseVolumeViewport){var n=t.split("volumeId:")[1],r=Y.cache.getVolume(n);return r.scaling&&Object.keys(r.scaling).length>0}if(e instanceof Y.StackViewport)return e.getImageData().preScale.scaled;throw new Error("Viewport is not a valid type")}var fd=Y.utilities.transformWorldToIndex,gd=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=l.getFrameOfReferenceUID(),g={invalidated:!0,highlighted:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:f,referencedImageId:v},data:{label:"",handles:{points:[xr(a),xr(a),xr(a),xr(a)],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},cachedStats:{}}};tt(g,o);var h=Ks(o,e.getToolName());return e.editData={annotation:g,viewportIdsToRender:h,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(c,h),g})),Q(la(e),"isPointNearTool",(function(t,n,r,o){var a=(0,Y.getEnabledElement)(t).viewport,i=n.data.handles.points,l=a.worldToCanvas(i[0]),c=a.worldToCanvas(i[3]),s=e._getRectangleImageCoordinates([l,c]),d=[r[0],r[1]];return cd([s.left,s.top,s.width,s.height],d)<=o})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},e._activateModify(r),Ql(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),t.preventDefault()})),Q(la(e),"handleSelectedCallback",(function(t,n,r){var o=t.detail.element,a=n.data;n.highlighted=!0;var i,l=!1;r.worldPosition?l=!0:i=a.handles.points.findIndex((function(e){return e===r}));var c=Ks(o,e.getToolName());e.editData={annotation:n,viewportIdsToRender:c,handleIndex:i,movingTextBox:l},e._activateModify(o),Ql(o);var s=(0,Y.getEnabledElement)(o).renderingEngine;na(s,c),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(e.editData=null,e.isDrawing=!1,e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}}})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else{var g,h,p,m,w,E,y,I,b=n.currentPoints,C=(0,Y.getEnabledElement)(r).viewport,T=C.worldToCanvas,_=C.canvasToWorld,O=b.world,D=s.handles.points;switch(D[l]=xr(O),l){case 0:case 3:g=T(D[0]),h=[(m=T(D[3]))[0],g[1]],p=[g[0],m[1]],E=_(h),y=_(p),D[1]=E,D[2]=y;break;case 1:case 2:h=T(D[1]),g=[(p=T(D[2]))[0],h[1]],m=[h[0],p[1]],w=_(g),I=_(m),D[0]=w,D[3]=I}a.invalidated=!0}e.editData.hasMoved=!0;var S=(0,Y.getEnabledElement)(r).renderingEngine;na(S,i)})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_MOVE,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f=c[v],g=f.annotationUID,h=f.data,p=h.handles,m=p.points,w=p.activeHandleIndex,E=m.map((function(e){return i.worldToCanvas(e)}));u.annotationUID=g;var y=e.getStyle("lineWidth",u,f),I=e.getStyle("lineDash",u,f),b=e.getStyle("color",u,f),C=i.getCamera(),T=C.viewPlaneNormal,_=C.viewUp;if(h.cachedStats[s]&&void 0!==h.cachedStats[s].unit?f.invalidated&&(e._throttledCalculateCachedStats(f,T,_,d,t),i instanceof Y.VolumeViewport&&function(){var e=f.metadata.referencedImageId;for(var t in h.cachedStats)t.startsWith("imageId")&&d.getStackViewports().find((function(t){var n=Y.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=Y.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n}))&&delete h.cachedStats[t]}()):(h.cachedStats[s]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},e._calculateCachedStats(f,T,_,d,t)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;var O=void 0;if(xe(g)){ie(f)||e.editData||null===w||(O=[E[w]]),O&&Uc(n,g,"0",O,{color:b});var D="".concat(g,"-rect");$c(n,g,"0",E[0],E[3],{color:b,lineDash:I,lineWidth:y},D),a=!0;var S=vd(i,s),x=e._getTextLines(h,s,S);if(x&&0!==x.length){if(!h.handles.textBox.hasMoved){var k=sd(E);h.handles.textBox.worldPosition=i.canvasToWorld(k)}var M=i.worldToCanvas(h.handles.textBox.worldPosition),R=Jc(n,g,"1",x,M,E,{},e.getLinkedTextBoxStyle(u,f)),P=R.x,N=R.y,A=R.width,L=R.height;h.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([P,N]),topRight:i.canvasToWorld([P+A,N]),bottomLeft:i.canvasToWorld([P,N+L]),bottomRight:i.canvasToWorld([P+A,N+L])}}}}return a})),Q(la(e),"_getRectangleImageCoordinates",(function(e){var t=Bn(e,2),n=t[0],r=t[1];return{left:Math.min(n[0],r[0]),top:Math.min(n[1],r[1]),width:Math.abs(n[0]-r[0]),height:Math.abs(n[1]-r[1])}})),Q(la(e),"_getTextLines",(function(e,t,n){var r=e.cachedStats[t],o=r.area,a=r.mean,i=r.max,l=r.stdDev,c=r.Modality,s=r.areaUnit;if(void 0!==a){var d=[],u=ud(c,n);return d.push("Area: ".concat(o.toFixed(2)," ").concat(s,"²")),d.push("Mean: ".concat(a.toFixed(2)," ").concat(u)),d.push("Max: ".concat(i.toFixed(2)," ").concat(u)),d.push("Std Dev: ".concat(l.toFixed(2)," ").concat(u)),d}})),Q(la(e),"_calculateCachedStats",(function(t,n,r,o,a){for(var i=t.data,l=a.viewportId,c=a.renderingEngineId,s=i.handles.points[0],d=i.handles.points[3],u=i.cachedStats,v=Object.keys(u),f=0;f<v.length;f++){var g=v[f],h=e.getTargetIdImage(g,o);if(h){var p=h.dimensions,m=h.imageData,w=h.metadata,E=h.hasPixelSpacing,y="getScalarData"in h?h.getScalarData():h.scalarData,I=fd(m,s);I[0]=Math.floor(I[0]),I[1]=Math.floor(I[1]),I[2]=Math.floor(I[2]);var b=fd(m,d);if(b[0]=Math.floor(b[0]),b[1]=Math.floor(b[1]),b[2]=Math.floor(b[2]),e._isInsideVolume(I,b,p)){e.isHandleOutsideImage=!1;for(var C=Math.min(I[0],b[0]),T=Math.max(I[0],b[0]),_=Math.min(I[1],b[1]),O=Math.max(I[1],b[1]),D=Math.min(I[2],b[2]),S=Math.max(I[2],b[2]),x=dd(n,r,s,d),k=x.worldWidth,M=x.worldHeight,R=Math.abs(k*M),P=0,N=0,A=0,L=-1/0,U=p[0],V=p[0]*p[1],B=D;B<=S;B++)for(var j=_;j<=O;j++)for(var H=C;H<=T;H++){var W=y[B*V+j*U+H];W>L&&(L=W),P++,N+=W}N/=P;for(var F=D;F<=S;F++)for(var G=_;G<=O;G++)for(var q=C;q<=T;q++){var z=y[F*V+G*U+q]-N;A+=z*z}A/=P,A=Math.sqrt(A),u[g]={Modality:w.Modality,area:R,mean:N,stdDev:A,max:L,areaUnit:E?"mm":"px"}}else e.isHandleOutsideImage=!0,u[g]={Modality:w.Modality}}}t.invalidated=!1;var K=J.ANNOTATION_MODIFIED,$={annotation:t,viewportId:l,renderingEngineId:c};return(0,Y.triggerEvent)(Y.eventTarget,K,$),u})),Q(la(e),"_isInsideVolume",(function(e,t,n){return Y.utilities.indexWithinDimensions(e,n)&&Y.utilities.indexWithinDimensions(t,n)})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o)}(od);Q(gd,"toolName",void 0),gd.toolName="RectangleROI";var hd=gd;var pd=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s,d,u=l.getCamera(),v=u.viewPlaneNormal,f=u.viewUp,g=e.getTargetId(l);if(l instanceof Y.StackViewport)s=g.split("imageId:")[1];else{d=g.split("volumeId:")[1];var h=Y.cache.getVolume(d);s=Y.utilities.getClosestImageId(h,a,v,f)}var p=l.getFrameOfReferenceUID(),m={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:xr(v),enabledElement:i,viewUp:xr(f),FrameOfReferenceUID:p,referencedImageId:s,toolName:e.getToolName(),volumeId:d},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[xr(a),xr(a),xr(a),xr(a)],activeHandleIndex:null},segmentationId:null}};tt(m,o);var w=Ks(o,e.getToolName());return e.editData={annotation:m,viewportIdsToRender:w,handleIndex:3,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(c,w),m})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=t.renderingEngineId,c=i.element,s=et(e.getToolName(),c);if(null===(r=s)||void 0===r||!r.length)return a;if(null===(o=s=e.filterInteractableAnnotationsForElement(c,s))||void 0===o||!o.length)return a;for(var d={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},u=0;u<s.length;u++){var v=s[u],f=v.annotationUID,g=v.data.handles,h=g.points,p=g.activeHandleIndex,m=h.map((function(e){return i.worldToCanvas(e)}));d.annotationUID=f;var w=e.getStyle("lineWidth",d,v),E=e.getStyle("lineDash",d,v),y=e.getStyle("color",d,v);if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;var I=J.ANNOTATION_MODIFIED,b={annotation:v,viewportId:i.id,renderingEngineId:l};(0,Y.triggerEvent)(Y.eventTarget,I,b);var C=void 0;xe(f)&&(ie(v)||e.editData||null===p||(C=[m[p]]),C&&Uc(n,f,"0",C,{color:y}),$c(n,f,"0",m[0],m[3],{color:y,lineDash:E,lineWidth:w}),a=!0)}return a})),e}return Z(o)}(hd);Q(pd,"toolName",void 0),pd.toolName="RectangleROIThreshold";var md=pd;var wd=Y.utilities.transformWorldToIndex,Ed=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{configuration:{numSlicesToPropagate:10}};return X(this,o),Q(la(e=r.call(this,t,n)),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s,d,u,v=l.getCamera(),f=v.viewPlaneNormal,g=v.viewUp;if(l instanceof Y.StackViewport)throw new Error("Stack Viewport Not implemented");if(u=e.getTargetId(l).split("volumeId:")[1],d=Y.cache.getVolume(u),!(s=Y.utilities.getClosestImageId(d,a,f,g)))throw new Error("This tool does not work on non-acquisition planes");var h=l.getCurrentImageIdIndex(),p=Y.utilities.getSpacingInNormalDirection(d,f),m=e._getEndSliceIndex(d,a,p,f),w=l.getFrameOfReferenceUID(),E={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:xr(f),enabledElement:i,viewUp:xr(g),FrameOfReferenceUID:w,referencedImageId:s,toolName:e.getToolName(),volumeId:u,spacingInNormal:p},data:{label:"",startSlice:h,endSlice:m,cachedStats:{projectionPoints:[],projectionPointsImageIds:[s]},handles:{textBox:{hasMoved:!1,worldPosition:null,worldBoundingBox:null},points:[xr(a),xr(a),xr(a),xr(a)],activeHandleIndex:null},labelmapUID:null}};e._computeProjectionPoints(E,d),tt(E,o);var y=Ks(o,e.getToolName());return e.editData={annotation:E,viewportIdsToRender:y,handleIndex:3,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(c,y),E})),Q(la(e),"renderAnnotation",(function(t,n){var r=!1,o=t.viewport,a=et(e.getToolName(),o.element);if(null==a||!a.length)return r;for(var i=o.getCurrentImageIdIndex(),l={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},c=0;c<a.length;c++){var s=a[c],d=s.annotationUID,u=s.data,v=u.startSlice,f=u.endSlice,g=u.handles,h=g.points,p=g.activeHandleIndex,m=h.map((function(e){return o.worldToCanvas(e)}));l.annotationUID=d;var w=e.getStyle("lineWidth",l,s),E=e.getStyle("lineDash",l,s),y=e.getStyle("color",l,s);if(!(i<Math.min(v,f)||i>Math.max(v,f))){s.invalidated&&e._throttledCalculateCachedStats(s,t);var I=!1;if(i!==v&&i!==f||(I=!0),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),r;var b=void 0;if(xe(d)){ie(s)||e.editData||null===p||!I||(b=[m[p]]),b&&Uc(n,d,"0",b,{color:y});var C=E;I||(C=2),$c(n,d,"0",m[0],m[3],{color:y,lineDash:C,lineWidth:w}),r=!0}}}return r})),e._throttledCalculateCachedStats=os(e._calculateCachedStatsTool,100,{trailing:!0}),e}return Z(o,[{key:"_computeProjectionPoints",value:function(e,t){var n=e.data,r=e.metadata,o=r.viewPlaneNormal,a=r.spacingInNormal,i=t.imageData,l=n.startSlice,c=n.endSlice,s=n.handles.points,d=wd(i,s[0]);if(d[2]!==l)throw new Error("Start slice does not match");var u=wc.vec3.fromValues(d[0],d[1],c),v=wc.vec3.create();i.indexToWorldVec3(d,v);var f=wc.vec3.create();i.indexToWorldVec3(u,f);for(var g=wc.vec3.distance(v,f),h=[],p=function(e){h.push(s.map((function(t){var n=wc.vec3.create();return wc.vec3.scaleAndAdd(n,t,o,e),Array.from(n)})))},m=0;m<g;m+=a)p(m);n.cachedStats.projectionPoints=h;for(var w=[],E=0,y=h;E<y.length;E++){var I=y[E],b=Y.utilities.getClosestImageId(t,I[0],o,r.viewUp);w.push(b)}n.cachedStats.projectionPointsImageIds=w}},{key:"_calculateCachedStatsTool",value:function(e,t){var n=e.data,r=t.viewportId,o=t.renderingEngineId,a=t.viewport,i=n.cachedStats,l=this.getTargetId(a),c=Y.cache.getVolume(l.split("volumeId:")[1]);this._computeProjectionPoints(e,c),e.invalidated=!1;var s=J.ANNOTATION_MODIFIED,d={annotation:e,viewportId:r,renderingEngineId:o};return(0,Y.triggerEvent)(Y.eventTarget,s,d),i}},{key:"_getEndSliceIndex",value:function(e,t,n,r){var o=this.configuration.numSlicesToPropagate,a=wc.vec3.create();wc.vec3.scaleAndAdd(a,t,r,o*n);for(var i,l=n/2,c=e.imageIds,s=0;s<c.length;s++){var d=c[s],u=Y.metaData.get("imagePlaneModule",d).imagePositionPatient,v=wc.vec3.create();wc.vec3.sub(v,a,u);var f=wc.vec3.dot(v,r);Math.abs(f)<l&&(i=s)}return i}}]),o}(hd);Q(Ed,"toolName",void 0),Ed.toolName="RectangleROIStartEndThreshold";var yd=Ed,Id=function(e,t){var n=e.findIndex((function(e){var t=Bn(e,2);return t[0]===t[1]}));if(-1===n)throw new Error("3D bounding boxes not supported in an oblique plane");return e[n][0]-=t,e[n][1]+=t,e},bd=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[];if(e.forEach((function(e){var o,a,i=e.data,l=i.handles.points,c=t.imageData,s=t.dimensions,d=l;if(null!==(o=i.cachedStats)&&void 0!==o&&o.projectionPoints){var u,v=i.cachedStats.projectionPoints;d=(u=[]).concat.apply(u,xr(v))}var f=d.map((function(e){return Y.utilities.transformWorldToIndex(c,e)})),g=cs(f,s);!n.numSlicesToProject||null!==(a=i.cachedStats)&&void 0!==a&&a.projectionPoints||(g=Id(g,n.numSlicesToProject)),r.push(g)})),1===r.length)return r[0];var o=r.reduce((function(e,t){return{iMin:Math.min(e.iMin,t.iMin),jMin:Math.min(e.jMin,t.jMin),kMin:Math.min(e.kMin,t.kMin),iMax:Math.max(e.iMax,t.iMax),jMax:Math.max(e.jMax,t.jMax),kMax:Math.max(e.kMax,t.kMax)}}),{iMin:1/0,jMin:1/0,kMin:1/0,iMax:-1/0,jMax:-1/0,kMax:-1/0});return o};function Cd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Td(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Td(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Od=function(e,t,n,r){var o,a=e.map((function(e){return ot(e)}));!function(e){var t,n=[md.toolName,yd.toolName],r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Cd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cd(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(e);try{for(r.s();!(t=r.n()).done;){var o=t.value.metadata.toolName;if(!n.includes(o))throw new Error("rectangleROIThresholdVolumeByRange only supports RectangleROIThreshold and RectangleROIStartEndThreshold annotations")}}catch(e){r.e(e)}finally{r.f()}}(a);for(var i=0;i<n.length;i++)n[i].volume.getScalarData().length!==t.getScalarData().length&&0!==i||(o=bd(a,n[i].volume,r));return Bs(t,n,_d(_d({},r),{},{boundsIJK:o}))},Dd=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mergedLabelmap";e.forEach((function(t){var n=t.direction,r=t.dimensions,o=t.origin,a=t.spacing;if(!(Y.utilities.isEqual(r,e[0].dimensions)&&Y.utilities.isEqual(n,e[0].direction)&&Y.utilities.isEqual(a,e[0].spacing)&&Y.utilities.isEqual(o,e[0].origin)))throw new Error("labelmaps must have the same size and shape")}));var r=e[0],o=r.getScalarData().constructor,a=new o(r.getScalarData().length);e.forEach((function(e){for(var n=e.getScalarData(),r=0;r<n.length;r++)n[r]===t&&(a[r]=t)}));var i={scalarData:a,metadata:r.metadata,spacing:r.spacing,origin:r.origin,direction:r.direction,dimensions:r.dimensions},l=!0,c=Y.volumeLoader.createLocalVolume(i,n,l);return c};function Sd(e,t){if(e===st.Labelmap)return function(e){return e&&"boolean"==typeof e.renderOutline&&"number"==typeof e.outlineWidthActive&&"number"==typeof e.outlineWidthInactive&&"boolean"==typeof e.renderFill&&"boolean"==typeof e.renderFillInactive&&"number"==typeof e.fillAlpha&&"number"==typeof e.fillAlphaInactive&&"number"==typeof e.outlineOpacity&&"number"==typeof e.outlineOpacityInactive}(t);throw new Error("Unknown representation type: ".concat(e))}function xd(e){var t=e.type;if(t===st.Labelmap)return vt();throw new Error("Unknown representation type: ".concat(t))}function kd(e){return Md.apply(this,arguments)}function Md(){return(Md=Ra(Na().mark((function e(t){var n,r,o,a,i,l,c,s,d,u,v,f;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.viewportId,r=t.renderingEngineId,o=t.options,a=t.segmentationId,i=(0,Y.getEnabledElementByIds)(n,r)){e.next=5;break}throw new Error("element disabled");case 5:if((l=i.viewport)instanceof Y.VolumeViewport){e.next=8;break}throw new Error("Segmentation only supports VolumeViewport");case 8:if(c=l.getDefaultActor(),s=c.uid,void 0===a&&(a="".concat(s,"-based-segmentation-").concat(null!==(d=null==o?void 0:o.volumeId)&&void 0!==d?d:Y.utilities.uuidv4().slice(0,8))),!o){e.next=16;break}return u=(0,ee._cloneDeep)(o),e.next=14,Y.volumeLoader.createLocalVolume(u,a);case 14:e.next=19;break;case 16:return v=l.getDefaultActor(),f=v.uid,e.next=19,Y.volumeLoader.createAndCacheDerivedVolume(f,{volumeId:a});case 19:return e.abrupt("return",a);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rd(e,t){return e===t}function Pd(e){for(var t=0,n=0;n<e.length;n+=1)0!==e[n]&&(t+=1);return t}function Nd(e,t,n){return(new Array(n+1).join(t)+e).slice(-n)}var Ad=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.onFlood,o=n.onBoundary,a=n.equals||Rd,i=n.diagonals||!1,l=y(t),c=b(),s=[],d=[],u={},v={};for(s.push({currentArgs:t});s.length>0;)f(s.pop());return{flooded:d,boundaries:T()};function f(e){var t=e.currentArgs,n=e.previousArgs;g(t)||(h(t),p(t)?(m(t),E(t)):w(n))}function g(e){return!0===u[e]}function h(e){u[e]=!0}function p(e){var t=I(y,[e]);return I(a,[t,l])}function m(e){d.push(e),r&&r.apply(void 0,xr(e))}function w(e){v[e]=e,o&&o.apply(void 0,xr(e))}function E(e){for(var t=0;t<c.length;t+=1){for(var n=c[t],r=e.slice(0),o=0;o<e.length;o+=1)r[o]+=n[o];s.push({currentArgs:r,previousArgs:e})}}function y(t){return e.apply(void 0,xr(t))}function I(e,t){try{return e.apply(void 0,xr(t))}catch(e){return}}function b(){return C(t.length).filter((function(e){var t=Pd(e);return 0!==t&&(1===t||i)}))}function C(e){for(var t=[],n=function(e){return e.split("").map((function(e){return parseInt(e,10)-1}))},r=0;r<Math.pow(3,e);r+=1){var o=Nd(r.toString(3),"0",e);t.push(n(o))}return t}function T(){var e=[];for(var t in v)void 0!==v[t]&&e.unshift(v[t]);return e}};function Ld(e,t){var n=ia(e);if(void 0!==n){Ls(e).forEach((function(e){e.configuration.brushSize=t,e.invalidateBrushCursor()}));var r=n.getViewportsInfo(),o=Object.keys(r).map((function(e){return r[e]}));if(o.length){var a=o[0].renderingEngineId,i=n.getViewportIds(),l=(0,Y.getRenderingEngine)(a);na(l,i)}}}function Ud(e){var t=ia(e);if(void 0!==t){var n=t._toolInstances;if(Object.keys(n).length){var r=Ls(e)[0];if(r)return r.configuration.brushSize}}}function Vd(e,t){var n=ia(e);if(void 0!==n){Ls(e).forEach((function(e){e.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold=t}));var r=n.getViewportsInfo();if(r.length){var o=r[0].renderingEngineId,a=n.getViewportIds(),i=(0,Y.getRenderingEngine)(o);na(i,a)}}}function Bd(e){var t=ia(e);if(void 0!==t){var n=t._toolInstances;if(Object.keys(n).length){var r=Ls(e)[0];if(r)return r.configuration.strategySpecificConfiguration.THRESHOLD_INSIDE_CIRCLE.threshold}}}var jd=function(e,t,n,r){var o=e.getScalarData(),a=Vs(e,n),i=a.baseVolumeIdx,l=a.volumeInfoList;return l.forEach((function(e){e.volumeSize===o.length?function(e,t,n){for(var r=n.referenceValues,o=n.lower,a=n.upper,i=0;i<e.length;i++)if(e[i]===t){var l=r[i];e[i]=l>=o&&l<=a?t:0}}(o,t,e):function(e,t,n,r,o,a){for(var i,l,c,s=n.imageData,d=n.lower,u=n.upper,v=n.dimensions,f=0;f<e.length;f++)if(e[f]===t){var g=Us(s,v,r[o].spacing,r[o].imageData.getPoint(f));i=0,l=0,c={lower:d,upper:u};var h;ls(s,(function(){return!0}),(function(e){var t=e.value;i+=1,t>=c.lower&&t<=c.upper&&(l+=1)}),g),h=0===a?l>0:l===i,e[f]=h?t:0}}(o,t,e,l,i,r)})),Ct(e.volumeId),e},Hd=1e-6;function Wd(e,t,n){var r=Bn(n,2),o=r[0],a=r[1];if(Math.abs(t)<Hd)return e<0;var i=e/t;if(t>0){if(i>a)return 0;i>o&&(n[0]=i)}else{if(i<o)return 0;i<a&&(n[1]=i)}return 1}function Fd(e,t,n,r,o){var a=Bn(e,2),i=a[0],l=a[1],c=Bn(t,2),s=c[0]-i,d=c[1]-l;if(void 0===r||void 0===o?(r=e,o=t):(r[0]=e[0],r[1]=e[1],o[0]=t[0],o[1]=t[1]),Math.abs(s)<Hd&&Math.abs(d)<Hd&&i>=n[0]&&i<=n[2]&&l>=n[1]&&l<=n[3])return 1;var u=[0,1];if(Wd(n[0]-i,s,u)&&Wd(i-n[2],-s,u)&&Wd(n[1]-l,d,u)&&Wd(l-n[3],-d,u)){var v=u[0],f=u[1];return f<1&&(o[0]=i+f*s,o[1]=l+f*d),v>0&&(r[0]+=v*s,r[1]+=v*d),1}return 0}function Gd(e){return"number"==typeof e?e?e<0?-1:1:e==e?0:NaN:NaN}function qd(e,t,n,r){var o=Bn(e,2),a=o[0],i=o[1],l=Bn(t,2),c=l[0],s=l[1],d=Bn(n,2),u=d[0],v=d[1],f=Bn(r,2),g=f[0],h=f[1],p=s-i,m=a-c,w=c*i-a*s,E=p*u+m*v+w,y=p*g+m*h+w;if(0===E||0===y||Gd(E)!==Gd(y)){var I=h-v,b=u-g,C=g*v-u*h,T=I*a+b*i+C,_=I*c+b*s+C;if(0===T||0===_||Gd(T)!==Gd(_)){var O=p*b-I*m;return[(m*C-b*w)/O,(I*w-p*C)/O]}}}function zd(e,t,n){var r,o,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];a?(o=e.length-1,r=0):(o=0,r=1);for(var i=r;i<e.length;i++){var l=e[o],c=e[i];if(Yd(t,n,l,c))return[o,i];o=i}}function Kd(e,t,n){var r,o,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];a?(o=e.length-1,r=0):(o=0,r=1);for(var i=[],l=r;l<e.length;l++){var c=e[o],s=e[l];Yd(t,n,c,s)&&i.push([o,l]),o=l}if(0!==i.length){var d=[];i.forEach((function(n){var r=[e[n[0]],e[n[1]]],o=[(r[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2];d.push(wc.vec2.distance(o,t))}));var u=Math.min.apply(Math,d),v=d.indexOf(u);return{segment:i[v],distance:u}}}function Yd(e,t,n,r){var o=!1,a=[Jd(e,t,n),Jd(e,t,r),Jd(n,r,e),Jd(n,r,t)];return a[0]!==a[1]&&a[2]!==a[3]||((0===a[0]&&$d(e,n,t)||0===a[1]&&$d(e,r,t)||0===a[2]&&$d(n,e,r)||0===a[3]&&$d(n,t,r))&&(o=!0),o)}function Jd(e,t,n){var r=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===r?0:r>0?1:2}function $d(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])}var Zd=.001,Xd=function(e,t){var n,r,o;if(e instanceof Y.StackViewport){var a=e.getImageData();r=a.direction.slice(0,3),o=a.direction.slice(3,6),n=a.spacing}else{var i=e.getImageData(),l=i.direction,c=i.spacing,s=e.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=l.slice(0,3),f=l.slice(3,6),g=l.slice(6,9),h=wc.vec3.create();wc.vec3.cross(h,u,d);var p,m=Math.abs(wc.vec3.dot(h,v)),w=Math.abs(wc.vec3.dot(h,f)),E=Math.abs(wc.vec3.dot(h,g));if(Math.abs(1-m)<Zd)p=c[0],r=v;else if(Math.abs(1-w)<Zd)p=c[1],r=f;else{if(!(Math.abs(1-E)<Zd))throw new Error("No support yet for oblique plane planar contours");p=c[2],r=g}var y,I=Math.abs(wc.vec3.dot(d,v)),b=Math.abs(wc.vec3.dot(d,f)),C=Math.abs(wc.vec3.dot(d,g));if(Math.abs(1-I)<Zd)y=c[0],o=v;else if(Math.abs(1-b)<Zd)y=c[1],o=f;else{if(!(Math.abs(1-C)<Zd))throw new Error("No support yet for oblique plane planar contours");y=c[2],o=g}n=[p,y]}return{spacing:[n[0]/t,n[1]/t],xDir:r,yDir:o}},Qd=function(e,t,n){return wc.vec2.dist(e,t)<n},eu=function(e,t,n,r){var o=r.xDir,a=r.yDir,i=r.spacing,l=(0,Y.getEnabledElement)(e).viewport,c=l.canvasToWorld(t[t.length-1]),s=l.canvasToWorld(n),d=wc.vec3.create();wc.vec3.subtract(d,s,c);var u=Math.abs(wc.vec3.dot(d,o)),v=Math.abs(wc.vec3.dot(d,a)),f=Math.max(Math.floor(u/i[0]),Math.floor(v/i[0]));if(f>1){var g=t[t.length-1],h=wc.vec2.dist(g,n),p=wc.vec2.create();wc.vec2.subtract(p,n,g),wc.vec2.set(p,p[0]/h,p[1]/h);for(var m=h/f,w=1;w<=f;w++)t.push([g[0]+m*p[0]*w,g[1]+m*p[1]*w])}else t.push(n);return f},tu=function(e,t,n,r){var o=[e[0]-t[0],e[1]-t[1]],a=[n[0]-t[0],n[1]-t[1]],i=o[0]*a[0]+o[1]*a[1];if(i<0)return!1;var l=Math.sqrt(a[0]*a[0]+a[1]*a[1]);if(0===l)return!1;var c=i/l,s=[a[0]/l,a[1]/l],d=[s[0]*c,s[1]*c],u=[t[0]+d[0],t[1]+d[1]];return!(wc.vec2.distance(e,u)>r||wc.vec2.distance(t,u)>wc.vec2.distance(t,n))};function nu(e){for(var t=e.length,n=0,r=t-1,o=0;o<t;o++)n+=(e[r][0]+e[o][0])*(e[r][1]-e[o][1]),r=o;return Math.abs(n/2)}function ru(e,t){if(2!==(null==e?void 0:e.length)||2!==(null==t?void 0:t.length))throw Error("points should have 2 elements of [x, y]");var n=Bn(e,2),r=n[0],o=n[1],a=Bn(t,2),i=a[0],l=a[1];return Math.sqrt(Math.pow(r-i,2)+Math.pow(o-l,2))}var ou=h(807),au=h.n(ou);function iu(e,t,n,r){var o,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.25,i=e.getCamera(),l=i.position,c=Y.utilities.getTargetVolumeAndSpacingInNormalDir(e,i,n),s=c.spacingInNormalDirection,d=s*a,u=e.getBounds(),v=u[0],f=u[1],g=[0,0,0],h=[0,0,0];au().subtract(t,l,g);for(var p=v;p<=f;p+=d){h=[p,0,0];var m=(p-l[0])/g[0];if(h[1]=m*g[1]+l[1],h[2]=m*g[2]+l[2],cu(h,u)){var w=e.getIntensityFromWorld(h),E=r(w,h);E&&(o=E)}}return o}var lu,cu=function(e,t){var n=Bn(t,6),r=n[0],o=n[1],a=n[2],i=n[3],l=n[4],c=n[5];return e[0]>r&&e[0]<o&&e[1]>a&&e[1]<i&&e[2]>l&&e[2]<c},su={filterAnnotationsWithinSlice:$s,getWorldWidthAndHeightFromCorners:dd,filterAnnotationsForDisplay:Zs,getPointInLineOfSightWithCriteria:iu};function du(e){for(var t="",n=e[0]<0?"R":"L",r=e[1]<0?"A":"P",o=e[2]<0?"F":"H",a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],i=1e-4,l=0;l<3;l++)if(a[0]>i&&a[0]>a[1]&&a[0]>a[2])t+=n,a[0]=0;else if(a[1]>i&&a[1]>a[0]&&a[1]>a[2])t+=r,a[1]=0;else if(a[2]>i&&a[2]>a[0]&&a[2]>a[1])t+=o,a[2]=0;else if(a[0]>i&&a[1]>i&&a[0]===a[1])t+=n+r,a[0]=0,a[1]=0;else if(a[0]>i&&a[2]>i&&a[0]===a[2])t+=n+o,a[0]=0,a[2]=0;else{if(!(a[1]>i&&a[2]>i&&a[1]===a[2]))break;t+=r+o,a[1]=0,a[2]=0}return t}function uu(e){var t=e.replace("H","f");return(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}!function(e){e.CLIP_STOPPED="CORNERSTONE_CINE_TOOL_STOPPED",e.CLIP_STARTED="CORNERSTONE_CINE_TOOL_STARTED"}(lu||(lu={}));var vu=lu,fu={};function gu(e,t){var n=(0,Y.getEnabledElement)(e).viewportId;fu[n]=t}function hu(e){var t=(0,Y.getEnabledElement)(e).viewportId;return fu[t]}var pu=Y.utilities.triggerEvent,mu=new Map;function wu(e,t){var n,r,o;if(void 0===e)throw new Error("playClip: element must not be undefined");var a=(0,Y.getEnabledElement)(e);if(!a)throw new Error("playClip: element must be a valid Cornerstone enabled element");t.dynamicCineEnabled=null===(n=t.dynamicCineEnabled)||void 0===n||n;var i,l,c,s,d=a.viewport,u=bu(d),v=function(e,t){if(e instanceof Y.StackViewport)return function(e){var t=e.getImageIds();return{get numScrollSteps(){return t.length},get currentStepIndex(){return e.getTargetImageIdIndex()},get frameTimeVectorEnabled(){return!0},scroll:function(t){yc(e,{delta:t,debounceLoading:!0})}}}(e);if(e instanceof Y.VolumeViewport){var n=bu(e);return t.dynamicCineEnabled&&null!=n&&n.isDynamicVolume()?function(e){return{get numScrollSteps(){return e.numTimePoints},get currentStepIndex(){return e.timePointIndex},get frameTimeVectorEnabled(){return!1},scroll:function(t){e.timePointIndex+=t}}}(n):function(e,t){var n=t.volumeId,r={viewPlaneNormal:wc.vec3.create(),scrollInfo:null},o=function(){var t=e.getCamera();if(!r.scrollInfo||!wc.vec3.equals(t.viewPlaneNormal,r.viewPlaneNormal)){var o=Y.utilities.getVolumeViewportScrollInfo(e,n);r.viewPlaneNormal=t.viewPlaneNormal,r.scrollInfo=o}return r.scrollInfo};return{get numScrollSteps(){return o().numScrollSteps},get currentStepIndex(){return o().currentStepIndex},get frameTimeVectorEnabled(){var n=e.getCamera(),r=t.direction.slice(6,9).map((function(e){return-e})),o=wc.vec3.dot(r,n.viewPlaneNormal);return wc.glMatrix.equals(o,1)},scroll:function(t){o().currentStepIndex+=t,yc(e,{delta:t})}}}(e,n)}throw new Error("Unknown viewport type")}(d,t),f=hu(e),g=t.dynamicCineEnabled&&(null==u?void 0:u.isDynamicVolume());if(g&&Iu(e),f?yu(e,g):gu(e,f={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,frameTimeVector:null!==(i=t.frameTimeVector)&&void 0!==i?i:void 0,speed:null!==(l=t.frameTimeVectorSpeedMultiplier)&&void 0!==l?l:1,reverse:null!==(c=t.reverse)&&void 0!==c&&c,loop:null===(s=t.loop)||void 0===s||s}),f.dynamicCineEnabled=t.dynamicCineEnabled,(t.framesPerSecond<0||t.framesPerSecond>0)&&(f.framesPerSecond=Number(t.framesPerSecond),f.reverse=f.framesPerSecond<0,f.ignoreFrameTimeVector=!0),!0!==f.ignoreFrameTimeVector&&f.frameTimeVector&&f.frameTimeVector.length===v.numScrollSteps&&v.frameTimeVectorEnabled){var h=function(e,t){var n,r,o,a=0,i=e.length,l=[],c=!1;for(("number"!=typeof t||t<=0)&&(t=1),n=1;n<i;n++)o=Number(e[n])/t|0,l.push(o),1===n?r=o:o!==r&&(c=!0),a+=o;return l.length>0&&(o=c?a/l.length|0:l[0],l.push(o)),{timeouts:l,isTimeVarying:c}}(f.frameTimeVector,f.speed),p=h.timeouts,m=h.isTimeVarying;r=p,o=m}var w=function(){var e=v.numScrollSteps,t=v.currentStepIndex,n=t+(f.reverse?-1:1);n>=e?n=0:n<0&&(n=e-1);var r=n-t;r&&v.scroll(r)};g&&mu.set(u.volumeId,e),r&&r.length>0&&o?(f.usingFrameTimeVector=!0,f.intervalId=window.setTimeout((function e(){f.intervalId=window.setTimeout(e,r[v.currentStepIndex]),w()}),0)):(f.usingFrameTimeVector=!1,f.intervalId=window.setInterval(w,1e3/Math.abs(f.framesPerSecond)));var E={element:e};pu(e,vu.CLIP_STARTED,E)}function Eu(e){yu(e,!0)}function yu(e,t){var n=(0,Y.getEnabledElement)(e);if(n){var r,o,a=hu(n.viewport.element);a&&void 0!==(o=(r=a).intervalId)&&(r.intervalId=void 0,r.usingFrameTimeVector?clearTimeout(o):clearInterval(o)),t&&Iu(e)}}function Iu(e){var t=bu((0,Y.getEnabledElement)(e).viewport);if(null!=t&&t.isDynamicVolume()){var n=mu.get(t.volumeId);mu.delete(t.volumeId),n&&n!==e&&Eu(n)}}function bu(e){var t=e.getDefaultActor();if(t){var n=t.uid;return Y.cache.getVolume(n)}}function Cu(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),o=e[r],a=e[r+1],i=r>0?e[r-1]:2*o-a,l=r<t-1?e[r+2]:2*a-o;return function(e,t,n,r,o){var a=e*e,i=a*e;return((1-3*e+3*a-i)*t+(4-6*a+3*i)*n+(1+3*e+3*a-3*i)*r+i*o)/6}((n-r/t)*t,i,o,a,l)}}function Tu(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e(r/(t-1));return n}function _u(e){if(!(o=e.length))return[];for(var t=-1,n=function(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let o of e)null!=(o=t(o,++r,e))&&(n>o||void 0===n&&o>=o)&&(n=o)}return n}(e,Ou),r=new Array(n);++t<n;)for(var o,a=-1,i=r[t]=new Array(o);++a<o;)i[a]=e[a][t];return r}function Ou(e){return e.length}function Du(){return _u(arguments)}function Su(e,t,n,r){var o,a,i=n-t+1,l=null!==(o=Math.floor(r/100*i))&&void 0!==o?o:1,c=null!==(a=Math.floor(i/l))&&void 0!==a?a:1;if(isNaN(i)||!i||!c)return e;if(i/c<2)return e;var s=Math.max(0,t),d=Math.min(e.length-1,n),u=e.slice(0,s),v=e.slice(d+1,e.length),f=function(e,t){if(!t||0===t.length||t.length===e.length)return e;var n,r=t[t.length-1]-t[0]+1,o=Cu(t.map((function(t){return e[t][0]}))),a=Cu(t.map((function(t){return e[t][1]})));if(3===(null===(n=e[0])||void 0===n?void 0:n.length)){var i=Cu(t.map((function(t){return e[t][2]})));return Du(Tu(o,r),Tu(a,r),Tu(i,r))}return Du(Tu(o,r),Tu(a,r))}(e,function(e,t){for(var n=[],r=Bn(t,2),o=r[0],a=r[1],i=a-o+1,l=Math.floor(i/e),c=0,s=Math.round((i-1)/(l-1)*c)+o;s<=a;)n.push(s),c++,s=Math.round((i-1)/(l-1)*c)+o;return n}(c,[s,d]));return[].concat(xr(u),xr(f),xr(v))}function xu(e){var t,n;return!0===(null==e||null===(t=e.interpolation)||void 0===t?void 0:t.interpolateOnAdd)||!0===(null==e||null===(n=e.interpolation)||void 0===n?void 0:n.interpolateOnEdit)}function ku(e,t,n){return(e+t+n)%t}function Mu(e,t,n,r){var o=Bn(e,3),a=o[1],i=o[2],l=Bn(t,3),c=l[1],s=l[2],d=i.length,u=s.length,v=e[0],f=t[0];if(!(i[v]&&s[f]&&i[a]&&s[c]))return[void 0,void 0];for(;v!==a&&f!==c;){if(n(s[f],i[v]))return[v,f];v=ku(v,d,r),f=ku(f,u,r)}return[void 0,void 0]}function Ru(e,t,n){var r=e.interpolation,o=t;if(r){var a=r.knotsRatioPercentageOnAdd,i=r.knotsRatioPercentageOnEdit,l=r.interpolateOnAdd,c=void 0!==l&&l,s=r.interpolateOnEdit,d=n?i:a;if(n?void 0!==s&&s:c){var u=Bn(n?function(e,t){var n=function(e,t){for(var n=0;n<e.length;n++)for(var r=0;r<t.length;r++)if(0===ru(e[n],t[r]))return[n,r]}(e,t)||[],r=Bn(n,2),o=r[0],a=r[1],i=function(e,t){return!1===function(e,t){return ru(e,t)<.001}(e,t)},l=Bn(Mu([ku(o,e.length,1),o,e],[ku(a,t.length,1),a,t],i,1),2),c=l[0],s=l[1];return[c,Bn(Mu([ku(c,e.length,-1),c,e],[ku(s,t.length,-1),s,t],i,-1),1)[0]]}(t,n):[0,t.length-1],2),v=u[0],f=u[1];return t[v]&&t[f]?Su(t,v,f,d):t}}return o}function Pu(e,t){var n=e[0],r=e[e.length-1],o=wc.vec2.create();wc.vec2.set(o,r[0]-n[0],r[1]-n[1]),wc.vec2.normalize(o,o);var a=wc.vec2.create(),i=wc.vec2.create();wc.vec2.set(a,-o[1],o[0]),wc.vec2.set(i,o[1],-o[0]);for(var l=[(n[0]+r[0])/2,(n[1]+r[1])/2],c={dist:0,index:null},s=0;s<e.length;s++){var d=e[s],u=wc.vec2.dist(d,l);u>c.dist&&(c.dist=u,c.index=s)}return[e[c.index],l].map(t.canvasToWorld)}var Nu=eu,Au=Qd,Lu=zd,Uu=Xd;function Vu(e,t,n){this.isDrawing=!0;var r=e.detail,o=r.currentPoints,a=r.element,i=o.canvas,l=(0,Y.getEnabledElement)(a).viewport,c=Uu(l,this.configuration.subPixelResolution),s=c.spacing,d=c.xDir,u=c.yDir;this.drawData={canvasPoints:[i],polylineIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:s,xDir:d,yDir:u},ze.isInteractingWithTool=!0,a.addEventListener(J.MOUSE_UP,this.mouseUpDrawCallback),a.addEventListener(J.MOUSE_DRAG,this.mouseDragDrawCallback),a.addEventListener(J.MOUSE_CLICK,this.mouseUpDrawCallback),a.addEventListener(J.TOUCH_END,this.mouseUpDrawCallback),a.addEventListener(J.TOUCH_DRAG,this.mouseDragDrawCallback),a.addEventListener(J.TOUCH_TAP,this.mouseUpDrawCallback),Ql(a)}function Bu(e){ze.isInteractingWithTool=!1,e.removeEventListener(J.MOUSE_UP,this.mouseUpDrawCallback),e.removeEventListener(J.MOUSE_DRAG,this.mouseDragDrawCallback),e.removeEventListener(J.MOUSE_CLICK,this.mouseUpDrawCallback),e.removeEventListener(J.TOUCH_END,this.mouseUpDrawCallback),e.removeEventListener(J.TOUCH_DRAG,this.mouseDragDrawCallback),e.removeEventListener(J.TOUCH_TAP,this.mouseUpDrawCallback),Xl(e)}function ju(e){var t=e.detail,n=t.currentPoints,r=t.element,o=n.world,a=n.canvas,i=(0,Y.getEnabledElement)(r),l=i.renderingEngine,c=i.viewport,s=this.commonData,d=s.viewportIdsToRender,u=s.xDir,v=s.yDir,f=s.spacing,g=this.drawData,h=g.polylineIndex,p=g.canvasPoints,m=p[p.length-1],w=c.canvasToWorld(m),E=wc.vec3.create();wc.vec3.subtract(E,o,w);var y=Math.abs(wc.vec3.dot(E,u)),I=Math.abs(wc.vec3.dot(E,v));if(!(y<=f[0]&&I<=f[1])){var b=this.findCrossingIndexDuringCreate(e);if(void 0!==b)this.applyCreateOnCross(e,b);else{var C=Nu(r,p,a,this.commonData);this.drawData.polylineIndex=h+C}na(l,d)}}function Hu(e){var t=this.configuration.allowOpenContours,n=this.drawData.canvasPoints,r=n[0],o=n[n.length-1],a=e.detail.element;t&&!Au(r,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(a):this.completeDrawClosedContour(a)}function Wu(e){this.removeCrossedLinesOnCompleteDraw();var t=this.drawData.canvasPoints;if(this.haltDrawing(e,t))return!1;var n=this.commonData,r=n.annotation,o=n.viewportIdsToRender,a=(0,Y.getEnabledElement)(e),i=a.viewport,l=a.renderingEngine;Nu(e,t,t[0],this.commonData),t.pop();var c=(xu(this.configuration)?Ru(this.configuration,t):t).map((function(e){return i.canvasToWorld(e)}));return r.data.polyline=c,r.data.isOpenContour=!1,this.triggerAnnotationCompleted(r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,na(l,o),this.deactivateDraw(e),!0}function Fu(){var e=this.drawData.canvasPoints,t=e.length,n=[e[0],e[t-1]],r=e.slice(0,-1).slice(1),o=Lu(r,n[0],n[1],!1);if(o){var a=o[1];this.drawData.canvasPoints=e.splice(0,a)}}function Gu(e){var t=this.drawData.canvasPoints;if(this.haltDrawing(e,t))return!1;var n=this.commonData,r=n.annotation,o=n.viewportIdsToRender,a=(0,Y.getEnabledElement)(e),i=a.viewport,l=a.renderingEngine,c=(xu(this.configuration)?Ru(this.configuration,t):t).map((function(e){return i.canvasToWorld(e)}));return r.data.polyline=c,r.data.isOpenContour=!0,r.data.handles.points=[c[0],c[c.length-1]],r.data.isOpenUShapeContour&&(r.data.openUShapeContourVectorToPeak=Pu(t,i)),this.triggerAnnotationCompleted(r),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,na(l,o),this.deactivateDraw(e),!0}function qu(e){var t=e.detail,n=t.currentPoints,r=t.lastPoints,o=n.canvas,a=r.canvas,i=this.drawData.canvasPoints.slice(0,-1),l=Lu(i,o,a,!1);if(void 0!==l)return l[0]}function zu(e,t){var n=e.detail.element,r=this.drawData.canvasPoints,o=this.commonData,a=o.annotation,i=o.viewportIdsToRender;Nu(n,r,r[t],this.commonData),r.pop();for(var l=0;l<t;l++)r.shift();this.completeDrawClosedContour(n)&&this.activateClosedContourEdit(e,a,i)}function Ku(e){var t=this.configuration.allowOpenContours,n=this.drawData.canvasPoints,r=n[0],o=n[n.length-1];t&&!Au(r,o,this.configuration.closeContourProximity)?this.completeDrawOpenContour(e):this.completeDrawClosedContour(e)}function Yu(e,t){if(function(e,t){var n=Math.max(3*t,3);return e.length<n}(t,this.configuration.subPixelResolution)){var n=this.commonData,r=n.annotation,o=n.viewportIdsToRender,a=(0,Y.getEnabledElement)(e).renderingEngine;return rt(r.annotationUID),this.isDrawing=!1,this.drawData=void 0,this.commonData=void 0,na(a,o),this.deactivateDraw(e),!0}return!1}var Ju=function(e){e.activateDraw=Vu.bind(e),e.deactivateDraw=Bu.bind(e),e.applyCreateOnCross=zu.bind(e),e.findCrossingIndexDuringCreate=qu.bind(e),e.completeDrawOpenContour=Gu.bind(e),e.removeCrossedLinesOnCompleteDraw=Fu.bind(e),e.mouseDragDrawCallback=ju.bind(e),e.mouseUpDrawCallback=Hu.bind(e),e.completeDrawClosedContour=Wu.bind(e),e.cancelDrawing=Ku.bind(e),e.haltDrawing=Yu.bind(e)},$u=eu,Zu=zd;function Xu(e,t){var n=e.detail,r=n.element,o=n.currentPoints,a=n.lastPoints,i=o.canvas,l=a.canvas,c=this.editData,s=c.editCanvasPoints,d=c.prevCanvasPoints,u=Zu(d,i,l,t);if(u)this.editData.startCrossingIndex=u[0],this.removePointsUpUntilFirstCrossing(t);else if(d.length>=2)if(s.length>this.configuration.checkCanvasEditFallbackProximity){for(var v=s[0],f=[],g=0;g<d.length;g++){var h=d[g],p=wc.vec2.distance(h,v);f.push({distance:p,index:g})}f.sort((function(e,t){return e.distance-t.distance}));var m=[f[0],f[1]],w=Math.min(m[0].index,m[1].index);this.editData.startCrossingIndex=w}else{var E=wc.vec2.create();wc.vec2.subtract(E,s[1],s[0]),wc.vec2.normalize(E,E);var y=[s[0][0]-6*E[0],s[0][1]-6*E[1]],I=Zu(d,y,s[0],t);if(I){var b=[y];$u(r,b,s[0],this.commonData),s.unshift.apply(s,b),this.removePointsUpUntilFirstCrossing(t),this.editData.editIndex=s.length-1,this.editData.startCrossingIndex=I[0]}}}function Qu(e){for(var t=this.editData,n=t.editCanvasPoints,r=t.prevCanvasPoints,o=0,a=0;a<n.length-1;a++){var i=[n[a],n[a+1]];if(o++,Zu(r,i[0],i[1],e))break}n.splice(0,o),this.editData.editIndex=n.length-1}function ev(e,t){var n=e.detail,r=n.currentPoints,o=n.lastPoints,a=r.canvas,i=o.canvas,l=this.editData.prevCanvasPoints;return!!Zu(l,a,i,t)}function tv(e){for(var t=this.editData,n=t.prevCanvasPoints,r=t.editCanvasPoints,o=r.length-1;o>0;o--){var a=[r[o],r[o-1]],i=!!Zu(n,a[0],a[1],e);if(r.pop(),i)break}}function nv(){var e=this.editData,t=e.editCanvasPoints,n=e.prevCanvasPoints;if(void 0!==e.startCrossingIndex){for(var r=t[t.length-1],o=[],a=0;a<n.length;a++){var i=n[a],l=wc.vec2.distance(i,r);o.push({distance:l,index:a})}o.sort((function(e,t){return e.distance-t.distance}));for(var c=t.slice(0,-1),s=0;s<o.length;s++){var d=o[s].index,u=n[d],v=t[t.length-1];if(!Zu(c,u,v,!1))return d}return-1}}function rv(e){var t=e.detail,n=t.currentPoints,r=t.lastPoints,o=n.canvas,a=r.canvas,i=this.editData.editCanvasPoints,l=i.slice(0,-2),c=Zu(l,o,a,!1);if(c)for(var s=c[0],d=i.length-s,u=0;u<d;u++)i.pop()}var ov=function(e){e.checkForFirstCrossing=Xu.bind(e),e.removePointsUpUntilFirstCrossing=Qu.bind(e),e.checkForSecondCrossing=ev.bind(e),e.findSnapIndex=nv.bind(e),e.removePointsAfterSecondCrossing=tv.bind(e),e.checkAndRemoveCrossesOnEditLine=rv.bind(e)},av=Xd,iv=eu,lv=nu;function cv(e,t,n){this.isEditingClosed=!0;var r=e.detail,o=r.currentPoints,a=r.element,i=o.canvas,l=(0,Y.getEnabledElement)(a).viewport,c=t.data.polyline.map(l.worldToCanvas),s=av(l,this.configuration.subPixelResolution),d=s.spacing,u=s.xDir,v=s.yDir;this.editData={prevCanvasPoints:c,editCanvasPoints:[i],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:d,xDir:u,yDir:v},ze.isInteractingWithTool=!0,a.addEventListener(J.MOUSE_UP,this.mouseUpClosedContourEditCallback),a.addEventListener(J.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(J.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),a.addEventListener(J.TOUCH_END,this.mouseUpClosedContourEditCallback),a.addEventListener(J.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),a.addEventListener(J.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Ql(a)}function sv(e){ze.isInteractingWithTool=!1,e.removeEventListener(J.MOUSE_UP,this.mouseUpClosedContourEditCallback),e.removeEventListener(J.MOUSE_DRAG,this.mouseDragClosedContourEditCallback),e.removeEventListener(J.MOUSE_CLICK,this.mouseUpClosedContourEditCallback),e.removeEventListener(J.TOUCH_END,this.mouseUpClosedContourEditCallback),e.removeEventListener(J.TOUCH_DRAG,this.mouseDragClosedContourEditCallback),e.removeEventListener(J.TOUCH_TAP,this.mouseUpClosedContourEditCallback),Xl(e)}function dv(e){var t=e.detail,n=t.currentPoints,r=t.element,o=n.world,a=n.canvas,i=(0,Y.getEnabledElement)(r),l=i.renderingEngine,c=i.viewport,s=this.commonData,d=s.viewportIdsToRender,u=s.xDir,v=s.yDir,f=s.spacing,g=this.editData,h=g.editIndex,p=g.editCanvasPoints,m=g.startCrossingIndex,w=p[p.length-1],E=c.canvasToWorld(w),y=wc.vec3.create();wc.vec3.subtract(y,o,E);var I=Math.abs(wc.vec3.dot(y,u)),b=Math.abs(wc.vec3.dot(y,v));if(!(I<=f[0]&&b<=f[1])){void 0!==m&&this.checkAndRemoveCrossesOnEditLine(e);var C=h+iv(r,p,a,this.commonData);this.editData.editIndex=C,void 0===m&&p.length>1&&this.checkForFirstCrossing(e,!0),this.editData.snapIndex=this.findSnapIndex(),-1!==this.editData.snapIndex?(this.editData.fusedCanvasPoints=this.fuseEditPointsWithClosedContour(e),void 0!==m&&this.checkForSecondCrossing(e,!0)&&(this.removePointsAfterSecondCrossing(!0),this.finishEditAndStartNewEdit(e)),na(l,d)):this.finishEditAndStartNewEdit(e)}}function uv(e){var t=e.detail.element,n=(0,Y.getEnabledElement)(t),r=n.viewport,o=n.renderingEngine,a=this.commonData,i=a.annotation,l=a.viewportIdsToRender,c=this.editData,s=c.fusedCanvasPoints,d=c.editCanvasPoints,u=s.map((function(e){return r.canvasToWorld(e)}));i.data.polyline=u,i.data.isOpenContour=!1,this.triggerAnnotationModified(i,n);var v=d.pop();this.editData={prevCanvasPoints:s,editCanvasPoints:[v],startCrossingIndex:void 0,editIndex:0,snapIndex:void 0},na(o,l)}function vv(e){var t=this.editData,n=t.prevCanvasPoints,r=t.editCanvasPoints,o=t.startCrossingIndex,a=t.snapIndex;if(void 0!==o&&void 0!==a){var i,l,c=e.detail.element,s=xr(r);iv(c,s,n[a],this.commonData),s.length>r.length&&s.pop(),o>a?(i=a,l=o):(i=o,l=a);for(var d=wc.vec2.distance(n[i],s[0]),u=wc.vec2.distance(n[i],s[s.length-1]),v=wc.vec2.distance(n[l],s[0]),f=wc.vec2.distance(n[l],s[s.length-1]),g=[],h=0;h<i;h++){var p=n[h];g.push([p[0],p[1]])}var m=d+f,w=u+v;if(m<w)for(var E=0;E<s.length;E++){var y=s[E];g.push([y[0],y[1]])}else for(var I=s.length-1;I>=0;I--){var b=s[I];g.push([b[0],b[1]])}for(var C=l;C<n.length;C++){var T=n[C];g.push([T[0],T[1]])}for(var _=[],O=i;O<l;O++){var D=n[O];_.push([D[0],D[1]])}if((m=v+u)<(w=f+d))for(var S=0;S<s.length;S++){var x=s[S];_.push([x[0],x[1]])}else for(var k=s.length-1;k>=0;k--){var M=s[k];_.push([M[0],M[1]])}return lv(g)>lv(_)?g:_}}function fv(e){var t=e.detail.element;this.completeClosedContourEdit(t)}function gv(e){var t=(0,Y.getEnabledElement)(e),n=t.viewport,r=t.renderingEngine,o=this.commonData,a=o.annotation,i=o.viewportIdsToRender,l=this.editData,c=l.fusedCanvasPoints,s=l.prevCanvasPoints;if(c){var d=(xu(this.configuration)?Ru(this.configuration,c,s):c).map((function(e){return n.canvasToWorld(e)}));a.data.polyline=d,a.data.isOpenContour=!1,this.triggerAnnotationModified(a,t)}this.isEditingClosed=!1,this.editData=void 0,this.commonData=void 0,na(r,i),this.deactivateClosedContourEdit(e)}function hv(e){this.completeClosedContourEdit(e)}var pv=function(e){e.activateClosedContourEdit=cv.bind(e),e.deactivateClosedContourEdit=sv.bind(e),e.mouseDragClosedContourEditCallback=dv.bind(e),e.mouseUpClosedContourEditCallback=fv.bind(e),e.finishEditAndStartNewEdit=uv.bind(e),e.fuseEditPointsWithClosedContour=vv.bind(e),e.cancelClosedContourEdit=hv.bind(e),e.completeClosedContourEdit=gv.bind(e)},mv=eu,wv=Xd;function Ev(e,t,n){this.isEditingOpen=!0;var r=e.detail,o=r.currentPoints,a=r.element,i=o.canvas,l=(0,Y.getEnabledElement)(a).viewport,c=t.data.polyline.map(l.worldToCanvas),s=wv(l,this.configuration.subPixelResolution),d=s.spacing,u=s.xDir,v=s.yDir;this.editData={prevCanvasPoints:c,editCanvasPoints:[i],startCrossingIndex:void 0,editIndex:0},this.commonData={annotation:t,viewportIdsToRender:n,spacing:d,xDir:u,yDir:v},ze.isInteractingWithTool=!0,a.addEventListener(J.MOUSE_UP,this.mouseUpOpenContourEditCallback),a.addEventListener(J.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(J.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),a.addEventListener(J.TOUCH_END,this.mouseUpOpenContourEditCallback),a.addEventListener(J.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),a.addEventListener(J.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Ql(a)}function yv(e){ze.isInteractingWithTool=!1,e.removeEventListener(J.MOUSE_UP,this.mouseUpOpenContourEditCallback),e.removeEventListener(J.MOUSE_DRAG,this.mouseDragOpenContourEditCallback),e.removeEventListener(J.MOUSE_CLICK,this.mouseUpOpenContourEditCallback),e.removeEventListener(J.TOUCH_END,this.mouseUpOpenContourEditCallback),e.removeEventListener(J.TOUCH_DRAG,this.mouseDragOpenContourEditCallback),e.removeEventListener(J.TOUCH_TAP,this.mouseUpOpenContourEditCallback),Xl(e)}function Iv(e){var t=e.detail,n=t.currentPoints,r=t.element,o=n.world,a=n.canvas,i=(0,Y.getEnabledElement)(r),l=i.renderingEngine,c=i.viewport,s=this.commonData,d=s.viewportIdsToRender,u=s.xDir,v=s.yDir,f=s.spacing,g=this.editData,h=g.editIndex,p=g.editCanvasPoints,m=g.startCrossingIndex,w=p[p.length-1],E=c.canvasToWorld(w),y=wc.vec3.create();wc.vec3.subtract(y,o,E);var I=Math.abs(wc.vec3.dot(y,u)),b=Math.abs(wc.vec3.dot(y,v));if(!(I<=f[0]&&b<=f[1])){void 0!==m&&this.checkAndRemoveCrossesOnEditLine(e);var C=h+mv(r,p,a,this.commonData);this.editData.editIndex=C,void 0===m&&p.length>1&&this.checkForFirstCrossing(e,!1),this.editData.snapIndex=this.findSnapIndex(),this.editData.fusedCanvasPoints=this.fuseEditPointsWithOpenContour(e),void 0!==m&&this.checkForSecondCrossing(e,!1)?(this.removePointsAfterSecondCrossing(!1),this.finishEditOpenOnSecondCrossing(e)):this.checkIfShouldOverwriteAnEnd(e)&&this.openContourEditOverwriteEnd(e),na(l,d)}}function bv(e){var t=e.detail.element,n=(0,Y.getEnabledElement)(t),r=n.viewport,o=this.commonData,a=o.annotation,i=o.viewportIdsToRender,l=this.fuseEditPointsForOpenContourEndEdit().map((function(e){return r.canvasToWorld(e)}));a.data.polyline=l,a.data.isOpenContour=!0,a.data.handles.points=[l[0],l[l.length-1]],a.data.handles.activeHandleIndex=1,this.triggerAnnotationModified(a,n),this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,this.deactivateOpenContourEdit(t),this.activateOpenContourEndEdit(e,a,i)}function Cv(e){var t=e.detail,n=t.currentPoints,r=t.lastPoints,o=n.canvas,a=r.canvas,i=this.editData,l=i.snapIndex,c=i.prevCanvasPoints;if(void 0===i.startCrossingIndex||void 0===l)return!1;if(-1===l)return!0;if(0!==l&&l!==c.length-1)return!1;var s=o,d=a,u=c[l],v=wc.vec2.create(),f=wc.vec2.create();wc.vec2.set(v,s[0]-d[0],s[1]-d[1]),wc.vec2.set(f,s[0]-u[0],s[1]-u[1]);var g=wc.vec2.dot(v,f),h=Math.sqrt(v[0]*v[0]+v[1]*v[1]),p=Math.sqrt(f[0]*f[0]+f[1]*f[1]);return Math.acos(g/(h*p))<Math.PI/2}function Tv(){var e=this.editData,t=e.snapIndex,n=e.prevCanvasPoints,r=e.editCanvasPoints,o=e.startCrossingIndex,a=[];if(0===t)for(var i=n.length-1;i>=o;i--){var l=n[i];a.push([l[0],l[1]])}else for(var c=0;c<o;c++){var s=n[c];a.push([s[0],s[1]])}if(wc.vec2.distance(n[o],r[0])<wc.vec2.distance(n[o],r[r.length-1]))for(var d=0;d<r.length;d++){var u=r[d];a.push([u[0],u[1]])}else for(var v=r.length-1;v>=0;v--){var f=r[v];a.push([f[0],f[1]])}return a}function _v(e){var t=this.editData,n=t.prevCanvasPoints,r=t.editCanvasPoints,o=t.startCrossingIndex,a=t.snapIndex;if(void 0!==o&&void 0!==a){var i,l,c=e.detail.element,s=xr(r);mv(c,s,n[a],this.commonData),s.length>r.length&&s.pop(),o>a?(i=a,l=o):(i=o,l=a);for(var d=wc.vec2.distance(n[i],s[0]),u=wc.vec2.distance(n[i],s[s.length-1]),v=wc.vec2.distance(n[l],s[0]),f=wc.vec2.distance(n[l],s[s.length-1]),g=[],h=0;h<i;h++){var p=n[h];g.push([p[0],p[1]])}if(d+f<u+v)for(var m=0;m<s.length;m++){var w=s[m];g.push([w[0],w[1]])}else for(var E=s.length-1;E>=0;E--){var y=s[E];g.push([y[0],y[1]])}for(var I=l;I<n.length;I++){var b=n[I];g.push([b[0],b[1]])}return g}}function Ov(e){var t=e.detail.element,n=(0,Y.getEnabledElement)(t),r=n.viewport,o=n.renderingEngine,a=this.commonData,i=a.annotation,l=a.viewportIdsToRender,c=this.editData,s=c.fusedCanvasPoints,d=c.editCanvasPoints,u=s.map((function(e){return r.canvasToWorld(e)}));i.data.polyline=u,i.data.isOpenContour=!0,i.data.handles.points=[u[0],u[u.length-1]],this.triggerAnnotationModified(i,n);var v=d.pop();this.editData={prevCanvasPoints:s,editCanvasPoints:[v],startCrossingIndex:void 0,editIndex:0},na(o,l)}function Dv(e){var t=e.detail.element;this.completeOpenContourEdit(t)}function Sv(e){var t=(0,Y.getEnabledElement)(e),n=t.viewport,r=t.renderingEngine,o=this.commonData,a=o.annotation,i=o.viewportIdsToRender,l=this.editData,c=l.fusedCanvasPoints,s=l.prevCanvasPoints;if(c){var d=(xu(this.configuration)?Ru(this.configuration,c,s):c).map((function(e){return n.canvasToWorld(e)}));a.data.polyline=d,a.data.isOpenContour=!0,a.data.handles.points=[d[0],d[d.length-1]],a.data.isOpenUShapeContour&&(a.data.openUShapeContourVectorToPeak=Pu(c,n)),this.triggerAnnotationModified(a,t)}this.isEditingOpen=!1,this.editData=void 0,this.commonData=void 0,na(r,i),this.deactivateOpenContourEdit(e)}function xv(e){this.completeOpenContourEdit(e)}var kv=function(e){e.activateOpenContourEdit=Ev.bind(e),e.deactivateOpenContourEdit=yv.bind(e),e.mouseDragOpenContourEditCallback=Iv.bind(e),e.mouseUpOpenContourEditCallback=Dv.bind(e),e.fuseEditPointsWithOpenContour=_v.bind(e),e.finishEditOpenOnSecondCrossing=Ov.bind(e),e.checkIfShouldOverwriteAnEnd=Cv.bind(e),e.fuseEditPointsForOpenContourEndEdit=Tv.bind(e),e.openContourEditOverwriteEnd=bv.bind(e),e.cancelOpenContourEdit=xv.bind(e),e.completeOpenContourEdit=Sv.bind(e)},Mv=Xd;function Rv(e,t,n){this.isDrawing=!0;var r=e.detail.element,o=(0,Y.getEnabledElement)(r).viewport,a=Mv(o,this.configuration.subPixelResolution),i=a.spacing,l=a.xDir,c=a.yDir,s=t.data.polyline.map(o.worldToCanvas);0===t.data.handles.activeHandleIndex&&s.reverse(),this.drawData={canvasPoints:s,polylineIndex:s.length-1},this.commonData={annotation:t,viewportIdsToRender:n,spacing:i,xDir:l,yDir:c},ze.isInteractingWithTool=!0,r.addEventListener(J.MOUSE_UP,this.mouseUpDrawCallback),r.addEventListener(J.MOUSE_DRAG,this.mouseDragDrawCallback),r.addEventListener(J.MOUSE_CLICK,this.mouseUpDrawCallback),r.addEventListener(J.TOUCH_END,this.mouseUpDrawCallback),r.addEventListener(J.TOUCH_DRAG,this.mouseDragDrawCallback),r.addEventListener(J.TOUCH_TAP,this.mouseUpDrawCallback),Ql(r)}var Pv=function(e){e.activateOpenContourEndEdit=Rv.bind(e)},Nv=Qd;function Av(e,t){var n={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id,annotationUID:t.annotationUID},r=this.getStyle("lineWidth",n,t),o=this.getStyle("lineDash",n,t),a=this.getStyle("color",n,t);return{color:void 0===a?void 0:a,width:void 0===r?void 0:r,lineDash:void 0===o?void 0:o,connectLastToFirst:!t.data.isOpenContour}}function Lv(e,t,n){var r;null!=e&&null!==(r=e.viewport)&&void 0!==r&&r.getImageData()&&(n.data.isOpenContour?n.data.isOpenUShapeContour?(function(e,t){t.data.openUShapeContourVectorToPeak||(t.data.openUShapeContourVectorToPeak=function(e,t){var n=e.viewport;return Pu(t.data.polyline.map(n.worldToCanvas),n)}(e,t))}(e,n),this.renderOpenUShapedContour(e,t,n)):this.renderOpenContour(e,t,n):this.renderClosedContour(e,t,n))}function Uv(e,t,n){var r=e.viewport,o=this._getRenderingOptions(e,n),a=n.data.polyline.map((function(e){return r.worldToCanvas(e)}));jc(t,n.annotationUID,"1",a,o)}function Vv(e,t,n){var r,o=e.viewport,a=this._getRenderingOptions(e,n),i=n.data.polyline.map((function(e){return o.worldToCanvas(e)}));jc(t,n.annotationUID,"1",i,a);var l=n.data.handles.activeHandleIndex;if(!0===(null===(r=this.configuration.alwaysRenderOpenContourHandles)||void 0===r?void 0:r.enabled)){var c=this.configuration.alwaysRenderOpenContourHandles.radius,s=[i[0],i[i.length-1]];0===l?s.shift():1===l&&s.pop(),Uc(t,n.annotationUID,"0",s,{color:a.color,handleRadius:c})}if(null!==l){var d=i[0===l?0:i.length-1];Uc(t,n.annotationUID,"1",[d],{color:a.color})}}function Bv(e,t,n){var r=e.viewport,o=n.data,a=o.polyline,i=o.openUShapeContourVectorToPeak;if(this.renderOpenContour(e,t,n),i){var l=r.worldToCanvas(a[0]),c=r.worldToCanvas(a[a.length-1]),s=[r.worldToCanvas(i[0]),r.worldToCanvas(i[1])],d=this._getRenderingOptions(e,n);jc(t,n.annotationUID,"first-to-last",[l,c],{color:d.color,width:d.width,connectLastToFirst:!1,lineDash:"2,2"}),jc(t,n.annotationUID,"midpoint-to-open-contour",[s[0],s[1]],{color:d.color,width:d.width,connectLastToFirst:!1,lineDash:"2,2"})}}function jv(e,t,n){var r=this._getRenderingOptions(e,n),o=this.configuration.allowOpenContours,a=this.drawData.canvasPoints;if(r.connectLastToFirst=!1,jc(t,n.annotationUID,"1",a,r),o){var i=a[0],l=a[a.length-1];Nv(i,l,this.configuration.closeContourProximity)?jc(t,n.annotationUID,"2",[l,i],r):Uc(t,n.annotationUID,"0",[i],{color:r.color,handleRadius:2})}}function Hv(e,t,n){var r=this.editData.fusedCanvasPoints;if(void 0!==r){var o=this._getRenderingOptions(e,n);jc(t,n.annotationUID,"preview-1",r,o)}else this.renderClosedContour(e,t,n)}function Wv(e,t,n){var r=this.editData.fusedCanvasPoints;if(void 0!==r){var o=this._getRenderingOptions(e,n);jc(t,n.annotationUID,"preview-1",r,o)}else this.renderOpenContour(e,t,n)}var Fv=function(e){e.renderContour=Lv.bind(e),e.renderClosedContour=Uv.bind(e),e.renderOpenContour=Vv.bind(e),e.renderOpenUShapedContour=Bv.bind(e),e.renderContourBeingDrawn=jv.bind(e),e.renderClosedContourBeingEdited=Hv.bind(e),e.renderOpenContourBeingEdited=Wv.bind(e),e._getRenderingOptions=Av.bind(e)};function Gv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var qv=tu,zv=1-Y.CONSTANTS.EPSILON,Kv=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,alwaysRenderOpenContourHandles:{enabled:!1,radius:2},allowOpenContours:!0,closeContourProximity:10,checkCanvasEditFallbackProximity:6,subPixelResolution:4,interpolation:{interpolateOnAdd:!1,interpolateOnEdit:!1,knotsRatioPercentageOnAdd:40,knotsRatioPercentageOnEdit:40}}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"commonData",void 0),Q(la(e),"isDrawing",!1),Q(la(e),"isEditingClosed",!1),Q(la(e),"isEditingOpen",!1),Q(la(e),"activateDraw",void 0),Q(la(e),"activateClosedContourEdit",void 0),Q(la(e),"activateOpenContourEdit",void 0),Q(la(e),"activateOpenContourEndEdit",void 0),Q(la(e),"cancelDrawing",void 0),Q(la(e),"cancelClosedContourEdit",void 0),Q(la(e),"cancelOpenContourEdit",void 0),Q(la(e),"renderContour",void 0),Q(la(e),"renderContourBeingDrawn",void 0),Q(la(e),"renderClosedContourBeingEdited",void 0),Q(la(e),"renderOpenContourBeingEdited",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine,s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=Ks(o,e.getToolName()),g=l.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:g,referencedImageId:v,toolName:e.getToolName()},data:{handles:{points:[],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},polyline:[xr(a)],label:""}};return tt(h,o),e.activateDraw(t,h,f),t.preventDefault(),na(c,f),h})),Q(la(e),"handleSelectedCallback",(function(t,n){var r=Ks(t.detail.element,e.getToolName());e.activateOpenContourEndEdit(t,n,r)})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=Ks(t.detail.element,e.getToolName());n.data.isOpenContour?e.activateOpenContourEdit(t,n,r):e.activateClosedContourEdit(t,n,r)})),Q(la(e),"isPointNearTool",(function(e,t,n,r){for(var o=(0,Y.getEnabledElement)(e).viewport,a=t.data.polyline,i=o.worldToCanvas(a[0]),l=1;l<a.length;l++){var c=i,s=o.worldToCanvas(a[l]);if(!0===qv(n,c,s,r))return!0;i=s}if(t.data.isOpenContour)return!1;var d=o.worldToCanvas(a[0]),u=o.worldToCanvas(a[a.length-1]);return!0===qv(n,d,u,r)})),Q(la(e),"cancel",(function(t){var n=e.isDrawing,r=e.isEditingOpen,o=e.isEditingClosed;n?e.cancelDrawing(t):r?e.cancelOpenContourEdit(t):o&&e.cancelClosedContourEdit(t)})),Q(la(e),"triggerAnnotationModified",(function(e,t){var n=t.viewportId,r=t.renderingEngineId,o=J.ANNOTATION_MODIFIED,a={annotation:e,viewportId:n,renderingEngineId:r};(0,Y.triggerEvent)(Y.eventTarget,o,a)})),Q(la(e),"triggerAnnotationCompleted",(function(e){var t=J.ANNOTATION_COMPLETED,n={annotation:e};(0,Y.triggerEvent)(Y.eventTarget,t,n)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport.element,l=et(e.getToolName(),i);if(null===(r=l)||void 0===r||!r.length)return a;if(null===(o=l=e.filterInteractableAnnotationsForElement(i,l))||void 0===o||!o.length)return a;var c=e.isDrawing,s=e.isEditingOpen,d=e.isEditingClosed;if(!(c||s||d))return l.forEach((function(r){r&&e.renderContour(t,n,r)})),a;var u=e.commonData.annotation.annotationUID;return l.forEach((function(r){if(r.annotationUID===u)if(c)e.renderContourBeingDrawn(t,n,r);else if(d)e.renderClosedContourBeingEdited(t,n,r);else{if(!s)throw new Error("Unknown ".concat(e.getToolName()," annotation rendering state"));e.renderOpenContourBeingEdited(t,n,r)}else e.renderContour(t,n,r)})),!0})),Ju(la(e)),ov(la(e)),pv(la(e)),kv(la(e)),Pv(la(e)),Fv(la(e)),e}return Z(o,[{key:"filterInteractableAnnotationsForElement",value:function(e,t){if(t&&t.length){var n,r=(0,Y.getEnabledElement)(e).viewport;if(r instanceof Y.StackViewport)n=Zs(r,t);else{if(!(r instanceof Y.VolumeViewport))throw new Error("Viewport Type ".concat(r.type," not supported"));var o=r.getCamera(),a=Y.utilities.getTargetVolumeAndSpacingInNormalDir(r,o).spacingInNormalDirection;n=this.filterAnnotationsWithinSlice(t,o,a)}return n}}},{key:"filterAnnotationsWithinSlice",value:function(e,t,n){var r=t.viewPlaneNormal,o=e.filter((function(e){var t=e.metadata.viewPlaneNormal,n=Math.abs(wc.vec3.dot(r,t))>zv;return t&&n}));if(!o.length)return[];var a,i=n/2,l=t.focalPoint,c=[],s=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return Gv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Gv(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){l=!0,a=e},f:function(){try{i||null==n.return||n.return()}finally{if(l)throw a}}}}(o);try{for(s.s();!(a=s.n()).done;){var d=a.value,u=d.data.polyline[0];if(d.isVisible){var v=wc.vec3.create();wc.vec3.sub(v,l,u);var f=wc.vec3.dot(v,r);Math.abs(f)<i&&c.push(d)}}}catch(e){s.e(e)}finally{s.f()}return c}}]),o}(od);Q(Kv,"toolName",void 0),Kv.toolName="PlanarFreehandROI";var Yv=Kv;function Jv(e,t,n){if(function(e,t,n){var r;if(null==t||null===(r=t.data)||void 0===r||!r.polyline||n<=0)return!0;if(!e.viewport)return!0;var o=e.renderingEngineId,a=e.viewportId,i=e.FrameOfReferenceUID,l=Ar(a,o);if(t.metadata.FrameOfReferenceUID!==i)return!0;if(!l)return!0;var c=l.getToolInstance(t.metadata.toolName);return!(c instanceof Yv)||c.isDrawing||c.isEditingOpen||c.isEditingClosed}(e,t,n))return!1;var r=e.viewport,o=t.data.polyline.map(r.worldToCanvas),a=Su(o,0,o.length,n);return a!==o&&(t.data.polyline=a.map(r.canvasToWorld),!0)}var $v={interpolateAnnotation:Jv},Zv={};function Xv(e){var t=(0,Y.getEnabledElement)(e).viewportId;return Zv[t]}var Qv,ef=Y.Enums.RequestType.Prefetch,tf={maxImagesToPrefetch:1/0,preserveExistingPool:!1};function nf(e,t){e=Math.round(e)||0;var n=[],r=(t=Math.round(t)||0)-e+1;if(r<=0)return n;for(;r--;)n[r]=t--;return n}function rf(e){var t=(0,Y.getEnabledElement)(e);if(!t)throw new Error("stackPrefetch: element must be a valid Cornerstone enabled element");var n=t.viewport;if(!(n instanceof Y.StackViewport))throw new Error("stackPrefetch: element must be a StackViewport, VolumeViewport stackPrefetch not yet implemented");return{currentImageIdIndex:n.getCurrentImageIdIndex(),imageIds:n.getImageIds()}}function of(e){var t=Xv(e);if(t){var n=t||{},r=rf(e);if(r&&r.imageIds&&0!==r.imageIds.length){if(n.indicesToRequest&&n.indicesToRequest.length||(n.enabled=!1),!1!==n.enabled&&(t.indicesToRequest.sort((function(e,t){return e-t})),n.indicesToRequest.slice().forEach((function(e){var t=r.imageIds[e];t&&Y.cache.getImageLoadObject(t)&&function(e){var t=n.indicesToRequest.indexOf(e);t>-1&&n.indicesToRequest.splice(t,1)}(e)})),n.indicesToRequest.length)){tf.preserveExistingPool||Y.imageLoadPoolManager.clearRequestStack(ef);for(var o,a,i,l,c,s,d=(o=n.indicesToRequest,a=r.currentImageIdIndex,i=0,l=o.length-1,o.forEach((function(e,t){e<a?i=Math.max(t,i):e>a&&(l=Math.min(t,l))})),{low:i,high:l}),u=d.low,v=d.high,f=[];u>=0||v<n.indicesToRequest.length;){var g=r.currentImageIdIndex,h=!(g-n.indicesToRequest[u]>tf.maxImagesToPrefetch)&&u>=0,p=!(n.indicesToRequest[v]-g>tf.maxImagesToPrefetch)&&v<n.indicesToRequest.length;if(!p&&!h)break;h&&(s=n.indicesToRequest[u--],c=r.imageIds[s],f.push(c)),p&&(s=n.indicesToRequest[v++],c=r.imageIds[s],f.push(c))}var m=function(e,t){return Y.imageLoader.loadAndCacheImage(e,t)},w=(0,Y.getConfiguration)().rendering.useNorm16Texture;f.forEach((function(e){var t={targetBuffer:{type:w?void 0:"Float32Array"},preScale:{enabled:!0},requestType:ef};Y.imageLoadPoolManager.addRequest(m.bind(null,e,t),ef,{imageId:e},0)}))}}else console.warn("CornerstoneTools.stackPrefetch: No images in stack.")}}function af(e){return function(t){var n,r=t.detail;try{n=rf(e)}catch(e){return}if(n&&n.imageIds&&0!==n.imageIds.length){var o=n.imageIds.indexOf(r.imageId);if(!(o<0)){var a=Xv(e);a&&a.data&&a.data.length&&a.indicesToRequest.push(o)}}}}function lf(e){clearTimeout(Qv),Qv=setTimeout((function(){var t=e.target;try{of(t)}catch(e){return}}),10)}function cf(e){var t=rf(e);if(t&&t.imageIds&&0!==t.imageIds.length){var n={indicesToRequest:nf(0,t.imageIds.length-1),enabled:!0,direction:1},r=n.indicesToRequest.indexOf(t.currentImageIdIndex);n.indicesToRequest.splice(r,1),function(e,t){var n=(0,Y.getEnabledElement)(e).viewportId;Zv[n]=t}(e,n),of(e),e.removeEventListener(Y.Enums.Events.STACK_NEW_IMAGE,lf),e.addEventListener(Y.Enums.Events.STACK_NEW_IMAGE,lf);var o=af(e);Y.eventTarget.removeEventListener(Y.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,o),Y.eventTarget.addEventListener(Y.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,o)}else console.warn("CornerstoneTools.stackPrefetch: No images in stack.")}function sf(e){clearTimeout(Qv),e.removeEventListener(Y.Enums.Events.STACK_NEW_IMAGE,lf);var t=af(e);Y.eventTarget.removeEventListener(Y.Enums.Events.IMAGE_CACHE_IMAGE_REMOVED,t);var n=Xv(e);n&&n.data.length&&(n.enabled=!1,Y.imageLoadPoolManager.clearRequestStack(ef))}function df(){return tf}function uf(e){tf=e}function vf(e,t){if(e instanceof Y.VolumeViewport){var n=e.getCamera().focalPoint,r=[0,0,0];return wc.vec3.sub(r,t,n),function(e,t){var n=e.getCamera(),r=n.viewPlaneNormal,o=wc.vec3.dot(t,r),a=wc.vec3.fromValues(r[0],r[1],r[2]);if(wc.vec3.scale(a,a,o),Math.abs(a[0])>.001||Math.abs(a[1])>.001||Math.abs(a[2])>.001){var i=[0,0,0],l=[0,0,0];wc.vec3.add(i,n.focalPoint,a),wc.vec3.add(l,n.position,a),e.setCamera({focalPoint:i,position:l}),e.render()}}(e,r),!0}}var ff=function(e,t){var n=t.frameNumbers||xr(Array(e.numTimePoints).keys());if(!t.maskVolumeId&&!t.imageCoordinate)throw new Error("No ROI provided");if(t.maskVolumeId&&t.imageCoordinate)throw new Error("Please provide only one ROI");if(t.maskVolumeId){var r=Y.cache.getVolume(t.maskVolumeId),o=function(e,t,n){for(var r=n.getScalarDataArrays(),o=[],a=function(n){var a=[];e.forEach((function(e){var o=r[e];a.push(o[t[n]])})),o.push(a)},i=0;i<t.length;i++)a(i);return o}(n,r.getScalarData().map((function(e,t){return t})).filter((function(e){return 0!==r.getScalarData()[e]})),e);return o}if(t.imageCoordinate){var a=function(e,t,n){var r=n.dimensions,o=n.imageData.worldToIndex(t);if(o[0]=Math.floor(o[0]),o[1]=Math.floor(o[1]),o[2]=Math.floor(o[2]),!Y.utilities.indexWithinDimensions(o,r))throw new Error("outside bounds");var a=r[0],i=r[0]*r[1],l=n.getScalarDataArrays(),c=[];return e.forEach((function(e){var t=l[e],n=o[2]*i+o[1]*a+o[0];c.push(t[n])})),c}(n,t.imageCoordinate,e);return a}},gf=function(e,t,n){var r=n||xr(Array(e.numTimePoints).keys()),o=r.length;if(r.length<=1)throw new Error("Please provide two or more time points");var a=e.getScalarDataArrays(),i=a[0].length,l=new Float32Array(i);if(t===Y.Enums.DynamicOperatorType.SUM){for(var c=0;c<o;c++)for(var s=a[r[c]],d=0;d<i;d++)l[d]+=s[d];return l}if(t===Y.Enums.DynamicOperatorType.SUBTRACT){if(r.length>2)throw new Error("Please provide only 2 time points for subtraction.");for(var u=0;u<i;u++)l[u]+=a[r[0]][u]-a[r[1]][u];return l}if(t===Y.Enums.DynamicOperatorType.AVERAGE){for(var v=0;v<o;v++)for(var f=a[r[v]],g=0;g<i;g++)l[g]+=f[g];for(var h=0;h<i;h++)l[h]=l[h]/o;return l}},hf=function(e,t){var n=Fl.getDefinedCursor(t,!0);n||(n=pl.getDefinedCursor(t)),n||(console.log("Cursor ".concat(t," is not defined either as SVG or as a standard cursor.")),n=pl.getDefinedCursor(t)),Zl(e,n)},pf=[].concat(xr(Al),xr(El)),mf=function(e,t,n){var r=Bl("textBoxFontSize",e,t,n),o=Bl("textBoxFontFamily",e,t,n);return"".concat(r,"px ").concat(o)},wf=function(e){if(!e||!e.length)throw new Error("The segmentationInputArray is undefined or empty array");e.forEach((function(e){if(void 0===e.segmentationId)throw new Error("The segmentationInput.segmentationId is undefined, please provide a valid segmentationId");if(void 0===e.representation)throw new Error("The segmentationInput.representation is undefined, please provide a valid representation");e.representation.type===st.Labelmap&&function(e){if(!e.representation.data)throw new Error("The segmentationInput.representationData.data is undefined, please provide a valid representationData.data");var t=e.representation.data;if(!t.volumeId)throw new Error("The segmentationInput.representationData.volumeId is undefined, please provide a valid representationData.volumeId");if(!Y.cache.getVolume(t.volumeId))throw new Error("volumeId of ".concat(t.volumeId," not found in cache, you should load and cache volume before adding segmentation"))}(e)}))},Ef=function(e){wf(e),e.map((function(e){xt(te()(e))}))};function yf(){return(yf=Ra(Na().mark((function e(t,n,r){var o,a;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ia(t)){e.next=3;break}throw new Error("No tool group found for toolGroupId: ".concat(t));case 3:return o=n.map((function(e){return If(t,e,r)})),e.next=6,Promise.all(o);case 6:return a=e.sent,e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function If(e,t,n){return bf.apply(this,arguments)}function bf(){return(bf=Ra(Na().mark((function e(t,n,r){var o;return Na().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.type!==st.Labelmap){e.next=6;break}return e.next=3,Mi.addSegmentationRepresentation(t,n,r);case 3:case 9:o=e.sent,e.next=13;break;case 6:if(n.type!==st.Contour){e.next=12;break}return e.next=9,ui.addSegmentationRepresentation(t,n,r);case 12:throw new Error("The representation type ".concat(n.type," is not supported"));case 13:return e.abrupt("return",o);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Cf=function(e,t,n){return yf.apply(this,arguments)};var Tf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]};return X(this,o),r.call(this,e,t)}return Z(o,[{key:"touchDragCallback",value:function(e){this._dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this._dragCallback(e)}},{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.deltaPoints,o=(0,Y.getEnabledElement)(n),a=r.world,i=o.viewport.getCamera(),l=i.focalPoint,c=i.position,s=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],d=[l[0]-a[0],l[1]-a[1],l[2]-a[2]];o.viewport.setCamera({focalPoint:d,position:s}),o.viewport.render()}}]),o}(ka);Q(Tf,"toolName",void 0),Tf.toolName="Pan";var _f=Tf;var Of=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{rotateIncrementDegrees:2}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"rotateCamera",(function(e,t,n,r){var o=e.getVtkActiveCamera(),a=o.getViewUp(),i=o.getFocalPoint(),l=o.getPosition(),c=[0,0,0],s=[0,0,0],d=[0,0,0],u=wc.mat4.identity(new Float32Array(16));wc.mat4.translate(u,u,t),wc.mat4.rotate(u,u,r,n),wc.mat4.translate(u,u,[-t[0],-t[1],-t[2]]),wc.vec3.transformMat4(c,l,u),wc.vec3.transformMat4(s,i,u),wc.mat4.identity(u),wc.mat4.rotate(u,u,r,n),wc.vec3.transformMat4(d,a,u),e.setCamera({position:c,viewUp:d,focalPoint:s})})),e.touchDragCallback=e._dragCallback.bind(la(e)),e.mouseDragCallback=e._dragCallback.bind(la(e)),e}return Z(o,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints,o=t.lastPoints,a=r.canvas,i=o.canvas,l=this.configuration.rotateIncrementDegrees,c=(0,Y.getEnabledElement)(n).viewport,s=c.getCamera(),d=n.clientWidth,u=n.clientHeight,v=[a[0]/d,a[1]/u],f=[i[0]/d,i[1]/u],g=[.5*d,.5*u],h=c.canvasToWorld(g),p=Math.pow(1+Math.abs(.5),2),m=[f[0],0,0],w=[v[0],0,0],E=Math.pow(m[0],2),y=Math.pow(w[0],2),I=E>p?0:Math.sqrt(p-E),b=y>p?0:Math.sqrt(p-y),C=[m[0],0,I];au().normalize(C);var T=[w[0],0,b];au().normalize(T);var _=au().dot(C,T);if(Math.abs(_)>1e-4){var O=-2*Math.acos(au().clampValue(_,-1,1))*Math.sign(v[0]-f[0])*l,D=s.viewUp,S=s.viewPlaneNormal,x=[0,0,0],k=[0,0,0];au().cross(D,S,x),au().normalize(x),au().cross(S,x,k),au().normalize(k),au().normalize(D),this.rotateCamera(c,h,k,O);var M=(f[1]-v[1])*l;this.rotateCamera(c,h,x,M),c.render()}}}]),o}(ka);Q(Of,"toolName",void 0),Of.toolName="TrackballRotate";var Df=Of;function Sf(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Sf(Object(n),!0).forEach((function(t){Q(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Sf(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var kf=Y.utilities.transformWorldToIndex,Mf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"editData",void 0),Q(la(e),"eventDispatchDetail",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=l.getFrameOfReferenceUID(),g={invalidated:!0,highlighted:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:f,referencedImageId:v},data:{label:"",handles:{points:[xr(a)]},cachedStats:{}}};tt(g,o);var h=Ks(o,e.getToolName());return e.editData={annotation:g,newAnnotation:!0,viewportIdsToRender:h},e._activateModify(o),Ql(o),t.preventDefault(),na(c,h),g})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=(0,Y.getEnabledElement)(n),c=l.renderingEngine,s=l.viewportId;if(e.eventDispatchDetail={viewportId:s,renderingEngineId:c.id},e._deactivateModify(n),Xl(n),e.editData=null,e.isDrawing=!1,e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(c,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=e.editData,l=i.annotation,c=i.viewportIdsToRender;l.data.handles.points[0]=xr(a),l.invalidated=!0;var s=(0,Y.getEnabledElement)(o).renderingEngine;na(s,c)})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f=c[v],g=f.annotationUID,h=f.data,p=h.handles.points[0],m=i.worldToCanvas(p);u.annotationUID=g;var w=e.getStyle("color",u,f);if(h.cachedStats[s]?f.invalidated&&(e._calculateCachedStats(f,d,t),i instanceof Y.VolumeViewport&&function(){var e=f.metadata.referencedImageId;for(var t in h.cachedStats)t.startsWith("imageId")&&d.getStackViewports().find((function(t){var n=Y.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=Y.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n}))&&delete h.cachedStats[t]}()):(h.cachedStats[s]={Modality:null,index:null,value:null},e._calculateCachedStats(f,d,t)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;Uc(n,g,"0",[m],{color:w}),a=!0;var E=vd(i,s),y=e._getTextLines(h,s,E);if(y){var I=[m[0]+6,m[1]-6];qc(n,g,"0",y,[I[0],I[1]],e.getLinkedTextBoxStyle(u,f))}}return a})),e}return Z(o,[{key:"isPointNearTool",value:function(){return!1}},{key:"toolSelectedCallback",value:function(){}},{key:"getHandleNearImagePoint",value:function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=t.data.handles.points[0],i=o.worldToCanvas(a);if(!0==wc.vec2.distance(n,i)<r)return a}},{key:"handleSelectedCallback",value:function(e,t){var n=e.detail.element;t.highlighted=!0;var r=Ks(n,this.getToolName());this.editData={annotation:t,viewportIdsToRender:r},this._activateModify(n),Ql(n);var o=(0,Y.getEnabledElement)(n).renderingEngine;na(o,r),e.preventDefault()}},{key:"_getTextLines",value:function(e,t,n){var r=e.cachedStats[t],o=r.index,a=r.Modality,i=r.value,l=r.SUVBw,c=r.SUVLbm,s=r.SUVBsa;if(void 0!==i||void 0!==l){var d=[],u=ud(a,n);return d.push("(".concat(o[0],", ").concat(o[1],", ").concat(o[2],")")),"PT"===a&&!0===n&&void 0!==l?(d.push("".concat(l.toFixed(2)," SUV bw")),c&&d.push("".concat(c.toFixed(2)," SUV lbm")),s&&d.push("".concat(s.toFixed(2)," SUV bsa"))):d.push("".concat(i.toFixed(2)," ").concat(u)),d}}},{key:"_getValueForModality",value:function(e,t,n){var r={};if(r.value=e,"PT"===n&&t.scaling.PET&&(t.scaling.PET.suvbwToSuvbsa||t.scaling.PET.suvbwToSuvlbm)){var o=t.scaling.PET,a=o.suvbwToSuvlbm,i=o.suvbwToSuvbsa;if(r.SUVBw=e,a){var l=e*a;r.SUVLbm=l}if(i){var c=e*i;r.SUVBsa=c}}return r}},{key:"_calculateCachedStats",value:function(e,t,n){for(var r=e.data,o=n.viewportId,a=n.renderingEngineId,i=r.handles.points[0],l=r.cachedStats,c=Object.keys(l),s=0;s<c.length;s++){var d=c[s],u=this.getTargetIdImage(d,t);if(u){var v=u.dimensions,f=u.imageData,g=u.metadata,h="getScalarData"in u?u.getScalarData():u.scalarData,p=g.Modality,m=kf(f,i);if(m[0]=Math.round(m[0]),m[1]=Math.round(m[1]),m[2]=Math.round(m[2]),Y.utilities.indexWithinDimensions(m,v)){this.isHandleOutsideImage=!1;var w=v[0],E=v[0]*v[1],y=h[m[2]*E+m[1]*w+m[0]];if(d.startsWith("imageId:")){var I=d.split("imageId:")[1],b=Y.utilities.imageIdToURI(I),C=Y.utilities.getViewportsWithImageURI(b,a)[0];m[2]=C.getCurrentImageIdIndex()}var T=this._getValueForModality(y,u,p);l[d]=xf(xf({index:m},T),{},{Modality:p})}else this.isHandleOutsideImage=!0,l[d]={index:m,Modality:p};e.invalidated=!1;var _=J.ANNOTATION_MODIFIED,O={annotation:e,viewportId:o,renderingEngineId:a};(0,Y.triggerEvent)(Y.eventTarget,_,O)}}return l}}]),o}(od);Q(Mf,"toolName",void 0),Mf.toolName="Probe";var Rf=Mf;var Pf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"editData",void 0),Q(la(e),"eventDispatchDetail",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"postMouseDownCallback",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f={invalidated:!0,highlighted:!0,isVisible:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:v},data:{label:"",handles:{points:[xr(a)]},cachedStats:{}}},g=Ks(o,e.getToolName());return e.editData={annotation:f,newAnnotation:!0,viewportIdsToRender:g},e._activateModify(o),Ql(o),t.preventDefault(),na(c,g),f})),Q(la(e),"postTouchStartCallback",(function(t){return e.postMouseDownCallback(t)})),Q(la(e),"renderAnnotation",(function(t,n){var r=!1,o=t.viewport;if(!e.editData)return r;var a=e.filterInteractableAnnotationsForElement(o.element,[e.editData.annotation]);if(null==a||!a.length)return r;var i=e.getTargetId(o),l=o.getRenderingEngine(),c={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},s=e.editData.annotation,d=s.annotationUID,u=s.data,v=u.handles.points[0],f=o.worldToCanvas(v);c.annotationUID=d;var g=e.getStyle("color",c,s);if(u.cachedStats[i]?s.invalidated&&e._calculateCachedStats(s,l,t):(u.cachedStats[i]={Modality:null,index:null,value:null},e._calculateCachedStats(s,l,t)),!o.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),r;Uc(n,d,"0",[f],{color:g}),r=!0;var h=vd(o,i),p=e._getTextLines(u,i,h);if(p){var m=[f[0]+6,f[1]-6];qc(n,d,"0",p,[m[0],m[1]],e.getLinkedTextBoxStyle(c,s))}return r})),e}return Z(o)}(Rf);Q(Pf,"toolName",void 0),Pf.toolName="DragProbe";var Nf=Pf;var Af=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]};return X(this,o),Q(la(e=r.call(this,t,n)),"_getImageDynamicRangeFromMiddleSlice",(function(t,n){var r,o,a=Math.floor(n[2]/2),i=n[0]*n[1];t instanceof Float32Array?(r=4,o=Float32Array):t instanceof Uint8Array?(r=1,o=Uint8Array):t instanceof Uint16Array?(r=2,o=Uint16Array):t instanceof Int16Array&&(r=2,o=Int16Array);var l=new o(t.buffer,a*i*r,i),c=e._getMinMax(l,i);return c.max-c.min})),e}return Z(o,[{key:"touchDragCallback",value:function(e){this.mouseDragCallback(e)}},{key:"mouseDragCallback",value:function(e){var t,n,r,o,a,i,l=e.detail,c=l.element,s=l.deltaPoints,d=(0,Y.getEnabledElement)(c),u=d.renderingEngine,v=d.viewport,f=!1;if(v instanceof Y.VolumeViewport){t=this.getTargetId(v).split("volumeId:")[1],i=Y.utilities.getViewportsWithVolumeId(t,u.id);var g=v.getProperties().voiRange;n=g.lower,r=g.upper;var h=Y.cache.getVolume(t);o=h.metadata.Modality,f=h.scaling&&Object.keys(h.scaling).length>0}else{if(!(v instanceof Y.StackViewport))throw new Error("Viewport is not a valid type");var p=v.getProperties();o=v.modality;var m=p.voiRange;n=m.lower,r=m.upper,f=v.getImageData().preScale.scaled}return a="PT"===o&&f?this.getPTNewRange({deltaPointsCanvas:s.canvas,lower:n,upper:r,clientHeight:c.clientHeight}):this.getNewRange({viewport:v,deltaPointsCanvas:s.canvas,volumeId:t,lower:n,upper:r}),v instanceof Y.StackViewport?(v.setProperties({voiRange:a}),void v.render()):v instanceof Y.VolumeViewport?(v.setProperties({voiRange:a}),void i.forEach((function(e){e.render()}))):void 0}},{key:"getPTNewRange",value:function(e){var t=e.deltaPointsCanvas,n=e.lower,r=e.upper,o=e.clientHeight;return r-=t[1]*(5/o),{lower:n,upper:r=Math.max(r,.1)}}},{key:"getNewRange",value:function(e){var t=e.viewport,n=e.deltaPointsCanvas,r=e.volumeId,o=e.lower,a=e.upper,i=this._getMultiplierFromDynamicRange(t,r)||4,l=n[0]*i,c=n[1]*i,s=Y.utilities.windowLevel.toWindowLevel(o,a),d=s.windowWidth,u=s.windowCenter;return d+=l,u+=c,d=Math.max(d,1),Y.utilities.windowLevel.toLowHighRange(d,u)}},{key:"_getMultiplierFromDynamicRange",value:function(e,t){var n;if(t){var r,o=Y.cache.getVolume(t),a=o.dimensions,i=o.getScalarData(),l=this._getImageDynamicRangeFromMiddleSlice(i,a),c=null==o||null===(r=o.metadata)||void 0===r?void 0:r.BitsStored,s=c?Math.pow(2,c):1/0;n=Math.min(l,s)}else n=this._getImageDynamicRangeFromViewport(e);var d=n/1024,u=4;return d>1&&(u=Math.round(d)),u}},{key:"_getImageDynamicRangeFromViewport",value:function(e){var t,n,r=e.getImageData().imageData,o=r.getDimensions();if(t=r.getScalarData?r.getScalarData():r.getPointData().getScalars(),1!==o[2])return this._getImageDynamicRangeFromMiddleSlice(t,o);if(t.getRange)n=t.getRange();else{var a=this._getMinMax(t,t.length);n=[a.min,a.max]}return n[1]-n[0]}},{key:"_getMinMax",value:function(e,t){for(var n=1/0,r=-1/0,o=0;o<t;o++){var a=e[o];a<n&&(n=a),a>r&&(r=a)}return{max:r,min:n}}}]),o}(ka);Q(Af,"toolName",void 0),Af.toolName="WindowLevel";var Lf=Af;var Uf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{zoomToCenter:!1,minZoomScale:.1,maxZoomScale:30,pinchToZoom:!0,pan:!0}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"initialMousePosWorld",void 0),Q(la(e),"dirVec",void 0),Q(la(e),"preMouseDownCallback",(function(t){var n=t.detail,r=n.element,o=n.currentPoints.world,a=(0,Y.getEnabledElement)(r).viewport.getCamera().focalPoint;e.initialMousePosWorld=o;var i=wc.vec3.fromValues(a[0]-o[0],a[1]-o[1],a[2]-o[2]);return i=wc.vec3.normalize(wc.vec3.create(),i),e.dirVec=i,!1})),Q(la(e),"preTouchStartCallback",(function(t){if(!e.configuration.pinchToZoom)return e.preMouseDownCallback(t)})),Q(la(e),"_dragParallelProjection",(function(t,n,r){var o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=t.detail,i=a.element,l=a.deltaPoints,c=o?t.detail.deltaDistance.canvas:l.canvas[1],s=[i.clientWidth,i.clientHeight],d=r.parallelScale,u=r.focalPoint,v=r.position,f=1.5/s[1],g=c*f,h=(1-g)*d,p=u,m=v;if(!e.configuration.zoomToCenter){var w=wc.vec3.distance(u,e.initialMousePosWorld),E=5/s[1],y=c*E;h=(1-y)*d,m=wc.vec3.scaleAndAdd(wc.vec3.create(),v,e.dirVec,-w*y),p=wc.vec3.scaleAndAdd(wc.vec3.create(),u,e.dirVec,-w*y)}var I=n.getImageData(),b=[1,1,1];I&&(b=I.spacing);var C=e.configuration,T=C.minZoomScale,_=C.maxZoomScale,O=i.clientHeight*b[1]*.5,D=O/h,S=h,x=!1;I&&(D<T?(S=O/T,x=!0):D>=_&&(S=O/_,x=!0)),n.setCamera({parallelScale:S,focalPoint:x?u:p,position:x?v:m})})),Q(la(e),"_dragPerspectiveProjection",(function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.detail,a=o.element,i=o.deltaPoints,l=r?e.detail.deltaDistance.canvas:i.canvas[1],c=[a.clientWidth,a.clientHeight],s=n.position,d=n.focalPoint,u=n.viewPlaneNormal,v=au().distance2BetweenPoints(s,d),f=Math.sqrt(v)/c[1],g=[-u[0],-u[1],-u[2]],h=l*f,p=h*g[0];s[0]+=p,d[0]+=p,p=h*g[1],s[1]+=p,d[1]+=p,p=h*g[2],s[2]+=p,d[2]+=p,t.setCamera({position:s,focalPoint:d})})),e.initialMousePosWorld=[0,0,0],e.dirVec=[0,0,0],e.configuration.pinchToZoom?e.touchDragCallback=e._pinchCallback.bind(la(e)):e.touchDragCallback=e._dragCallback.bind(la(e)),e.mouseDragCallback=e._dragCallback.bind(la(e)),e}return Z(o,[{key:"_pinchCallback",value:function(e){if(e.detail.currentPointsList.length>1){var t=e.detail,n=t.element,r=t.currentPoints,o=(0,Y.getEnabledElement)(n).viewport,a=o.getCamera(),i=r.world,l=a.focalPoint;this.initialMousePosWorld=i;var c=wc.vec3.fromValues(l[0]-i[0],l[1]-i[1],l[2]-i[2]);c=wc.vec3.normalize(wc.vec3.create(),c),this.dirVec=c,a.parallelProjection?this._dragParallelProjection(e,o,a,!0):this._dragPerspectiveProjection(e,o,a,!0),o.render()}this.configuration.pan&&this._panCallback(e)}},{key:"_dragCallback",value:function(e){var t=e.detail.element,n=(0,Y.getEnabledElement)(t).viewport,r=n.getCamera();r.parallelProjection?this._dragParallelProjection(e,n,r):this._dragPerspectiveProjection(e,n,r),n.render()}},{key:"_panCallback",value:function(e){var t=e.detail,n=t.element,r=t.deltaPoints,o=(0,Y.getEnabledElement)(n),a=r.world,i=o.viewport.getCamera(),l=i.focalPoint,c=i.position,s=[c[0]-a[0],c[1]-a[1],c[2]-a[2]],d=[l[0]-a[0],l[1]-a[1],l[2]-a[2]];o.viewport.setCamera({focalPoint:d,position:s}),o.viewport.render()}}]),o}(ka);Q(Uf,"toolName",void 0),Uf.toolName="Zoom";var Vf=Uf;var Bf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"deltaY",void 0),e.deltaY=1,e}return Z(o,[{key:"mouseDragCallback",value:function(e){this._dragCallback(e)}},{key:"touchDragCallback",value:function(e){this._dragCallback(e)}},{key:"_dragCallback",value:function(e){var t,n=e.detail,r=n.deltaPoints,o=n.viewportId,a=n.renderingEngineId,i=(0,Y.getEnabledElementByIds)(o,a).viewport,l=this.getTargetId(i),c=this.configuration,s=c.debounceIfNotLoaded,d=c.invert,u=c.loop,v=r.canvas[1];i instanceof Y.VolumeViewport&&(t=l.split("volumeId:")[1]);var f=this._getPixelPerImage(i),g=v+this.deltaY;if(f)if(Math.abs(g)>=f){var h=Math.round(g/f);yc(i,{delta:d?-h:h,volumeId:t,debounceLoading:s,loop:u}),this.deltaY=g%f}else this.deltaY=g}},{key:"_getPixelPerImage",value:function(e){var t=e.element,n=this._getNumberOfSlices(e);return Math.max(2,t.offsetHeight/Math.max(n,8))}},{key:"_getNumberOfSlices",value:function(e){return e instanceof Y.VolumeViewport?Y.utilities.getImageSliceDataForVolumeViewport(e).numberOfSlices:e instanceof Y.StackViewport?e.getImageIds().length:void 0}}]),o}(ka);Q(Bf,"toolName",void 0),Bf.toolName="StackScroll";var jf=Bf;function Hf(e,t){var n=Bn(e,2),r=n[0],o=n[1],a=Bn(t,2),i=a[0],l=a[1],c=wc.vec3.sub(wc.vec3.create(),o,r),s=wc.vec3.sub(wc.vec3.create(),i,l),d=wc.vec3.dot(c,s)/(wc.vec3.length(c)*wc.vec3.length(s));return 180*Math.acos(d)/Math.PI}var Wf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),e.touchDragCallback=e._dragCallback.bind(la(e)),e.mouseDragCallback=e._dragCallback.bind(la(e)),e}return Z(o,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints,o=t.startPoints,a=r.world,i=o.world,l=(0,Y.getEnabledElement)(n).viewport,c=l.getCamera(),s=[.5*n.clientWidth,.5*n.clientHeight],d=l.canvasToWorld(s),u=Hf([i,d],[d,a]),v=c.viewPlaneNormal,f=c.viewUp,g=wc.vec3.sub(wc.vec3.create(),d,i),h=wc.vec3.sub(wc.vec3.create(),d,a),p=wc.vec3.cross(wc.vec3.create(),g,h);if(wc.vec3.dot(v,p)>0&&(u=-u),!Number.isNaN(u)){if(l instanceof Y.BaseVolumeViewport){var m=u*Math.PI/180,w=wc.mat4.identity(new Float32Array(16));wc.mat4.rotate(w,w,m,v);var E=wc.vec3.transformMat4(wc.vec3.create(),f,w);l.setCamera({viewUp:E})}else{var y=l.getProperties().rotation;l.setProperties({rotation:y+u})}l.render()}}}]),o}(ka);Q(Wf,"toolName",void 0),Wf.toolName="PlanarRotate";var Ff=Wf;var Gf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,debounceIfNotLoaded:!0,loop:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"_configuration",void 0),e}return Z(o,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.wheel,r=t.element,o=n.direction,a=this.configuration.invert,i=(0,Y.getEnabledElement)(r).viewport,l=o*(a?-1:1);if(i instanceof Y.StackViewport)i.scroll(l,this.configuration.debounceIfNotLoaded,this.configuration.loop);else{if(!(i instanceof Y.VolumeViewport))throw new Error("StackScrollMouseWheelTool: Unsupported viewport type");Ic(i,this.getTargetId(i).split("volumeId:")[1],l)}}}]),o}(ka);Q(Gf,"toolName",void 0),Gf.toolName="StackScrollMouseWheel";var qf=Gf;var zf={X:[1,0,0],Y:[0,1,0],Z:[0,0,1],CUSTOM:[]},Kf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{direction:zf.Z,rotateIncrementDegrees:.5}};return X(this,o),Q(la(e=r.call(this,t,n)),"_configuration",void 0),e}return Z(o,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,r=t.wheel,o=(0,Y.getEnabledElement)(n).viewport,a=this.configuration,i=a.direction,l=a.rotateIncrementDegrees,c=o.getCamera(),s=c.viewUp,d=c.position,u=c.focalPoint,v=r.direction,f=Bn(u,3),g=f[0],h=f[1],p=f[2],m=Bn(i,3),w=m[0],E=m[1],y=m[2],I=v*l,b=[0,0,0],C=[0,0,0],T=[0,0,0],_=wc.mat4.identity(new Float32Array(16));wc.mat4.translate(_,_,[g,h,p]),wc.mat4.rotate(_,_,I,[w,E,y]),wc.mat4.translate(_,_,[-g,-h,-p]),wc.vec3.transformMat4(b,d,_),wc.vec3.transformMat4(C,u,_),wc.mat4.identity(_),wc.mat4.rotate(_,_,I,[w,E,y]),wc.vec3.transformMat4(T,s,_),o.setCamera({position:b,viewUp:T,focalPoint:C}),o.render()}}]),o}(ka);Q(Kf,"toolName",void 0),Kf.toolName="VolumeRotateMouseWheel";var Yf=Kf;var Jf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{targetViewportIds:[]}};return X(this,o),Q(la(e=r.call(this,t,n)),"_bounds",void 0),e}return Z(o,[{key:"mouseClickCallback",value:function(e){var t=e.detail,n=t.element,r=t.currentPoints,o=(0,Y.getEnabledElement)(n),a=o.viewport,i=o.renderingEngine,l=this.getTargetId(a);if(!l.startsWith("volumeId"))throw new Error("MIPJumpToClickTool: targetId is not a volumeId, you should only use MIPJumpToClickTool with a volumeId as the targetId");var c=l.split("volumeId:")[1],s=-1/0,d=iu(a,r.world,c,(function(e,t){if(e>s)return s=e,t}));d&&d.length&&this.configuration.targetViewportIds.forEach((function(e){var t=i.getViewport(e);t instanceof Y.VolumeViewport?vf(t,d):console.warn("Cannot jump to specified world coordinates for a viewport that is not a VolumeViewport")}))}}]),o}(ka);Q(Jf,"toolName",void 0),Jf.toolName="MIPJumpToClickTool";var $f=Jf;var Zf=Y.utilities.transformWorldToIndex,Xf=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;Ql(o),e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=l.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:f,referencedImageId:v},data:{handles:{points:[xr(a),xr(a)],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};tt(g,o);var h=Ks(o,e.getToolName());return e.editData={annotation:g,viewportIdsToRender:h,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),t.preventDefault(),na(c,h),g})),Q(la(e),"isPointNearTool",(function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=Bn(t.data.handles.points,2),i=a[0],l=a[1],c=o.worldToCanvas(i),s=o.worldToCanvas(l),d={start:{x:c[0],y:c[1]},end:{x:s[0],y:s[1]}};return ld([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]])<=r})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},e._activateModify(r),Ql(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}e.editData=null,e.isDrawing=!1}})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else{var g=n.currentPoints.world;s.handles.points[l]=xr(g),a.invalidated=!0}e.editData.hasMoved=!0;var h=(0,Y.getEnabledElement)(r).renderingEngine;na(h,i)})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_MOVE,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f=c[v],g=f.annotationUID,h=f.data,p=h.handles,m=p.points,w=p.activeHandleIndex;u.annotationUID=g;var E=e.getStyle("lineWidth",u,f),y=e.getStyle("lineDash",u,f),I=e.getStyle("color",u,f),b=e.getStyle("shadow",u,f),C=m.map((function(e){return i.worldToCanvas(e)})),T=void 0;if(h.cachedStats[s]&&void 0!==h.cachedStats[s].unit?f.invalidated&&e._throttledCalculateCachedStats(f,d,t):(h.cachedStats[s]={length:null,unit:null},e._calculateCachedStats(f,d,t)),xe(g)){ie(f)||e.editData||null===w||(T=[C[w]]),T&&Uc(n,g,"0",C,{color:I,lineDash:y,lineWidth:E});var _="".concat(g,"-line");if(Vc(n,g,"1",C[0],C[1],{color:I,width:E,lineDash:y,shadow:b},_),a=!0,!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;var O=e._getTextLines(h,s);if(!h.handles.textBox.hasMoved){var D=sd(C);h.handles.textBox.worldPosition=i.canvasToWorld(D)}var S=i.worldToCanvas(h.handles.textBox.worldPosition),x=Jc(n,g,"1",O,S,C,{},e.getLinkedTextBoxStyle(u,f)),k=x.x,M=x.y,R=x.width,P=x.height;h.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([k,M]),topRight:i.canvasToWorld([k+R,M]),bottomLeft:i.canvasToWorld([k,M+P]),bottomRight:i.canvasToWorld([k+R,M+P])}}}return a})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o,[{key:"handleSelectedCallback",value:function(e,t,n){var r=e.detail.element,o=t.data;t.highlighted=!0;var a,i=!1;n.worldPosition?i=!0:a=o.handles.points.findIndex((function(e){return e===n}));var l=Ks(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:a,movingTextBox:i},this._activateModify(r),Ql(r);var c=(0,Y.getEnabledElement)(r).renderingEngine;na(c,l),e.preventDefault()}},{key:"_getTextLines",value:function(e,t){var n=e.cachedStats[t],r=n.length,o=n.unit;if(null!=r&&!isNaN(r))return["".concat(r.toFixed(2)," ").concat(o)]}},{key:"_calculateLength",value:function(e,t){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(n*n+r*r+o*o)}},{key:"_calculateCachedStats",value:function(e,t,n){for(var r=e.data,o=n.viewportId,a=n.renderingEngineId,i=r.handles.points[0],l=r.handles.points[1],c=r.cachedStats,s=Object.keys(c),d=0;d<s.length;d++){var u=s[d],v=this.getTargetIdImage(u,t);if(v){var f=v.imageData,g=v.dimensions,h=v.hasPixelSpacing,p=this._calculateLength(i,l),m=Zf(f,i),w=Zf(f,l);this._isInsideVolume(m,w,g)?this.isHandleOutsideImage=!1:this.isHandleOutsideImage=!0,c[u]={length:p,unit:h?"mm":"px"}}}e.invalidated=!1;var E=J.ANNOTATION_MODIFIED,y={annotation:e,viewportId:o,renderingEngineId:a};return(0,Y.triggerEvent)(Y.eventTarget,E,y),c}},{key:"_isInsideVolume",value:function(e,t,n){return Y.utilities.indexWithinDimensions(e,n)&&Y.utilities.indexWithinDimensions(t,n)}}]),o}(od);Q(Xf,"toolName",void 0),Xf.toolName="Length";var Qf=Xf,eg=h(847),tg=h.n(eg);var ng=Y.CONSTANTS.RENDERING_DEFAULTS;function rg(){return"rgb(0, 200, 0)"}function og(){return!0}function ag(){return!0}function ig(){return!0}var lg=.001,cg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t,n,a,i,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse"],configuration:{shadow:!0,viewportIndicators:!0,autoPan:{enabled:!1,panSize:10},filterActorUIDsToSetSlabThickness:[],slabThicknessBlendMode:Y.Enums.BlendModes.MAXIMUM_INTENSITY_BLEND,mobile:{enabled:!1,opacity:.8,handleRadius:9}}};return X(this,o),Q(la(i=r.call(this,l,c)),"toolCenter",[0,0,0]),Q(la(i),"_getReferenceLineColor",void 0),Q(la(i),"_getReferenceLineControllable",void 0),Q(la(i),"_getReferenceLineDraggableRotatable",void 0),Q(la(i),"_getReferenceLineSlabThicknessControlsOn",void 0),Q(la(i),"editData",void 0),Q(la(i),"initializeViewport",(function(e){var t=e.renderingEngineId,n=e.viewportId,r=(0,Y.getEnabledElementByIds)(n,t),o=r.FrameOfReferenceUID,a=r.viewport,l=a.element,c=a.getCamera(),s=c.position,d=c.focalPoint,u=c.viewPlaneNormal,v=i._getAnnotations(r);return(v=i.filterInteractableAnnotationsForElement(l,v)).length&&rt(v[0].annotationUID),tt({highlighted:!1,metadata:{cameraPosition:xr(s),cameraFocalPoint:xr(d),FrameOfReferenceUID:o,toolName:i.getToolName()},data:{handles:{rotationPoints:[],slabThicknessPoints:[],toolCenter:i.toolCenter},activeOperation:null,activeViewportIds:[],viewportId:n}},l),{normal:u,point:a.canvasToWorld([a.canvas.clientWidth/2,a.canvas.clientHeight/2])}})),Q(la(i),"_getViewportsInfo",(function(){return ia(i.toolGroupId).viewportsInfo})),Q(la(i),"computeToolCenter",(function(e){if(!e.length||1===e.length)throw new Error("For crosshairs to operate, at least two viewports must be given.");var t=Bn(e,3),n=t[0],r=t[1],o=t[2],a=i.initializeViewport(n),l=a.normal,c=a.point,s=i.initializeViewport(r),d=s.normal,u=s.point,v=[0,0,0],f=wc.vec3.create();if(o){var g=i.initializeViewport(o);v=g.normal,f=g.point}else wc.vec3.add(f,c,u),wc.vec3.scale(f,f,.5),wc.vec3.cross(v,l,d);var h=Y.utilities.planar.planeEquation(l,c),p=Y.utilities.planar.planeEquation(d,u),m=Y.utilities.planar.planeEquation(v,f);i.toolCenter=Y.utilities.planar.threePlaneIntersection(h,p,m);var w=(0,Y.getEnabledElementByIds)(e[0].viewportId,e[0].renderingEngineId).renderingEngine;na(w,e.map((function(e){return e.viewportId})))})),Q(la(i),"addNewAnnotation",(function(e){var t=e.detail,n=t.element,r=t.currentPoints.world,o=(0,Y.getEnabledElement)(n),a=o.viewport;i._jump(o,r);for(var l=i._getAnnotations(o),c=i.filterInteractableAnnotationsForElement(a.element,l),s=c[0].data,d=s.handles.rotationPoints,u=[],v=0;v<d.length-1;++v){var f=d[v][1],g=i._getReferenceLineControllable(f.id),h=i._getReferenceLineDraggableRotatable(f.id);g&&h&&(u.push(f.id),v++)}return s.activeViewportIds=[].concat(u),s.handles.activeOperation=1,e.preventDefault(),Ql(n),i._activateModify(n),c[0]})),Q(la(i),"cancel",(function(){console.log("Not implemented yet")})),Q(la(i),"handleSelectedCallback",(function(e,t){var n=e.detail.element;t.highlighted=!0,i._activateModify(n),Ql(n),e.preventDefault()})),Q(la(i),"isPointNearTool",(function(e,t,n,r){return!!i._pointNearTool(e,t,n,6)})),Q(la(i),"toolSelectedCallback",(function(e,t,n){var r=e.detail.element;t.highlighted=!0,i._activateModify(r),Ql(r),e.preventDefault()})),Q(la(i),"onCameraModified",(function(e){var t,n=e.detail.element,r=(0,Y.getEnabledElement)(n),o=r.renderingEngine,a=r.viewport,l=i._getAnnotations(r),c=i.filterInteractableAnnotationsForElement(n,l)[0];if(c){var s=a.getCamera(),d=c.metadata.cameraPosition,u=[0,0,0];au().subtract(s.position,d,u);var v=c.metadata.cameraFocalPoint,f=[0,0,0];au().subtract(s.focalPoint,v,f),c.metadata.cameraPosition=xr(s.position),c.metadata.cameraFocalPoint=xr(s.focalPoint);var g=i._getReferenceLineControllable(a.id),h=i._getReferenceLineDraggableRotatable(a.id);if(!Y.utilities.isEqual(s.position,d,.001)&&g&&h){var p=!1;Y.utilities.isEqual(u,f,.001)||(p=!0);var m=Math.abs(au().dot(u,s.viewPlaneNormal))<.01;p||m||(i.toolCenter[0]+=u[0],i.toolCenter[1]+=u[1],i.toolCenter[2]+=u[2])}null!==(t=i.configuration.autoPan)&&void 0!==t&&t.enabled&&Ar(a.id,o.id).getViewportIds().filter((function(e){return e!==a.id})).forEach((function(e){i._autoPanViewportIfNecessary(e,o)}));var w=Ks(n,i.getToolName(),!1);na(o,w)}})),Q(la(i),"mouseMoveCallback",(function(e,t){for(var n=e.detail,r=n.element,o=n.currentPoints.canvas,a=!1,l=0;l<t.length;l++){var c=t[l];if(!ie(c)){var s=c.data,d=c.highlighted;if(s.handles){var u=s.handles.activeOperation,v=s.activeViewportIds&&s.activeViewportIds.length>0?xr(s.activeViewportIds):[];s.activeViewportIds=[],s.handles.activeOperation=null;var f;(f=!!i.getHandleNearImagePoint(r,c,o,6)||i._pointNearTool(r,c,o,6))&&!d||!f&&d?(c.highlighted=!d,a=!0):s.handles.activeOperation===u&&i._areViewportIdArraysEqual(s.activeViewportIds,v)||(a=!0)}}}return a})),Q(la(i),"filterInteractableAnnotationsForElement",(function(e,t){if(!t||!t.length)return[];var n=(0,Y.getEnabledElement)(e).viewportId;return t.filter((function(e){return e.data.viewportId===n}))})),Q(la(i),"renderAnnotation",(function(e,t){var n=!1,r=e.viewport,o=e.renderingEngine,a=r.element,l=i._getAnnotations(e),c=r.getCamera(),s=i.filterInteractableAnnotationsForElement(a,l)[0];if(null==l||!l.length||null==s||!s.data)return n;var d=s.annotationUID,u=r.canvas,v=u.clientWidth,f=u.clientHeight,g=Math.sqrt(v*v+f*f),h=s.data,p=r.worldToCanvas(i.toolCenter),m=i._filterAnnotationsByUniqueViewportOrientations(e,l),w=[];m.forEach((function(e){var t=e.data;t.handles.toolCenter=i.toolCenter;var n=o.getViewport(t.viewportId),a=n.getCamera(),l=i._getReferenceLineControllable(n.id),s=i._getReferenceLineDraggableRotatable(n.id),d=i._getReferenceLineSlabThicknessControlsOn(n.id),u=n.canvas,v=u.clientWidth,f=u.clientHeight,h=Math.sqrt(v*v+f*f),E=[.5*v,.5*f],y=n.canvasToWorld(E),I=[0,0,0];au().cross(c.viewPlaneNormal,a.viewPlaneNormal,I),au().normalize(I),au().multiplyScalar(I,h);var b=[0,0,0];au().add(y,I,b);var C=[0,0,0];au().subtract(y,I,C);var T=[0,0,v,f],_=r.worldToCanvas(b),O=r.worldToCanvas(y),D=wc.vec2.create();wc.vec2.subtract(D,_,O),wc.vec2.normalize(D,D);var S=wc.vec2.create();wc.vec2.scale(S,D,100*g);var x=wc.vec2.create();wc.vec2.scale(x,D,.25*g);var k=wc.vec2.create();wc.vec2.scale(k,D,.15*g);var M=wc.vec2.create();wc.vec2.scale(M,D,2===m.length?.04*g:0);var R=wc.vec2.create(),P=wc.vec2.create(),N=wc.vec2.create(),A=wc.vec2.create(),L=wc.vec2.clone(p);s&&l||(L=wc.vec2.clone(O)),wc.vec2.add(R,L,M),wc.vec2.add(P,L,S),wc.vec2.subtract(N,L,M),wc.vec2.subtract(A,L,S),Fd(R,P,T),Fd(N,A,T);var U=wc.vec2.create();wc.vec2.subtract(U,p,x);var V=wc.vec2.create();wc.vec2.add(V,p,x);var B=wc.vec2.clone(p);!s&&d&&(B=wc.vec2.clone(O));var j=xr(i.toolCenter);!s&&d&&(j=xr(y));var H=[0,0,0];au().subtract(b,C,H),au().normalize(H);var W=c.viewPlaneNormal,F=tg().buildFromDegree().rotate(90,W).matrix,G=[0,0,0];wc.vec3.transformMat4(G,H,F);var q=n.getSlabThickness(),z=[].concat(G);au().multiplyScalar(z,q);var K=[0,0,0];au().add(j,z,K);var Y=r.worldToCanvas(K),J=wc.vec2.create();wc.vec2.subtract(J,B,Y);var $=wc.vec2.create();wc.vec2.subtract($,B,S),wc.vec2.add($,$,J);var Z=wc.vec2.create();wc.vec2.add(Z,B,S),wc.vec2.add(Z,Z,J),Fd($,Z,T);var X=wc.vec2.create();wc.vec2.add(X,B,S),wc.vec2.subtract(X,X,J);var Q=wc.vec2.create();wc.vec2.subtract(Q,B,S),wc.vec2.subtract(Q,Q,J),Fd(X,Q,T);var ee=wc.vec2.create(),te=wc.vec2.create(),ne=wc.vec2.create(),re=wc.vec2.create();wc.vec2.subtract(ee,B,k),wc.vec2.add(ee,ee,J),wc.vec2.add(te,B,k),wc.vec2.add(te,te,J),wc.vec2.subtract(ne,B,k),wc.vec2.subtract(ne,ne,J),wc.vec2.add(re,B,k),wc.vec2.subtract(re,re,J),w.push([n,R,P,N,A,$,Z,X,Q,U,V,ee,te,ne,re])}));var E=[],y=[],I=i._getReferenceLineColor(r.id),b=void 0!==I?I:"rgb(200, 200, 200)";return w.forEach((function(e,n){var o,a,l=e[0],c=i._getReferenceLineColor(l.id),s=i._getReferenceLineControllable(l.id),u=i._getReferenceLineDraggableRotatable(l.id)||(null===(o=i.configuration.mobile)||void 0===o?void 0:o.enabled),v=i._getReferenceLineSlabThicknessControlsOn(l.id)||(null===(a=i.configuration.mobile)||void 0===a?void 0:a.enabled),f=h.activeViewportIds.find((function(e){return e===l.id})),g=void 0!==c?c:"rgb(200, 200, 200)",p=1,m=null!==h.handles.activeOperation&&1===h.handles.activeOperation&&f;m&&(p=2.5);var w="".concat(n);if(s&&u?(w="".concat(n,"One"),Vc(t,d,w,e[1],e[2],{color:g,lineWidth:p}),w="".concat(n,"Two"),Vc(t,d,w,e[3],e[4],{color:g,lineWidth:p})):Vc(t,d,w,e[2],e[4],{color:g,lineWidth:p}),s){var I;g=void 0!==c?c:"rgb(200, 200, 200)";var b=2===h.handles.activeOperation,C=[e[9],e[10]],T=[r.canvasToWorld(e[9]),l,e[1],e[2]],_=[r.canvasToWorld(e[10]),l,e[3],e[4]];E.push(T,_);var O=3===h.handles.activeOperation,D=[e[11],e[12],e[13],e[14]],S=[r.canvasToWorld(e[11]),l,e[5],e[6]],x=[r.canvasToWorld(e[12]),l,e[5],e[6]],k=[r.canvasToWorld(e[13]),l,e[7],e[8]],M=[r.canvasToWorld(e[14]),l,e[7],e[8]];if(y.push(S,x,k,M),(m||null!==(I=i.configuration.mobile)&&void 0!==I&&I.enabled)&&!b&&!O&&u&&v){var R,P,N,A,L,U,V,B,j="".concat(n,"One");Uc(t,d,j,C,{color:g,handleRadius:null!==(R=i.configuration.mobile)&&void 0!==R&&R.enabled?null===(P=i.configuration.mobile)||void 0===P?void 0:P.handleRadius:3,opacity:null!==(N=i.configuration.mobile)&&void 0!==N&&N.enabled?null===(A=i.configuration.mobile)||void 0===A?void 0:A.opacity:1,type:"circle"}),j="".concat(n,"Two"),Uc(t,d,j,D,{color:g,handleRadius:null!==(L=i.configuration.mobile)&&void 0!==L&&L.enabled?null===(U=i.configuration.mobile)||void 0===U?void 0:U.handleRadius:3,opacity:null!==(V=i.configuration.mobile)&&void 0!==V&&V.enabled?null===(B=i.configuration.mobile)||void 0===B?void 0:B.opacity:1,type:"rect"})}else if(m&&!b&&!O&&u){var H,W,F,G,q="".concat(n);Uc(t,d,q,C,{color:g,handleRadius:null!==(H=i.configuration.mobile)&&void 0!==H&&H.enabled?null===(W=i.configuration.mobile)||void 0===W?void 0:W.handleRadius:3,opacity:null!==(F=i.configuration.mobile)&&void 0!==F&&F.enabled?null===(G=i.configuration.mobile)||void 0===G?void 0:G.opacity:1,type:"circle"})}else if(f&&!b&&!O&&v){var z,K,Y,J,$="".concat(n);Uc(t,d,$,D,{color:g,handleRadius:null!==(z=i.configuration.mobile)&&void 0!==z&&z.enabled?null===(K=i.configuration.mobile)||void 0===K?void 0:K.handleRadius:3,opacity:null!==(Y=i.configuration.mobile)&&void 0!==Y&&Y.enabled?null===(J=i.configuration.mobile)||void 0===J?void 0:J.opacity:1,type:"rect"})}else if(b&&u){var Z="".concat(n);Uc(t,d,Z,C,{color:g,handleRadius:2,fill:g,type:"circle"})}else O&&f&&v&&Uc(t,d,w,D,{color:g,handleRadius:2,fill:g,type:"rect"});l.getSlabThickness()>.5&&v&&(w="".concat(n,"STOne"),Vc(t,d,w,e[5],e[6],{color:g,width:1,lineDash:[2,3]}),w="".concat(n,"STTwo"),Vc(t,d,w,e[7],e[8],{color:g,width:e,lineDash:[2,3]}))}})),n=!0,h.handles.rotationPoints=E,h.handles.slabThicknessPoints=y,i.configuration.viewportIndicators&&Ac(t,d,"0",[.95*v,.05*f],.01*g,{color:b,fill:b}),n})),Q(la(i),"_getAnnotations",(function(e){var t=e.viewport;return et(i.getToolName(),t.element)})),Q(la(i),"_onNewVolume",(function(e){var t=i._getViewportsInfo();i.computeToolCenter(t)})),Q(la(i),"_areViewportIdArraysEqual",(function(e,t){return e.length===t.length&&(e.forEach((function(e){for(var n=!1,r=0;r<t.length;++r)if(e===t[r]){n=!0;break}if(!1===n)return!1})),!0)})),Q(la(i),"_getAnnotationsForViewportsWithDifferentCameras",(function(e,t){var n=e.viewportId,r=e.renderingEngine,o=e.viewport,a=t.filter((function(e){return e.data.viewportId!==n}));if(!a||!a.length)return[];var i=o.getCamera(),l=i.viewPlaneNormal,c=i.position,s=a.filter((function(e){var t=e.data.viewportId,n=r.getViewport(t).getCamera();return!(Y.utilities.isEqual(n.viewPlaneNormal,l,.01)&&Y.utilities.isEqual(n.position,c,1))}));return s})),Q(la(i),"_filterViewportWithSameOrientation",(function(e,t,n){var r=e.renderingEngine,o=t.data,a=r.getViewport(o.viewportId),l=n.filter((function(e){var t=e.data,n=r.getViewport(t.viewportId);return!0===i._getReferenceLineControllable(n.id)}));if(!l||!l.length)return[];var c=a.getCamera(),s=c.viewPlaneNormal;return au().normalize(s),l.filter((function(e){var t=e.data.viewportId,n=r.getViewport(t).getCamera(),o=n.viewPlaneNormal;return au().normalize(o),Y.utilities.isEqual(s,o,.01)&&Y.utilities.isEqual(c.viewUp,n.viewUp,.01)}))})),Q(la(i),"_filterAnnotationsByUniqueViewportOrientations",(function(e,t){var n=e.renderingEngine,r=e.viewport,o=r.getCamera().viewPlaneNormal;au().normalize(o);for(var a=t.filter((function(e){var t=e.data,o=n.getViewport(t.viewportId),a=i._getReferenceLineControllable(o.id);return r!==o&&!0===a})),l=[],c=0;c<a.length;++c){var s=a[c],d=s.data.viewportId,u=n.getViewport(d).getCamera(),v=u.viewPlaneNormal;if(au().normalize(v),!Y.utilities.isEqual(o,v,.01)&&!Y.utilities.isOpposite(o,v,.01)){for(var f=!1,g=0;g<l.length;++g){var h=l[g].data.viewportId,p=n.getViewport(h).getCamera();Y.utilities.isEqual(p.viewPlaneNormal,u.viewPlaneNormal,.01)&&Y.utilities.isEqual(p.position,u.position,1)&&(f=!0)}f||l.push(s)}}for(var m=t.filter((function(e){var t=e.data,o=n.getViewport(t.viewportId),a=i._getReferenceLineControllable(o.id);return r!==o&&!0!==a})),w=0;w<m.length;++w){var E=m[w],y=E.data.viewportId,I=n.getViewport(y).getCamera(),b=I.viewPlaneNormal;if(au().normalize(b),!Y.utilities.isEqual(o,b,.01)&&!Y.utilities.isOpposite(o,b,.01)){for(var C=!1,T=0;T<l.length;++T){var _=l[T].data.viewportId,O=n.getViewport(_).getCamera();Y.utilities.isEqual(O.viewPlaneNormal,I.viewPlaneNormal,.01)&&Y.utilities.isEqual(O.position,I.position,1)&&(C=!0)}C||l.push(E)}}for(var D=i._getAnnotationsForViewportsWithDifferentCameras(e,t),S=function(e){var t=D[e];if(!0===l.find((function(e){return e===t})))return"continue";var r=t.data.viewportId,a=n.getViewport(r).getCamera(),i=a.viewPlaneNormal;if(au().normalize(i),Y.utilities.isEqual(o,i,.01)||Y.utilities.isOpposite(o,i,.01))return"continue";for(var c=!1,s=0;s<l.length;++s){var d=l[s].data.viewportId,u=n.getViewport(d).getCamera();Y.utilities.isEqual(u.viewPlaneNormal,a.viewPlaneNormal,.01)&&Y.utilities.isEqual(u.position,a.position,1)&&(c=!0)}c||l.push(t)},x=0;x<D.length;++x)S(x);return l})),Q(la(i),"_checkIfViewportsRenderingSameScene",(function(e,t){var n=e.getActors(),r=t.getActors(),o=!0;return n.forEach((function(e){n.length===r.length&&void 0!==r.find((function(t){return t.uid===e.uid}))||(o=!1)})),o})),Q(la(i),"_jump",(function(e,t){ze.isInteractingWithTool=!0;var n=e.viewport,r=e.renderingEngine,o=i._getAnnotations(e),a=[0,0,0];au().subtract(t,i.toolCenter,a);var l=i._getAnnotationsForViewportsWithDifferentCameras(e,o).filter((function(e){var t=e.data,o=r.getViewport(t.viewportId),a=i._checkIfViewportsRenderingSameScene(n,o);return i._getReferenceLineControllable(o.id)&&i._getReferenceLineDraggableRotatable(o.id)&&a}));return 0===l.length?(ze.isInteractingWithTool=!1,!1):(i._applyDeltaShiftToSelectedViewportCameras(r,l,a),ze.isInteractingWithTool=!1,!0)})),Q(la(i),"_activateModify",(function(e){var t;ze.isInteractingWithTool=!(null!==(t=i.configuration.mobile)&&void 0!==t&&t.enabled),e.addEventListener(J.MOUSE_UP,i._endCallback),e.addEventListener(J.MOUSE_DRAG,i._dragCallback),e.addEventListener(J.MOUSE_CLICK,i._endCallback),e.addEventListener(J.TOUCH_END,i._endCallback),e.addEventListener(J.TOUCH_DRAG,i._dragCallback),e.addEventListener(J.TOUCH_TAP,i._endCallback)})),Q(la(i),"_deactivateModify",(function(e){ze.isInteractingWithTool=!1,e.removeEventListener(J.MOUSE_UP,i._endCallback),e.removeEventListener(J.MOUSE_DRAG,i._dragCallback),e.removeEventListener(J.MOUSE_CLICK,i._endCallback),e.removeEventListener(J.TOUCH_END,i._endCallback),e.removeEventListener(J.TOUCH_DRAG,i._dragCallback),e.removeEventListener(J.TOUCH_TAP,i._endCallback)})),Q(la(i),"_endCallback",(function(e){var t=e.detail.element;i.editData.annotation.data.handles.activeOperation=null,i.editData.annotation.data.activeViewportIds=[],i._deactivateModify(t),Xl(t),i.editData=null;var n=(0,Y.getEnabledElement)(t).renderingEngine,r=Ks(t,i.getToolName(),!1);na(n,r)})),Q(la(i),"_dragCallback",(function(e){var t=e.detail,n=t.deltaPoints.world;if(!(Math.abs(n[0])<.001&&Math.abs(n[1])<.001&&Math.abs(n[2])<.001)){var r=t.element,o=(0,Y.getEnabledElement)(r),a=o.renderingEngine,l=o.viewport,c=i._getAnnotations(o),s=i.filterInteractableAnnotationsForElement(r,c)[0];if(s){var d=s.data.handles,u=e.detail.currentPoints.canvas;if(1===d.activeOperation){var v=i._getAnnotationsForViewportsWithDifferentCameras(o,c).filter((function(e){var t=e.data,n=a.getViewport(t.viewportId),r=i._getReferenceLineControllable(n.id),o=i._getReferenceLineDraggableRotatable(n.id);return!0===r&&!0===o&&s.data.activeViewportIds.find((function(e){return e===n.id}))}));i._applyDeltaShiftToSelectedViewportCameras(a,v,n)}else if(2===d.activeOperation){var f=i._getAnnotationsForViewportsWithDifferentCameras(o,c).filter((function(e){var t=e.data,n=a.getViewport(t.viewportId),r=i._getReferenceLineControllable(n.id),o=i._getReferenceLineDraggableRotatable(n.id);return!0===r&&!0===o})),g=wc.vec2.create(),h=wc.vec2.create(),p=[i.toolCenter[0],i.toolCenter[1],i.toolCenter[2]],m=l.worldToCanvas(p),w=t.currentPoints.canvas,E=wc.vec2.create();wc.vec2.sub(E,w,t.deltaPoints.canvas),wc.vec2.sub(g,E,m),wc.vec2.sub(h,w,m);var y=wc.vec2.angle(g,h);i._isClockWise(m,E,w)&&(y*=-1),y=Math.round(100*y)/100;var I=l.getCamera().viewPlaneNormal,b=tg().buildFromRadian().translate(p[0],p[1],p[2]).rotate(y,I).translate(-p[0],-p[1],-p[2]).matrix,C=[];f.forEach((function(e){var t=e.data;t.handles.toolCenter=p;var n=a.getViewport(t.viewportId),r=n.getCamera(),o=r.viewUp,i=r.position,l=r.focalPoint;o[0]+=i[0],o[1]+=i[1],o[2]+=i[2],wc.vec3.transformMat4(l,l,b),wc.vec3.transformMat4(i,i,b),wc.vec3.transformMat4(o,o,b),o[0]-=i[0],o[1]-=i[1],o[2]-=i[2],n.setCamera({position:i,viewUp:o,focalPoint:l}),C.push(n.id)})),a.renderViewports(C)}else if(3===d.activeOperation){var T=i._getAnnotationsForViewportsWithDifferentCameras(o,c).filter((function(e){var t=e.data,n=a.getViewport(t.viewportId),r=i._getReferenceLineControllable(n.id),o=i._getReferenceLineSlabThicknessControlsOn(n.id);return!0===r&&!0===o&&s.data.activeViewportIds.find((function(e){return e===n.id}))}));if(0===T.length)return;var _=i._filterViewportWithSameOrientation(o,T[0],c),O=[];O.push(l.id),_.forEach((function(e){var r=e.data,o=a.getViewport(r.viewportId),c=o.getCamera().viewPlaneNormal,d=au().dot(n,c),v=xr(c);if(au().multiplyScalar(v,d),Math.abs(v[0])>.001||Math.abs(v[1])>.001||Math.abs(v[2])>.001){var f=Math.sqrt(v[0]*v[0]+v[1]*v[1]+v[2]*v[2]),g=t.lastPoints.world,h=[0,0,0],p=[i.toolCenter[0],i.toolCenter[1],i.toolCenter[2]];if(!i._getReferenceLineDraggableRotatable(o.id)){var m=i.editData.annotation.data.handles.rotationPoints.filter((function(e){return e[1].uid===o.id}));if(2===m.length){var w=l.canvasToWorld(m[0][3]),E=l.canvasToWorld(m[1][3]);au().add(w,E,p),au().multiplyScalar(p,.5)}}au().subtract(g,p,h);var y=au().dot(h,c),I=xr(c);au().multiplyScalar(I,y);var b=[I[0],I[1],I[2]];wc.vec3.normalize(b,b);var C=[v[0],v[1],v[2]];wc.vec3.normalize(C,C);var T=o.getSlabThickness();Y.utilities.isOpposite(b,C,.001)?T-=f:T+=f,T=Math.abs(T),T=Math.max(ng.MINIMUM_SLAB_THICKNESS,T),i._pointNearReferenceLine(s,u,6,o)&&(T=ng.MINIMUM_SLAB_THICKNESS),Ar(o.id,a.id).getToolInstance(i.getToolName()).setSlabThickness(o,T),O.push(o.id)}})),a.renderViewports(O)}}}})),Q(la(i),"_pointNearReferenceLine",(function(e,t,n,r){for(var o=e.data.handles.rotationPoints,a=0;a<o.length-1;++a){var l=o[a][1];if(l.id===r.id&&i._getReferenceLineControllable(l.id)){var c={start:{x:o[a][2][0],y:o[a][2][1]},end:{x:o[a][3][0],y:o[a][3][1]}},s=ld([c.start.x,c.start.y],[c.end.x,c.end.y],[t[0],t[1]]),d={start:{x:o[a+1][2][0],y:o[a+1][2][1]},end:{x:o[a+1][3][0],y:o[a+1][3][1]}},u=ld([d.start.x,d.start.y],[d.end.x,d.end.y],[t[0],t[1]]);if(s<=n||u<=n)return!0;a++}}return!1})),i._getReferenceLineColor=(null===(e=l.configuration)||void 0===e?void 0:e.getReferenceLineColor)||rg,i._getReferenceLineControllable=(null===(t=l.configuration)||void 0===t?void 0:t.getReferenceLineControllable)||og,i._getReferenceLineDraggableRotatable=(null===(n=l.configuration)||void 0===n?void 0:n.getReferenceLineDraggableRotatable)||ag,i._getReferenceLineSlabThicknessControlsOn=(null===(a=l.configuration)||void 0===a?void 0:a.getReferenceLineSlabThicknessControlsOn)||ig,i}return Z(o,[{key:"onSetToolActive",value:function(){var e=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(e),this._subscribeToViewportNewVolumeSet(e),this.computeToolCenter(e)}},{key:"onSetToolPassive",value:function(){var e=this._getViewportsInfo();this.computeToolCenter(e)}},{key:"onSetToolEnabled",value:function(){var e=this._getViewportsInfo();this.computeToolCenter(e)}},{key:"onSetToolDisabled",value:function(){var e=this,t=this._getViewportsInfo();this._unsubscribeToViewportNewVolumeSet(t),t.forEach((function(t){var n=t.renderingEngineId,r=t.viewportId,o=(0,Y.getEnabledElementByIds)(r,n);if(o){var a=e._getAnnotations(o);null!=a&&a.length&&a.forEach((function(e){rt(e.annotationUID)}))}}))}},{key:"getHandleNearImagePoint",value:function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=this._getRotationHandleNearImagePoint(o,t,n,r);return null!==a||null!==(a=this._getSlabThicknessHandleNearImagePoint(o,t,n,r))?a:void 0}},{key:"_unsubscribeToViewportNewVolumeSet",value:function(e){var t=this;e.forEach((function(e){var n=e.viewportId,r=e.renderingEngineId;(0,Y.getEnabledElementByIds)(n,r).viewport.element.removeEventListener(Y.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,t._onNewVolume)}))}},{key:"_subscribeToViewportNewVolumeSet",value:function(e){var t=this;e.forEach((function(e){var n=e.viewportId,r=e.renderingEngineId;(0,Y.getEnabledElementByIds)(n,r).viewport.element.addEventListener(Y.Enums.Events.VOLUME_VIEWPORT_NEW_VOLUME,t._onNewVolume)}))}},{key:"_autoPanViewportIfNecessary",value:function(e,t){var n,r=t.getViewport(e),o=r.canvas,a=o.clientWidth,i=o.clientHeight,l=r.canvasToWorld([0,0]),c=r.canvasToWorld([a,i]),s=r.canvasToWorld([a,0]),d=r.canvasToWorld([0,i]),u=Math.min(l[0],c[0],s[0],d[0]),v=Math.max(l[0],c[0],s[0],d[0]),f=Math.min(l[1],c[1],s[1],d[1]),g=Math.max(l[1],c[1],s[1],d[1]),h=Math.min(l[2],c[2],s[2],d[2]),p=Math.max(l[2],c[2],s[2],d[2]),m=this.configuration.autoPan.panSize;if(this.toolCenter[0]<u-lg)n=[u-this.toolCenter[0]+m,0,0];else if(this.toolCenter[0]>v+lg)n=[v-this.toolCenter[0]-m,0,0];else if(this.toolCenter[1]<f-lg)n=[0,f-this.toolCenter[1]+m,0];else if(this.toolCenter[1]>g+lg)n=[0,g-this.toolCenter[1]-m,0];else if(this.toolCenter[2]<h-lg)n=[0,0,h-this.toolCenter[2]+m];else{if(!(this.toolCenter[2]>p+lg))return;n=[0,0,p-this.toolCenter[2]-m]}var w=r.getCamera(),E=w.focalPoint,y=w.position,I=[y[0]-n[0],y[1]-n[1],y[2]-n[2]],b=[E[0]-n[0],E[1]-n[1],E[2]-n[2]];r.setCamera({focalPoint:b,position:I}),r.render()}},{key:"setSlabThickness",value:function(e,t){var n,r=this.configuration.filterActorUIDsToSetSlabThickness;r&&r.length>0&&(n=r);var o=this.configuration.slabThicknessBlendMode;t===ng.MINIMUM_SLAB_THICKNESS&&(o=Y.Enums.BlendModes.COMPOSITE),e.setBlendMode(o,n,!1),e.setSlabThickness(t,n)}},{key:"_isClockWise",value:function(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])>0}},{key:"_applyDeltaShiftToSelectedViewportCameras",value:function(e,t,n){var r=this;t.forEach((function(t){r._applyDeltaShiftToViewportCamera(e,t,n)}))}},{key:"_applyDeltaShiftToViewportCamera",value:function(e,t,n){var r=t.data,o=e.getViewport(r.viewportId),a=o.getCamera(),i=a.viewPlaneNormal,l=au().dot(n,i),c=xr(i);if(au().multiplyScalar(c,l),Math.abs(c[0])>.001||Math.abs(c[1])>.001||Math.abs(c[2])>.001){var s=[0,0,0],d=[0,0,0];au().add(a.focalPoint,c,s),au().add(a.position,c,d),o.setCamera({focalPoint:s,position:d}),o.render()}}},{key:"_getRotationHandleNearImagePoint",value:function(e,t,n,r){for(var o=t.data,a=o.handles.rotationPoints,i=0;i<a.length;i++){var l=a[i][0],c=a[i][1];if(this._getReferenceLineControllable(c.id)&&this._getReferenceLineDraggableRotatable(c.id)){var s=e.worldToCanvas(l);if(wc.vec2.distance(n,s)<r)return o.handles.activeOperation=2,this.editData={annotation:t},l}}return null}},{key:"_getSlabThicknessHandleNearImagePoint",value:function(e,t,n,r){for(var o=t.data,a=o.handles.slabThicknessPoints,i=0;i<a.length;i++){var l=a[i][0],c=a[i][1];if(this._getReferenceLineControllable(c.id)&&this._getReferenceLineSlabThicknessControlsOn(c.id)){var s=e.worldToCanvas(l);if(wc.vec2.distance(n,s)<r)return o.handles.activeOperation=3,o.activeViewportIds=[c.id],this.editData={annotation:t},l}}return null}},{key:"_pointNearTool",value:function(e,t,n,r){for(var o=this,a=(0,Y.getEnabledElement)(e).viewport.canvas,i=a.clientWidth,l=a.clientHeight,c=Math.sqrt(i*i+l*l),s=t.data,d=s.handles.rotationPoints,u=s.handles.slabThicknessPoints,v=[],f=0;f<d.length-1;++f){var g=d[f][1],h=this._getReferenceLineControllable(g.id),p=this._getReferenceLineDraggableRotatable(g.id);if(h&&p){var m={start:{x:d[f][2][0],y:d[f][2][1]},end:{x:d[f][3][0],y:d[f][3][1]}},w=ld([m.start.x,m.start.y],[m.end.x,m.end.y],[n[0],n[1]]),E={start:{x:d[f+1][2][0],y:d[f+1][2][1]},end:{x:d[f+1][3][0],y:d[f+1][3][1]}},y=ld([E.start.x,E.start.y],[E.end.x,E.end.y],[n[0],n[1]]);(w<=r||y<=r)&&(v.push(g.id),s.handles.activeOperation=1),f++}}for(var I=function(e){var t=u[e][1];if(v.find((function(e){return e===t.id})))return b=e,"continue";var a=o._getReferenceLineControllable(t.id),i=o._getReferenceLineSlabThicknessControlsOn(t.id);if(!a||!i)return b=e,"continue";var l=u[e][2],d=u[e][3],f=wc.vec2.create();wc.vec2.add(f,l,d),wc.vec2.scale(f,f,.5);var g=wc.vec2.create();wc.vec2.subtract(g,l,f),wc.vec2.normalize(g,g);var h=wc.vec2.create();wc.vec2.scale(h,g,.05*c);var p=wc.vec2.create(),m=wc.vec2.create();wc.vec2.add(p,f,h),wc.vec2.subtract(m,f,h);var w={start:{x:p[0],y:p[1]},end:{x:l[0],y:l[1]}},E=ld([w.start.x,w.start.y],[w.end.x,w.end.y],[n[0],n[1]]),y={start:{x:m[0],y:m[1]},end:{x:d[0],y:d[1]}},I=ld([y.start.x,y.start.y],[y.end.x,y.end.y],[n[0],n[1]]);(E<=r||I<=r)&&(v.push(t.id),s.handles.activeOperation=null),e++,b=e},b=0;b<u.length-1;++b)I(b);return s.activeViewportIds=[].concat(v),this.editData={annotation:t},1===s.handles.activeOperation}}]),o}(od);Q(cg,"toolName",void 0),cg.toolName="Crosshairs";var sg=cg;var dg=Y.CONSTANTS.EPSILON,ug=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{sourceViewportId:""}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",{}),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"_init",(function(){var t=(0,Y.getRenderingEngines)()[0];if(t){var n=t.getViewports();n=Gs(n,e.getToolName());var r=t.getViewport(e.configuration.sourceViewportId);if(r&&r.getImageData()){var o=r.element,a=r.getCamera(),i=a.viewUp,l=a.viewPlaneNormal,c=Y.utilities.getViewportImageCornersInWorld(r),s=e.editData.annotation,d=r.getFrameOfReferenceUID();if(s)e.editData.annotation.data.handles.points=c;else{var u={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(l),viewUp:xr(i),FrameOfReferenceUID:d,referencedImageId:null},data:{handles:{points:c}}};tt(u,o),s=u}e.editData={sourceViewport:r,renderingEngine:t,annotation:s},na(t,n.filter((function(e){return e.id!==r.id})).map((function(e){return e.id})))}}})),Q(la(e),"onSetToolEnabled",(function(){e._init()})),Q(la(e),"onCameraModified",(function(t){e._init()})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=t.viewport,i=e.editData,l=i.annotation,c=i.sourceViewport,s=!1;if(!c)return s;if(c.id===a.id)return s;if(!l||null==l||null===(r=l.data)||void 0===r||null===(o=r.handles)||void 0===o||!o.points)return s;var d={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},u=l.data.handles.points[0],v=l.data.handles.points[1],f=l.data.handles.points[2],g=l.data.handles.points[3],h=a.getCamera(),p=h.focalPoint,m=h.viewPlaneNormal,w=c.getCamera().viewPlaneNormal;if(e.isParallel(m,w))return s;var E=Y.utilities.planar.planeEquation(m,p),y=[u,f,v,g],I=[u,v,f,g],b=y,C=wc.vec3.subtract(wc.vec3.create(),y[0],y[1]);C=wc.vec3.normalize(wc.vec3.create(),C);var T=wc.vec3.subtract(wc.vec3.create(),y[2],y[0]);T=wc.vec3.normalize(wc.vec3.create(),T);var _=wc.vec3.cross(wc.vec3.create(),C,T);if(e.isParallel(_,m))return s;e.isPerpendicular(C,m)&&(b=I);var O=Y.utilities.planar.linePlaneIntersection(b[0],b[1],E),D=Y.utilities.planar.linePlaneIntersection(b[2],b[3],E),S=l.annotationUID;d.annotationUID=S;var x=e.getStyle("lineWidth",d,l),k=e.getStyle("lineDash",d,l),M=e.getStyle("color",d,l),R=e.getStyle("shadow",d,l),P=[O,D].map((function(e){return a.worldToCanvas(e)})),N="".concat(S,"-line");return Vc(n,S,"1",P[0],P[1],{color:M,width:x,lineDash:k,shadow:R},N),!0})),Q(la(e),"isPerpendicular",(function(e,t){var n=wc.vec3.dot(e,t);return Math.abs(n)<dg})),e}return Z(o,[{key:"isParallel",value:function(e,t){return Math.abs(wc.vec3.dot(e,t))>1-dg}}]),o}(ed);Q(ug,"toolName",void 0),ug.toolName="ReferenceLines";var vg=ug;function fg(e,t,n,r){var o=wc.vec3.create();wc.vec3.cross(o,t,e);var a=wc.vec3.fromValues.apply(wc.vec3,xr(n)),i=wc.vec3.fromValues.apply(wc.vec3,xr(r)),l=wc.vec3.create();wc.vec3.subtract(l,a,i);var c=wc.vec3.length(l);if(c<1e-4)return{worldWidth:0,worldHeight:0};var s=wc.vec3.dot(l,o)/(c*wc.vec3.length(o));return{worldWidth:Math.sqrt(1-s*s)*c,worldHeight:s*c}}var gg=Y.utilities.transformWorldToIndex,hg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,centerPointRadius:0}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",!1),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=r.canvas,l=(0,Y.getEnabledElement)(o),c=l.viewport,s=l.renderingEngine;e.isDrawing=!0;var d=c.getCamera(),u=d.viewPlaneNormal,v=d.viewUp,f=e.getReferencedImageId(c,a,u,v),g=c.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(u),viewUp:xr(v),FrameOfReferenceUID:g,referencedImageId:f},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[xr(a),xr(a),xr(a),xr(a)],activeHandleIndex:null},cachedStats:{},initialRotation:c.getRotation()}};tt(h,o);var p=Ks(o,e.getToolName());return e.editData={annotation:h,viewportIdsToRender:p,centerCanvas:i,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(s,p),h})),Q(la(e),"isPointNearTool",(function(t,n,r,o){var a=(0,Y.getEnabledElement)(t).viewport,i=Bn(fs(n.data.handles.points.map((function(e){return a.worldToCanvas(e)}))),2),l=i[0],c=i[1],s={left:Math.min(l[0],c[0])+o/2,top:Math.min(l[1],c[1])+o/2,width:Math.abs(l[0]-c[0])-o,height:Math.abs(l[1]-c[1])-o},d={left:Math.min(l[0],c[0])-o/2,top:Math.min(l[1],c[1])-o/2,width:Math.abs(l[0]-c[0])+o,height:Math.abs(l[1]-c[1])+o},u=e._pointInEllipseCanvas(s,r);return!(!e._pointInEllipseCanvas(d,r)||u)})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},Ql(r),e._activateModify(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),t.preventDefault()})),Q(la(e),"handleSelectedCallback",(function(t,n,r){var o=t.detail.element,a=n.data;n.highlighted=!0;var i,l,c,s,d,u=!1;if(r.worldPosition)u=!0;else{var v=a.handles.points,f=(0,Y.getEnabledElement)(o).viewport.worldToCanvas;i=v.findIndex((function(e){return e===r}));var g=v.map(f);d=g[i],c=Math.abs(g[2][0]-g[3][0]),s=Math.abs(g[0][1]-g[1][1]),l=[(g[2][0]+g[3][0])/2,(g[0][1]+g[1][1])/2]}var h=Ks(o,e.getToolName());e.editData={annotation:n,viewportIdsToRender:h,handleIndex:i,canvasWidth:c,canvasHeight:s,centerCanvas:l,originalHandleCanvas:d,movingTextBox:u},e._activateModify(o),Ql(o);var p=(0,Y.getEnabledElement)(o).renderingEngine;na(p,h),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){o.highlighted=!1,c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(e.editData=null,e.isDrawing=!1,e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}}})),Q(la(e),"_dragDrawCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=n.currentPoints.canvas,a=(0,Y.getEnabledElement)(r),i=a.renderingEngine,l=a.viewport.canvasToWorld,c=e.editData,s=c.annotation,d=c.viewportIdsToRender,u=c.centerCanvas,v=s.data,f=Math.abs(o[0]-u[0]),g=Math.abs(o[1]-u[1]),h=[u[0],u[1]-g],p=[u[0],u[1]+g],m=[u[0]-f,u[1]],w=[u[0]+f,u[1]];v.handles.points=[l(h),l(p),l(m),l(w)],s.invalidated=!0,e.editData.hasMoved=!0,na(i,d)})),Q(la(e),"_dragModifyCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else e._dragHandle(t),a.invalidated=!0;var g=(0,Y.getEnabledElement)(r).renderingEngine;na(g,i)})),Q(la(e),"_dragHandle",(function(t){var n=t.detail,r=n.element,o=(0,Y.getEnabledElement)(r).viewport.canvasToWorld,a=e.editData,i=a.annotation,l=a.canvasWidth,c=a.canvasHeight,s=a.handleIndex,d=a.centerCanvas,u=a.originalHandleCanvas,v=i.data.handles.points,f=n.currentPoints.canvas;if(0===s||1===s){var g=Math.abs(f[1]-d[1]),h=[d[0],d[1]-g],p=[d[0],d[1]+g];v[0]=o(h),v[1]=o(p);var m=l/2+(f[0]-u[0]),w=[d[0]-m,d[1]],E=[d[0]+m,d[1]];v[2]=o(w),v[3]=o(E)}else{var y=Math.abs(f[0]-d[0]),I=[d[0]-y,d[1]],b=[d[0]+y,d[1]];v[2]=o(I),v[3]=o(b);var C=c/2+(f[1]-u[1]),T=[d[0],d[1]-C],_=[d[0],d[1]+C];v[0]=o(T),v[1]=o(_)}})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragModifyCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragModifyCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragModifyCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragModifyCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragDrawCallback),t.addEventListener(J.MOUSE_MOVE,e._dragDrawCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragDrawCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragDrawCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragDrawCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragDrawCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f=c[v],g=f.annotationUID,h=f.data,p=h.handles,m=p.points,w=p.activeHandleIndex;u.annotationUID=g;var E,y=e.getStyle("lineWidth",u,f),I=e.getStyle("lineDash",u,f),b=e.getStyle("color",u,f),C=m.map((function(e){return i.worldToCanvas(e)})),T=Math.abs(i.getRotation()-(h.initialRotation||0));E=fs(90==T||270==T?[C[2],C[3],C[0],C[1]]:C);var _=e.configuration.centerPointRadius;if(h.cachedStats[s]&&void 0!==h.cachedStats[s].areaUnit?f.invalidated&&(e._throttledCalculateCachedStats(f,i,d,t),i instanceof Y.VolumeViewport&&function(){var e=f.metadata.referencedImageId;for(var t in h.cachedStats)t.startsWith("imageId")&&d.getStackViewports().find((function(t){var n=Y.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=Y.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n}))&&delete h.cachedStats[t]}()):(h.cachedStats[s]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null},e._calculateCachedStats(f,i,d,t)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;var O=void 0;if(xe(g)){ie(f)||e.editData||null===w||(O=[C[w]]),O&&Uc(n,g,"0",O,{color:b});var D="".concat(g,"-ellipse");if(Lc(n,g,"0",E[0],E[1],{color:b,lineDash:I,lineWidth:y},D),_>0&&Math.min(Math.abs(E[0][0]-E[1][0])/2,Math.abs(E[0][1]-E[1][1])/2)>3*_){var S=e._getCanvasEllipseCenter(C);Ac(n,g,"".concat("0","-center"),S,_,{color:b,lineDash:I,lineWidth:y})}a=!0;var x=vd(i,s),k=e._getTextLines(h,s,x);if(k&&0!==k.length){var M=void 0;h.handles.textBox.hasMoved||(M=sd(E),h.handles.textBox.worldPosition=i.canvasToWorld(M));var R=i.worldToCanvas(h.handles.textBox.worldPosition),P=Jc(n,g,"1",k,R,C,{},e.getLinkedTextBoxStyle(u,f)),N=P.x,A=P.y,L=P.width,U=P.height;h.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([N,A]),topRight:i.canvasToWorld([N+L,A]),bottomLeft:i.canvasToWorld([N,A+U]),bottomRight:i.canvasToWorld([N+L,A+U])}}}}return a})),Q(la(e),"_getTextLines",(function(e,t,n){var r=e.cachedStats[t],o=r.area,a=r.mean,i=r.stdDev,l=r.max,c=r.isEmptyArea,s=r.Modality,d=r.areaUnit,u=[],v=ud(s,n);if(o){var f=c?"Area: Oblique not supported":"Area: ".concat(o.toFixed(2)," ").concat(d,"²");u.push(f)}return a&&u.push("Mean: ".concat(a.toFixed(2)," ").concat(v)),l&&u.push("Max: ".concat(l.toFixed(2)," ").concat(v)),i&&u.push("Std Dev: ".concat(i.toFixed(2)," ").concat(v)),u})),Q(la(e),"_calculateCachedStats",(function(t,n,r,o){for(var a=t.data,i=o.viewportId,l=o.renderingEngineId,c=a.handles.points.map((function(e){return n.worldToCanvas(e)})),s=n.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=Bn(fs(c),2),f=v[0],g=v[1],h=n.canvasToWorld(f),p=n.canvasToWorld(g),m=a.cachedStats,w=Object.keys(m),E=h,y=p,I=0;I<w.length;I++){var b=w[I],C=e.getTargetIdImage(b,r);if(C){var T=C.dimensions,_=C.imageData,O=C.metadata,D=C.hasPixelSpacing,S=gg(_,E);S[0]=Math.floor(S[0]),S[1]=Math.floor(S[1]),S[2]=Math.floor(S[2]);var x=gg(_,y);x[0]=Math.floor(x[0]),x[1]=Math.floor(x[1]),x[2]=Math.floor(x[2]),e._isInsideVolume(S,x,T)?function(){var e=[[Math.min(S[0],x[0]),Math.max(S[0],x[0])],[Math.min(S[1],x[1]),Math.max(S[1],x[1])],[Math.min(S[2],x[2]),Math.max(S[2],x[2])]],t={center:[(h[0]+p[0])/2,(h[1]+p[1])/2,(h[2]+p[2])/2],xRadius:Math.abs(h[0]-p[0])/2,yRadius:Math.abs(h[1]-p[1])/2,zRadius:Math.abs(h[2]-p[2])/2},n=fg(d,u,E,y),r=n.worldWidth,o=n.worldHeight,a=0===r&&0===o,i=Math.abs(Math.PI*(r/2)*(o/2)),l=0,c=0,s=0,v=-1/0;ls(_,(function(e,n){return gs(t,e)}),(function(e){var t=e.value;t>v&&(v=t),c+=t,l+=1}),e),c/=l,ls(_,(function(e,n){return gs(t,e)}),(function(e){var t=e.value-c;s+=t*t}),e),s/=l,s=Math.sqrt(s),m[b]={Modality:O.Modality,area:i,mean:c,max:v,stdDev:s,isEmptyArea:a,areaUnit:D?"mm":"px"}}():(e.isHandleOutsideImage=!0,m[b]={Modality:O.Modality})}}t.invalidated=!1;var k=J.ANNOTATION_MODIFIED,M={annotation:t,viewportId:i,renderingEngineId:l};return(0,Y.triggerEvent)(Y.eventTarget,k,M),m})),Q(la(e),"_isInsideVolume",(function(e,t,n){return Y.utilities.indexWithinDimensions(e,n)&&Y.utilities.indexWithinDimensions(t,n)})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o,[{key:"_pointInEllipseCanvas",value:function(e,t){var n=e.width/2,r=e.height/2;if(n<=0||r<=0)return!1;var o=[e.left+n,e.top+r],a=[t[0]-o[0],t[1]-o[1]];return a[0]*a[0]/(n*n)+a[1]*a[1]/(r*r)<=1}},{key:"_getCanvasEllipseCenter",value:function(e){var t=Bn(e,4),n=t[0],r=t[1],o=t[2],a=t[3],i=[o[0],r[1]],l=[a[0],n[1]];return[(i[0]+l[0])/2,(i[1]+l[1])/2]}}]),o}(od);Q(hg,"toolName",void 0),hg.toolName="EllipticalROI";var pg=hg;function mg(e){var t=Bn(e,2);return ru(t[0],t[1])}function wg(e){var t=Bn(e,2),n=t[0],r=ru(n,t[1]);return[[n[0]-r,n[1]-r],[n[0]+r,n[1]+r]]}var Eg=Y.utilities.transformWorldToIndex,yg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,centerPointRadius:0}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",!1),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(r.canvas,(0,Y.getEnabledElement)(o)),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=l.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:f,referencedImageId:v},data:{label:"",handles:{textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},points:[xr(a),xr(a)],activeHandleIndex:null},cachedStats:{}}};tt(g,o);var h=Ks(o,e.getToolName());return e.editData={annotation:g,viewportIdsToRender:h,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(c,h),g})),Q(la(e),"isPointNearTool",(function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=t.data.handles.points.map((function(e){return o.worldToCanvas(e)})),i=mg(a),l=mg([a[0],n]);return Math.abs(l-i)<r/2})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},Ql(r),e._activateModify(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),t.preventDefault()})),Q(la(e),"handleSelectedCallback",(function(t,n,r){var o=t.detail.element,a=n.data;n.highlighted=!0;var i,l=!1;r.worldPosition?l=!0:i=a.handles.points.findIndex((function(e){return e===r}));var c=Ks(o,e.getToolName());e.editData={annotation:n,viewportIdsToRender:c,handleIndex:i,movingTextBox:l},e._activateModify(o),Ql(o);var s=(0,Y.getEnabledElement)(o).renderingEngine;na(s,c),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){o.highlighted=!1,c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(e.editData=null,e.isDrawing=!1,e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}}})),Q(la(e),"_dragDrawCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=n.currentPoints.canvas,a=(0,Y.getEnabledElement)(r),i=a.renderingEngine,l=a.viewport.canvasToWorld,c=e.editData,s=c.annotation,d=c.viewportIdsToRender,u=s.data;u.handles.points=[u.handles.points[0],l(o)],s.invalidated=!0,e.editData.hasMoved=!0,na(i,d)})),Q(la(e),"_dragModifyCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else e._dragHandle(t),a.invalidated=!0;var g=(0,Y.getEnabledElement)(r).renderingEngine;na(g,i)})),Q(la(e),"_dragHandle",(function(t){var n=t.detail,r=n.element,o=(0,Y.getEnabledElement)(r).viewport,a=o.canvasToWorld,i=o.worldToCanvas,l=e.editData,c=l.annotation,s=l.handleIndex,d=c.data.handles.points,u=d.map((function(e){return i(e)})),v=n.currentPoints.canvas;if(0===s){var f=v[0]-u[0][0],g=v[1]-u[0][1],h=v,p=[u[1][0]+f,u[1][1]+g];d[0]=a(h),d[1]=a(p)}else d[1]=a(v)})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragModifyCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragModifyCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragModifyCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragModifyCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragDrawCallback),t.addEventListener(J.MOUSE_MOVE,e._dragDrawCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragDrawCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragDrawCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragDrawCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragDrawCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f=c[v],g=f.annotationUID,h=f.data,p=h.handles,m=p.points,w=p.activeHandleIndex;u.annotationUID=g;var E=e.getStyle("lineWidth",u,f),y=e.getStyle("lineDash",u,f),I=e.getStyle("color",u,f),b=m.map((function(e){return i.worldToCanvas(e)})),C=b[0],T=mg(b),_=wg(b),O=e.configuration.centerPointRadius;if(h.cachedStats[s]&&void 0!==h.cachedStats[s].areaUnit?f.invalidated&&(e._throttledCalculateCachedStats(f,i,d,t),i instanceof Y.VolumeViewport&&function(){var e=f.metadata.referencedImageId;for(var t in h.cachedStats)t.startsWith("imageId")&&d.getStackViewports().find((function(t){var n=Y.utilities.imageIdToURI(e),r=t.hasImageURI(n),o=Y.utilities.imageIdToURI(t.getCurrentImageId());return r&&o!==n}))&&delete h.cachedStats[t]}()):(h.cachedStats[s]={Modality:null,area:null,max:null,mean:null,stdDev:null,areaUnit:null,radius:null,radiusUnit:null,perimeter:null},e._calculateCachedStats(f,i,d,t)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;var D=void 0;if(xe(g)){ie(f)||e.editData||null===w||(D=[b[w]]),D&&Uc(n,g,"0",D,{color:I});var S="".concat(g,"-circle");Ac(n,g,"0",C,T,{color:I,lineDash:y,lineWidth:E},S),O>0&&T>3*O&&Ac(n,g,"".concat("0","-center"),C,O,{color:I,lineDash:y,lineWidth:E}),a=!0;var x=vd(i,s),k=e._getTextLines(h,s,x);if(k&&0!==k.length){var M=void 0;h.handles.textBox.hasMoved||(M=sd(_),h.handles.textBox.worldPosition=i.canvasToWorld(M));var R=i.worldToCanvas(h.handles.textBox.worldPosition),P=Jc(n,g,"1",k,R,b,{},e.getLinkedTextBoxStyle(u,f)),N=P.x,A=P.y,L=P.width,U=P.height;h.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([N,A]),topRight:i.canvasToWorld([N+L,A]),bottomLeft:i.canvasToWorld([N,A+U]),bottomRight:i.canvasToWorld([N+L,A+U])}}}}return a})),Q(la(e),"_getTextLines",(function(e,t,n){var r=e.cachedStats[t],o=r.radius,a=r.radiusUnit,i=r.area,l=r.mean,c=r.stdDev,s=r.max,d=r.isEmptyArea,u=r.Modality,v=r.areaUnit,f=[],g=ud(u,n);if(o){var h=d?"Radius: Oblique not supported":"Radius: ".concat(o.toFixed(2)," ").concat(a);f.push(h)}if(i){var p=d?"Area: Oblique not supported":"Area: ".concat(i.toFixed(2)," ").concat(v,"²");f.push(p)}return l&&f.push("Mean: ".concat(l.toFixed(2)," ").concat(g)),s&&f.push("Max: ".concat(s.toFixed(2)," ").concat(g)),c&&f.push("Std Dev: ".concat(c.toFixed(2)," ").concat(g)),f})),Q(la(e),"_calculateCachedStats",(function(t,n,r,o){for(var a=t.data,i=o.viewportId,l=o.renderingEngineId,c=a.handles.points.map((function(e){return n.worldToCanvas(e)})),s=n.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=Bn(wg(c),2),f=v[0],g=v[1],h=n.canvasToWorld(f),p=n.canvasToWorld(g),m=a.cachedStats,w=Object.keys(m),E=h,y=p,I=0;I<w.length;I++){var b=w[I],C=e.getTargetIdImage(b,r);if(C){var T=C.dimensions,_=C.imageData,O=C.metadata,D=C.hasPixelSpacing,S=Eg(_,E);S[0]=Math.floor(S[0]),S[1]=Math.floor(S[1]),S[2]=Math.floor(S[2]);var x=Eg(_,y);x[0]=Math.floor(x[0]),x[1]=Math.floor(x[1]),x[2]=Math.floor(x[2]),e._isInsideVolume(S,x,T)?function(){var e=[[Math.min(S[0],x[0]),Math.max(S[0],x[0])],[Math.min(S[1],x[1]),Math.max(S[1],x[1])],[Math.min(S[2],x[2]),Math.max(S[2],x[2])]],t={center:[(h[0]+p[0])/2,(h[1]+p[1])/2,(h[2]+p[2])/2],xRadius:Math.abs(h[0]-p[0])/2,yRadius:Math.abs(h[1]-p[1])/2,zRadius:Math.abs(h[2]-p[2])/2},n=fg(d,u,E,y),r=n.worldWidth,o=n.worldHeight,a=0===r&&0===o,i=Math.abs(Math.PI*(r/2)*(o/2)),l=0,c=0,s=0,v=-1/0;ls(_,(function(e,n){return gs(t,e)}),(function(e){var t=e.value;t>v&&(v=t),c+=t,l+=1}),e),c/=l,ls(_,(function(e,n){return gs(t,e)}),(function(e){var t=e.value-c;s+=t*t}),e),s/=l,s=Math.sqrt(s),m[b]={Modality:O.Modality,area:i,mean:c,max:v,stdDev:s,isEmptyArea:a,areaUnit:D?"mm":"px",radius:r/2,radiusUnit:D?"mm":"px",perimeter:2*Math.PI*(r/2)}}():(e.isHandleOutsideImage=!0,m[b]={Modality:O.Modality})}}t.invalidated=!1;var k=J.ANNOTATION_MODIFIED,M={annotation:t,viewportId:i,renderingEngineId:l};return(0,Y.triggerEvent)(Y.eventTarget,k,M),m})),Q(la(e),"_isInsideVolume",(function(e,t,n){return Y.utilities.indexWithinDimensions(e,n)&&Y.utilities.indexWithinDimensions(t,n)})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o)}(od);Q(yg,"toolName",void 0),yg.toolName="CircleROI";var Ig=yg;var bg=Y.utilities.transformWorldToIndex,Cg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"preventHandleOutsideImage",void 0),Q(la(e),"isPointNearTool",(function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=t.data.handles.points,i=o.worldToCanvas(a[0]),l=o.worldToCanvas(a[1]),c={start:{x:i[0],y:i[1]},end:{x:l[0],y:l[1]}},s=ld([c.start.x,c.start.y],[c.end.x,c.end.y],[n[0],n[1]]);return s<=r||(i=o.worldToCanvas(a[2]),l=o.worldToCanvas(a[3]),(s=ld([(c={start:{x:i[0],y:i[1]},end:{x:l[0],y:l[1]}}).start.x,c.start.y],[c.end.x,c.end.y],[n[0],n[1]]))<=r)})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},e._activateModify(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),Ql(r),t.preventDefault()})),Q(la(e),"handleSelectedCallback",(function(t,n,r){var o=t.detail.element,a=n.data;n.highlighted=!0;var i,l=!1;r.worldPosition?l=!0:i=a.handles.points.findIndex((function(e){return e===r}));var c=Ks(o,e.getToolName());Ql(o),e.editData={annotation:n,viewportIdsToRender:c,handleIndex:i,movingTextBox:l},e._activateModify(o);var s=(0,Y.getEnabledElement)(o).renderingEngine;na(s,c),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(void 0!==e.editData.handleIndex){var d=c.handles.points,u=wc.vec3.distance(d[0],d[1]);if(wc.vec3.distance(d[2],d[3])>u){var v=[xr(d[2]),xr(d[3])],f=xr(d[0]),g=xr(d[1]),h=wc.vec2.create();wc.vec2.set(h,v[1][0]-v[0][0],v[1][1]-v[1][0]);var p=wc.vec2.create();wc.vec2.set(p,-h[1],h[0]);var m,w=wc.vec2.create();wc.vec2.set(w,g[0]-f[0],g[1]-f[0]),m=wc.vec2.dot(w,p)>0?[f,g]:[g,f],c.handles.points=[v[0],v[1],m[0],m[1]]}}if(e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var E=J.ANNOTATION_COMPLETED,y={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,E,y)}e.editData=null,e.isDrawing=!1}})),Q(la(e),"_dragDrawCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.currentPoints,o=n.element,a=(0,Y.getEnabledElement)(o),i=a.renderingEngine,l=a.viewport,c=l.worldToCanvas,s=e.editData,d=s.annotation,u=s.viewportIdsToRender,v=s.handleIndex,f=d.data,g=r.world;f.handles.points[v]=xr(g);var h=f.handles.points.map(c),p={x:h[0][0],y:h[0][1]},m={x:h[1][0],y:h[1][1]},w=(h[2][0],h[2][1],h[3][0],h[3][1],wc.vec2.distance(h[0],h[1])/3),E=p.x-m.x,y=p.y-m.y,I=Math.sqrt(E*E+y*y),b=E/I,C=y/I,T=(p.x+m.x)/2,_=(p.y+m.y)/2,O=T+w*C,D=_-w*b,S=T-w*C,x=_+w*b;f.handles.points[2]=l.canvasToWorld([O,D]),f.handles.points[3]=l.canvasToWorld([S,x]),d.invalidated=!0,na(i,u),e.editData.hasMoved=!0})),Q(la(e),"_dragModifyCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=(0,Y.getEnabledElement)(r).renderingEngine,a=e.editData,i=a.annotation,l=a.viewportIdsToRender,c=a.handleIndex,s=a.movingTextBox,d=i.data;if(s){var u=n.deltaPoints.world,v=d.handles.textBox,f=v.worldPosition;f[0]+=u[0],f[1]+=u[1],f[2]+=u[2],v.hasMoved=!0}else if(void 0===c){var g=n.deltaPoints.world;d.handles.points.forEach((function(e){e[0]+=g[0],e[1]+=g[1],e[2]+=g[2]})),i.invalidated=!0}else e._dragModifyHandle(t),i.invalidated=!0;na(o,l)})),Q(la(e),"_dragModifyHandle",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=(0,Y.getEnabledElement)(o).viewport,i=e.editData,l=i.annotation,c=i.handleIndex,s=l.data,d=r.world,u=[a.worldToCanvas(s.handles.points[0]),a.worldToCanvas(s.handles.points[1]),a.worldToCanvas(s.handles.points[2]),a.worldToCanvas(s.handles.points[3])],v={start:{x:u[0][0],y:u[0][1]},end:{x:u[1][0],y:u[1][1]}},f={start:{x:u[2][0],y:u[2][1]},end:{x:u[3][0],y:u[3][1]}},g=xr(d),h=a.worldToCanvas(g);if(0===c||1===c){var p=u[0===c?1:0],m=wc.vec2.set(wc.vec2.create(),h[0]-p[0],h[1]-p[1]),w=wc.vec2.set(wc.vec2.create(),u[c][0]-p[0],u[c][1]-p[1]);wc.vec2.normalize(m,m),wc.vec2.normalize(w,w);var E={start:{x:p[0],y:p[1]},end:{x:h[0],y:h[1]}};if(e._movingLongAxisWouldPutItThroughShortAxis(E,f))return;var y=p,I=e._getSignedAngle(w,m),b=u[2][0],C=u[2][1],T=u[3][0],_=u[3][1];b-=y[0],C-=y[1],T-=y[0],_-=y[1];var O=b*Math.cos(I)-C*Math.sin(I),D=b*Math.sin(I)+C*Math.cos(I),S=T*Math.cos(I)-_*Math.sin(I),x=T*Math.sin(I)+_*Math.cos(I);b=O+y[0],C=D+y[1],T=S+y[0],_=x+y[1];var k=a.canvasToWorld([b,C]),M=a.canvasToWorld([T,_]);s.handles.points[c]=g,s.handles.points[2]=k,s.handles.points[3]=M}else{var R=2===c?3:2,P={longLineSegment:{start:v.start,end:v.end},shortLineSegment:{start:f.start,end:f.end}},N=wc.vec2.subtract(wc.vec2.create(),[P.longLineSegment.end.x,P.longLineSegment.end.y],[P.longLineSegment.start.x,P.longLineSegment.start.y]),A=wc.vec2.normalize(wc.vec2.create(),N),L=wc.vec2.subtract(wc.vec2.create(),[h[0],h[1]],[u[c][0],u[c][1]]),U=wc.vec2.length(L),V=e._getSignedAngle(A,L),B=Math.cos(V)*U,j=wc.vec2.scaleAndAdd(wc.vec2.create(),[u[R][0],u[R][1]],A,B);if(e._movingLongAxisWouldPutItThroughShortAxis({start:{x:h[0],y:h[1]},end:{x:j[0],y:j[1]}},{start:{x:P.longLineSegment.start.x,y:P.longLineSegment.start.y},end:{x:P.longLineSegment.end.x,y:P.longLineSegment.end.y}}))return;if(!qd([h[0],h[1]],[j[0],j[1]],[v.start.x,v.start.y],[v.end.x,v.end.y]))return;s.handles.points[R]=a.canvasToWorld(j),s.handles.points[c]=g}})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragDrawCallback),t.addEventListener(J.MOUSE_MOVE,e._dragDrawCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragDrawCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragDrawCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragDrawCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragDrawCallback)})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragModifyCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragModifyCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragModifyCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragModifyCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!0,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f=c[v],g=f.annotationUID,h=f.data,p=h.handles,m=p.points,w=p.activeHandleIndex,E=m.map((function(e){return i.worldToCanvas(e)}));u.annotationUID=g;var y=e.getStyle("lineWidth",u,f),I=e.getStyle("lineDash",u,f),b=e.getStyle("color",u,f),C=e.getStyle("shadow",u,f);if(h.cachedStats[s]&&void 0!==h.cachedStats[s].unit?f.invalidated&&e._throttledCalculateCachedStats(f,d,t):(h.cachedStats[s]={length:null,width:null,unit:null},e._calculateCachedStats(f,d,t)),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;var T=void 0;if(xe(g)){ie(f)||e.editData||null===w||(T=[E[w]]),T&&Uc(n,g,"0",T,{color:b});var _="".concat(g,"-line-1"),O="".concat(g,"-line-2");Vc(n,g,"0",E[0],E[1],{color:b,lineDash:I,lineWidth:y,shadow:C},_),Vc(n,g,"1",E[2],E[3],{color:b,lineDash:I,lineWidth:y,shadow:C},O),a=!0;var D=e._getTextLines(h,s);if(D&&0!==D.length){var S=void 0;h.handles.textBox.hasMoved||(S=sd(E),h.handles.textBox.worldPosition=i.canvasToWorld(S));var x=i.worldToCanvas(h.handles.textBox.worldPosition),k=Jc(n,g,"1",D,x,E,{},e.getLinkedTextBoxStyle(u,f)),M=k.x,R=k.y,P=k.width,N=k.height;h.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([M,R]),topRight:i.canvasToWorld([M+P,R]),bottomLeft:i.canvasToWorld([M,R+N]),bottomRight:i.canvasToWorld([M+P,R+N])}}}}return a})),Q(la(e),"_movingLongAxisWouldPutItThroughShortAxis",(function(e,t){var n=wc.vec2.create();wc.vec2.set(n,t.end.x-t.start.x,t.end.y-t.start.y),wc.vec2.normalize(n,n);var r={start:{x:t.start.x-10*n[0],y:t.start.y-10*n[1]},end:{x:t.end.x+10*n[0],y:t.end.y+10*n[1]}};return!qd([r.start.x,r.start.y],[r.end.x,r.end.y],[e.start.x,e.start.y],[e.end.x,e.end.y])})),Q(la(e),"_getTextLines",(function(e,t){var n=e.cachedStats[t],r=n.length,o=n.width,a=n.unit;if(void 0!==r)return["L: ".concat(r.toFixed(2)," ").concat(a),"W: ".concat(o.toFixed(2)," ").concat(a)]})),Q(la(e),"_calculateCachedStats",(function(t,n,r){for(var o=t.data,a=r.viewportId,i=r.renderingEngineId,l=o.handles.points[0],c=o.handles.points[1],s=o.handles.points[2],d=o.handles.points[3],u=o.cachedStats,v=Object.keys(u),f=0;f<v.length;f++){var g=v[f],h=e.getTargetIdImage(g,n);if(h){var p=h.imageData,m=h.dimensions,w=h.hasPixelSpacing,E=e._calculateLength(l,c),y=e._calculateLength(s,d),I=E>y?E:y,b=E>y?y:E,C=bg(p,l),T=bg(p,c),_=bg(p,s),O=bg(p,d);e._isInsideVolume(C,T,_,O,m)?e.isHandleOutsideImage=!1:e.isHandleOutsideImage=!0,u[g]={length:I,width:b,unit:w?"mm":"px"}}}t.invalidated=!1;var D=J.ANNOTATION_MODIFIED,S={annotation:t,viewportId:a,renderingEngineId:i};return(0,Y.triggerEvent)(Y.eventTarget,D,S),u})),Q(la(e),"_isInsideVolume",(function(e,t,n,r,o){return Y.utilities.indexWithinDimensions(e,o)&&Y.utilities.indexWithinDimensions(t,o)&&Y.utilities.indexWithinDimensions(n,o)&&Y.utilities.indexWithinDimensions(r,o)})),Q(la(e),"_getSignedAngle",(function(e,t){return Math.atan2(e[0]*t[1]-e[1]*t[0],e[0]*t[0]+e[1]*t[1])})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o,[{key:"addNewAnnotation",value:function(e){var t=e.detail,n=t.currentPoints,r=t.element,o=n.world,a=(0,Y.getEnabledElement)(r),i=a.viewport,l=a.renderingEngine;this.isDrawing=!0;var c=i.getCamera(),s=c.viewPlaneNormal,d=c.viewUp,u=this.getReferencedImageId(i,o,s,d),v=i.getFrameOfReferenceUID(),f={highlighted:!0,invalidated:!0,metadata:{toolName:this.getToolName(),viewPlaneNormal:xr(s),viewUp:xr(d),FrameOfReferenceUID:v,referencedImageId:u},data:{handles:{points:[xr(o),xr(o),xr(o),xr(o)],textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}},activeHandleIndex:null},label:"",cachedStats:{}}};tt(f,r);var g=Ks(r,this.getToolName());return this.editData={annotation:f,viewportIdsToRender:g,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},this._activateDraw(r),Ql(r),e.preventDefault(),na(l,g),f}},{key:"_calculateLength",value:function(e,t){var n=e[0]-t[0],r=e[1]-t[1],o=e[2]-t[2];return Math.sqrt(n*n+r*r+o*o)}}]),o}(od);Q(Cg,"toolName",void 0),Cg.toolName="Bidirectional";var Tg=Cg;var _g=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,getTextCallback:Og,changeTextCallback:Dg,preventHandleOutsideImage:!1,arrowFirst:!0}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;Ql(o),e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=e.configuration.arrowFirst,g=l.getFrameOfReferenceUID(),h={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:g,referencedImageId:v},data:{text:"",handles:{points:[xr(a),xr(a)],activeHandleIndex:null,arrowFirst:f,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:""}};tt(h,o);var p=Ks(o,e.getToolName());return e.editData={annotation:h,viewportIdsToRender:p,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),t.preventDefault(),na(c,p),h})),Q(la(e),"isPointNearTool",(function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=Bn(t.data.handles.points,2),i=a[0],l=a[1],c=o.worldToCanvas(i),s=o.worldToCanvas(l),d={start:{x:c[0],y:c[1]},end:{x:s[0],y:s[1]}};return ld([d.start.x,d.start.y],[d.end.x,d.end.y],[n[0],n[1]])<=r})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},e._activateModify(r),Ql(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),i&&e.configuration.getTextCallback((function(t){if(!t)return rt(o.annotationUID),na(s,a),e.editData=null,void(e.isDrawing=!1);o.data.text=t;var n=J.ANNOTATION_COMPLETED,r={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,n,r),na(s,a)})),e.editData=null,e.isDrawing=!1}})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else{var g=n.currentPoints.world;s.handles.points[l]=xr(g),a.invalidated=!0}e.editData.hasMoved=!0;var h=(0,Y.getEnabledElement)(r).renderingEngine;na(h,i)})),Q(la(e),"touchTapCallback",(function(t){2==t.detail.taps&&e.doubleClickCallback(t)})),Q(la(e),"doubleClickCallback",(function(t){var n,r=t.detail,o=r.element,a=et(e.getToolName(),o);if(null!==(n=a=e.filterInteractableAnnotationsForElement(o,a))&&void 0!==n&&n.length){var i=a.find((function(t){return e.isPointNearTool(o,t,r.currentPoints.canvas,6)}));if(i){var l=i;e.configuration.changeTextCallback(i,t.detail,e._doneChangingTextCallback.bind(la(e),o,l)),e.editData=null,e.isDrawing=!1,t.stopImmediatePropagation(),t.preventDefault()}}})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_END,e._endCallback)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_MOVE,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},d=0;d<c.length;d++){var u=c[d],v=u.annotationUID,f=u.data,g=f.handles,h=f.text,p=g.points,m=g.activeHandleIndex;s.annotationUID=v;var w=e.getStyle("lineWidth",s,u),E=e.getStyle("lineDash",s,u),y=e.getStyle("color",s,u),I=p.map((function(e){return i.worldToCanvas(e)})),b=void 0;if(ie(u)||e.editData||null===m||(b=[I[m]]),b&&Uc(n,v,"0",I,{color:y,lineWidth:w}),e.configuration.arrowFirst?Zc(n,v,"1",I[1],I[0],{color:y,width:w,lineDash:E}):Zc(n,v,"1",I[0],I[1],{color:y,width:w,lineDash:E}),a=!0,!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;if(h){if(!f.handles.textBox.hasMoved){var C=sd(I);f.handles.textBox.worldPosition=i.canvasToWorld(C)}var T=i.worldToCanvas(f.handles.textBox.worldPosition),_=Jc(n,v,"1",[h],T,I,{},e.getLinkedTextBoxStyle(s,u)),O=_.x,D=_.y,S=_.width,x=_.height;f.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([O,D]),topRight:i.canvasToWorld([O+S,D]),bottomLeft:i.canvasToWorld([O,D+x]),bottomRight:i.canvasToWorld([O+S,D+x])}}}return a})),e}return Z(o,[{key:"handleSelectedCallback",value:function(e,t,n){var r=e.detail.element,o=t.data;t.highlighted=!0;var a,i=!1;n.worldPosition?i=!0:a=o.handles.points.findIndex((function(e){return e===n}));var l=Ks(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:a,movingTextBox:i},this._activateModify(r),Ql(r);var c=(0,Y.getEnabledElement)(r).renderingEngine;na(c,l),e.preventDefault()}},{key:"_doneChangingTextCallback",value:function(e,t,n){t.data.text=n;var r=(0,Y.getEnabledElement)(e),o=r.renderingEngine,a=r.viewportId,i=r.renderingEngineId,l=Ks(e,this.getToolName());na(o,l);var c=J.ANNOTATION_MODIFIED;(0,Y.triggerEvent)(Y.eventTarget,c,{annotation:t,viewportId:a,renderingEngineId:i})}},{key:"_isInsideVolume",value:function(e,t,n){return Y.utilities.indexWithinDimensions(e,n)&&Y.utilities.indexWithinDimensions(t,n)}}]),o}(od);function Og(e){return e(prompt("Enter your annotation:"))}function Dg(e,t,n){return n(prompt("Enter your annotation:"))}Q(_g,"toolName",void 0),_g.toolName="ArrowAnnotate";var Sg=_g;var xg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"angleStartedNotYetCompleted",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){if(!e.angleStartedNotYetCompleted){e.angleStartedNotYetCompleted=!0;var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;Ql(o),e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=l.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:f,referencedImageId:v},data:{handles:{points:[xr(a),xr(a)],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};tt(g,o);var h=Ks(o,e.getToolName());return e.editData={annotation:g,viewportIdsToRender:h,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),t.preventDefault(),na(c,h),g}})),Q(la(e),"isPointNearTool",(function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=Bn(t.data.handles.points,3),i=a[0],l=a[1],c=a[2],s=o.worldToCanvas(i),d=o.worldToCanvas(l),u=o.worldToCanvas(c),v={start:{x:s[0],y:s[1]},end:{x:d[0],y:d[1]}},f={start:{x:d[0],y:d[1]},end:{x:u[0],y:u[1]}},g=ld([v.start.x,v.start.y],[v.end.x,v.end.y],[n[0],n[1]]),h=ld([f.start.x,f.start.y],[f.end.x,f.end.y],[n[0],n[1]]);return g<=r||h<=r})),Q(la(e),"toolSelectedCallback",(function(t,n){var r=t.detail.element;n.highlighted=!0;var o=Ks(r,e.getToolName());e.editData={annotation:n,viewportIdsToRender:o,movingTextBox:!1},e._activateModify(r),Ql(r);var a=(0,Y.getEnabledElement)(r).renderingEngine;na(a,o),t.preventDefault()})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l)if(e.angleStartedNotYetCompleted&&2===c.handles.points.length)e.editData.handleIndex=2;else{e.angleStartedNotYetCompleted=!1,c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}e.editData=null,e.isDrawing=!1}})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else{var g=n.currentPoints.world;s.handles.points[l]=xr(g),a.invalidated=!0}e.editData.hasMoved=!0;var h=(0,Y.getEnabledElement)(r).renderingEngine;na(h,i)})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,e.angleStartedNotYetCompleted=!1,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_MOVE,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_MOVE,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f,g=c[v],h=g.annotationUID,p=g.data,m=p.handles,w=m.points,E=m.activeHandleIndex;u.annotationUID=h;var y=e.getStyle("lineWidth",u,g),I=e.getStyle("lineDash",u,g),b=e.getStyle("color",u,g),C=w.map((function(e){return i.worldToCanvas(e)}));p.cachedStats[s]?g.invalidated&&e._throttledCalculateCachedStats(g,d,t):(p.cachedStats[s]={angle:null},e._calculateCachedStats(g,d,t));var T=void 0;if(ie(g)||e.editData||null===E||(T=[C[E]]),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;T&&Uc(n,h,"0",C,{color:b,lineDash:I,lineWidth:y});var _="1";if(Vc(n,h,_,C[0],C[1],{color:b,width:y,lineDash:I}),a=!0,3!==C.length)return a;if(Vc(n,h,_="2",C[1],C[2],{color:b,width:y,lineDash:I}),null!==(f=p.cachedStats[s])&&void 0!==f&&f.angle){var O=e._getTextLines(p,s);if(!p.handles.textBox.hasMoved){var D=sd(C);p.handles.textBox.worldPosition=i.canvasToWorld(D)}var S=i.worldToCanvas(p.handles.textBox.worldPosition),x=Jc(n,h,"1",O,S,C,{},e.getLinkedTextBoxStyle(u,g)),k=x.x,M=x.y,R=x.width,P=x.height;p.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([k,M]),topRight:i.canvasToWorld([k+R,M]),bottomLeft:i.canvasToWorld([k,M+P]),bottomRight:i.canvasToWorld([k+R,M+P])}}}return a})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o,[{key:"handleSelectedCallback",value:function(e,t,n){var r=e.detail.element,o=t.data;t.highlighted=!0;var a,i=!1;n.worldPosition?i=!0:a=o.handles.points.findIndex((function(e){return e===n}));var l=Ks(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:a,movingTextBox:i},this._activateModify(r),Ql(r);var c=(0,Y.getEnabledElement)(r).renderingEngine;na(c,l),e.preventDefault()}},{key:"_getTextLines",value:function(e,t){var n=e.cachedStats[t].angle;if(void 0!==n)return["".concat(n.toFixed(2)," ").concat(String.fromCharCode(176))]}},{key:"_calculateCachedStats",value:function(e,t,n){var r=e.data,o=n.viewportId,a=n.renderingEngineId;if(3===r.handles.points.length){for(var i=r.handles.points[0],l=r.handles.points[1],c=r.handles.points[2],s=r.cachedStats,d=Object.keys(s),u=0;u<d.length;u++){var v=d[u],f=Hf([i,l],[l,c]);s[v]={angle:f}}e.invalidated=!1;var g=J.ANNOTATION_MODIFIED,h={annotation:e,viewportId:o,renderingEngineId:a};return(0,Y.triggerEvent)(Y.eventTarget,g,h),s}}}]),o}(od);Q(xg,"toolName",void 0),xg.toolName="Angle";var kg=xg,Mg=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=2===t[0].length?[0,0]:[0,0,0],o=t.length,a=0,i=t;a<i.length;a++){var l=i[a];r[0]+=l[0]/o,r[1]+=l[1]/o,3===r.length&&(r[2]+=l[2]/o)}return r};var Rg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"angleStartedNotYetCompleted",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"addNewAnnotation",(function(t){if(!e.angleStartedNotYetCompleted){e.angleStartedNotYetCompleted=!0;var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;Ql(o),e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.getReferencedImageId(l,a,d,u),f=l.getFrameOfReferenceUID(),g={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:f,referencedImageId:v},data:{handles:{points:[xr(a),xr(a)],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}},label:"",cachedStats:{}}};tt(g,o);var h=Ks(o,e.getToolName());return e.editData={annotation:g,viewportIdsToRender:h,handleIndex:1,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),t.preventDefault(),na(c,h),g}})),Q(la(e),"isPointNearTool",(function(e,t,n,r){var o=(0,Y.getEnabledElement)(e).viewport,a=Bn(t.data.handles.points,4),i=a[0],l=a[1],c=a[2],s=a[3],d=o.worldToCanvas(i),u=o.worldToCanvas(l),v=o.worldToCanvas(c),f=o.worldToCanvas(s),g={start:{x:d[0],y:d[1]},end:{x:u[0],y:u[1]}},h={start:{x:v[0],y:v[1]},end:{x:f[0],y:f[1]}},p=ld([g.start.x,g.start.y],[g.end.x,g.end.y],[n[0],n[1]]),m=ld([h.start.x,h.start.y],[h.end.x,h.end.y],[n[0],n[1]]);return p<=r||m<=r})),Q(la(e),"toolSelectedCallback",(function(t,n,r){var o=t.detail.element;n.highlighted=!0;var a=Ks(o,e.getToolName());e.editData={annotation:n,viewportIdsToRender:a,movingTextBox:!1},e._activateModify(o),Ql(o);var i=(0,Y.getEnabledElement)(o).renderingEngine;na(i,a),t.preventDefault()})),Q(la(e),"_mouseUpCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.viewportIdsToRender,i=r.newAnnotation,l=r.hasMoved,c=o.data;if(!i||l){if(e.angleStartedNotYetCompleted&&c.handles.points.length<4)return Xl(n),void(e.editData.handleIndex=c.handles.points.length);e.angleStartedNotYetCompleted=!1,c.handles.activeHandleIndex=null,e._deactivateModify(n),e._deactivateDraw(n),Xl(n);var s=(0,Y.getEnabledElement)(n).renderingEngine;if(e.isHandleOutsideImage&&e.configuration.preventHandleOutsideImage&&rt(o.annotationUID),na(s,a),i){var d=J.ANNOTATION_COMPLETED,u={annotation:o};(0,Y.triggerEvent)(Y.eventTarget,d,u)}e.editData=null,e.isDrawing=!1}})),Q(la(e),"_mouseDragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=e.editData,a=o.annotation,i=o.viewportIdsToRender,l=o.handleIndex,c=o.movingTextBox,s=a.data;if(c){var d=n.deltaPoints.world,u=s.handles.textBox,v=u.worldPosition;v[0]+=d[0],v[1]+=d[1],v[2]+=d[2],u.hasMoved=!0}else if(void 0===l){var f=n.deltaPoints.world;s.handles.points.forEach((function(e){e[0]+=f[0],e[1]+=f[1],e[2]+=f[2]})),a.invalidated=!0}else{var g=n.currentPoints.world;s.handles.points[l]=xr(g),a.invalidated=!0}e.editData.hasMoved=!0;var h=(0,Y.getEnabledElement)(r).renderingEngine;na(h,i)})),Q(la(e),"cancel",(function(t){if(e.isDrawing){e.isDrawing=!1,e._deactivateDraw(t),e._deactivateModify(t),Xl(t);var n=e.editData,r=n.annotation,o=n.viewportIdsToRender,a=n.newAnnotation,i=r.data;r.highlighted=!1,i.handles.activeHandleIndex=null;var l=(0,Y.getEnabledElement)(t).renderingEngine;if(na(l,o),a){var c=J.ANNOTATION_COMPLETED,s={annotation:r};(0,Y.triggerEvent)(Y.eventTarget,c,s)}return e.editData=null,e.angleStartedNotYetCompleted=!1,r.annotationUID}})),Q(la(e),"_activateModify",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._mouseUpCallback),t.addEventListener(J.MOUSE_DRAG,e._mouseDragCallback),t.addEventListener(J.MOUSE_CLICK,e._mouseUpCallback)})),Q(la(e),"_deactivateModify",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(J.MOUSE_DRAG,e._mouseDragCallback),t.removeEventListener(J.MOUSE_CLICK,e._mouseUpCallback)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._mouseUpCallback),t.addEventListener(J.MOUSE_DRAG,e._mouseDragCallback),t.addEventListener(J.MOUSE_MOVE,e._mouseDragCallback),t.addEventListener(J.MOUSE_CLICK,e._mouseUpCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._mouseUpCallback),t.removeEventListener(J.MOUSE_DRAG,e._mouseDragCallback),t.removeEventListener(J.MOUSE_MOVE,e._mouseDragCallback),t.removeEventListener(J.MOUSE_CLICK,e._mouseUpCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=i.element,c=et(e.getToolName(),l);if(null===(r=c)||void 0===r||!r.length)return a;if(null===(o=c=e.filterInteractableAnnotationsForElement(l,c))||void 0===o||!o.length)return a;for(var s=e.getTargetId(i),d=i.getRenderingEngine(),u={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},v=0;v<c.length;v++){var f,g=c[v],h=g.annotationUID,p=g.data,m=p.handles,w=m.points,E=m.activeHandleIndex;u.annotationUID=h;var y=e.getStyle("lineWidth",u,g),I=e.getStyle("lineDash",u,g),b=e.getStyle("color",u,g),C=w.map((function(e){return i.worldToCanvas(e)}));p.cachedStats[s]?g.invalidated&&e._throttledCalculateCachedStats(g,d,t):(p.cachedStats[s]={angle:null},e._calculateCachedStats(g,d,t));var T=void 0;if(ie(g)||e.editData||null===E||(T=[C[E]]),!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;T&&Uc(n,h,"0",C,{color:b,lineDash:I,lineWidth:y});var _="1";if(Vc(n,h,_,C[0],C[1],{color:b,width:y,lineDash:I}),a=!0,C.length<4)return a;if(Vc(n,h,_="2",C[2],C[3],{color:b,width:y,lineDash:I}),Vc(n,h,_="3",Mg(C[0],C[1]),Mg(C[2],C[3]),{color:b,lineWidth:"1",lineDash:"1,4"}),null!==(f=p.cachedStats[s])&&void 0!==f&&f.angle){var O=e._getTextLines(p,s);if(!p.handles.textBox.hasMoved){var D=sd(C);p.handles.textBox.worldPosition=i.canvasToWorld(D)}var S=i.worldToCanvas(p.handles.textBox.worldPosition),x=Jc(n,h,"1",O,S,C,{},e.getLinkedTextBoxStyle(u,g)),k=x.x,M=x.y,R=x.width,P=x.height;p.handles.textBox.worldBoundingBox={topLeft:i.canvasToWorld([k,M]),topRight:i.canvasToWorld([k+R,M]),bottomLeft:i.canvasToWorld([k,M+P]),bottomRight:i.canvasToWorld([k+R,M+P])}}}return a})),e._throttledCalculateCachedStats=os(e._calculateCachedStats,100,{trailing:!0}),e}return Z(o,[{key:"handleSelectedCallback",value:function(e,t,n){var r=e.detail.element,o=t.data;t.highlighted=!0;var a,i=!1;n.worldPosition?i=!0:a=o.handles.points.findIndex((function(e){return e===n}));var l=Ks(r,this.getToolName());this.editData={annotation:t,viewportIdsToRender:l,handleIndex:a,movingTextBox:i},this._activateModify(r),Ql(r);var c=(0,Y.getEnabledElement)(r).renderingEngine;na(c,l),e.preventDefault()}},{key:"_getTextLines",value:function(e,t){var n=e.cachedStats[t].angle;if(void 0!==n)return["".concat(n.toFixed(2)," ").concat(String.fromCharCode(176))]}},{key:"_calculateCachedStats",value:function(e,t,n){var r=e.data,o=n.viewportId,a=n.renderingEngineId;if(4===r.handles.points.length){for(var i=r.handles.points[0],l=r.handles.points[1],c=r.handles.points[2],s=r.handles.points[3],d=r.cachedStats,u=Object.keys(d),v=0;v<u.length;v++){var f=u[v],g=Hf([i,l],[c,s]);d[f]={angle:g}}e.invalidated=!1;var h=J.ANNOTATION_MODIFIED,p={annotation:e,viewportId:o,renderingEngineId:a};return(0,Y.triggerEvent)(Y.eventTarget,h,p),d}}}]),o}(od);Q(Rg,"toolName",void 0),Rg.toolName="CobbAngle";var Pg=Rg;var Ng="magnify-viewport",Ag=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:10,magnifyWidth:250,magnifyHeight:250}};return X(this,o),Q(la(e=r.call(this,t,n)),"_bounds",void 0),Q(la(e),"editData",void 0),Q(la(e),"preMouseDownCallback",(function(t){var n=t.detail,r=n.element,o=n.currentPoints,a=(0,Y.getEnabledElement)(r),i=a.viewport,l=a.renderingEngine;if(!(i instanceof Y.StackViewport))throw new Error("MagnifyTool only works on StackViewports");var c=e._getReferencedImageId(i);if(!c)throw new Error("MagnifyTool: No referenced image id found, reconstructed planes not supported yet");var s=Ks(r,e.getToolName());return e.editData={referencedImageId:c,viewportIdsToRender:s,enabledElement:a,renderingEngine:l,currentPoints:o},e._createMagnificationViewport(),e._activateDraw(r),Ql(r),t.preventDefault(),na(l,s),!0})),Q(la(e),"preTouchStartCallback",(function(t){e.preMouseDownCallback(t)})),Q(la(e),"_createMagnificationViewport",(function(){var t,n=e.editData,r=n.enabledElement,o=n.referencedImageId,a=n.viewportIdsToRender,i=n.renderingEngine,l=n.currentPoints,c=r.viewport,s=c.element,d=c.getProperties().voiRange,u=l.canvas,v=l.world;if(null===(t=s.querySelector(".magnifyTool"))){var f=document.createElement("div");f.classList.add("magnifyTool"),f.style.display="block",f.style.width="".concat(e.configuration.magnifyWidth,"px"),f.style.height="".concat(e.configuration.magnifyHeight,"px"),f.style.position="absolute",t=f,s.querySelector(".viewport-element").appendChild(f);var g={viewportId:Ng,type:Y.Enums.ViewportType.STACK,element:t};i.enableElement(g)}t.style.top="".concat(u[1]-e.configuration.magnifyHeight/2,"px"),t.style.left="".concat(u[0]-e.configuration.magnifyWidth/2,"px");var h=i.getViewport(Ng);h.setStack([o]).then((function(){h.setProperties({voiRange:d});var t=c.getCamera().parallelScale,n=h.getCamera(),r=n.focalPoint,o=n.position,a=n.viewPlaneNormal,i=Math.sqrt(Math.pow(r[0]-o[0],2)+Math.pow(r[1]-o[1],2)+Math.pow(r[2]-o[2],2)),l=[v[0],v[1],v[2]],s=[l[0]+i*a[0],l[1]+i*a[1],l[2]+i*a[2]];h.setCamera({parallelScale:t*(1/e.configuration.magnifySize),focalPoint:l,position:s}),h.render()})),t.style.display="block",na(i,a)})),Q(la(e),"_dragCallback",(function(t){var n=t.detail,r=n.deltaPoints,o=n.element,a=n.currentPoints,i=r.world,l=a.canvas,c=(0,Y.getEnabledElement)(o).renderingEngine.getViewport(Ng),s=o.querySelector(".magnifyTool");if(s){s.style.top="".concat(l[1]-e.configuration.magnifyHeight/2,"px"),s.style.left="".concat(l[0]-e.configuration.magnifyWidth/2,"px");var d=c.getCamera(),u=d.focalPoint,v=d.position,f=[v[0]+i[0],v[1]+i[1],v[2]+i[2]],g=[u[0]+i[0],u[1]+i[1],u[2]+i[2]];c.setCamera({focalPoint:g,position:f}),c.render()}})),Q(la(e),"_dragEndCallback",(function(t){var n=t.detail.element;(0,Y.getEnabledElement)(n).renderingEngine.disableElement(Ng);var r=n.querySelector(".viewport-element"),o=r.querySelector(".magnifyTool");r.removeChild(o),e._deactivateDraw(n),Xl(n)})),Q(la(e),"_activateDraw",(function(t){ze.isInteractingWithTool=!0,t.addEventListener(J.MOUSE_UP,e._dragEndCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._dragEndCallback),t.addEventListener(J.TOUCH_END,e._dragEndCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_deactivateDraw",(function(t){ze.isInteractingWithTool=!1,t.removeEventListener(J.MOUSE_UP,e._dragEndCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._dragEndCallback),t.removeEventListener(J.TOUCH_END,e._dragEndCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback)})),e}return Z(o,[{key:"_getReferencedImageId",value:function(e){var t,n=this.getTargetId(e);return e instanceof Y.StackViewport&&(t=n.split("imageId:")[1]),t}}]),o}(ka);Q(Ag,"toolName",void 0),Ag.toolName="Magnify";var Lg=Ag;var Ug=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{shadow:!0,preventHandleOutsideImage:!1,displayThreshold:5,positionSync:!0,disableCursor:!1}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"isDrawing",!1),Q(la(e),"isHandleOutsideImage",!1),Q(la(e),"_elementWithCursor",null),Q(la(e),"_currentCursorWorldPosition",null),Q(la(e),"_currentCanvasPosition",null),Q(la(e),"_disableCursorEnabled",!1),Q(la(e),"mouseMoveCallback",(function(t){var n=t.detail,r=n.element,o=n.currentPoints;e._currentCursorWorldPosition=o.world,e._currentCanvasPosition=o.canvas,e._elementWithCursor=r;var a=e.getActiveAnnotation(r);return null===a?(e.createInitialAnnotation(o.world,r),!1):(e.updateAnnotationPosition(r,a),!1)})),Q(la(e),"createInitialAnnotation",(function(t,n){var r=(0,Y.getEnabledElement)(n);if(!r)throw new Error("No enabled element found");var o=r.viewport,a=r.renderingEngine;e.isDrawing=!0;var i=o.getCamera(),l=i.viewPlaneNormal,c=i.viewUp;if(!l||!c)throw new Error("Camera not found");var s=e.getReferencedImageId(o,t,l,c),d=o.getFrameOfReferenceUID(),u={highlighted:!0,invalidated:!0,metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(l),viewUp:xr(c),FrameOfReferenceUID:d,referencedImageId:s},data:{label:"",handles:{points:[xr(t)],activeHandleIndex:null,textBox:{hasMoved:!1,worldPosition:[0,0,0],worldBoundingBox:{topLeft:[0,0,0],topRight:[0,0,0],bottomLeft:[0,0,0],bottomRight:[0,0,0]}}}}};if(et(e.getToolName(),n).length>0)return null;if(null!==tt(u,n)){var v=Ks(n,e.getToolName(),!1);na(a,v)}})),Q(la(e),"onCameraModified",(function(t){var n=t.detail,r=n.element,o=n.previousCamera,a=n.camera,i=(0,Y.getEnabledElement)(r).viewport;if(r===e._elementWithCursor){var l=o.focalPoint,c=a.viewPlaneNormal,s=a.focalPoint,d=[0,0,0];if(au().subtract(s,l,d),0!==d.reduce((function(e,t){return e+t}),0)){var u=au().dot(d,c);if(!(Math.abs(u)<.01)&&e._currentCanvasPosition){var v=i.canvasToWorld(e._currentCanvasPosition);e._currentCursorWorldPosition=v,e.updateAnnotationPosition(r,e.getActiveAnnotation(r))}}}})),Q(la(e),"renderAnnotation",(function(t,n){var r,o,a=!1,i=t.viewport,l=(t.FrameOfReferenceUID,e._elementWithCursor===i.element);e.configuration.positionSync&&!l&&e.updateViewportImage(i);var c=i.element,s=et(e.getToolName(),c);if(null===(r=s)||void 0===r||!r.length)return a;if(null===(o=s=e.filterInteractableAnnotationsForElement(c,s))||void 0===o||!o.length)return a;for(var d={toolGroupId:e.toolGroupId,toolName:e.getToolName(),viewportId:t.viewport.id},u=0;u<s.length;u++){var v=s[u],f=v.annotationUID,g=v.data.handles.points;if(!f)return a;d.annotationUID=f;var h=parseFloat(e.getStyle("lineWidth",d,v)),p=e.getStyle("lineDash",d,v),m=e.getStyle("color",d,v);if(g[0].some((function(e){return isNaN(e)})))return a;var w=g.map((function(e){return i.worldToCanvas(e)}));if(!i.getRenderingEngine())return console.warn("Rendering Engine has been destroyed"),a;if(xe(f)){var E={upper:"upper",right:"right",lower:"lower",left:"left"},y=Bn(w[0],2),I=y[0],b=y[1],C=l?20:7,T=l?5:7;Vc(n,f,E.upper,[I,b-(C/2+T)],[I,b-C/2],{color:m,lineDash:p,lineWidth:h}),Vc(n,f,E.lower,[I,b+(C/2+T)],[I,b+C/2],{color:m,lineDash:p,lineWidth:h}),Vc(n,f,E.right,[I+(C/2+T),b],[I+C/2,b],{color:m,lineDash:p,lineWidth:h}),Vc(n,f,E.left,[I-(C/2+T),b],[I-C/2,b],{color:m,lineDash:p,lineWidth:h}),a=!0}}return a})),e._disableCursorEnabled=e.configuration.disableCursor,e}return Z(o,[{key:"onSetToolActive",value:function(){if(this._disableCursorEnabled=this.configuration.disableCursor,this._disableCursorEnabled){var e=ia(this.toolGroupId).viewportsInfo;e&&e.map((function(e){return(0,Y.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)})).forEach((function(e){e&&Ql(e.viewport.element)}))}}},{key:"onSetToolDisabled",value:function(){if(this._disableCursorEnabled){var e=ia(this.toolGroupId).viewportsInfo;e&&e.map((function(e){return(0,Y.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)})).forEach((function(e){e&&Xl(e.viewport.element)}))}}},{key:"getActiveAnnotation",value:function(e){var t=et(this.getToolName(),e);return t.length?t[0]:null}},{key:"updateAnnotationPosition",value:function(e,t){var n,r,o=this._currentCursorWorldPosition;if(o&&null!==(n=t.data)&&void 0!==n&&null!==(r=n.handles)&&void 0!==r&&r.points){t.data.handles.points=[xr(o)],t.invalidated=!0;var a=Ks(e,this.getToolName(),!1),i=(0,Y.getEnabledElement)(e);if(i){var l=i.renderingEngine;na(l,a)}}}},{key:"filterInteractableAnnotationsForElement",value:function(e,t){var n,r,o;if(!(t instanceof Array)||0===t.length)return[];var a=t[0],i=null===(n=(0,Y.getEnabledElement)(e))||void 0===n?void 0:n.viewport;if(!i)return[];var l=i.getCamera(),c=l.viewPlaneNormal,s=l.focalPoint;if(!c||!s)return[];var d=null===(r=a.data)||void 0===r||null===(o=r.handles)||void 0===o?void 0:o.points;if(!(d instanceof Array)||1!==d.length)return[];var u=d[0],v=Y.utilities.planar.planeEquation(c,s);return Y.utilities.planar.planeDistanceToPoint(v,u)<this.configuration.displayThreshold?[a]:[]}},{key:"updateViewportImage",value:function(e){var t=this._currentCursorWorldPosition;if(t&&!t.some((function(e){return isNaN(e)})))if(e instanceof Y.StackViewport){var n=Y.utilities.getClosestStackImageIndexForPoint(t,e);if(null===n)return;n!==e.getCurrentImageIdIndex()&&e.setImageIdIndex(n)}else if(e instanceof Y.VolumeViewport){var r=e.getCamera(),o=r.focalPoint,a=r.viewPlaneNormal;if(!o||!a)return;var i=Y.utilities.planar.planeEquation(a,o),l=Y.utilities.planar.planeDistanceToPoint(i,t,!0);if(Math.abs(l)<.5)return;var c=wc.vec3.normalize(wc.vec3.create(),wc.vec3.fromValues.apply(wc.vec3,xr(a))),s=wc.vec3.scale(wc.vec3.create(),c,l),d=wc.vec3.add(wc.vec3.create(),wc.vec3.fromValues.apply(wc.vec3,xr(o)),s);e.setCamera({focalPoint:d});var u=e.getRenderingEngine();u&&u.renderViewport(e.id)}}}]),o}(ed);Q(Ug,"toolName",void 0),Ug.toolName="ReferenceCursors";var Vg=Ug;var Bg=[],jg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{configuration:{viewportId:"",scaleLocation:"bottom"}};return X(this,o),Q(la(e=r.call(this,t,n)),"touchDragCallback",void 0),Q(la(e),"mouseDragCallback",void 0),Q(la(e),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",{}),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"_init",(function(){var t=(0,Y.getRenderingEngines)()[0];if(t){var n=ia(e.toolGroupId).viewportsInfo;if(n){var r=n.map((function(e){return(0,Y.getEnabledElementByIds)(e.viewportId,e.renderingEngineId)})),o=r[0].viewport,a=r[0].FrameOfReferenceUID;if(e.configuration.viewportId&&r.forEach((function(t){t.viewport.id==e.configuration.viewportId&&(o=t.viewport)})),o){var i=o.getCamera(),l=i.viewUp,c=i.viewPlaneNormal,s=Y.utilities.getViewportImageCornersInWorld(o),d=e.editData.annotation,u=et(e.getToolName(),o.element);if(u.length&&(d=u.filter((function(e){return e.data.viewportId==o.id}))[0]),Bg.includes(o.id))e.editData.annotation.data.viewportId==o.id&&(e.editData.annotation.data.handles.points=s,e.editData.annotation.data.viewportId=o.id);else{var v={metadata:{toolName:e.getToolName(),viewPlaneNormal:xr(c),viewUp:xr(l),FrameOfReferenceUID:a,referencedImageId:null},data:{handles:{points:s},viewportId:o.id}};Bg.push(o.id),tt(v,o.element),d=v}e.editData={viewport:o,renderingEngine:t,annotation:d}}}}})),Q(la(e),"onSetToolEnabled",(function(){e._init()})),Q(la(e),"onCameraModified",(function(t){e.configuration.viewportId=t.detail.viewportId,e._init()})),Q(la(e),"computeScaleSize",(function(e,t,n){var r=[16e3,8e3,4e3,2e3,1e3,500,250,100,50,25,10,5,2];return("top"==n||"bottom"==n?r.filter((function(t){return t<.6*e&&t>.2*e})):r.filter((function(e){return e<.6*t&&e>.2*t})))[0]})),Q(la(e),"computeEndScaleTicks",(function(e,t){var n={bottom:[[0,-10],[0,-10]],top:[[0,10],[0,10]],left:[[0,0],[10,0]],right:[[0,0],[-10,0]]};return{endTick1:[[e[1][0]+n[t][0][0],e[1][1]+n[t][0][0]],[e[1][0]+n[t][1][0],e[1][1]+n[t][1][1]]],endTick2:[[e[0][0]+n[t][0][0],e[0][1]+n[t][0][0]],[e[0][0]+n[t][1][0],e[0][1]+n[t][1][1]]]}})),Q(la(e),"computeInnerScaleTicks",(function(e,t,n,r,o){var a;"bottom"==t||"top"==t?a=o[0][0]-r[0][0]:"left"!=t&&"right"!=t||(a=o[0][1]-r[0][1]);var i=[],l=[],c=[],s=e;e>=50&&(s=e/10);for(var d=a/s,u=0;u<s-1;u++){var v={bottom:[[d*(u+1),0],[d*(u+1),5]],top:[[d*(u+1),0],[d*(u+1),-5]],left:[[0,d*(u+1)],[-5,d*(u+1)]],right:[[0,d*(u+1)],[5,d*(u+1)]]};i.push("".concat(n,"-tick").concat(u)),l.push("tick".concat(u)),(u+1)%5==0?c.push([[r[0][0]+v[t][0][0],r[0][1]+v[t][0][1]],[r[1][0]+v[t][0][0],r[1][1]+v[t][0][1]]]):c.push([[r[0][0]+v[t][0][0],r[0][1]+v[t][0][1]],[r[1][0]+v[t][1][0],r[1][1]+v[t][1][1]]])}return{tickIds:i,tickUIDs:l,tickCoordinates:c}})),Q(la(e),"computeWorldScaleCoordinates",(function(e,t,n){var r,o=wc.vec3.subtract(wc.vec3.create(),n[0],n[1]);o=wc.vec3.normalize(wc.vec3.create(),o);var a=wc.vec3.subtract(wc.vec3.create(),n[2],n[0]);a=wc.vec3.normalize(wc.vec3.create(),a);var i={bottom:[n[1],n[2]],top:[n[0],n[3]],right:[n[2],n[3]],left:[n[0],n[1]]},l=wc.vec3.add(wc.vec3.create(),i[t][0],i[t][0]).map((function(e){return e/2})),c=e/2/Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2)+Math.pow(o[2],2));return"top"==t||"bottom"==t?r=[wc.vec3.subtract(wc.vec3.create(),l,a.map((function(e){return e*c}))),wc.vec3.add(wc.vec3.create(),l,a.map((function(e){return e*c})))]:"left"!=t&&"right"!=t||(r=[wc.vec3.add(wc.vec3.create(),l,o.map((function(e){return e*c}))),wc.vec3.subtract(wc.vec3.create(),l,o.map((function(e){return e*c})))]),r})),Q(la(e),"computeCanvasScaleCoordinates",(function(e,t,n,r,o){var a;if("top"==o||"bottom"==o){var i=t[0][0]-t[1][0];a=[[e.width/2-i/2,n.height],[e.width/2+i/2,n.height]]}else if("left"==o||"right"==o){var l=t[0][1]-t[1][1];a=[[r.width,e.height/2-l/2],[r.width,e.height/2+l/2]]}return a})),Q(la(e),"computeScaleBounds",(function(e,t,n,r){var o=t*Math.min(1e3,e.width),a=n*Math.min(1e3,e.height),i={bottom:[-a,-o],top:[a,o],left:[a,o],right:[-a,-o]},l={bottom:[e.height,e.width],top:[0,e.width],left:[e.height,0],right:[e.height,e.width]};return{height:l[r][0]+i[r][0],width:l[r][1]+i[r][1]}})),e}return Z(o,[{key:"renderAnnotation",value:function(e,t){if(this.editData.viewport){var n=this.configuration.scaleLocation,r=e.viewport,o=et(this.getToolName(),r.element).filter((function(e){return e.data.viewportId==r.id}))[0],a=e.viewport.canvas;if(!r)return!1;var i={toolGroupId:this.toolGroupId,toolName:this.getToolName(),viewportId:e.viewport.id},l={width:a.width,height:a.height},c=o.data.handles.points[0],s=o.data.handles.points[1],d=o.data.handles.points[2],u=o.data.handles.points[3],v=[c,d,s,u],f=wc.vec3.distance(d,u),g=wc.vec3.distance(c,d),h=this.computeScaleBounds(l,.05,.05,n),p=this.computeScaleBounds(l,.05,.05,n),m=this.computeScaleSize(f,g,n),w=this.computeWorldScaleCoordinates(m,n,v).map((function(e){return r.worldToCanvas(e)})),E=this.computeCanvasScaleCoordinates(l,w,p,h,n),y=this.computeEndScaleTicks(E,n),I=o.annotationUID;i.annotationUID=I;var b=this.getStyle("lineWidth",i,o),C=this.getStyle("lineDash",i,o),T=this.getStyle("color",i,o),_=this.getStyle("shadow",i,o),O="".concat(I,"-scaleline");Vc(t,I,"1",E[0],E[1],{color:T,width:b,lineDash:C,shadow:_},O);var D="".concat(I,"-left");Vc(t,I,"2",y.endTick1[0],y.endTick1[1],{color:T,width:b,lineDash:C,shadow:_},D);var S="".concat(I,"-right");Vc(t,I,"3",y.endTick2[0],y.endTick2[1],{color:T,width:b,lineDash:C,shadow:_},S);for(var x={bottom:[-10,-42],top:[-12,-35],left:[-40,-20],right:[-50,-20]},k=[E[0][0]+x[n][0],E[0][1]+x[n][1]],M=this._getTextLines(m),R=this.computeInnerScaleTicks(m,n,I,y.endTick1,y.endTick2),P=R.tickIds,N=R.tickUIDs,A=R.tickCoordinates,L=0;L<N.length;L++)Vc(t,I,N[L],A[L][0],A[L][1],{color:T,width:b,lineDash:C,shadow:_},P[L]);return qc(t,I,"text0",M,[k[0],k[1]],{fontFamily:"Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"14px",lineDash:"2,3",lineWidth:"1",shadow:!0,color:T}),!1}}},{key:"_getTextLines",value:function(e){var t,n;return e>=50?(t=e/10,n=" cm"):(t=e,n=" mm"),[t.toString().concat(n)]}}]),o}(ed);Q(jg,"toolName",void 0),jg.toolName="ScaleOverlay";var Hg=jg,Wg=Y.utilities.transformWorldToIndex;function Fg(e,t){!function(e,t){var n=t.volume,r=t.points,o=t.segmentsLocked,a=t.segmentIndex,i=t.segmentationId,l=t.constraintFn,c=n.imageData,s=n.dimensions,d=n.getScalarData(),u=r.map((function(e){return Wg(c,e)}));u=u.map((function(e){return e.map((function(e){return Math.round(e)}))}));var v=cs(u,s);if(v.every((function(e){var t=Bn(e,2);return t[0]!==t[1]})))throw new Error("Oblique segmentation tools are not supported yet");ls(c,(function(){return!0}),(function(e){var t=e.value,n=e.index,r=e.pointIJK;o.includes(t)||(l?l(r)&&(d[n]=a):d[n]=a)}),v),Ct(i)}(0,t)}var Gg=Y.utilities.transformWorldToIndex;function qg(e,t){!function(e,t){var n=t.volume,r=t.points,o=t.segmentsLocked,a=t.segmentationId,i=n.imageData,l=n.dimensions,c=n.getScalarData(),s=r.map((function(e){return Gg(i,e)})),d=cs(s,l);if(d.every((function(e){var t=Bn(e,2);return t[0]!==t[1]})))throw new Error("Oblique segmentation tools are not supported yet");ls(i,(function(){return!0}),(function(e){var t=e.value,n=e.index;o.includes(t)||(c[n]=0)}),d),Ct(a)}(0,t)}var zg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:Fg,ERASE_INSIDE:qg},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}};return X(this,o),Q(la(e=r.call(this,t,n)),"_throttledCalculateCachedStats",void 0),Q(la(e),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"preMouseDownCallback",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o),l=i.viewport,c=i.renderingEngine;e.isDrawing=!0;var s=l.getCamera(),d=s.viewPlaneNormal,u=s.viewUp,v=e.toolGroupId,f=Cs(v);if(!f)throw new Error("No active segmentation detected, create one before using scissors tool");var g=f.segmentationRepresentationUID,h=f.segmentationId,p=f.type,m=xs(h),w=Ds(h),E=Rs(v,g,m),y=Dt(h).representationData[p].volumeId,I=Y.cache.getVolume(y),b={highlighted:!0,invalidated:!0,metadata:{viewPlaneNormal:xr(d),viewUp:xr(u),FrameOfReferenceUID:l.getFrameOfReferenceUID(),referencedImageId:"",toolName:e.getToolName(),segmentColor:E},data:{handles:{points:[xr(a),xr(a),xr(a),xr(a)],activeHandleIndex:null}}},C=Ks(o,e.getToolName());return e.editData={annotation:b,segmentation:I,segmentIndex:m,segmentsLocked:w,segmentColor:E,segmentationId:h,viewportIdsToRender:C,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(c,C),!0})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n,r,o,a,i,l,c,s,d=t.detail,u=d.element,v=e.editData,f=v.annotation,g=v.viewportIdsToRender,h=v.handleIndex,p=f.data,m=d.currentPoints,w=(0,Y.getEnabledElement)(u),E=w.viewport,y=E.worldToCanvas,I=E.canvasToWorld,b=m.world,C=p.handles.points;switch(C[h]=xr(b),h){case 0:case 3:n=y(C[0]),r=[(a=y(C[3]))[0],n[1]],o=[n[0],a[1]],l=I(r),c=I(o),C[1]=l,C[2]=c;break;case 1:case 2:r=y(C[1]),n=[(o=y(C[2]))[0],r[1]],a=[r[0],o[1]],i=I(n),s=I(a),C[0]=i,C[3]=s}f.invalidated=!0,e.editData.hasMoved=!0;var T=w.renderingEngine;na(T,g)})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.newAnnotation,i=r.hasMoved,l=r.segmentation,c=r.segmentationId,s=r.segmentIndex,d=r.segmentsLocked,u=o.data;if(!a||i){u.handles.activeHandleIndex=null,e._deactivateDraw(n),Xl(n);var v=(0,Y.getEnabledElement)(n),f=v.viewport;if(e.editData=null,e.isDrawing=!1,f instanceof Y.StackViewport)throw new Error("Not implemented yet");var g={points:u.handles.points,volume:l,segmentationId:c,segmentIndex:s,segmentsLocked:d};e.applyActiveStrategy(v,g)}})),Q(la(e),"_activateDraw",(function(t){t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r=!1;if(!e.editData)return r;var o=t.viewport,a=e.editData.annotation,i=a.metadata,l=a.annotationUID,c=a.data.handles.points.map((function(e){return o.worldToCanvas(e)})),s="rgb(".concat(i.segmentColor.slice(0,3),")");return o.getRenderingEngine()?($c(n,l,"0",c[0],c[3],{color:s}),!0):(console.warn("Rendering Engine has been destroyed"),r)})),e}return Z(o)}(ka);Q(zg,"toolName",void 0),zg.toolName="RectangleScissor";var Kg=zg;var Yg=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:ws},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}};return X(this,o),Q(la(e=r.call(this,t,n)),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"preMouseDownCallback",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=r.canvas,l=(0,Y.getEnabledElement)(o),c=l.viewport,s=l.renderingEngine;e.isDrawing=!0;var d=c.getCamera(),u=d.viewPlaneNormal,v=d.viewUp,f=e.toolGroupId,g=Cs(f);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");var h=g.segmentationRepresentationUID,p=g.segmentationId,m=g.type,w=xs(p),E=Ds(p),y=Rs(f,h,w),I=Dt(p).representationData[m].volumeId,b=Y.cache.getVolume(I),C={invalidated:!0,highlighted:!0,metadata:{viewPlaneNormal:xr(u),viewUp:xr(v),FrameOfReferenceUID:c.getFrameOfReferenceUID(),referencedImageId:"",toolName:e.getToolName(),segmentColor:y},data:{handles:{points:[xr(a),xr(a),xr(a),xr(a)],activeHandleIndex:null},isDrawing:!0,cachedStats:{}}},T=[c.id];return e.editData={annotation:C,segmentation:b,centerCanvas:i,segmentIndex:w,segmentationId:p,segmentsLocked:E,segmentColor:y,viewportIdsToRender:T,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(s,T),!0})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=n.currentPoints.canvas,a=(0,Y.getEnabledElement)(r),i=a.renderingEngine,l=a.viewport.canvasToWorld,c=e.editData,s=c.annotation,d=c.viewportIdsToRender,u=c.centerCanvas,v=s.data,f=Math.abs(o[0]-u[0]),g=Math.abs(o[1]-u[1]),h=Math.sqrt(f*f+g*g),p=[u[0],u[1]+h],m=[u[0],u[1]-h],w=[u[0]-h,u[1]],E=[u[0]+h,u[1]];v.handles.points=[l(p),l(m),l(w),l(E)],s.invalidated=!0,e.editData.hasMoved=!0,na(i,d)})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.newAnnotation,i=r.hasMoved,l=r.segmentation,c=r.segmentIndex,s=r.segmentsLocked,d=r.segmentationId,u=o.data,v=o.metadata,f=v.viewPlaneNormal,g=v.viewUp;if(!a||i){u.handles.activeHandleIndex=null,e._deactivateDraw(n),Xl(n);var h=(0,Y.getEnabledElement)(n),p=h.viewport;if(e.editData=null,e.isDrawing=!1,p instanceof Y.StackViewport)throw new Error("Not implemented yet");var m={points:u.handles.points,volume:l,segmentIndex:c,segmentsLocked:s,viewPlaneNormal:f,segmentationId:d,viewUp:g};e.applyActiveStrategy(h,m)}})),Q(la(e),"_activateDraw",(function(t){t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback),t.addEventListener(J.TOUCH_END,e._endCallback)})),Q(la(e),"_deactivateDraw",(function(t){t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r=!1;if(!e.editData)return r;var o=t.viewport;if(!e.editData.viewportIdsToRender.includes(o.id))return r;var a=e.editData.annotation,i=a.metadata,l=a.annotationUID,c=a.data.handles.points.map((function(e){return o.worldToCanvas(e)})),s=c[0],d=c[1],u=[Math.floor((s[0]+d[0])/2),Math.floor((s[1]+d[1])/2)],v=Math.abs(s[1]-Math.floor((s[1]+d[1])/2)),f="rgb(".concat(i.segmentColor.slice(0,3),")");return o.getRenderingEngine()?(Ac(n,l,"0",u,v,{color:f}),!0):(console.warn("Rendering Engine has been destroyed"),r)})),e}return Z(o)}(ka);Q(Yg,"toolName",void 0),Yg.toolName="CircleScissor";var Jg=Yg;var $g=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"],configuration:{strategies:{FILL_INSIDE:us},defaultStrategy:"FILL_INSIDE",activeStrategy:"FILL_INSIDE"}};return X(this,o),Q(la(e=r.call(this,t,n)),"editData",void 0),Q(la(e),"isDrawing",void 0),Q(la(e),"isHandleOutsideImage",void 0),Q(la(e),"preMouseDownCallback",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=r.canvas,l=(0,Y.getEnabledElement)(o),c=l.viewport,s=l.renderingEngine;e.isDrawing=!0;var d=c.getCamera(),u=d.viewPlaneNormal,v=d.viewUp,f=e.toolGroupId,g=Cs(f);if(!g)throw new Error("No active segmentation detected, create one before using scissors tool");var h=g.segmentationRepresentationUID,p=g.segmentationId,m=g.type,w=xs(p),E=Ds(p),y=Rs(f,h,w),I=Dt(p).representationData[m].volumeId,b=Y.cache.getVolume(I);e.isDrawing=!0;var C={metadata:{viewPlaneNormal:xr(u),viewUp:xr(v),FrameOfReferenceUID:c.getFrameOfReferenceUID(),referencedImageId:"",toolName:e.getToolName(),segmentColor:y},data:{invalidated:!0,handles:{points:[xr(a),xr(a),xr(a),xr(a)],activeHandleIndex:null},cachedStats:{},highlighted:!0}},T=[c.id];return e.editData={annotation:C,segmentation:b,centerCanvas:i,segmentIndex:w,segmentsLocked:E,segmentColor:y,segmentationId:p,toolGroupId:f,viewportIdsToRender:T,handleIndex:3,movingTextBox:!1,newAnnotation:!0,hasMoved:!1},e._activateDraw(o),Ql(o),t.preventDefault(),na(s,T),!0})),Q(la(e),"_dragCallback",(function(t){e.isDrawing=!0;var n=t.detail,r=n.element,o=n.currentPoints.canvas,a=(0,Y.getEnabledElement)(r),i=a.renderingEngine,l=a.viewport.canvasToWorld,c=e.editData,s=c.annotation,d=c.viewportIdsToRender,u=c.centerCanvas,v=s.data,f=Math.abs(o[0]-u[0]),g=Math.abs(o[1]-u[1]),h=Math.sqrt(f*f+g*g),p=[u[0],u[1]+h],m=[u[0],u[1]-h],w=[u[0]-h,u[1]],E=[u[0]+h,u[1]];v.handles.points=[l(p),l(m),l(w),l(E)],s.invalidated=!0,e.editData.hasMoved=!0,na(i,d)})),Q(la(e),"_endCallback",(function(t){var n=t.detail.element,r=e.editData,o=r.annotation,a=r.newAnnotation,i=r.hasMoved,l=r.segmentation,c=r.segmentIndex,s=r.segmentsLocked,d=r.segmentationId,u=o.data,v=o.metadata,f=v.viewPlaneNormal,g=v.viewUp;if(!a||i){o.highlighted=!1,u.handles.activeHandleIndex=null,e._deactivateDraw(n),Xl(n);var h=(0,Y.getEnabledElement)(n),p=h.viewport;if(e.editData=null,e.isDrawing=!1,p instanceof Y.StackViewport)throw new Error("Not implemented yet");var m={points:u.handles.points,volume:l,segmentIndex:c,segmentsLocked:s,segmentationId:d,viewPlaneNormal:f,viewUp:g};e.applyActiveStrategy(h,m)}})),Q(la(e),"_activateDraw",(function(t){t.addEventListener(J.MOUSE_UP,e._endCallback),t.addEventListener(J.MOUSE_DRAG,e._dragCallback),t.addEventListener(J.MOUSE_CLICK,e._endCallback),t.addEventListener(J.TOUCH_END,e._endCallback),t.addEventListener(J.TOUCH_TAP,e._endCallback),t.addEventListener(J.TOUCH_DRAG,e._dragCallback)})),Q(la(e),"_deactivateDraw",(function(t){t.removeEventListener(J.MOUSE_UP,e._endCallback),t.removeEventListener(J.MOUSE_DRAG,e._dragCallback),t.removeEventListener(J.MOUSE_CLICK,e._endCallback),t.removeEventListener(J.TOUCH_END,e._endCallback),t.removeEventListener(J.TOUCH_DRAG,e._dragCallback),t.removeEventListener(J.TOUCH_TAP,e._endCallback)})),Q(la(e),"renderAnnotation",(function(t,n){var r=!1;if(!e.editData)return r;var o=t.viewport;if(!e.editData.viewportIdsToRender.includes(o.id))return r;var a=e.editData.annotation,i=a.metadata,l=a.annotationUID,c=a.data.handles.points.map((function(e){return o.worldToCanvas(e)})),s=c[0],d=c[1],u=[Math.floor((s[0]+d[0])/2),Math.floor((s[1]+d[1])/2)],v=Math.abs(s[1]-Math.floor((s[1]+d[1])/2)),f="rgb(".concat(i.segmentColor.slice(0,3),")");return o.getRenderingEngine()?(Ac(n,l,"0",u,v,{color:f}),!0):(console.warn("Rendering Engine has been destroyed"),r)})),e}return Z(o)}(ka);Q($g,"toolName",void 0),$g.toolName="SphereScissor";var Zg=$g;var Xg=Y.utilities.transformWorldToIndex,Qg=Y.utilities.isEqual,eh=function(e){sa(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=va(t);if(n){var o=va(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return ua(this,e)});function o(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{supportedInteractionTypes:["Mouse","Touch"]};return X(this,o),Q(la(e=r.call(this,t,n)),"preMouseDownCallback",(function(t){var n=t.detail,r=n.currentPoints,o=n.element,a=r.world,i=(0,Y.getEnabledElement)(o).viewport.getCamera().viewPlaneNormal,l=Cs(e.toolGroupId);if(!l)throw new Error("No active segmentation detected, create one before using scissors tool");var c=l.segmentationId,s=l.type,d=xs(c),u=Ds(c),v=Dt(c).representationData[s].volumeId,f=Y.cache.getVolume(v),g=f.dimensions,h=f.direction,p=f.getScalarData(),m=Xg(f.imageData,a),w=e.getFixedDimension(i,h);if(void 0!==w){var E=e.generateHelpers(p,g,m,w),y=E.floodFillGetter,I=E.getLabelValue,b=E.getScalarDataPositionFromPlane,C=E.inPlaneSeedPoint,T=E.fixedDimensionValue;if(!(m[0]<0||m[0]>=g[0]||m[1]<0||m[1]>=g[1]||m[2]<0||m[2]>=g[2])){var _=I(m[0],m[1],m[2]);if(!u.includes(_)){var O=Ad(y,C);return O.flooded.forEach((function(e){var t=b(e[0],e[1]);p[t]=d})),Ct(c,e.getFramesModified(w,T,O)),!0}}}else console.warn("Oblique paint fill not yet supported")})),Q(la(e),"getFramesModified",(function(e,t,n){var r=n.boundaries;if(2===e)return[t];for(var o=1/0,a=-1/0,i=0;i<r.length;i++){var l=r[i][1];l<o&&(o=l),l>a&&(a=l)}for(var c=[],s=o;s<=a;s++)c.push(s);return c})),Q(la(e),"generateHelpers",(function(t,n,r){var o,a,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;switch(i){case 0:o=r[0],a=[r[1],r[2]];break;case 1:o=r[1],a=[r[0],r[2]];break;case 2:o=r[2],a=[r[0],r[1]];break;default:throw new Error("Invalid fixedDimension: ".concat(i))}var l=function(e,t,r){return r*n[1]*n[0]+t*n[0]+e},c=function(e,n,r){return t[l(e,n,r)]},s=e.generateFloodFillGetter(n,i,o,c),d=e.generateGetScalarDataPositionFromPlane(l,i,o);return{getScalarDataPositionFromPlane:d,getLabelValue:c,floodFillGetter:s,inPlaneSeedPoint:a,fixedDimensionValue:o}})),Q(la(e),"generateFloodFillGetter",(function(e,t,n,r){var o;switch(t){case 0:o=function(t,o){if(!(t>=e[1]||t<0||o>=e[2]||o<0))return r(n,t,o)};break;case 1:o=function(t,o){if(!(t>=e[0]||t<0||o>=e[2]||o<0))return r(t,n,o)};break;case 2:o=function(t,o){if(!(t>=e[0]||t<0||o>=e[1]||o<0))return r(t,o,n)};break;default:throw new Error("Invalid fixedDimension: ".concat(t))}return o})),Q(la(e),"generateGetScalarDataPositionFromPlane",(function(e,t,n){var r;switch(t){case 0:r=function(t,r){return e(n,t,r)};break;case 1:r=function(t,r){return e(t,n,r)};break;case 2:r=function(t,r){return e(t,r,n)};break;default:throw new Error("Invalid fixedDimension: ".concat(t))}return r})),e}return Z(o,[{key:"getFixedDimension",value:function(e,t){var n=t.slice(0,3),r=t.slice(3,6),o=t.slice(6,9),a=[Math.abs(e[0]),Math.abs(e[1]),Math.abs(e[2])],i=[Math.abs(n[0]),Math.abs(n[1]),Math.abs(n[2])];if(Qg(a,i))return 0;var l=[Math.abs(r[0]),Math.abs(r[1]),Math.abs(r[2])];if(Qg(a,l))return 1;var c=[Math.abs(o[0]),Math.abs(o[1]),Math.abs(o[2])];return Qg(a,c)?2:void 0}}]),o}(ka);Q(eh,"toolName",void 0),eh.toolName="PaintFill";var th=eh}(),p}()}));
//# sourceMappingURL=index.js.map